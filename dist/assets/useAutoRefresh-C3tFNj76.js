import{r as l}from"./charts-sad3owxz.js";import{u as m,t as p,a as v}from"./index-CxeZ8DrT.js";const R=(f={})=>{const{enabled:c=!0,checkInterval:u=3e4,showNotifications:o=!0}=f,{addToast:h}=m(),t=l.useRef(null),i=l.useRef(!1),d=async()=>{try{{const n=await(await fetch("/index.html",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}})).text(),r=n.match(/<script[^>]*src="[^"]*assets[^"]*\.js"[^>]*>/),a=n.match(/<meta name="version" content="([^"]*)">/);return a?a[1]:r?r[0]:null}}catch(e){return console.warn("Failed to check for app updates:",e),null}},s=async()=>{if(!(i.current||!c)){i.current=!0;try{const e=await d();if(e&&t.current){if(e!==t.current){o&&h(p("App Updated","A new version is available. The page will refresh automatically.")),setTimeout(()=>{window.location.reload()},2e3);return}}else e&&!t.current&&(t.current=e)}catch(e){console.warn("Update check failed:",e)}finally{i.current=!1}}};return l.useEffect(()=>{if(!c)return;d().then(a=>{t.current=a});const e=setInterval(s,u),n=()=>{document.hidden||setTimeout(s,1e3)};document.addEventListener("visibilitychange",n);const r=()=>{setTimeout(s,1e3)};return window.addEventListener("online",r),()=>{clearInterval(e),document.removeEventListener("visibilitychange",n),window.removeEventListener("online",r)}},[c,u,o]),{forceRefresh:()=>{o&&h(v("Refreshing","Updating to the latest version...")),setTimeout(()=>{window.location.reload()},500)},checkForUpdates:s}};export{R as u};
