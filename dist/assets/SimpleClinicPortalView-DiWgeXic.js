import{u as C,t as y,a as w,c as R,j as e,e as N}from"./index-_Qz0svUm.js";import{r as d}from"./charts-sad3owxz.js";import{c as b,q as k,r as D,s as A,p as T,t as E,n as F,P as I}from"./icons-79JrDgB8.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";const U=(j={})=>{const{enabled:p=!0,checkInterval:f=3e4,showNotifications:c=!0}=j,{addToast:u}=C(),i=d.useRef(null),o=d.useRef(!1),x=async()=>{try{{const r=await(await fetch("/index.html",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}})).text(),m=r.match(/<script[^>]*src="[^"]*assets[^"]*\.js"[^>]*>/),h=r.match(/<meta name="version" content="([^"]*)">/);return h?h[1]:m?m[0]:null}}catch(a){return console.warn("Failed to check for app updates:",a),null}},l=async()=>{if(!(o.current||!p)){o.current=!0;try{const a=await x();if(a&&i.current){if(a!==i.current){c&&u(y("App Updated","A new version is available. The page will refresh automatically.")),setTimeout(()=>{window.location.reload()},2e3);return}}else a&&!i.current&&(i.current=a)}catch(a){console.warn("Update check failed:",a)}finally{o.current=!1}}};return d.useEffect(()=>{if(!p)return;x().then(h=>{i.current=h});const a=setInterval(l,f),r=()=>{document.hidden||setTimeout(l,1e3)};document.addEventListener("visibilitychange",r);const m=()=>{setTimeout(l,1e3)};return window.addEventListener("online",m),()=>{clearInterval(a),document.removeEventListener("visibilitychange",r),window.removeEventListener("online",m)}},[p,f,c]),{forceRefresh:()=>{c&&u(w("Refreshing","Updating to the latest version...")),setTimeout(()=>{window.location.reload()},500)},checkForUpdates:l}};function V(){const{isAuthenticated:j,login:p,logout:f}=R();U({enabled:!0,showNotifications:!0});const[c,u]=d.useState(null),[i,o]=d.useState({username:"",password:""}),[x,l]=d.useState([]),[v,a]=d.useState(!0),{addToast:r}=C();d.useEffect(()=>{(async()=>{if(c)try{a(!0);const g=(await N.getByClinicId(c.id)).map(t=>({id:t.id,cardControlNumber:t.cardControlNumber,patientName:t.patientName,patientEmail:t.patientEmail,patientPhone:t.patientPhone,preferredDate:t.preferredDate,preferredTime:t.preferredTime,serviceType:t.serviceType,perkRequested:t.perkRequested||"",status:t.status,adminNotes:t.notes,clinicNotes:"",forwardedAt:t.createdAt,processedAt:void 0}));l(g)}catch(n){console.error("Failed to load appointment data:",n)}finally{a(!1)}})()},[c]);const m=async(s,n)=>{await N.updateStatus(s,"accepted"),l(g=>g.map(t=>t.id===s?{...t,status:"accepted",clinicNotes:n||"",processedAt:new Date().toISOString()}:t)),r(w("Appointment Accepted","Patient will be notified of the confirmation"))},h=async(s,n)=>{await N.updateStatus(s,"declined"),l(g=>g.map(t=>t.id===s?{...t,status:"declined",clinicNotes:n,processedAt:new Date().toISOString()}:t)),r(y("Appointment Declined","Patient will be notified with the reason"))},P=async s=>{s.preventDefault();const n={id:"clinic1",name:"Sample Clinic",code:i.username};i.username&&i.password?(u(n),p("clinic",n),r(w("Welcome",`Logged in to ${n.name}`))):r(y("Login Failed","Invalid clinic code or password"))},S=()=>{f(),u(null),o({username:"",password:""})};if(!j)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Clinic Portal Login"}),e.jsx("p",{className:"text-gray-600",children:"Please authenticate with your clinic credentials"})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:i.username,onChange:s=>o({...i,username:s.target.value}),className:"light-input",placeholder:"Enter clinic username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:i.password,onChange:s=>o({...i,password:s.target.value}),className:"light-input",placeholder:"Enter clinic password",required:!0})]}),e.jsxs("button",{type:"submit",className:"light-button-primary w-full flex items-center justify-center",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Access Clinic Portal"]})]})]})});if(!c||v)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"h-8 w-8 text-blue-600"})}),e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading Clinic Data"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we load your appointment requests..."})]})});const L=x.filter(s=>s.status==="pending");return e.jsxs("div",{className:"min-h-screen bg-gray-50 px-3 sm:px-0",children:[e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center",children:e.jsx(b,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c.name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Clinic Portal - Appointment Management"})]})]}),e.jsxs("button",{onClick:S,className:"light-button-secondary flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),"Appointment Requests"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[L.length," pending requests"]})]}),x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Appointment Requests"}),e.jsx("p",{className:"text-gray-600",children:"No appointment requests have been forwarded to your clinic yet."})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.patientName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.cardControlNumber})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="accepted"?"bg-green-100 text-green-800":s.status==="declined"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Preferred Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.preferredDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Preferred Time"}),e.jsx("p",{className:"font-medium",children:s.preferredTime})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Service"}),e.jsx("p",{className:"font-medium",children:s.serviceType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contact"}),e.jsx("p",{className:"font-medium",children:s.patientPhone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:s.patientEmail})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Perk Requested"}),e.jsx("p",{className:"font-medium",children:s.perkRequested||"None"})]})]}),s.adminNotes&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Admin Notes:"})," ",s.adminNotes]})}),s.clinicNotes&&e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Clinic Notes:"})," ",s.clinicNotes]})}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:async()=>{const n=prompt("Add any notes for the patient (optional):");await m(s.id,n||void 0)},className:"flex items-center space-x-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Accept"})]}),e.jsxs("button",{onClick:async()=>{const n=prompt("Please provide a reason for declining:");n&&await h(s.id,n)},className:"flex items-center space-x-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Decline"})]}),e.jsxs("a",{href:`tel:${s.patientPhone}`,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:"Call Patient"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-4",children:["Forwarded: ",new Date(s.forwardedAt).toLocaleString(),s.processedAt&&e.jsxs("span",{children:[" â€¢ Processed: ",new Date(s.processedAt).toLocaleString()]})]})]},s.id))})]})})]})}export{V as SimpleClinicPortalView};
