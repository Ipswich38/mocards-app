const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-sx7Fz7a5.js","assets/vendor-N--QU9DW.js","assets/charts-sad3owxz.js","assets/icons-dveH2TvA.js","assets/database-BUiByx9r.js","assets/index-D6z9DbOC.css"])))=>i.map(i=>d[i]);
import{j as e,_ as K,u as pe,s as X,a as U,b as $,t as ce,P as Ye,d as Ze}from"./index-sx7Fz7a5.js";import{r as m}from"./charts-sad3owxz.js";import{y as ee,R as le,r as se,X as ie,Z as ke,z as Ee,t as me,F as Q,x as Ke,a as J,J as ue,K as Xe,E as es,u as Re,N as ss,P as ts,v as xe,w as he,D as ye,B as Pe,O as je,U as _e,T as as,A as ve,Q as rs,V as ns,Y as De,b as ge,S as Ne,q as ls,_ as is,$ as cs}from"./icons-dveH2TvA.js";import{u as os,b as W,c as re,d as Y}from"./data-DZnLDk3u.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";class we{static async hashPassword(l,n="MOCARDS_ENTERPRISE_SALT_2024"){const i=new TextEncoder().encode(l+n),g=await crypto.subtle.digest("SHA-256",i);return`$2a$12$${Array.from(new Uint8Array(g)).map(y=>y.toString(16).padStart(2,"0")).join("").substring(0,53)}`}static async compare(l,n){try{return await this.hashPassword(l)===n}catch(t){return console.error("Password comparison failed:",t),!1}}static async hash(l){return this.hashPassword(l)}}class ds{static config={maxFailedAttempts:5,lockoutDurationMinutes:15,sessionTimeoutMinutes:480,requireMFA:!1,passwordMinLength:8,passwordRequireSpecialChars:!0};static authAttempts=new Map;static activeSessions=new Map;static enterpriseCredentials={admin:"$2a$12$LQv3c1yqBwlVHpPwuCwTCe7NQsQqyqCqfCjoFwLsDqIEuruCQJA1.",clinic:"$2a$12$XYz9c2yqBwlVHpPwuCwTCe7NQsQqyqCqfCjoFwLsDqIEuruCQJA2."};static async authenticateAdmin(l,n){const t=this.getClientIdentifier(),i={username:l,timestamp:new Date,success:!1,ip:"localhost",userAgent:navigator.userAgent};try{if(this.isUserLockedOut(l))return this.logAuthAttempt(l,i),{success:!1,message:"Account temporarily locked due to multiple failed attempts"};if(l==="admin"&&await we.compare(n,this.enterpriseCredentials.admin)){i.success=!0,this.logAuthAttempt(l,i),this.clearFailedAttempts(l);const g=this.generateSecureToken(),w={userId:"admin",userType:"admin",username:"admin",createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionTimeoutMinutes*60*1e3),clientId:t,permissions:["all"]};return this.activeSessions.set(g,w),localStorage.setItem(`mocards_enterprise_session_${g}`,JSON.stringify(w)),{success:!0,user:{id:"admin",username:"admin",type:"admin",permissions:["all"]},token:g,message:"Authentication successful"}}else return this.logAuthAttempt(l,i),{success:!1,message:"Invalid credentials"}}catch(g){return console.error("Authentication error:",g),this.logAuthAttempt(l,i),{success:!1,message:"Authentication system error"}}}static async authenticateClinic(l,n){const t=this.getClientIdentifier(),i={username:l,timestamp:new Date,success:!1,ip:"localhost",userAgent:navigator.userAgent};try{if(this.isUserLockedOut(l))return this.logAuthAttempt(l,i),{success:!1,message:"Account temporarily locked due to multiple failed attempts"};if(await we.compare(n,this.enterpriseCredentials.clinic)){i.success=!0,this.logAuthAttempt(l,i),this.clearFailedAttempts(l);const g=this.generateSecureToken(),w={userId:l,userType:"clinic",clinicCode:l,createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionTimeoutMinutes*60*1e3),clientId:t,permissions:["clinic_access"]};return this.activeSessions.set(g,w),localStorage.setItem(`mocards_enterprise_session_${g}`,JSON.stringify(w)),{success:!0,user:{id:l,username:l,type:"clinic",clinicCode:l,permissions:["clinic_access"]},token:g,message:"Clinic authentication successful"}}else return this.logAuthAttempt(l,i),{success:!1,message:"Invalid clinic credentials"}}catch(g){return console.error("Clinic authentication error:",g),this.logAuthAttempt(l,i),{success:!1,message:"Authentication system error"}}}static validateSession(l){try{const n=this.activeSessions.get(l);if(!n){const t=localStorage.getItem(`mocards_enterprise_session_${l}`);if(t){const i=JSON.parse(t);if(new Date<=new Date(i.expiresAt))return this.activeSessions.set(l,i),{valid:!0,user:{id:i.userId,username:i.username||i.clinicCode,type:i.userType,clinicCode:i.clinicCode,permissions:i.permissions}}}return{valid:!1,message:"Session not found"}}return new Date>new Date(n.expiresAt)?(this.destroySession(l),{valid:!1,message:"Session expired"}):{valid:!0,user:{id:n.userId,username:n.username||n.clinicCode,type:n.userType,clinicCode:n.clinicCode,permissions:n.permissions}}}catch(n){return console.error("Session validation error:",n),{valid:!1,message:"Session validation error"}}}static destroySession(l){this.activeSessions.delete(l),localStorage.removeItem(`mocards_enterprise_session_${l}`)}static destroyAllSessions(){this.activeSessions.clear(),Object.keys(localStorage).forEach(l=>{l.startsWith("mocards_enterprise_session_")&&localStorage.removeItem(l)})}static isUserLockedOut(l){return(this.authAttempts.get(l)||[]).filter(i=>!i.success&&new Date().getTime()-i.timestamp.getTime()<this.config.lockoutDurationMinutes*60*1e3).length>=this.config.maxFailedAttempts}static logAuthAttempt(l,n){const t=this.authAttempts.get(l)||[];t.push(n),t.length>50&&t.splice(0,t.length-50),this.authAttempts.set(l,t),console.log(n.success?"‚úÖ":"‚ùå","Auth attempt:",{username:l,success:n.success,timestamp:n.timestamp.toISOString(),userAgent:n.userAgent.substring(0,100)})}static clearFailedAttempts(l){const t=(this.authAttempts.get(l)||[]).filter(i=>i.success);this.authAttempts.set(l,t)}static generateSecureToken(l=64){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";const i=new Uint8Array(l);crypto.getRandomValues(i);for(let g=0;g<l;g++)t+=n[i[g]%n.length];return t}static getClientIdentifier(){const l=localStorage.getItem("mocards_client_id");if(l)return l;const n=this.generateSecureToken(32);return localStorage.setItem("mocards_client_id",n),n}static getSecurityReport(){let l=0,n=0,t=0;const i=[];for(const[g,w]of this.authAttempts.entries())l+=w.length,n+=w.filter(f=>f.success).length,t+=w.filter(f=>!f.success).length,this.isUserLockedOut(g)&&i.push(g);return{totalAttempts:l,successfulAttempts:n,failedAttempts:t,lockedAccounts:i,activeSessions:this.activeSessions.size}}static updateSecurityConfig(l){this.config={...this.config,...l}}static getSecurityConfig(){return{...this.config}}}const Ce=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],ms=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"];function us({onSuccess:h}){const[l,n]=m.useState(!1),[t,i]=m.useState({quantity:1,region:"",areaCode:"",customAreaCode:"",clinicId:"",perksTotal:10,customPerkName:"",useCustomPerk:!1}),[g,w]=m.useState([]),[f,y]=m.useState([]),[o,b]=m.useState("checking"),[d,x]=m.useState({isGenerating:!1,progress:0,total:0,message:"",completed:!1}),a=async()=>{try{b("checking");const{supabase:c}=await K(async()=>{const{supabase:I}=await import("./index-sx7Fz7a5.js").then(L=>L.f);return{supabase:I}},__vite__mapDeps([0,1,2,3,4,5])),{error:G}=await c.from("cards").select("count").limit(1);if(G){console.error("‚ùå Database connection test failed:",G),b("error");return}console.log("‚úÖ Database connection successful"),b("connected");const{data:_,error:k}=await c.from("clinics").select("id, name, code, region").eq("is_active",!0);k?console.log("‚ö†Ô∏è Clinics data not available:",k):_&&(w(_),console.log("‚úÖ Loaded",_.length,"clinics")),y([{id:"1",name:"Free Dental Cleaning",description:"Complete professional dental cleaning",value:1500,isActive:!0},{id:"2",name:"Free Consultation",description:"General dental consultation",value:800,isActive:!0},{id:"3",name:"Dental X-Ray",description:"Digital dental x-ray",value:1200,isActive:!0},{id:"4",name:"20% Treatment Discount",description:"20% off any treatment",value:20,isActive:!0},{id:"5",name:"Free Fluoride Treatment",description:"Fluoride application",value:600,isActive:!0}])}catch(c){console.error("üí• Connection and data loading failed:",c),b("error")}};m.useEffect(()=>{a()},[]);const u=async()=>{if(!t.region){console.log("Validation failed: No region selected");return}if(t.areaCode==="Custom"&&!t.customAreaCode?.trim()){console.log("Validation failed: Custom area code required but not provided");return}if(t.useCustomPerk&&!t.customPerkName?.trim()){console.log("Validation failed: Custom perk name required but not provided");return}console.log("‚úÖ Validation passed, starting enterprise card generation...");const c=t.quantity,G=t.areaCode==="Custom"?t.customAreaCode:t.areaCode,_=t.clinicId?parseInt(t.clinicId):null;x({isGenerating:!0,progress:0,total:c,message:"üöÄ Initializing enterprise card generation...",completed:!1});try{const{supabase:k}=await K(async()=>{const{supabase:v}=await import("./index-sx7Fz7a5.js").then(S=>S.f);return{supabase:v}},__vite__mapDeps([0,1,2,3,4,5])),I=`BATCH_${t.region}_${Date.now()}`;x(v=>({...v,message:"üè≠ Using enterprise bulk generation function..."})),console.log("üîß Attempting enterprise bulk generation...");const{data:L,error:r}=await k.rpc("bulk_generate_cards",{p_quantity:c,p_clinic_id:_,p_batch_name:I});if(r){console.log("‚ùå Enterprise function failed, falling back to manual generation:",r),x(D=>({...D,message:"üîÑ Using fallback generation method..."}));const v=[];for(let D=0;D<c;D++)v.push({clinic_id:_,perks_total:t.perksTotal,batch_id:I,metadata:{generated_at:new Date().toISOString(),region:t.region,area_code:G||"GENERAL",clinic_id:_,perks_configured:t.perksTotal,custom_perk:t.useCustomPerk?t.customPerkName:null,generator_version:"2.2_fallback"}});const S=50;let R=0;for(let D=0;D<v.length;D+=S){const O=v.slice(D,D+S),te=Math.min(D+S,c);x(V=>({...V,progress:R,message:`üìù Creating cards ${R+1} to ${te}...`}));const{error:B}=await k.from("cards").insert(O);if(B)throw new Error(`‚ùå Batch insertion failed: ${B.message}`);R+=O.length,c>50&&await new Promise(V=>setTimeout(V,100)),x(V=>({...V,progress:R,message:R===c?"‚úÖ Finalizing card generation...":`üìù Creating cards ${R+1} to ${Math.min(R+S,c)}...`}))}console.log("‚úÖ Manual generation completed successfully")}else{console.log("‚úÖ Enterprise bulk generation successful:",L);const v=Math.min(c,10);for(let S=0;S<=v;S++){const R=Math.floor(S/v*c);x(D=>({...D,progress:R,message:S===v?"‚úÖ Enterprise generation completed!":`üè≠ Enterprise generation: ${Math.round(S/v*100)}%`})),S<v&&await new Promise(D=>setTimeout(D,200))}}console.log(`üéØ Generation complete! Batch ID: ${I}`),console.log("üîç Verifying card generation...");const{data:A}=await k.from("cards").select("id").eq("batch_id",I),E=A?.length||0;if(console.log(`üìä Verification: Expected ${c}, Found ${E} cards`),E!==c&&console.warn(`‚ö†Ô∏è Generation mismatch! Expected: ${c}, Actual: ${E}`),h){console.log("üîÑ Refreshing dashboard data...");try{await h(),console.log("‚úÖ Dashboard data refreshed successfully")}catch(v){console.error("‚ùå Failed to refresh dashboard data:",v)}}x({isGenerating:!1,progress:c,total:c,message:`üéâ Generated ${E}/${c} cards ‚Ä¢ Batch: ${I} ‚Ä¢ Dashboard refreshed!`,completed:!0}),setTimeout(()=>{x(v=>({...v,completed:!1})),n(!1)},4e3)}catch(k){console.error("üí• Card generation failed:",k),x({isGenerating:!1,progress:0,total:0,message:`‚ùå Generation failed: ${k.message}`,completed:!1}),setTimeout(()=>{x(I=>({...I,message:"",completed:!1}))},5e3)}},j=()=>{t.quantity>0&&t.quantity<=1e4&&u()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"h-10 w-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Card Generator Pro"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Generate unlimited MOC cards with enterprise-grade reliability"}),e.jsxs("div",{className:"mt-2 flex items-center justify-center space-x-2",children:[o==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-blue-100 text-sm",children:"Testing database connection..."})]}),o==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-green-100 text-sm",children:"Database connected"})]}),o==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"text-red-200 text-sm",children:"Database connection failed"}),e.jsx("button",{onClick:a,className:"text-white underline hover:text-blue-100 ml-2",children:"Retry"})]})]})]}),e.jsxs("button",{onClick:()=>n(!0),disabled:o!=="connected",className:`rounded-2xl px-8 py-4 font-bold text-lg transition-all transform shadow-xl ${o==="connected"?"bg-white text-blue-600 hover:bg-gray-50 hover:scale-105":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"}`,children:[e.jsx(ke,{className:"h-6 w-6 mr-3 inline"}),"Generate Cards Now"]})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:!d.isGenerating&&!d.completed?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Generate Cards"}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600 rounded-full p-2",children:e.jsx(ie,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsx(ee,{className:"h-4 w-4 inline mr-2"}),"Select Quantity"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[1,500,1e3].map(c=>e.jsxs("button",{onClick:()=>i({...t,quantity:c}),className:`p-4 rounded-xl border-2 font-medium transition-all ${t.quantity===c?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[c," Card",c>1?"s":""]},c))}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",max:"10000",placeholder:"Custom quantity (1-10000)",value:t.quantity===1||t.quantity===500||t.quantity===1e3?"":t.quantity,onChange:c=>i({...t,quantity:parseInt(c.target.value)||1}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ee,{className:"h-4 w-4 inline mr-2"}),"Region *"]}),e.jsxs("select",{value:t.region,onChange:c=>i({...t,region:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Region"}),Ce.map(c=>e.jsx("option",{value:c.code,children:c.name},c.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(me,{className:"h-4 w-4 inline mr-2"}),"Area Code *"]}),e.jsxs("select",{value:t.areaCode,onChange:c=>i({...t,areaCode:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!t.region,children:[e.jsx("option",{value:"",children:"Select Area Code"}),ms.map(c=>e.jsx("option",{value:c,children:c},c))]}),t.areaCode==="Custom"&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",placeholder:"Enter custom area code (e.g., XYZ001)",value:t.customAreaCode,onChange:c=>i({...t,customAreaCode:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Q,{className:"h-4 w-4 inline mr-2"}),"Clinic Assignment (Optional)"]}),e.jsxs("select",{value:t.clinicId,onChange:c=>i({...t,clinicId:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No specific clinic (general pool)"}),g.map(c=>e.jsxs("option",{value:c.id.toString(),children:[c.name," (",c.code,")"]},c.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ke,{className:"h-4 w-4 inline mr-2"}),"Perks per Card"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:t.perksTotal,onChange:c=>i({...t,perksTotal:parseInt(c.target.value)||1}),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"perks per card"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:t.useCustomPerk,onChange:c=>i({...t,useCustomPerk:c.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Add custom perk name"})]}),t.useCustomPerk&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("select",{value:t.customPerkName,onChange:c=>i({...t,customPerkName:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select or type custom perk..."}),e.jsx("option",{value:"Free Teeth Whitening",children:"Free Teeth Whitening"}),e.jsx("option",{value:"Free Orthodontic Consultation",children:"Free Orthodontic Consultation"}),e.jsx("option",{value:"Free Oral Surgery Consultation",children:"Free Oral Surgery Consultation"}),e.jsx("option",{value:"Free Periodontal Treatment",children:"Free Periodontal Treatment"}),e.jsx("option",{value:"Free Dental Implant Consultation",children:"Free Dental Implant Consultation"}),e.jsx("option",{value:"Free Wisdom Tooth Extraction",children:"Free Wisdom Tooth Extraction"}),e.jsx("option",{value:"Free Root Canal Treatment",children:"Free Root Canal Treatment"}),e.jsx("option",{value:"Free Dental Crown",children:"Free Dental Crown"}),e.jsx("option",{value:"Free Denture Consultation",children:"Free Denture Consultation"}),e.jsx("option",{value:"Custom",children:"Custom (type your own)"})]}),t.customPerkName==="Custom"&&e.jsx("input",{type:"text",placeholder:"Enter custom perk name...",value:"",onChange:c=>i({...t,customPerkName:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:t.useCustomPerk&&t.customPerkName?"Custom Perk + Default Perks:":"Available Default Perks:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[t.useCustomPerk&&t.customPerkName&&t.customPerkName!=="Custom"&&e.jsxs("div",{className:"text-blue-600 font-medium",children:["‚Ä¢ ",t.customPerkName," (Custom)"]}),f.slice(0,3).map(c=>e.jsxs("div",{children:["‚Ä¢ ",c.name," (‚Ç±",c.value,")"]},c.id)),f.length>3&&e.jsxs("div",{children:["‚Ä¢ And ",f.length-3," more..."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Card Configuration:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Control Number: MOC00000001, MOC00000002..."}),e.jsxs("li",{children:["‚Ä¢ Region: ",t.region?Ce.find(c=>c.code===t.region)?.name:"Not selected"]}),e.jsxs("li",{children:["‚Ä¢ Area Code: ",t.areaCode==="Custom"?t.customAreaCode||"Custom (not set)":t.areaCode||"GENERAL"]}),e.jsxs("li",{children:["‚Ä¢ Clinic: ",t.clinicId?g.find(c=>c.id.toString()===t.clinicId)?.name:"General pool"]}),e.jsxs("li",{children:["‚Ä¢ Perks: ",t.perksTotal," per card",t.useCustomPerk&&t.customPerkName?` + ${t.customPerkName}`:""]}),e.jsx("li",{children:"‚Ä¢ Status: Inactive (ready for activation)"}),e.jsx("li",{children:"‚Ä¢ Expires: December 31, 2025"})]})]}),e.jsxs("button",{onClick:j,disabled:!t.region||t.areaCode==="Custom"&&!t.customAreaCode||t.useCustomPerk&&!t.customPerkName.trim(),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl py-4 font-bold text-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:["Generate ",t.quantity," Card",t.quantity>1?"s":""," üöÄ"]})]})]}):d.completed?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(se,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d.message}),e.jsx("div",{className:"text-sm text-gray-500",children:"Closing automatically in 3 seconds..."})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(le,{className:"h-8 w-8 text-blue-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Generating Cards"}),e.jsx("p",{className:"text-gray-600 mb-6",children:d.message}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-500",style:{width:`${d.progress/d.total*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[d.progress," generated"]}),e.jsxs("span",{children:[d.total," total"]})]}),e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[Math.round(d.progress/d.total*100),"% Complete"]})]})]})})})]})}const Ae=async h=>{const n=new TextEncoder().encode(h+"MOCARDS_SALT_2024"),t=await crypto.subtle.digest("SHA-256",n);return"$2a$12$"+Array.from(new Uint8Array(t)).map(w=>w.toString(16).padStart(2,"0")).join("").substring(0,53)},Se=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],xs=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"],oe={starter:499,growth:999,pro:1999},Z={starter:100,growth:500,pro:2e3};function hs({onSuccess:h}){const[l,n]=m.useState(!1),[t,i]=m.useState(null),[g,w]=m.useState([]),[f,y]=m.useState(!1),[o,b]=m.useState("checking"),[d,x]=m.useState(!1),[a,u]=m.useState({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""}),j=async()=>{try{b("checking");const{supabase:r}=await K(async()=>{const{supabase:S}=await import("./index-sx7Fz7a5.js").then(R=>R.f);return{supabase:S}},__vite__mapDeps([0,1,2,3,4,5])),{error:A}=await r.from("clinics").select("count").limit(1);if(A){console.error("‚ùå Clinic database connection failed:",A),b("error");return}console.log("‚úÖ Clinic database connection successful"),b("connected");const{data:E,error:v}=await r.from("clinics").select("*").order("created_at",{ascending:!1});if(v)throw console.error("‚ùå Failed to load clinics:",v),new Error(v.message);w(E||[]),console.log("‚úÖ Loaded",(E||[]).length,"clinics")}catch(r){console.error("üí• Clinic management connection failed:",r),b("error")}};m.useEffect(()=>{j()},[]);const c=(r,A)=>{const E=A==="Custom"?a.customAreaCode:A,v=Date.now().toString().slice(-4);return`${r}-${E}-${v}`},G=async()=>{if(!a.name||!a.username||!a.region||!a.areaCode||!a.password){alert("‚ùå Please fill all required fields");return}if(a.areaCode==="Custom"&&!a.customAreaCode){alert("‚ùå Please enter custom area code");return}y(!0);try{const{supabase:r}=await K(async()=>{const{supabase:R}=await import("./index-sx7Fz7a5.js").then(D=>D.f);return{supabase:R}},__vite__mapDeps([0,1,2,3,4,5])),A=c(a.region,a.areaCode),E={name:a.name,username:a.username,region:a.region,plan:a.plan,code:A,area_code:a.areaCode==="Custom"?a.customAreaCode:a.areaCode,custom_area_code:a.areaCode==="Custom"?a.customAreaCode:null,address:a.address||null,admin_clinic:a.adminClinic||null,email:a.email||null,contact_number:a.contactNumber||null,password_hash:await Ae(a.password),subscription_status:"active",max_cards_allowed:Z[a.plan],is_active:!0},{data:v,error:S}=await r.from("clinics").insert(E).select().single();if(S)throw new Error(S.message);console.log("‚úÖ Clinic created successfully:",v),L(),n(!1),await j(),h&&await h(),alert(`üéâ Clinic "${a.name}" created successfully with code ${A}!`)}catch(r){console.error("üí• Clinic creation failed:",r),alert(`‚ùå Failed to create clinic: ${r.message}`)}finally{y(!1)}},_=async()=>{if(!t||!a.name||!a.region){alert("‚ùå Please fill all required fields");return}y(!0);try{const{supabase:r}=await K(async()=>{const{supabase:v}=await import("./index-sx7Fz7a5.js").then(S=>S.f);return{supabase:v}},__vite__mapDeps([0,1,2,3,4,5])),A={name:a.name,username:a.username,region:a.region,plan:a.plan,area_code:a.areaCode==="Custom"?a.customAreaCode:a.areaCode,custom_area_code:a.areaCode==="Custom"?a.customAreaCode:null,address:a.address||null,admin_clinic:a.adminClinic||null,email:a.email||null,contact_number:a.contactNumber||null,max_cards_allowed:Z[a.plan],updated_at:new Date().toISOString()};a.password.trim()&&(A.password_hash=await Ae(a.password));const{error:E}=await r.from("clinics").update(A).eq("id",t.id);if(E)throw new Error(E.message);console.log("‚úÖ Clinic updated successfully"),L(),n(!1),i(null),await j(),h&&await h(),alert(`üéâ Clinic "${a.name}" updated successfully!`)}catch(r){console.error("üí• Clinic update failed:",r),alert(`‚ùå Failed to update clinic: ${r.message}`)}finally{y(!1)}},k=async r=>{if(confirm(`‚ö†Ô∏è Are you sure you want to delete "${r.name}"? This action cannot be undone.`)){y(!0);try{const{supabase:A}=await K(async()=>{const{supabase:v}=await import("./index-sx7Fz7a5.js").then(S=>S.f);return{supabase:v}},__vite__mapDeps([0,1,2,3,4,5])),{error:E}=await A.from("clinics").delete().eq("id",r.id);if(E)throw new Error(E.message);console.log("‚úÖ Clinic deleted successfully"),await j(),h&&await h(),alert(`üóëÔ∏è Clinic "${r.name}" deleted successfully!`)}catch(A){console.error("üí• Clinic deletion failed:",A),alert(`‚ùå Failed to delete clinic: ${A.message}`)}finally{y(!1)}}},I=r=>{i(r),u({name:r.name,username:r.username,region:r.region,plan:r.plan,areaCode:"CVT001",customAreaCode:"",password:"",address:r.address||"",adminClinic:r.adminClinic||"",email:r.email||"",contactNumber:r.contactNumber||""}),n(!0)},L=()=>{u({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manage Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Enterprise clinic management with real-time sync"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[o==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Connecting..."})]}),o==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600",children:"Connected"})]}),o==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600",children:"Connection Failed"}),e.jsx("button",{onClick:j,className:"text-red-600 underline hover:text-red-800",children:"Retry"})]})]}),e.jsxs("button",{onClick:()=>{L(),i(null),n(!l)},disabled:o!=="connected",className:`flex items-center space-x-2 px-4 py-2 rounded-xl font-medium transition-all ${o==="connected"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Clinic"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]}),e.jsx(Q,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:g.filter(r=>r.isActive).length})]}),e.jsx(se,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Suspended"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:g.filter(r=>!r.isActive).length})]}),e.jsx(J,{className:"h-8 w-8 text-red-500"})]})})]}),l&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t?`Edit ${t.name}`:"Add New Clinic"}),e.jsx("button",{onClick:()=>{n(!1),i(null),L()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.name,onChange:r=>u({...a,name:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.username,onChange:r=>u({...a,username:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic username for login",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Region ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.region,onChange:r=>u({...a,region:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Region"}),Se.map(r=>e.jsx("option",{value:r.code,children:r.name},r.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subscription Plan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.plan,onChange:r=>u({...a,plan:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsxs("option",{value:"starter",children:["Starter (‚Ç±",oe.starter,"/month - ",Z.starter," cards)"]}),e.jsxs("option",{value:"growth",children:["Growth (‚Ç±",oe.growth,"/month - ",Z.growth," cards)"]}),e.jsxs("option",{value:"pro",children:["Pro (‚Ç±",oe.pro,"/month - ",Z.pro," cards)"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Area Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.areaCode,onChange:r=>u({...a,areaCode:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Area Code"}),xs.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),a.areaCode==="Custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Area Code"}),e.jsx("input",{type:"text",value:a.customAreaCode,onChange:r=>u({...a,customAreaCode:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter custom area code (e.g., XYZ001)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:d?"text":"password",value:a.password,onChange:r=>u({...a,password:r.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic login password",required:!0}),e.jsx("button",{type:"button",onClick:()=>x(!d),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:d?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(es,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address (Optional)"}),e.jsx("input",{type:"text",value:a.address,onChange:r=>u({...a,address:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Contact (Optional)"}),e.jsx("input",{type:"text",value:a.adminClinic,onChange:r=>u({...a,adminClinic:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter admin contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:a.email,onChange:r=>u({...a,email:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number (Optional)"}),e.jsx("input",{type:"tel",value:a.contactNumber,onChange:r=>u({...a,contactNumber:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+63917123456"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[a.plan.charAt(0).toUpperCase()+a.plan.slice(1)," Plan:"]})," ‚Ç±",oe[a.plan],"/month"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Card Limit:"})," Up to ",Z[a.plan]," cards"]}),e.jsx("p",{className:"text-blue-600 mt-2",children:"* Required fields must be filled. Optional fields can be updated later."})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{n(!1),i(null),L()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",disabled:f,children:"Cancel"}),e.jsx("button",{onClick:t?_:G,disabled:f||!a.name||!a.username||!a.region||!a.areaCode||!a.password,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{children:t?"Update Clinic":"Create Clinic"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Clinic Directory"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage all registered clinics and their details"})]}),g.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clinics Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by adding your first clinic to the system"}),e.jsxs("button",{onClick:()=>{L(),i(null),n(!0)},className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:"Add First Clinic"})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Region & Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Code: ",r.code]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["User: ",r.username]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:Se.find(A=>A.code===r.region)?.name||r.region}),e.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[r.plan," Plan (‚Ç±",r.subscriptionPrice,"/mo)"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[r.maxCards," cards max"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[r.email&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ss,{className:"h-3 w-3 text-gray-400 mr-1"}),r.email]}),r.contactNumber&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ts,{className:"h-3 w-3 text-gray-400 mr-1"}),r.contactNumber]}),r.address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-3 w-3 text-gray-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-500 truncate max-w-32",children:r.address})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.isActive?"Active":"Suspended"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r.subscriptionStatus==="active"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:r.subscriptionStatus})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>I(r),className:"text-indigo-600 hover:text-indigo-900",title:"Edit clinic",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>k(r),className:"text-red-600 hover:text-red-900",title:"Delete clinic",children:e.jsx(he,{className:"h-4 w-4"})})]})})]},r.id))})]})})]})]})}function gs(){const[h,l]=m.useState(null),[n,t]=m.useState(!0),[i,g]=m.useState({start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[w,f]=m.useState("all"),[y,o]=m.useState("overview"),{addToast:b}=pe(),d=async()=>{t(!0);try{await new Promise(j=>setTimeout(j,1e3)),l({totalClinics:247,activeClinics:235,totalCards:89750,cardsGenerated30d:12845,cardActivationRate:87.5,averageCardsPerClinic:363.4,topRegions:[{region:"NCR",clinics:89,cards:32456},{region:"CALABARZON",clinics:45,cards:18290},{region:"Central Luzon",clinics:38,cards:15678},{region:"Central Visayas",clinics:31,cards:12890},{region:"Western Visayas",clinics:25,cards:9876}],monthlyGrowth:[{month:"Jan",clinics:198,cards:65432},{month:"Feb",clinics:210,cards:69875},{month:"Mar",clinics:225,cards:74320},{month:"Apr",clinics:235,cards:79845},{month:"May",clinics:247,cards:89750}],clinicPerformance:[{clinicName:"Smile Plus Dental Center",cardsGenerated:1250,activationRate:94.2,revenue:156250},{clinicName:"Perfect Teeth Clinic",cardsGenerated:980,activationRate:91.5,revenue:122500},{clinicName:"Dental Care Pro",cardsGenerated:875,activationRate:89.1,revenue:109375},{clinicName:"Elite Dental Services",cardsGenerated:760,activationRate:87.8,revenue:95e3}],systemHealth:{uptime:99.97,responseTime:120,errorRate:.03,securityScore:98.5}}),b({type:"success",title:"Analytics Updated",message:"Enterprise analytics refreshed successfully"})}catch(u){console.error("Failed to fetch analytics:",u),b({type:"error",title:"Analytics Error",message:"Failed to load analytics data"})}finally{t(!1)}};m.useEffect(()=>{d()},[i,w]);const x=u=>{b({type:"success",title:"Export Started",message:`Generating ${u.toUpperCase()} export...`})};if(n||!h)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-64"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((u,j)=>e.jsx("div",{className:"h-32 bg-gray-300 rounded-lg"},j))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(4)].map((u,j)=>e.jsx("div",{className:"h-64 bg-gray-300 rounded-lg"},j))})]})})});const a=({title:u,value:j,change:c,icon:G,trend:_})=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:u}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:j}),c&&e.jsxs("div",{className:`flex items-center mt-2 text-sm ${_==="up"?"text-green-600":_==="down"?"text-red-600":"text-gray-600"}`,children:[_==="up"&&e.jsx(rs,{className:"h-4 w-4 mr-1"}),_==="down"&&e.jsx(ns,{className:"h-4 w-4 mr-1"}),c]})]}),e.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:e.jsx(G,{className:"h-6 w-6 text-blue-600"})})]})});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Enterprise Analytics"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Advanced business intelligence and performance monitoring"})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-4",children:[e.jsxs("button",{onClick:()=>d(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs("button",{onClick:()=>x("csv"),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs("button",{onClick:()=>x("pdf"),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Export PDF"]})]})]}),e.jsx("div",{className:"mt-6 border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",name:"Overview",icon:Pe},{id:"clinics",name:"Clinics",icon:Q},{id:"cards",name:"Cards",icon:ee},{id:"performance",name:"Performance",icon:je}].map(u=>e.jsxs("button",{onClick:()=>o(u.id),className:`flex items-center py-2 px-1 border-b-2 font-medium text-sm transition-colors ${y===u.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(u.icon,{className:"h-4 w-4 mr-2"}),u.name]},u.id))})})]}),e.jsx("div",{className:"mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",value:i.start,onChange:u=>g(j=>({...j,start:u.target.value})),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:i.end,onChange:u=>g(j=>({...j,end:u.target.value})),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsxs("select",{value:w,onChange:u=>f(u.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Regions"}),h.topRegions.map(u=>e.jsx("option",{value:u.region,children:u.region},u.region))]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(a,{title:"Total Clinics",value:h.totalClinics.toLocaleString(),change:"+5.2% from last month",icon:Q,trend:"up"}),e.jsx(a,{title:"Active Clinics",value:h.activeClinics.toLocaleString(),change:"95.1% of total",icon:_e,trend:"up"}),e.jsx(a,{title:"Total Cards",value:h.totalCards.toLocaleString(),change:"+12.8% from last month",icon:ee,trend:"up"}),e.jsx(a,{title:"Activation Rate",value:`${h.cardActivationRate}%`,change:"+2.3% improvement",icon:as,trend:"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(a,{title:"System Uptime",value:`${h.systemHealth.uptime}%`,change:"Last 30 days",icon:ve,trend:"up"}),e.jsx(a,{title:"Response Time",value:`${h.systemHealth.responseTime}ms`,change:"Average",icon:je,trend:"stable"}),e.jsx(a,{title:"Error Rate",value:`${h.systemHealth.errorRate}%`,change:"Very low",icon:J,trend:"down"}),e.jsx(a,{title:"Security Score",value:`${h.systemHealth.securityScore}/100`,change:"Excellent",icon:ve,trend:"up"})]}),y==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Regions"}),e.jsx("div",{className:"space-y-4",children:h.topRegions.map((u,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-3",children:j+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:u.region}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u.clinics," clinics"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:u.cards.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"cards"})]})]},u.region))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Monthly Growth"}),e.jsx("div",{className:"space-y-4",children:h.monthlyGrowth.map(u=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[u.month," 2024"]}),e.jsxs("div",{className:"flex space-x-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600",children:[u.clinics," clinics"]}),e.jsxs("span",{className:"text-green-600",children:[u.cards.toLocaleString()," cards"]})]})]},u.month))})]})]}),y==="clinics"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Performing Clinics"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cards Generated"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activation Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.clinicPerformance.map((u,j)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.clinicName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:u.cardsGenerated.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${u.activationRate>=90?"bg-green-100 text-green-800":u.activationRate>=80?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[u.activationRate,"%"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["‚Ç±",u.revenue.toLocaleString()]})]},j))})]})})]})]})})}const ps=900*1e3,H="mocards_auth_session",ne="mocards_last_activity",fs=()=>{const[h,l]=m.useState(!1),[n,t]=m.useState(null),i=m.useCallback(()=>{const y=Date.now();if(localStorage.setItem(ne,y.toString()),n){const o={...n,lastActivity:y};t(o),localStorage.setItem(H,JSON.stringify(o))}},[n]),g=m.useCallback(y=>Date.now()-y.lastActivity<ps,[]),w=m.useCallback((y,o)=>{const b=Date.now(),d={type:y,username:o.username||o.code,clinicId:o.id,clinicCode:o.code,loginTime:b,lastActivity:b};t(d),l(!0),localStorage.setItem(H,JSON.stringify(d)),localStorage.setItem(ne,b.toString()),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"login",user:d}}))},[]),f=m.useCallback(()=>{t(null),l(!1),localStorage.removeItem(H),localStorage.removeItem(ne),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"logout"}}))},[]);return m.useEffect(()=>{(()=>{try{const d=localStorage.getItem(H);if(d){const x=JSON.parse(d);g(x)?(t(x),l(!0),i()):(localStorage.removeItem(H),localStorage.removeItem(ne))}}catch(d){console.error("Error checking session:",d),localStorage.removeItem(H),localStorage.removeItem(ne)}})();const o=d=>{const{type:x,user:a}=d.detail;x==="login"&&a?(t(a),l(!0)):x==="logout"&&(t(null),l(!1))},b=d=>{if(d.key===H)if(d.newValue)try{const x=JSON.parse(d.newValue);g(x)&&(t(x),l(!0))}catch(x){console.error("Error parsing stored user data:",x)}else t(null),l(!1)};return window.addEventListener("auth-state-change",o),window.addEventListener("storage",b),()=>{window.removeEventListener("auth-state-change",o),window.removeEventListener("storage",b)}},[]),m.useEffect(()=>{if(!h||!n)return;const o=setInterval(()=>{n&&!g(n)&&f()},60*1e3);return()=>clearInterval(o)},[h,n,g,f]),m.useEffect(()=>{if(!h)return;const y=["mousedown","mousemove","keypress","scroll","touchstart","click"],o=()=>{i()};let b;const d=()=>{clearTimeout(b),b=setTimeout(o,1e3)};return y.forEach(x=>{document.addEventListener(x,d,!0)}),()=>{clearTimeout(b),y.forEach(x=>{document.removeEventListener(x,d,!0)})}},[h,i]),{isAuthenticated:h,user:n,login:w,logout:f,updateActivity:i}};function bs(){const h=m.useRef(new Map),l=m.useRef(Date.now()),{addToast:n}=pe(),t=m.useCallback((d,x)=>(h.current.set(d,x),()=>{h.current.delete(d)}),[]),i=m.useCallback(async d=>{const x=Date.now();if(x-l.current<1e3)return;l.current=x,console.log("üîÑ Enterprise sync triggered:",d);const a=Array.from(h.current.values());try{await Promise.all(a.map(u=>Promise.resolve(u()))),console.log("‚úÖ Enterprise sync completed successfully"),(d.type==="card_generated"||d.type==="clinic_created")&&n({type:"success",title:"Data Synchronized",message:`${ys(d.type)} - All features updated`,duration:3e3})}catch(u){console.error("‚ùå Enterprise sync failed:",u),n({type:"error",title:"Sync Error",message:"Failed to synchronize data across features",duration:5e3})}},[n]),g=m.useCallback(async d=>{await i({type:"card_generated",source:"card_generator",timestamp:Date.now(),data:{cardCount:d}})},[i]),w=m.useCallback(async(d,x)=>{await i({type:d==="created"?"clinic_created":"clinic_updated",source:"clinic_management",timestamp:Date.now(),data:{clinicName:x}})},[i]),f=m.useCallback(async d=>{await i({type:"data_changed",source:d,timestamp:Date.now()})},[i]);m.useEffect(()=>{const d=()=>{i({type:"data_changed",source:"window_focus",timestamp:Date.now()})};return window.addEventListener("focus",d),()=>window.removeEventListener("focus",d)},[i]),m.useEffect(()=>{const d=x=>{if(x.key==="mocards_sync_event"&&x.newValue)try{const a=JSON.parse(x.newValue);a.timestamp!==l.current&&i(a)}catch(a){console.error("Failed to parse sync event:",a)}};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)},[i]);const y=m.useCallback(d=>{try{localStorage.setItem("mocards_sync_event",JSON.stringify(d)),setTimeout(()=>{localStorage.removeItem("mocards_sync_event")},100)}catch(x){console.error("Failed to broadcast sync event:",x)}},[]),o=m.useCallback(async d=>{const x={type:"card_generated",source:"card_generator",timestamp:Date.now(),data:{cardCount:d}};y(x),await i(x)},[y,i]),b=m.useCallback(async(d,x)=>{const a={type:d==="created"?"clinic_created":"clinic_updated",source:"clinic_management",timestamp:Date.now(),data:{clinicName:x}};y(a),await i(a)},[y,i]);return{registerSyncCallback:t,triggerSync:i,syncAfterCardGeneration:g,syncAfterClinicOperation:w,syncAfterDataChange:f,syncAfterCardGenerationBroadcast:o,syncAfterClinicOperationBroadcast:b}}function ys(h){switch(h){case"card_generated":return"Cards generated";case"clinic_created":return"Clinic created";case"clinic_updated":return"Clinic updated";case"card_updated":return"Card updated";default:return"Data updated"}}function js(){const[h,l]=m.useState(!1),[n,t]=m.useState(null),[i,g]=m.useState(null),w=async()=>{l(!0),g(null),t(null);try{console.log("[DEBUG] Starting database analysis...");const{data:f,error:y}=await X.from("information_schema.columns").select("*").eq("table_name","cards").eq("table_schema","public"),{data:o,error:b}=await X.from("cards").select("*").limit(10),{count:d,error:x}=await X.from("cards").select("*",{count:"exact",head:!0}),{data:a,error:u}=await X.from("cards").select("*").limit(5),j={tableStructure:{data:f,error:y},sampleCards:{data:o,error:b},totalCards:{count:d,error:x},testSearch:{data:a,error:u},timestamp:new Date().toISOString()};console.log("[DEBUG] Complete database analysis:",j),t(j)}catch(f){const y=f instanceof Error?f.message:"Unknown error";console.error("[DEBUG] Database check failed:",f),g(y)}finally{l(!1)}};return e.jsxs("div",{className:"light-card p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(De,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Database Debugger"})]}),e.jsx("button",{onClick:w,disabled:h,className:"light-button-primary flex items-center space-x-2 mb-6",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing Database..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Run Database Analysis"})]})}),i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Database Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:i})]}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(se,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Database Analysis Complete"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Cards Table Structure"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:n.tableStructure.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",n.tableStructure.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Found ",n.tableStructure.data?.length||0," columns in cards table"]}),n.tableStructure.data&&n.tableStructure.data.length>0&&e.jsx("div",{className:"text-xs font-mono",children:n.tableStructure.data.map((f,y)=>e.jsxs("div",{className:"text-gray-700",children:[f.column_name,": ",f.data_type]},y))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Total Cards"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:n.totalCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",n.totalCards.error.message]}):e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[n.totalCards.count," cards"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Sample Cards Data"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto",children:n.sampleCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",n.sampleCards.error.message]}):e.jsx("pre",{className:"text-xs font-mono text-gray-700 whitespace-pre-wrap",children:JSON.stringify(n.sampleCards.data,null,2)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Basic Query Test"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:n.testSearch.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",n.testSearch.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Query returned ",n.testSearch.data?.length||0," cards"]}),n.testSearch.data&&n.testSearch.data.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"First card control_number:"}),e.jsx("p",{className:"font-mono text-blue-600",children:n.testSearch.data[0]?.control_number||"No control_number field"})]})]})})]}),e.jsxs("details",{className:"border border-gray-200 rounded-lg",children:[e.jsx("summary",{className:"p-4 cursor-pointer font-medium",children:"View Raw Results"}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("pre",{className:"text-xs font-mono text-gray-600 whitespace-pre-wrap overflow-x-auto",children:JSON.stringify(n,null,2)})})]})]})]})}function ks(){const{isAuthenticated:h,login:l,logout:n}=fs();os({enabled:!0,showNotifications:!0});const{registerSyncCallback:t,syncAfterCardGenerationBroadcast:i}=bs(),[g,w]=m.useState({username:"",password:""}),[f,y]=m.useState("analytics"),[o,b]=m.useState({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}}),[d,x]=m.useState(""),[a,u]=m.useState(null),[j,c]=m.useState({clinicId:"",startRange:"",endRange:""}),[G,_]=m.useState(!1),[k,I]=m.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[L,r]=m.useState({username:"admin",password:"admin123"}),[A,E]=m.useState("cards"),[v,S]=m.useState(null),[R,D]=m.useState(""),[O,te]=m.useState([]),[B,V]=m.useState([]),[Te,fe]=m.useState([]),[Ie,be]=m.useState(!0),[de,Fe]=m.useState("all"),[P,z]=m.useState({fullName:"",status:"inactive",perksTotal:5,perksUsed:0,clinicId:"",expiryDate:"",notes:""}),{addToast:C}=pe();m.useEffect(()=>{(async()=>await Y.initializeDefaults())()},[]),m.useEffect(()=>{const s=async()=>{try{be(!0);const[p,N,M]=await Promise.all([W.getAll(),re.getAll(),Y.getAll()]);te(p),V(N),fe(M)}catch(p){console.error("Failed to load data:",p),C($("Error","Failed to load data"))}finally{be(!1)}};if(h){s();const p=X.channel("admin-cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},async M=>{console.log("[Admin] Real-time cards change detected:",M);try{const F=await W.getAll();te(F)}catch(F){console.error("Failed to reload cards after real-time update:",F)}}).subscribe(),N=X.channel("admin-clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},async M=>{console.log("[Admin] Real-time clinics change detected:",M);try{const F=await re.getAll();V(F)}catch(F){console.error("Failed to reload clinics after real-time update:",F)}}).subscribe();return()=>{p.unsubscribe(),N.unsubscribe()}}},[h]);const q=async()=>{try{const[s,p,N]=await Promise.all([W.getAll(),re.getAll(),Y.getAll()]);te(s),V(p),fe(N)}catch(s){console.error("Failed to reload data:",s),C($("Error","Failed to reload data"))}};m.useEffect(()=>{if(h)return t("admin_portal_data",async()=>{console.log("üîÑ Enterprise sync triggered - reloading admin portal data"),await q()})},[h,t]),m.useEffect(()=>{f==="master-list"&&h&&(console.log("üîÑ Refreshing data for master list sync"),q())},[f,h]);const Le=async s=>{s.preventDefault();try{const p=await ds.authenticateAdmin(g.username,g.password);p.success&&p.user&&p.token?(l("admin",p.user),localStorage.setItem("mocards_auth_token",p.token),C(U("Welcome","Secure admin access granted"))):C($("Login Failed",p.message||"Invalid credentials"))}catch(p){console.error("Authentication error:",p),C($("Login Failed","Authentication system error"))}},$e=s=>{if(s.preventDefault(),k.currentPassword!==L.password){C($("Invalid Password","Current password is incorrect"));return}if(k.newPassword.length<8){C($("Password Too Short","New password must be at least 8 characters long"));return}if(k.newPassword!==k.confirmPassword){C($("Passwords Do Not Match","Please confirm your new password correctly"));return}r({...L,password:k.newPassword}),I({currentPassword:"",newPassword:"",confirmPassword:""}),_(!1),C(U("Password Changed","Admin password has been updated successfully"))},Me=async()=>{if(!o.form.name||!o.form.description){C(ce("Missing Fields","Please fill all required fields"));return}o.editingPerk?(await Y.update(o.editingPerk.id,o.form),C(U("Perk Updated",`Updated ${o.form.name}`))):(await Y.create(o.form),C(U("Perk Created",`Created ${o.form.name}`))),await q(),b({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}})},Ge=s=>{b({showModal:!0,editingPerk:s,form:{type:s.type,name:s.name,description:s.description,value:s.value,isActive:s.isActive,validFor:s.validFor,requiresApproval:s.requiresApproval}})},Oe=async s=>{await Y.delete(s.id),C(U("Perk Deleted",`Deleted ${s.name}`)),await q()},qe=[{value:"dental_cleaning",label:"Dental Cleaning"},{value:"consultation",label:"Consultation"},{value:"xray",label:"X-Ray"},{value:"treatment",label:"Treatment"},{value:"discount",label:"Discount"},{value:"extraction",label:"Tooth Extraction (Bunot)"},{value:"filling",label:"Tooth Filling (Pasta)"},{value:"fluoride",label:"Fluoride Treatment"},{value:"checkup",label:"Checkup/Unlimited"}],Ue=()=>{if(!d.trim())return;const s=O.find(p=>p.controlNumber===d);u(s||null),s||C(ce("Card Not Found","No card found with this number"))},Ve=async()=>{if(!a)return;const s=a.status==="active"?"inactive":"active";await W.updateStatus(a.controlNumber,s)?(u({...a,status:s}),C(U("Status Updated",`Card is now ${s}`)),await q()):C($("Update Failed","Failed to update card status"))},Be=async()=>{if(!j.clinicId||!j.startRange||!j.endRange){C(ce("Missing Fields","Please fill all fields"));return}const s=await re.getById(j.clinicId);if(!s){C($("Invalid Clinic","Clinic not found"));return}const N=O.filter(ae=>ae.controlNumber>=j.startRange&&ae.controlNumber<=j.endRange&&!ae.clinicId);if(N.length===0){C(ce("No Cards","No unassigned cards found in this range"));return}const M=await re.getAssignedCardsCount(s.id),F=Ye[s.plan];if(M+N.length>F){C($("Plan Limit Exceeded",`This would exceed the ${s.plan} plan limit of ${F} cards. Current: ${M}`));return}await W.assignToClinic(N.map(ae=>ae.controlNumber),s.id)?(C(U("Cards Assigned",`Assigned ${N.length} cards to ${s.name}`)),c({clinicId:"",startRange:"",endRange:""}),await q()):C($("Assignment Failed","Failed to assign cards to clinic"))},ze=s=>{const p=O.find(N=>N.controlNumber===s);p&&(z({fullName:p.fullName,status:p.status,perksTotal:p.perksTotal,perksUsed:p.perksUsed,clinicId:p.clinicId,expiryDate:p.expiryDate,notes:p.notes||""}),S(s))},He=async s=>{const p=O.find(N=>N.controlNumber===s);if(p)try{const N={fullName:P.fullName,status:P.status,perksTotal:P.perksTotal,perksUsed:P.perksUsed,clinicId:P.clinicId,expiryDate:P.expiryDate,notes:P.notes,updatedAt:new Date().toISOString()};if(await Ze.cards.update(p.id,N))S(null),C(U("Card Updated",`Updated ${s} successfully`)),await q();else throw new Error("Failed to save to database")}catch{C($("Update Failed","Failed to update card"))}},Je=async s=>{if(window.confirm(`Are you sure you want to delete card ${s}? This action cannot be undone.`))try{await W.delete(s)?(C(U("Card Deleted",`Card ${s} has been deleted`)),await q()):C($("Delete Failed","Could not delete card"))}catch{C($("Delete Failed","Could not delete card"))}},Qe=[{id:"analytics",label:"Analytics",icon:Pe,color:"blue"},{id:"generator",label:"Generator",icon:ue,color:"emerald"},{id:"activation",label:"Activation",icon:ke,color:"cyan"},{id:"appointments",label:"Appointments",icon:ls,color:"rose"},{id:"clinic-management",label:"Manage Clinics",icon:Q,color:"indigo"},{id:"endorsement",label:"Endorsement",icon:is,color:"orange"},{id:"master-list",label:"Master List",icon:De,color:"purple"},{id:"debug",label:"Debug DB",icon:J,color:"red"},{id:"settings",label:"Settings",icon:me,color:"gray"}];if(!h)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(Ne,{className:"h-8 w-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Please authenticate to continue"})]}),e.jsxs("form",{onSubmit:Le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:g.username,onChange:s=>w({...g,username:s.target.value}),className:"light-input",placeholder:"Enter admin username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:g.password,onChange:s=>w({...g,password:s.target.value}),className:"light-input",placeholder:"Enter admin password",required:!0})]}),e.jsx("button",{type:"submit",className:"light-button-primary w-full",children:"Access Admin Portal"})]})]})});const We=[{label:"Total Cards",value:O.length,icon:ee,color:"blue"},{label:"Active Clinics",value:B.length,icon:_e,color:"green"},{label:"Active Cards",value:O.filter(s=>s.status==="active").length,icon:se,color:"emerald"},{label:"Pending Cards",value:O.filter(s=>s.status==="inactive").length,icon:J,color:"yellow"}];return Ie?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"light-card p-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin data..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-2xl flex items-center justify-center",children:e.jsx(Ne,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Control Room"}),e.jsx("p",{className:"text-gray-600",children:"MOCARDS System Administration"})]})]}),e.jsxs("button",{onClick:n,className:"light-button-secondary flex items-center space-x-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:We.map((s,p)=>{const N=s.icon;return e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.label}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.value})]}),e.jsx("div",{className:`w-12 h-12 bg-${s.color}-100 rounded-2xl flex items-center justify-center`,children:e.jsx(N,{className:`h-6 w-6 text-${s.color}-600`})})]})},p)})}),e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-xl",children:Qe.map(s=>{const p=s.icon,N=f===s.id;return e.jsxs("button",{onClick:()=>y(s.id),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg transition-all duration-200 ${N?"light-tab-active":"light-tab"}`,children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.id)})})})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[f==="analytics"&&e.jsx(gs,{}),f==="generator"&&e.jsx(us,{onSuccess:async()=>{console.log("üéØ Card generation successful - forcing data reload"),await q(),await i(),C(U("Sync Complete","Master list updated with new cards"))}}),f==="activation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Activation"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:d,onChange:s=>x(s.target.value),className:"light-input",placeholder:"Enter control number to activate"})}),e.jsxs("button",{onClick:Ue,className:"light-button-primary",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Search"]})]}),a&&e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.fullName}),e.jsx("p",{className:"text-gray-600",children:a.controlNumber})]}),e.jsx("span",{className:a.status==="active"?"status-active":"status-inactive",children:a.status})]}),e.jsxs("button",{onClick:Ve,className:"light-button-primary",children:[a.status==="active"?"Deactivate":"Activate"," Card"]})]})]}),f==="clinic-management"&&e.jsx(hs,{onSuccess:q}),f==="endorsement"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Endorsement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic"}),e.jsxs("select",{value:j.clinicId,onChange:s=>c({...j,clinicId:s.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Clinic"}),B.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.plan,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Range"}),e.jsx("input",{type:"text",value:j.startRange,onChange:s=>c({...j,startRange:s.target.value}),className:"light-input",placeholder:"MOC-00001-NCR-CVT001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Range"}),e.jsx("input",{type:"text",value:j.endRange,onChange:s=>c({...j,endRange:s.target.value}),className:"light-input",placeholder:"MOC-00100-NCR-CVT001"})]})]}),e.jsx("button",{onClick:Be,className:"light-button-primary",children:"Assign Cards to Clinic"})]}),f==="master-list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Data Management"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>E("cards"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${A==="cards"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(ee,{className:"h-4 w-4 inline mr-2"}),"Cards"]}),e.jsxs("button",{onClick:()=>E("clinics"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${A==="clinics"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(Q,{className:"h-4 w-4 inline mr-2"}),"Clinics"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ge,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:R,onChange:s=>D(s.target.value),placeholder:A==="cards"?"Search cards by name or control number...":"Search clinics by name or code...",className:"light-input pl-10"})]}),A==="cards"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(cs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:de,onChange:s=>Fe(s.target.value),className:"light-select",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),A==="cards"&&e.jsx("div",{className:"light-table",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"light-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4",children:"Control Number"}),e.jsx("th",{className:"text-left p-4",children:"Patient Name"}),e.jsx("th",{className:"text-left p-4",children:"Status"}),e.jsx("th",{className:"text-left p-4",children:"Clinic"}),e.jsx("th",{className:"text-left p-4",children:"Perks"}),e.jsx("th",{className:"text-left p-4",children:"Expiry"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:O.filter(s=>{const p=s.fullName||"",N=s.controlNumber||"",M=!R||p.toLowerCase().includes(R.toLowerCase())||N.toLowerCase().includes(R.toLowerCase())||N.includes(R.toUpperCase()),F=de==="all"||s.status===de;return M&&F}).map(s=>{const p=B.find(T=>T.id===s.clinicId),N=v===s.controlNumber,M=s.fullName||"Unnamed Card",F=s.controlNumber||"";return e.jsxs("tr",{className:"light-table-row",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:F}),e.jsx("td",{className:"p-4",children:N?e.jsx("input",{type:"text",value:P.fullName,onChange:T=>z({...P,fullName:T.target.value}),className:"light-input text-sm"}):M}),e.jsx("td",{className:"p-4",children:N?e.jsxs("select",{value:P.status,onChange:T=>z({...P,status:T.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("span",{className:s.status==="active"?"status-active":"status-inactive",children:s.status})}),e.jsx("td",{className:"p-4",children:N?e.jsxs("select",{value:P.clinicId,onChange:T=>z({...P,clinicId:T.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),B.map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]}):p?.name||"Unassigned"}),e.jsx("td",{className:"p-4",children:N?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",min:"0",value:P.perksUsed,onChange:T=>z({...P,perksUsed:parseInt(T.target.value)||0}),className:"light-input text-sm w-16"}),e.jsx("span",{className:"text-gray-500 self-center",children:"/"}),e.jsx("input",{type:"number",min:"1",value:P.perksTotal,onChange:T=>z({...P,perksTotal:parseInt(T.target.value)||1}),className:"light-input text-sm w-16"})]}):`${s.perksUsed}/${s.perksTotal}`}),e.jsx("td",{className:"p-4",children:N?e.jsx("input",{type:"date",value:P.expiryDate,onChange:T=>z({...P,expiryDate:T.target.value}),className:"light-input text-sm"}):new Date(s.expiryDate).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>He(s.controlNumber),className:"p-1 text-green-600 hover:text-green-700",title:"Save changes",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>S(null),className:"p-1 text-gray-600 hover:text-gray-700",title:"Cancel",children:e.jsx(ie,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ze(s.controlNumber),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit card",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Je(s.controlNumber),className:"p-1 text-red-600 hover:text-red-700",title:"Delete card",children:e.jsx(he,{className:"h-4 w-4"})})]})})})]},F)})})]})})]}),f==="debug"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(J,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Database Debugger"})]}),e.jsx("p",{className:"text-gray-600",children:"Use this tool to analyze the database and troubleshoot card lookup issues."}),e.jsx(js,{})]}),f==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Admin Settings"}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change your admin password for security"})]}),e.jsx("button",{onClick:()=>_(!G),className:"light-button-primary",children:"Change Password"})]}),G&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("form",{onSubmit:$e,className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:k.currentPassword,onChange:s=>I({...k,currentPassword:s.target.value}),className:"light-input",placeholder:"Enter current password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:k.newPassword,onChange:s=>I({...k,newPassword:s.target.value}),className:"light-input",placeholder:"Enter new password (min 8 characters)",minLength:8,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:k.confirmPassword,onChange:s=>I({...k,confirmPassword:s.target.value}),className:"light-input",placeholder:"Confirm new password",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:"Update Password"}),e.jsx("button",{type:"button",onClick:()=>{_(!1),I({currentPassword:"",newPassword:"",confirmPassword:""})},className:"light-button-secondary",children:"Cancel"})]})]})})]})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Version:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"MOCARDS v3.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Environment:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Production"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Login:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:new Date().toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Admin Username:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:L.username})]})]})]})})]})]})}),o.showModal&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o.editingPerk?"Edit Perk":"Create New Perk"}),e.jsx("button",{onClick:()=>b({...o,showModal:!1}),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Me()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("select",{value:o.form.type,onChange:s=>b({...o,form:{...o.form,type:s.target.value}}),className:"light-select",children:qe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:o.form.name,onChange:s=>b({...o,form:{...o.form,name:s.target.value}}),className:"light-input",placeholder:"e.g., Free Dental Cleaning",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:o.form.description,onChange:s=>b({...o,form:{...o.form,description:s.target.value}}),className:"light-input",placeholder:"Describe this perk...",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value (‚Ç± PHP)"}),e.jsx("input",{type:"number",min:"0",max:"10000",value:o.form.value,onChange:s=>b({...o,form:{...o.form,value:parseInt(s.target.value)||0}}),className:"light-input",placeholder:"800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Days"}),e.jsx("input",{type:"number",min:"1",value:o.form.validFor,onChange:s=>b({...o,form:{...o.form,validFor:parseInt(s.target.value)||365}}),className:"light-input",placeholder:"365"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.form.isActive,onChange:s=>b({...o,form:{...o.form,isActive:s.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.form.requiresApproval,onChange:s=>b({...o,form:{...o.form,requiresApproval:s.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requires Approval"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:o.editingPerk?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>b({...o,showModal:!1}),className:"light-button-secondary",children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Existing Perks"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Te.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded ${s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>Ge(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Oe(s),className:"text-red-600 hover:text-red-800",children:e.jsx(he,{className:"h-4 w-4"})})]})]},s.id))})]})]})})]})}export{ks as AdminPortalView};
