const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CrYyXH0w.js","assets/vendor-N--QU9DW.js","assets/charts-sad3owxz.js","assets/icons-FM-1VMJJ.js","assets/database-BUiByx9r.js","assets/index-DGPaplxv.css"])))=>i.map(i=>d[i]);
import{j as e,_ as J,s as K,u as Oe,b as $,a as M,t as ne,P as Ve,d as qe}from"./index-CrYyXH0w.js";import{r as i}from"./charts-sad3owxz.js";import{y as ie,R as ce,r as Y,X as ae,Z as Ne,z as ve,t as de,F as te,x as Ue,a as Q,J as me,K as Be,E as ze,u as ye,N as We,P as He,v as ue,w as xe,O as Ce,b as he,S as pe,U as Je,q as Ke,Q as Qe,V as Ye}from"./icons-FM-1VMJJ.js";import{u as Ze,b as z,c as ee,d as W}from"./data-7kUCEqqM.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";const be=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],Xe=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"];function es({onSuccess:v}){const[E,o]=i.useState(!1),[a,p]=i.useState({quantity:1,region:"",areaCode:"",customAreaCode:"",clinicId:"",perksTotal:10,customPerkName:"",useCustomPerk:!1}),[f,L]=i.useState([]),[l,d]=i.useState([]),[u,N]=i.useState("checking"),[c,h]=i.useState({isGenerating:!1,progress:0,total:0,message:"",completed:!1}),t=async()=>{try{N("checking");const{supabase:n}=await J(async()=>{const{supabase:F}=await import("./index-CrYyXH0w.js").then(D=>D.f);return{supabase:F}},__vite__mapDeps([0,1,2,3,4,5])),{error:R}=await n.from("cards").select("count").limit(1);if(R){console.error("âŒ Database connection test failed:",R),N("error");return}console.log("âœ… Database connection successful"),N("connected");const{data:_,error:T}=await n.from("clinics").select("id, name, code, region").eq("is_active",!0);T?console.log("âš ï¸ Clinics data not available:",T):_&&(L(_),console.log("âœ… Loaded",_.length,"clinics")),d([{id:"1",name:"Free Dental Cleaning",description:"Complete professional dental cleaning",value:1500,isActive:!0},{id:"2",name:"Free Consultation",description:"General dental consultation",value:800,isActive:!0},{id:"3",name:"Dental X-Ray",description:"Digital dental x-ray",value:1200,isActive:!0},{id:"4",name:"20% Treatment Discount",description:"20% off any treatment",value:20,isActive:!0},{id:"5",name:"Free Fluoride Treatment",description:"Fluoride application",value:600,isActive:!0}])}catch(n){console.error("ğŸ’¥ Connection and data loading failed:",n),N("error")}};i.useEffect(()=>{t()},[]);const C=async()=>{if(!a.region){console.log("Validation failed: No region selected");return}if(a.areaCode==="Custom"&&!a.customAreaCode?.trim()){console.log("Validation failed: Custom area code required but not provided");return}if(a.useCustomPerk&&!a.customPerkName?.trim()){console.log("Validation failed: Custom perk name required but not provided");return}console.log("âœ… Validation passed, starting enterprise card generation...");const n=a.quantity,R=a.areaCode==="Custom"?a.customAreaCode:a.areaCode,_=a.clinicId?parseInt(a.clinicId):null;h({isGenerating:!0,progress:0,total:n,message:"ğŸš€ Initializing enterprise card generation...",completed:!1});try{const{supabase:T}=await J(async()=>{const{supabase:m}=await import("./index-CrYyXH0w.js").then(y=>y.f);return{supabase:m}},__vite__mapDeps([0,1,2,3,4,5])),F=`BATCH_${a.region}_${Date.now()}`;h(m=>({...m,message:"ğŸ­ Using enterprise bulk generation function..."})),console.log("ğŸ”§ Attempting enterprise bulk generation...");const{data:D,error:r}=await T.rpc("bulk_generate_cards",{p_quantity:n,p_clinic_id:_,p_batch_name:F});if(r){console.log("âŒ Enterprise function failed, falling back to manual generation:",r),h(S=>({...S,message:"ğŸ”„ Using fallback generation method..."}));const m=[];for(let S=0;S<n;S++)m.push({clinic_id:_,perks_total:a.perksTotal,batch_id:F,metadata:{generated_at:new Date().toISOString(),region:a.region,area_code:R||"GENERAL",clinic_id:_,perks_configured:a.perksTotal,custom_perk:a.useCustomPerk?a.customPerkName:null,generator_version:"2.2_fallback"}});const y=50;let A=0;for(let S=0;S<m.length;S+=y){const q=m.slice(S,S+y),Z=Math.min(S+y,n);h(O=>({...O,progress:A,message:`ğŸ“ Creating cards ${A+1} to ${Z}...`}));const{error:re}=await T.from("cards").insert(q);if(re)throw new Error(`âŒ Batch insertion failed: ${re.message}`);A+=q.length,n>50&&await new Promise(O=>setTimeout(O,100)),h(O=>({...O,progress:A,message:A===n?"âœ… Finalizing card generation...":`ğŸ“ Creating cards ${A+1} to ${Math.min(A+y,n)}...`}))}console.log("âœ… Manual generation completed successfully")}else{console.log("âœ… Enterprise bulk generation successful:",D);const m=Math.min(n,10);for(let y=0;y<=m;y++){const A=Math.floor(y/m*n);h(S=>({...S,progress:A,message:y===m?"âœ… Enterprise generation completed!":`ğŸ­ Enterprise generation: ${Math.round(y/m*100)}%`})),y<m&&await new Promise(S=>setTimeout(S,200))}}console.log(`ğŸ¯ Generation complete! Batch ID: ${F}`),console.log("ğŸ” Verifying card generation...");const{data:w}=await T.from("cards").select("id").eq("batch_id",F),k=w?.length||0;if(console.log(`ğŸ“Š Verification: Expected ${n}, Found ${k} cards`),k!==n&&console.warn(`âš ï¸ Generation mismatch! Expected: ${n}, Actual: ${k}`),v){console.log("ğŸ”„ Refreshing dashboard data...");try{await v(),console.log("âœ… Dashboard data refreshed successfully")}catch(m){console.error("âŒ Failed to refresh dashboard data:",m)}}h({isGenerating:!1,progress:n,total:n,message:`ğŸ‰ Generated ${k}/${n} cards â€¢ Batch: ${F} â€¢ Dashboard refreshed!`,completed:!0}),setTimeout(()=>{h(m=>({...m,completed:!1})),o(!1)},4e3)}catch(T){console.error("ğŸ’¥ Card generation failed:",T),h({isGenerating:!1,progress:0,total:0,message:`âŒ Generation failed: ${T.message}`,completed:!1}),setTimeout(()=>{h(F=>({...F,message:"",completed:!1}))},5e3)}},I=()=>{a.quantity>0&&a.quantity<=1e4&&C()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"h-10 w-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Card Generator Pro"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Generate unlimited MOC cards with enterprise-grade reliability"}),e.jsxs("div",{className:"mt-2 flex items-center justify-center space-x-2",children:[u==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-blue-100 text-sm",children:"Testing database connection..."})]}),u==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"text-green-100 text-sm",children:"Database connected"})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-red-200 text-sm",children:"Database connection failed"}),e.jsx("button",{onClick:t,className:"text-white underline hover:text-blue-100 ml-2",children:"Retry"})]})]})]}),e.jsxs("button",{onClick:()=>o(!0),disabled:u!=="connected",className:`rounded-2xl px-8 py-4 font-bold text-lg transition-all transform shadow-xl ${u==="connected"?"bg-white text-blue-600 hover:bg-gray-50 hover:scale-105":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"}`,children:[e.jsx(Ne,{className:"h-6 w-6 mr-3 inline"}),"Generate Cards Now"]})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:!c.isGenerating&&!c.completed?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Generate Cards"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600 rounded-full p-2",children:e.jsx(ae,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-2"}),"Select Quantity"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[1,500,1e3].map(n=>e.jsxs("button",{onClick:()=>p({...a,quantity:n}),className:`p-4 rounded-xl border-2 font-medium transition-all ${a.quantity===n?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[n," Card",n>1?"s":""]},n))}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",max:"10000",placeholder:"Custom quantity (1-10000)",value:a.quantity===1||a.quantity===500||a.quantity===1e3?"":a.quantity,onChange:n=>p({...a,quantity:parseInt(n.target.value)||1}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"h-4 w-4 inline mr-2"}),"Region *"]}),e.jsxs("select",{value:a.region,onChange:n=>p({...a,region:n.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Region"}),be.map(n=>e.jsx("option",{value:n.code,children:n.name},n.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(de,{className:"h-4 w-4 inline mr-2"}),"Area Code *"]}),e.jsxs("select",{value:a.areaCode,onChange:n=>p({...a,areaCode:n.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!a.region,children:[e.jsx("option",{value:"",children:"Select Area Code"}),Xe.map(n=>e.jsx("option",{value:n,children:n},n))]}),a.areaCode==="Custom"&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",placeholder:"Enter custom area code (e.g., XYZ001)",value:a.customAreaCode,onChange:n=>p({...a,customAreaCode:n.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(te,{className:"h-4 w-4 inline mr-2"}),"Clinic Assignment (Optional)"]}),e.jsxs("select",{value:a.clinicId,onChange:n=>p({...a,clinicId:n.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No specific clinic (general pool)"}),f.map(n=>e.jsxs("option",{value:n.id.toString(),children:[n.name," (",n.code,")"]},n.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ue,{className:"h-4 w-4 inline mr-2"}),"Perks per Card"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:a.perksTotal,onChange:n=>p({...a,perksTotal:parseInt(n.target.value)||1}),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"perks per card"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.useCustomPerk,onChange:n=>p({...a,useCustomPerk:n.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Add custom perk name"})]}),a.useCustomPerk&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("select",{value:a.customPerkName,onChange:n=>p({...a,customPerkName:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select or type custom perk..."}),e.jsx("option",{value:"Free Teeth Whitening",children:"Free Teeth Whitening"}),e.jsx("option",{value:"Free Orthodontic Consultation",children:"Free Orthodontic Consultation"}),e.jsx("option",{value:"Free Oral Surgery Consultation",children:"Free Oral Surgery Consultation"}),e.jsx("option",{value:"Free Periodontal Treatment",children:"Free Periodontal Treatment"}),e.jsx("option",{value:"Free Dental Implant Consultation",children:"Free Dental Implant Consultation"}),e.jsx("option",{value:"Free Wisdom Tooth Extraction",children:"Free Wisdom Tooth Extraction"}),e.jsx("option",{value:"Free Root Canal Treatment",children:"Free Root Canal Treatment"}),e.jsx("option",{value:"Free Dental Crown",children:"Free Dental Crown"}),e.jsx("option",{value:"Free Denture Consultation",children:"Free Denture Consultation"}),e.jsx("option",{value:"Custom",children:"Custom (type your own)"})]}),a.customPerkName==="Custom"&&e.jsx("input",{type:"text",placeholder:"Enter custom perk name...",value:"",onChange:n=>p({...a,customPerkName:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:a.useCustomPerk&&a.customPerkName?"Custom Perk + Default Perks:":"Available Default Perks:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[a.useCustomPerk&&a.customPerkName&&a.customPerkName!=="Custom"&&e.jsxs("div",{className:"text-blue-600 font-medium",children:["â€¢ ",a.customPerkName," (Custom)"]}),l.slice(0,3).map(n=>e.jsxs("div",{children:["â€¢ ",n.name," (â‚±",n.value,")"]},n.id)),l.length>3&&e.jsxs("div",{children:["â€¢ And ",l.length-3," more..."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Card Configuration:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Control Number: MOC00000001, MOC00000002..."}),e.jsxs("li",{children:["â€¢ Region: ",a.region?be.find(n=>n.code===a.region)?.name:"Not selected"]}),e.jsxs("li",{children:["â€¢ Area Code: ",a.areaCode==="Custom"?a.customAreaCode||"Custom (not set)":a.areaCode||"GENERAL"]}),e.jsxs("li",{children:["â€¢ Clinic: ",a.clinicId?f.find(n=>n.id.toString()===a.clinicId)?.name:"General pool"]}),e.jsxs("li",{children:["â€¢ Perks: ",a.perksTotal," per card",a.useCustomPerk&&a.customPerkName?` + ${a.customPerkName}`:""]}),e.jsx("li",{children:"â€¢ Status: Inactive (ready for activation)"}),e.jsx("li",{children:"â€¢ Expires: December 31, 2025"})]})]}),e.jsxs("button",{onClick:I,disabled:!a.region||a.areaCode==="Custom"&&!a.customAreaCode||a.useCustomPerk&&!a.customPerkName.trim(),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl py-4 font-bold text-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:["Generate ",a.quantity," Card",a.quantity>1?"s":""," ğŸš€"]})]})]}):c.completed?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(Y,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c.message}),e.jsx("div",{className:"text-sm text-gray-500",children:"Closing automatically in 3 seconds..."})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(ce,{className:"h-8 w-8 text-blue-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Generating Cards"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c.message}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-500",style:{width:`${c.progress/c.total*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[c.progress," generated"]}),e.jsxs("span",{children:[c.total," total"]})]}),e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[Math.round(c.progress/c.total*100),"% Complete"]})]})]})})})]})}const fe=async v=>{const o=new TextEncoder().encode(v+"MOCARDS_SALT_2024"),a=await crypto.subtle.digest("SHA-256",o);return"$2a$12$"+Array.from(new Uint8Array(a)).map(L=>L.toString(16).padStart(2,"0")).join("").substring(0,53)},je=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],ss=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"],le={starter:499,growth:999,pro:1999},H={starter:100,growth:500,pro:2e3};function as({onSuccess:v}){const[E,o]=i.useState(!1),[a,p]=i.useState(null),[f,L]=i.useState([]),[l,d]=i.useState(!1),[u,N]=i.useState("checking"),[c,h]=i.useState(!1),[t,C]=i.useState({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""}),I=async()=>{try{N("checking");const{supabase:r}=await J(async()=>{const{supabase:y}=await import("./index-CrYyXH0w.js").then(A=>A.f);return{supabase:y}},__vite__mapDeps([0,1,2,3,4,5])),{error:w}=await r.from("clinics").select("count").limit(1);if(w){console.error("âŒ Clinic database connection failed:",w),N("error");return}console.log("âœ… Clinic database connection successful"),N("connected");const{data:k,error:m}=await r.from("clinics").select("*").order("created_at",{ascending:!1});if(m)throw console.error("âŒ Failed to load clinics:",m),new Error(m.message);L(k||[]),console.log("âœ… Loaded",(k||[]).length,"clinics")}catch(r){console.error("ğŸ’¥ Clinic management connection failed:",r),N("error")}};i.useEffect(()=>{I()},[]);const n=(r,w)=>{const k=w==="Custom"?t.customAreaCode:w,m=Date.now().toString().slice(-4);return`${r}-${k}-${m}`},R=async()=>{if(!t.name||!t.username||!t.region||!t.areaCode||!t.password){alert("âŒ Please fill all required fields");return}if(t.areaCode==="Custom"&&!t.customAreaCode){alert("âŒ Please enter custom area code");return}d(!0);try{const{supabase:r}=await J(async()=>{const{supabase:A}=await import("./index-CrYyXH0w.js").then(S=>S.f);return{supabase:A}},__vite__mapDeps([0,1,2,3,4,5])),w=n(t.region,t.areaCode),k={name:t.name,username:t.username,region:t.region,plan:t.plan,code:w,area_code:t.areaCode==="Custom"?t.customAreaCode:t.areaCode,custom_area_code:t.areaCode==="Custom"?t.customAreaCode:null,address:t.address||null,admin_clinic:t.adminClinic||null,email:t.email||null,contact_number:t.contactNumber||null,password_hash:await fe(t.password),subscription_status:"active",max_cards_allowed:H[t.plan],is_active:!0},{data:m,error:y}=await r.from("clinics").insert(k).select().single();if(y)throw new Error(y.message);console.log("âœ… Clinic created successfully:",m),D(),o(!1),await I(),v&&await v(),alert(`ğŸ‰ Clinic "${t.name}" created successfully with code ${w}!`)}catch(r){console.error("ğŸ’¥ Clinic creation failed:",r),alert(`âŒ Failed to create clinic: ${r.message}`)}finally{d(!1)}},_=async()=>{if(!a||!t.name||!t.region){alert("âŒ Please fill all required fields");return}d(!0);try{const{supabase:r}=await J(async()=>{const{supabase:m}=await import("./index-CrYyXH0w.js").then(y=>y.f);return{supabase:m}},__vite__mapDeps([0,1,2,3,4,5])),w={name:t.name,username:t.username,region:t.region,plan:t.plan,area_code:t.areaCode==="Custom"?t.customAreaCode:t.areaCode,custom_area_code:t.areaCode==="Custom"?t.customAreaCode:null,address:t.address||null,admin_clinic:t.adminClinic||null,email:t.email||null,contact_number:t.contactNumber||null,max_cards_allowed:H[t.plan],updated_at:new Date().toISOString()};t.password.trim()&&(w.password_hash=await fe(t.password));const{error:k}=await r.from("clinics").update(w).eq("id",a.id);if(k)throw new Error(k.message);console.log("âœ… Clinic updated successfully"),D(),o(!1),p(null),await I(),v&&await v(),alert(`ğŸ‰ Clinic "${t.name}" updated successfully!`)}catch(r){console.error("ğŸ’¥ Clinic update failed:",r),alert(`âŒ Failed to update clinic: ${r.message}`)}finally{d(!1)}},T=async r=>{if(confirm(`âš ï¸ Are you sure you want to delete "${r.name}"? This action cannot be undone.`)){d(!0);try{const{supabase:w}=await J(async()=>{const{supabase:m}=await import("./index-CrYyXH0w.js").then(y=>y.f);return{supabase:m}},__vite__mapDeps([0,1,2,3,4,5])),{error:k}=await w.from("clinics").delete().eq("id",r.id);if(k)throw new Error(k.message);console.log("âœ… Clinic deleted successfully"),await I(),v&&await v(),alert(`ğŸ—‘ï¸ Clinic "${r.name}" deleted successfully!`)}catch(w){console.error("ğŸ’¥ Clinic deletion failed:",w),alert(`âŒ Failed to delete clinic: ${w.message}`)}finally{d(!1)}}},F=r=>{p(r),C({name:r.name,username:r.username,region:r.region,plan:r.plan,areaCode:"CVT001",customAreaCode:"",password:"",address:r.address||"",adminClinic:r.adminClinic||"",email:r.email||"",contactNumber:r.contactNumber||""}),o(!0)},D=()=>{C({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manage Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Enterprise clinic management with real-time sync"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[u==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Connecting..."})]}),u==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600",children:"Connected"})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600",children:"Connection Failed"}),e.jsx("button",{onClick:I,className:"text-red-600 underline hover:text-red-800",children:"Retry"})]})]}),e.jsxs("button",{onClick:()=>{D(),p(null),o(!E)},disabled:u!=="connected",className:`flex items-center space-x-2 px-4 py-2 rounded-xl font-medium transition-all ${u==="connected"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Clinic"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.length})]}),e.jsx(te,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.filter(r=>r.isActive).length})]}),e.jsx(Y,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Suspended"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.filter(r=>!r.isActive).length})]}),e.jsx(Q,{className:"h-8 w-8 text-red-500"})]})})]}),E&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?`Edit ${a.name}`:"Add New Clinic"}),e.jsx("button",{onClick:()=>{o(!1),p(null),D()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ae,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.name,onChange:r=>C({...t,name:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.username,onChange:r=>C({...t,username:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic username for login",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Region ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.region,onChange:r=>C({...t,region:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Region"}),je.map(r=>e.jsx("option",{value:r.code,children:r.name},r.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subscription Plan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.plan,onChange:r=>C({...t,plan:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsxs("option",{value:"starter",children:["Starter (â‚±",le.starter,"/month - ",H.starter," cards)"]}),e.jsxs("option",{value:"growth",children:["Growth (â‚±",le.growth,"/month - ",H.growth," cards)"]}),e.jsxs("option",{value:"pro",children:["Pro (â‚±",le.pro,"/month - ",H.pro," cards)"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Area Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.areaCode,onChange:r=>C({...t,areaCode:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Area Code"}),ss.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),t.areaCode==="Custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Area Code"}),e.jsx("input",{type:"text",value:t.customAreaCode,onChange:r=>C({...t,customAreaCode:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter custom area code (e.g., XYZ001)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c?"text":"password",value:t.password,onChange:r=>C({...t,password:r.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic login password",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:c?e.jsx(Be,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address (Optional)"}),e.jsx("input",{type:"text",value:t.address,onChange:r=>C({...t,address:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Contact (Optional)"}),e.jsx("input",{type:"text",value:t.adminClinic,onChange:r=>C({...t,adminClinic:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter admin contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:t.email,onChange:r=>C({...t,email:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number (Optional)"}),e.jsx("input",{type:"tel",value:t.contactNumber,onChange:r=>C({...t,contactNumber:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+63917123456"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[t.plan.charAt(0).toUpperCase()+t.plan.slice(1)," Plan:"]})," â‚±",le[t.plan],"/month"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Card Limit:"})," Up to ",H[t.plan]," cards"]}),e.jsx("p",{className:"text-blue-600 mt-2",children:"* Required fields must be filled. Optional fields can be updated later."})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{o(!1),p(null),D()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",disabled:l,children:"Cancel"}),e.jsx("button",{onClick:a?_:R,disabled:l||!t.name||!t.username||!t.region||!t.areaCode||!t.password,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:a?"Update Clinic":"Create Clinic"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Clinic Directory"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage all registered clinics and their details"})]}),f.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(te,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clinics Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by adding your first clinic to the system"}),e.jsxs("button",{onClick:()=>{D(),p(null),o(!0)},className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Add First Clinic"})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Region & Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Code: ",r.code]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["User: ",r.username]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:je.find(w=>w.code===r.region)?.name||r.region}),e.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[r.plan," Plan (â‚±",r.subscriptionPrice,"/mo)"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[r.maxCards," cards max"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[r.email&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(We,{className:"h-3 w-3 text-gray-400 mr-1"}),r.email]}),r.contactNumber&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(He,{className:"h-3 w-3 text-gray-400 mr-1"}),r.contactNumber]}),r.address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 text-gray-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-500 truncate max-w-32",children:r.address})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.isActive?"Active":"Suspended"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r.subscriptionStatus==="active"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:r.subscriptionStatus})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>F(r),className:"text-indigo-600 hover:text-indigo-900",title:"Edit clinic",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>T(r),className:"text-red-600 hover:text-red-900",title:"Delete clinic",children:e.jsx(xe,{className:"h-4 w-4"})})]})})]},r.id))})]})})]})]})}const ts=900*1e3,B="mocards_auth_session",se="mocards_last_activity",rs=()=>{const[v,E]=i.useState(!1),[o,a]=i.useState(null),p=i.useCallback(()=>{const d=Date.now();if(localStorage.setItem(se,d.toString()),o){const u={...o,lastActivity:d};a(u),localStorage.setItem(B,JSON.stringify(u))}},[o]),f=i.useCallback(d=>Date.now()-d.lastActivity<ts,[]),L=i.useCallback((d,u)=>{const N=Date.now(),c={type:d,username:u.username||u.code,clinicId:u.id,clinicCode:u.code,loginTime:N,lastActivity:N};a(c),E(!0),localStorage.setItem(B,JSON.stringify(c)),localStorage.setItem(se,N.toString()),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"login",user:c}}))},[]),l=i.useCallback(()=>{a(null),E(!1),localStorage.removeItem(B),localStorage.removeItem(se),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"logout"}}))},[]);return i.useEffect(()=>{(()=>{try{const c=localStorage.getItem(B);if(c){const h=JSON.parse(c);f(h)?(a(h),E(!0),p()):(localStorage.removeItem(B),localStorage.removeItem(se))}}catch(c){console.error("Error checking session:",c),localStorage.removeItem(B),localStorage.removeItem(se)}})();const u=c=>{const{type:h,user:t}=c.detail;h==="login"&&t?(a(t),E(!0)):h==="logout"&&(a(null),E(!1))},N=c=>{if(c.key===B)if(c.newValue)try{const h=JSON.parse(c.newValue);f(h)&&(a(h),E(!0))}catch(h){console.error("Error parsing stored user data:",h)}else a(null),E(!1)};return window.addEventListener("auth-state-change",u),window.addEventListener("storage",N),()=>{window.removeEventListener("auth-state-change",u),window.removeEventListener("storage",N)}},[]),i.useEffect(()=>{if(!v||!o)return;const u=setInterval(()=>{o&&!f(o)&&l()},60*1e3);return()=>clearInterval(u)},[v,o,f,l]),i.useEffect(()=>{if(!v)return;const d=["mousedown","mousemove","keypress","scroll","touchstart","click"],u=()=>{p()};let N;const c=()=>{clearTimeout(N),N=setTimeout(u,1e3)};return d.forEach(h=>{document.addEventListener(h,c,!0)}),()=>{clearTimeout(N),d.forEach(h=>{document.removeEventListener(h,c,!0)})}},[v,p]),{isAuthenticated:v,user:o,login:L,logout:l,updateActivity:p}};function ns(){const[v,E]=i.useState(!1),[o,a]=i.useState(null),[p,f]=i.useState(null),L=async()=>{E(!0),f(null),a(null);try{console.log("[DEBUG] Starting database analysis...");const{data:l,error:d}=await K.from("information_schema.columns").select("*").eq("table_name","cards").eq("table_schema","public"),{data:u,error:N}=await K.from("cards").select("*").limit(10),{count:c,error:h}=await K.from("cards").select("*",{count:"exact",head:!0}),{data:t,error:C}=await K.from("cards").select("*").limit(5),I={tableStructure:{data:l,error:d},sampleCards:{data:u,error:N},totalCards:{count:c,error:h},testSearch:{data:t,error:C},timestamp:new Date().toISOString()};console.log("[DEBUG] Complete database analysis:",I),a(I)}catch(l){const d=l instanceof Error?l.message:"Unknown error";console.error("[DEBUG] Database check failed:",l),f(d)}finally{E(!1)}};return e.jsxs("div",{className:"light-card p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(Ce,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Database Debugger"})]}),e.jsx("button",{onClick:L,disabled:v,className:"light-button-primary flex items-center space-x-2 mb-6",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing Database..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Run Database Analysis"})]})}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Database Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:p})]}),o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(Y,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Database Analysis Complete"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Cards Table Structure"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:o.tableStructure.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",o.tableStructure.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Found ",o.tableStructure.data?.length||0," columns in cards table"]}),o.tableStructure.data&&o.tableStructure.data.length>0&&e.jsx("div",{className:"text-xs font-mono",children:o.tableStructure.data.map((l,d)=>e.jsxs("div",{className:"text-gray-700",children:[l.column_name,": ",l.data_type]},d))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Total Cards"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:o.totalCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",o.totalCards.error.message]}):e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[o.totalCards.count," cards"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Sample Cards Data"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto",children:o.sampleCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",o.sampleCards.error.message]}):e.jsx("pre",{className:"text-xs font-mono text-gray-700 whitespace-pre-wrap",children:JSON.stringify(o.sampleCards.data,null,2)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Basic Query Test"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:o.testSearch.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",o.testSearch.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Query returned ",o.testSearch.data?.length||0," cards"]}),o.testSearch.data&&o.testSearch.data.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"First card control_number:"}),e.jsx("p",{className:"font-mono text-blue-600",children:o.testSearch.data[0]?.control_number||"No control_number field"})]})]})})]}),e.jsxs("details",{className:"border border-gray-200 rounded-lg",children:[e.jsx("summary",{className:"p-4 cursor-pointer font-medium",children:"View Raw Results"}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("pre",{className:"text-xs font-mono text-gray-600 whitespace-pre-wrap overflow-x-auto",children:JSON.stringify(o,null,2)})})]})]})]})}function xs(){const{isAuthenticated:v,login:E,logout:o}=rs();Ze({enabled:!0,showNotifications:!0});const[a,p]=i.useState({username:"",password:""}),[f,L]=i.useState("generator"),[l,d]=i.useState({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}}),[u,N]=i.useState(""),[c,h]=i.useState(null),[t,C]=i.useState({clinicId:"",startRange:"",endRange:""}),[I,n]=i.useState(!1),[R,_]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[T,F]=i.useState({username:"admin",password:"admin123"}),[D,r]=i.useState("cards"),[w,k]=i.useState(null),[m,y]=i.useState(""),[A,S]=i.useState([]),[q,Z]=i.useState([]),[re,O]=i.useState([]),[we,ge]=i.useState(!0),[oe,Ae]=i.useState("all"),[P,U]=i.useState({fullName:"",status:"inactive",perksTotal:5,perksUsed:0,clinicId:"",expiryDate:"",notes:""}),{addToast:j}=Oe();i.useEffect(()=>{(async()=>await W.initializeDefaults())()},[]),i.useEffect(()=>{const s=async()=>{try{ge(!0);const[x,g,b]=await Promise.all([z.getAll(),ee.getAll(),W.getAll()]);S(x),Z(g),O(b)}catch(x){console.error("Failed to load data:",x),j($("Error","Failed to load data"))}finally{ge(!1)}};if(v){s();const x=K.channel("admin-cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},async b=>{console.log("[Admin] Real-time cards change detected:",b);try{const G=await z.getAll();S(G)}catch(G){console.error("Failed to reload cards after real-time update:",G)}}).subscribe(),g=K.channel("admin-clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},async b=>{console.log("[Admin] Real-time clinics change detected:",b);try{const G=await ee.getAll();Z(G)}catch(G){console.error("Failed to reload clinics after real-time update:",G)}}).subscribe();return()=>{x.unsubscribe(),g.unsubscribe()}}},[v]);const V=async()=>{try{const[s,x,g]=await Promise.all([z.getAll(),ee.getAll(),W.getAll()]);S(s),Z(x),O(g)}catch(s){console.error("Failed to reload data:",s),j($("Error","Failed to reload data"))}},ke=s=>{s.preventDefault(),a.username==="admin"&&a.password==="admin123"?(E("admin",{username:a.username}),j(M("Welcome","Admin access granted"))):j($("Login Failed","Invalid credentials"))},Se=s=>{if(s.preventDefault(),R.currentPassword!==T.password){j($("Invalid Password","Current password is incorrect"));return}if(R.newPassword.length<8){j($("Password Too Short","New password must be at least 8 characters long"));return}if(R.newPassword!==R.confirmPassword){j($("Passwords Do Not Match","Please confirm your new password correctly"));return}F({...T,password:R.newPassword}),_({currentPassword:"",newPassword:"",confirmPassword:""}),n(!1),j(M("Password Changed","Admin password has been updated successfully"))},Pe=async()=>{if(!l.form.name||!l.form.description){j(ne("Missing Fields","Please fill all required fields"));return}l.editingPerk?(await W.update(l.editingPerk.id,l.form),j(M("Perk Updated",`Updated ${l.form.name}`))):(await W.create(l.form),j(M("Perk Created",`Created ${l.form.name}`))),await V(),d({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}})},Ee=s=>{d({showModal:!0,editingPerk:s,form:{type:s.type,name:s.name,description:s.description,value:s.value,isActive:s.isActive,validFor:s.validFor,requiresApproval:s.requiresApproval}})},Re=async s=>{await W.delete(s.id),j(M("Perk Deleted",`Deleted ${s.name}`)),await V()},De=[{value:"dental_cleaning",label:"Dental Cleaning"},{value:"consultation",label:"Consultation"},{value:"xray",label:"X-Ray"},{value:"treatment",label:"Treatment"},{value:"discount",label:"Discount"},{value:"extraction",label:"Tooth Extraction (Bunot)"},{value:"filling",label:"Tooth Filling (Pasta)"},{value:"fluoride",label:"Fluoride Treatment"},{value:"checkup",label:"Checkup/Unlimited"}],_e=()=>{if(!u.trim())return;const s=A.find(x=>x.controlNumber===u);h(s||null),s||j(ne("Card Not Found","No card found with this number"))},Te=async()=>{if(!c)return;const s=c.status==="active"?"inactive":"active";await z.updateStatus(c.controlNumber,s)?(h({...c,status:s}),j(M("Status Updated",`Card is now ${s}`)),await V()):j($("Update Failed","Failed to update card status"))},Ie=async()=>{if(!t.clinicId||!t.startRange||!t.endRange){j(ne("Missing Fields","Please fill all fields"));return}const s=await ee.getById(t.clinicId);if(!s){j($("Invalid Clinic","Clinic not found"));return}const g=A.filter(X=>X.controlNumber>=t.startRange&&X.controlNumber<=t.endRange&&!X.clinicId);if(g.length===0){j(ne("No Cards","No unassigned cards found in this range"));return}const b=await ee.getAssignedCardsCount(s.id),G=Ve[s.plan];if(b+g.length>G){j($("Plan Limit Exceeded",`This would exceed the ${s.plan} plan limit of ${G} cards. Current: ${b}`));return}await z.assignToClinic(g.map(X=>X.controlNumber),s.id)?(j(M("Cards Assigned",`Assigned ${g.length} cards to ${s.name}`)),C({clinicId:"",startRange:"",endRange:""}),await V()):j($("Assignment Failed","Failed to assign cards to clinic"))},Fe=s=>{const x=A.find(g=>g.controlNumber===s);x&&(U({fullName:x.fullName,status:x.status,perksTotal:x.perksTotal,perksUsed:x.perksUsed,clinicId:x.clinicId,expiryDate:x.expiryDate,notes:x.notes||""}),k(s))},$e=async s=>{const x=A.find(g=>g.controlNumber===s);if(x)try{const g={fullName:P.fullName,status:P.status,perksTotal:P.perksTotal,perksUsed:P.perksUsed,clinicId:P.clinicId,expiryDate:P.expiryDate,notes:P.notes,updatedAt:new Date().toISOString()};if(await qe.cards.update(x.id,g))k(null),j(M("Card Updated",`Updated ${s} successfully`)),await V();else throw new Error("Failed to save to database")}catch{j($("Update Failed","Failed to update card"))}},Le=async s=>{if(window.confirm(`Are you sure you want to delete card ${s}? This action cannot be undone.`))try{await z.delete(s)?(j(M("Card Deleted",`Card ${s} has been deleted`)),await V()):j($("Delete Failed","Could not delete card"))}catch{j($("Delete Failed","Could not delete card"))}},Ge=[{id:"generator",label:"Generator",icon:me,color:"emerald"},{id:"activation",label:"Activation",icon:Ne,color:"blue"},{id:"appointments",label:"Appointments",icon:Ke,color:"rose"},{id:"clinic-management",label:"Manage Clinics",icon:te,color:"indigo"},{id:"endorsement",label:"Endorsement",icon:Qe,color:"orange"},{id:"master-list",label:"Master List",icon:Ce,color:"purple"},{id:"debug",label:"Debug DB",icon:Q,color:"red"},{id:"settings",label:"Settings",icon:de,color:"gray"}];if(!v)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{className:"h-8 w-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Please authenticate to continue"})]}),e.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:a.username,onChange:s=>p({...a,username:s.target.value}),className:"light-input",placeholder:"Enter admin username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:s=>p({...a,password:s.target.value}),className:"light-input",placeholder:"Enter admin password",required:!0})]}),e.jsx("button",{type:"submit",className:"light-button-primary w-full",children:"Access Admin Portal"})]})]})});const Me=[{label:"Total Cards",value:A.length,icon:ie,color:"blue"},{label:"Active Clinics",value:q.length,icon:Je,color:"green"},{label:"Active Cards",value:A.filter(s=>s.status==="active").length,icon:Y,color:"emerald"},{label:"Pending Cards",value:A.filter(s=>s.status==="inactive").length,icon:Q,color:"yellow"}];return we?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"light-card p-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin data..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-2xl flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Control Room"}),e.jsx("p",{className:"text-gray-600",children:"MOCARDS System Administration"})]})]}),e.jsxs("button",{onClick:o,className:"light-button-secondary flex items-center space-x-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:Me.map((s,x)=>{const g=s.icon;return e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.label}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.value})]}),e.jsx("div",{className:`w-12 h-12 bg-${s.color}-100 rounded-2xl flex items-center justify-center`,children:e.jsx(g,{className:`h-6 w-6 text-${s.color}-600`})})]})},x)})}),e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-xl",children:Ge.map(s=>{const x=s.icon,g=f===s.id;return e.jsxs("button",{onClick:()=>L(s.id),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg transition-all duration-200 ${g?"light-tab-active":"light-tab"}`,children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.id)})})})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[f==="generator"&&e.jsx(es,{onSuccess:V}),f==="activation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Activation"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:u,onChange:s=>N(s.target.value),className:"light-input",placeholder:"Enter control number to activate"})}),e.jsxs("button",{onClick:_e,className:"light-button-primary",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Search"]})]}),c&&e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:c.fullName}),e.jsx("p",{className:"text-gray-600",children:c.controlNumber})]}),e.jsx("span",{className:c.status==="active"?"status-active":"status-inactive",children:c.status})]}),e.jsxs("button",{onClick:Te,className:"light-button-primary",children:[c.status==="active"?"Deactivate":"Activate"," Card"]})]})]}),f==="clinic-management"&&e.jsx(as,{onSuccess:V}),f==="endorsement"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Endorsement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic"}),e.jsxs("select",{value:t.clinicId,onChange:s=>C({...t,clinicId:s.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Clinic"}),q.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.plan,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Range"}),e.jsx("input",{type:"text",value:t.startRange,onChange:s=>C({...t,startRange:s.target.value}),className:"light-input",placeholder:"MOC-00001-NCR-CVT001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Range"}),e.jsx("input",{type:"text",value:t.endRange,onChange:s=>C({...t,endRange:s.target.value}),className:"light-input",placeholder:"MOC-00100-NCR-CVT001"})]})]}),e.jsx("button",{onClick:Ie,className:"light-button-primary",children:"Assign Cards to Clinic"})]}),f==="master-list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Data Management"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>r("cards"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${D==="cards"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(ie,{className:"h-4 w-4 inline mr-2"}),"Cards"]}),e.jsxs("button",{onClick:()=>r("clinics"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${D==="clinics"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(te,{className:"h-4 w-4 inline mr-2"}),"Clinics"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(he,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:s=>y(s.target.value),placeholder:D==="cards"?"Search cards by name or control number...":"Search clinics by name or code...",className:"light-input pl-10"})]}),D==="cards"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:oe,onChange:s=>Ae(s.target.value),className:"light-select",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),D==="cards"&&e.jsx("div",{className:"light-table",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"light-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4",children:"Control Number"}),e.jsx("th",{className:"text-left p-4",children:"Patient Name"}),e.jsx("th",{className:"text-left p-4",children:"Status"}),e.jsx("th",{className:"text-left p-4",children:"Clinic"}),e.jsx("th",{className:"text-left p-4",children:"Perks"}),e.jsx("th",{className:"text-left p-4",children:"Expiry"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:A.filter(s=>{const x=!m||s.fullName.toLowerCase().includes(m.toLowerCase())||s.controlNumber.toLowerCase().includes(m.toLowerCase()),g=oe==="all"||s.status===oe;return x&&g}).map(s=>{const x=q.find(b=>b.id===s.clinicId),g=w===s.controlNumber;return e.jsxs("tr",{className:"light-table-row",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:s.controlNumber}),e.jsx("td",{className:"p-4",children:g?e.jsx("input",{type:"text",value:P.fullName,onChange:b=>U({...P,fullName:b.target.value}),className:"light-input text-sm"}):s.fullName}),e.jsx("td",{className:"p-4",children:g?e.jsxs("select",{value:P.status,onChange:b=>U({...P,status:b.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("span",{className:s.status==="active"?"status-active":"status-inactive",children:s.status})}),e.jsx("td",{className:"p-4",children:g?e.jsxs("select",{value:P.clinicId,onChange:b=>U({...P,clinicId:b.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),q.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]}):x?.name||"Unassigned"}),e.jsx("td",{className:"p-4",children:g?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",min:"0",value:P.perksUsed,onChange:b=>U({...P,perksUsed:parseInt(b.target.value)||0}),className:"light-input text-sm w-16"}),e.jsx("span",{className:"text-gray-500 self-center",children:"/"}),e.jsx("input",{type:"number",min:"1",value:P.perksTotal,onChange:b=>U({...P,perksTotal:parseInt(b.target.value)||1}),className:"light-input text-sm w-16"})]}):`${s.perksUsed}/${s.perksTotal}`}),e.jsx("td",{className:"p-4",children:g?e.jsx("input",{type:"date",value:P.expiryDate,onChange:b=>U({...P,expiryDate:b.target.value}),className:"light-input text-sm"}):new Date(s.expiryDate).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>$e(s.controlNumber),className:"p-1 text-green-600 hover:text-green-700",title:"Save changes",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>k(null),className:"p-1 text-gray-600 hover:text-gray-700",title:"Cancel",children:e.jsx(ae,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Fe(s.controlNumber),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit card",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Le(s.controlNumber),className:"p-1 text-red-600 hover:text-red-700",title:"Delete card",children:e.jsx(xe,{className:"h-4 w-4"})})]})})})]},s.controlNumber)})})]})})]}),f==="debug"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Database Debugger"})]}),e.jsx("p",{className:"text-gray-600",children:"Use this tool to analyze the database and troubleshoot card lookup issues."}),e.jsx(ns,{})]}),f==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Admin Settings"}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change your admin password for security"})]}),e.jsx("button",{onClick:()=>n(!I),className:"light-button-primary",children:"Change Password"})]}),I&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("form",{onSubmit:Se,className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:R.currentPassword,onChange:s=>_({...R,currentPassword:s.target.value}),className:"light-input",placeholder:"Enter current password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:R.newPassword,onChange:s=>_({...R,newPassword:s.target.value}),className:"light-input",placeholder:"Enter new password (min 8 characters)",minLength:8,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:R.confirmPassword,onChange:s=>_({...R,confirmPassword:s.target.value}),className:"light-input",placeholder:"Confirm new password",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:"Update Password"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),_({currentPassword:"",newPassword:"",confirmPassword:""})},className:"light-button-secondary",children:"Cancel"})]})]})})]})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Version:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"MOCARDS v3.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Environment:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Production"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Login:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:new Date().toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Admin Username:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:T.username})]})]})]})})]})]})}),l.showModal&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.editingPerk?"Edit Perk":"Create New Perk"}),e.jsx("button",{onClick:()=>d({...l,showModal:!1}),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ae,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Pe()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("select",{value:l.form.type,onChange:s=>d({...l,form:{...l.form,type:s.target.value}}),className:"light-select",children:De.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:l.form.name,onChange:s=>d({...l,form:{...l.form,name:s.target.value}}),className:"light-input",placeholder:"e.g., Free Dental Cleaning",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:l.form.description,onChange:s=>d({...l,form:{...l.form,description:s.target.value}}),className:"light-input",placeholder:"Describe this perk...",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value (â‚± PHP)"}),e.jsx("input",{type:"number",min:"0",max:"10000",value:l.form.value,onChange:s=>d({...l,form:{...l.form,value:parseInt(s.target.value)||0}}),className:"light-input",placeholder:"800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Days"}),e.jsx("input",{type:"number",min:"1",value:l.form.validFor,onChange:s=>d({...l,form:{...l.form,validFor:parseInt(s.target.value)||365}}),className:"light-input",placeholder:"365"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.form.isActive,onChange:s=>d({...l,form:{...l.form,isActive:s.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.form.requiresApproval,onChange:s=>d({...l,form:{...l.form,requiresApproval:s.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requires Approval"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:l.editingPerk?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>d({...l,showModal:!1}),className:"light-button-secondary",children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Existing Perks"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:re.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded ${s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>Ee(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Re(s),className:"text-red-600 hover:text-red-800",children:e.jsx(xe,{className:"h-4 w-4"})})]})]},s.id))})]})]})})]})}export{xs as AdminPortalView};
