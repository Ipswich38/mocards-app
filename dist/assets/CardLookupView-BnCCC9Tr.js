import{u as E,j as e,t as m,d as k,a as S,b as x}from"./index-3zLSGTYl.js";import{r as c}from"./charts-sad3owxz.js";import{f as F,c as O}from"./data-Bph3WAmK.js";import{b as T,p as A,q as I,S as M,r as d,G as f,s as U,P as B,C as $}from"./icons-Dn_uH5YA.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";function W(){const[o,b]=c.useState(""),[t,j]=c.useState(null),[n,N]=c.useState(!1),[y,p]=c.useState(!1),[v,P]=c.useState([]),[w,h]=c.useState(!1),[r,i]=c.useState({patientName:"",patientEmail:"",patientPhone:"",preferredDate:"",preferredTime:"",serviceType:"",perkRequested:"",notes:""}),{addToast:l}=E();c.useEffect(()=>{(async()=>{try{const a=await O.getAll();P(a)}catch(a){console.error("Failed to load clinics:",a)}})()},[]);const u=async()=>{if(!o.trim()){l(m("Empty Search","Please enter a MOC card number"));return}N(!0),p(!1),j(null),await new Promise(s=>setTimeout(s,800));try{const s=await k.getCardByControlNumber(o.trim());if(s){const a={id:s.id,controlNumber:s.control_number||s.unified_control_number||`${s.card_number}`,fullName:"",status:s.status==="activated"?"active":"inactive",perksTotal:5,perksUsed:s.perks?.filter(g=>g.claimed).length||0,clinicId:s.assigned_clinic_id||"",expiryDate:s.expires_at?.split("T")[0]||"2025-12-31",createdAt:s.created_at,updatedAt:s.updated_at||s.created_at};j(a),l(S("Card Found","Card information retrieved successfully"))}else p(!0),l(m("Card Not Found","No MOC card found with this number"))}catch{l(x("Search Error","Failed to search for card"))}finally{N(!1)}},D=s=>{s.key==="Enter"&&u()},C=s=>v.find(g=>g.id===s)?.name||"No clinic assigned",R=()=>{if(!t){l(m("No Card Selected","Please search for a valid MOC card first"));return}h(!0)},_=async()=>{if(!r.patientName||!r.patientEmail||!r.preferredDate||!r.preferredTime||!r.serviceType){l(m("Missing Information","Please fill in all required fields"));return}if(!t||!t.clinicId){l(x("No Clinic Assigned","This card is not assigned to any clinic yet. Please contact MOCARDS admin."));return}const s=v.find(a=>a.id===t.clinicId);if(!s){l(x("Clinic Not Found","The assigned clinic was not found. Please contact MOCARDS admin."));return}try{await k.createAppointment({control_number:t.controlNumber,assigned_clinic_id:t.clinicId,appointment_date:r.preferredDate,appointment_time:r.preferredTime,perk_type:r.perkRequested||r.serviceType,cardholder_notes:r.notes,cardholder_email:r.patientEmail,cardholder_phone:r.patientPhone,status:"waiting_for_approval",passcode:"default-passcode"}),l(S("Request Sent to Clinic",`Your appointment request has been sent directly to ${s.name}. The clinic will contact you within 24 hours to confirm your appointment.`))}catch{l(x("Request Failed","Failed to submit appointment request. Please try again."));return}i({patientName:"",patientEmail:"",patientPhone:"",preferredDate:"",preferredTime:"",serviceType:"",perkRequested:"",notes:""}),h(!1)},q=[{value:"dental_cleaning",label:"Free Dental Cleaning"},{value:"consultation",label:"Free Consultation"},{value:"xray",label:"X-Ray (50% discount)"},{value:"treatment",label:"Treatment (20% discount)"},{value:"general_discount",label:"General Discount (10%)"}];return e.jsxs("div",{className:"dark-search-container min-h-screen",children:[e.jsxs("div",{className:"flex flex-col items-center pt-20 pb-8",children:[e.jsx("h1",{className:"text-6xl font-normal text-white mb-8 select-none",children:"MOCARDS"}),e.jsx("div",{className:"relative w-full max-w-xl mb-8",children:e.jsxs("div",{className:"flex items-center dark-search-bar",children:[e.jsx(T,{className:"h-5 w-5 text-gray-400 mr-4"}),e.jsx("input",{type:"text",value:o,onChange:s=>b(s.target.value),onKeyPress:D,placeholder:"Enter MOC control number",className:"flex-1 bg-transparent text-white outline-none",disabled:n}),e.jsx("div",{className:"flex items-center space-x-2 ml-4",children:e.jsx("button",{onClick:u,disabled:n,className:"p-1 rounded hover:bg-gray-700 transition-colors disabled:opacity-50",children:e.jsx(A,{className:"h-5 w-5 text-gray-400 hover:text-gray-300"})})})]})}),e.jsx("div",{className:"flex space-x-4",children:e.jsx("button",{onClick:u,disabled:n,className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-900 font-medium rounded-lg transition-colors disabled:opacity-50",children:n?"Searching...":"MOCARDS Search"})})]}),(t||y||n)&&e.jsxs("div",{className:"max-w-4xl mx-auto px-6 pb-20",children:[n&&e.jsxs("div",{className:"dark-card p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-gray-600 border-t-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300",children:"Searching MOCARDS registry..."})]}),t&&!n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"dark-card p-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-teal-600 to-teal-800 rounded-2xl p-6 text-white mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"MOCARDS"}),e.jsx("p",{className:"text-teal-100",children:"Philippines Dental Benefits Card"})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${t.status==="active"?"bg-green-400 text-green-900":"bg-red-400 text-red-900"}`,children:t.status==="active"?"✅ ACTIVE":"❌ INACTIVE"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-teal-200 text-sm",children:"Control Number"}),e.jsx("p",{className:"text-2xl font-mono font-bold",children:t.controlNumber})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-teal-200 text-sm",children:"Cardholder Name"}),e.jsx("p",{className:"text-lg font-semibold",children:t.fullName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-teal-200 text-sm",children:"Expires"}),e.jsx("p",{className:"text-lg font-semibold",children:F(t.expiryDate)})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-300",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cardholder Information"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(I,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Full Name"}),e.jsx("p",{className:"text-white",children:t.fullName})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Assigned Clinic"}),e.jsx("p",{className:"text-white",children:C(t.clinicId)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(d,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Card Status"}),e.jsx("p",{className:`capitalize ${t.status==="active"?"text-green-400":"text-red-400"}`,children:t.status})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Dental Benefits"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Total Perks"}),e.jsxs("p",{className:"text-white",children:[t.perksTotal," benefits"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Used Perks"}),e.jsxs("p",{className:"text-white",children:[t.perksUsed," utilized"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Available Perks"}),e.jsxs("p",{className:"text-green-400 font-semibold",children:[t.perksTotal-t.perksUsed," remaining"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:"Benefits Usage"}),e.jsxs("span",{children:[t.perksUsed,"/",t.perksTotal]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-teal-600 h-2 rounded-full transition-all duration-300",style:{width:`${t.perksUsed/t.perksTotal*100}%`}})})]})]})]})]}),t.status==="active"&&e.jsxs("div",{className:"dark-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-6 w-6 text-teal-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Schedule Appointment"})]}),!w&&e.jsxs("button",{onClick:R,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4"}),"Request Appointment"]})]}),e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"Request an appointment directly with your assigned clinic to claim your dental benefits."}),w&&e.jsxs("div",{className:"space-y-4 border-t border-gray-600 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Full Name *"}),e.jsx("input",{type:"text",value:r.patientName,onChange:s=>i(a=>({...a,patientName:s.target.value})),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Enter your full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"email",value:r.patientEmail,onChange:s=>i(a=>({...a,patientEmail:s.target.value})),className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"your.email@example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"tel",value:r.patientPhone,onChange:s=>i(a=>({...a,patientPhone:s.target.value})),className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"+63917123456"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Service Type *"}),e.jsx("input",{type:"text",value:r.serviceType,onChange:s=>i(a=>({...a,serviceType:s.target.value})),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"e.g., Dental Cleaning, Consultation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Preferred Benefit"}),e.jsxs("select",{value:r.perkRequested,onChange:s=>i(a=>({...a,perkRequested:s.target.value})),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a benefit (optional)"}),q.map(s=>e.jsx("option",{value:s.label,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Preferred Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",value:r.preferredDate,onChange:s=>i(a=>({...a,preferredDate:s.target.value})),min:new Date().toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Preferred Time *"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"time",value:r.preferredTime,onChange:s=>i(a=>({...a,preferredTime:s.target.value})),className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Additional Notes"}),e.jsx("textarea",{value:r.notes,onChange:s=>i(a=>({...a,notes:s.target.value})),rows:3,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Any specific requests or health concerns..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:_,className:"px-6 py-3 bg-teal-600 hover:bg-teal-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Submit Request"]}),e.jsx("button",{onClick:()=>h(!1),className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Cancel"})]}),e.jsx("div",{className:"bg-teal-900/30 border border-teal-600/50 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{className:"h-5 w-5 text-teal-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-teal-300 font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"text-teal-100 space-y-1",children:[e.jsxs("li",{children:["1. Request sent directly to ",t?C(t.clinicId):"your assigned clinic"]}),e.jsx("li",{children:"2. Clinic will review and process your request"}),e.jsx("li",{children:"3. Clinic will contact you within 24 hours to confirm, decline, or reschedule"})]})]})]})})]})]})]}),y&&!n&&e.jsxs("div",{className:"dark-card p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No card found"}),e.jsxs("p",{className:"text-gray-300 mb-4",children:['No MOC card found with the number "',o,'"']}),e.jsx("button",{onClick:()=>{b(""),p(!1)},className:"px-6 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition-colors",children:"Try another search"})]})]})]})}export{W as CardLookupView};
