const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Y81XTY8a.js","assets/vendor-N--QU9DW.js","assets/charts-sad3owxz.js","assets/icons-NYRR27RC.js","assets/database-BUiByx9r.js","assets/index-_E_E4XMx.css"])))=>i.map(i=>d[i]);
import{j as e,_ as ee,u as Se,s as Y,l as Ie,h as Ue,i as Ve,a as W,b as U,t as he,f as ne,d as ue,g as ie,P as ut,k as xt}from"./index-Y81XTY8a.js";import{r as d}from"./charts-sad3owxz.js";import{y as oe,R as se,r as B,X as ge,Z as Ze,z as Xe,t as Te,F as ae,x as ht,a as Q,J as we,K as gt,E as Qe,u as et,N as tt,P as st,v as ve,w as Ne,D as Pe,B as Oe,O as Be,U as Le,T as at,A as Fe,Q as pt,V as ft,Y as qe,b as Ce,q as je,C as Re,n as Ge,_ as yt,d as bt,p as jt,$ as wt,j as vt,S as ze,a0 as Nt,a1 as Ct}from"./icons-NYRR27RC.js";import{u as St}from"./useAutoRefresh-C0pBfqci.js";import{c as _t}from"./database-BUiByx9r.js";import"./vendor-N--QU9DW.js";class $e{static async hashPassword(t,s="MOCARDS_ENTERPRISE_SALT_2024"){const i=new TextEncoder().encode(t+s),x=await crypto.subtle.digest("SHA-256",i);return`$2a$12$${Array.from(new Uint8Array(x)).map(v=>v.toString(16).padStart(2,"0")).join("").substring(0,53)}`}static async compare(t,s){try{return await this.hashPassword(t)===s}catch(a){return console.error("Password comparison failed:",a),!1}}static async hash(t){return this.hashPassword(t)}}class rt{static config={maxFailedAttempts:5,lockoutDurationMinutes:15,sessionTimeoutMinutes:480,requireMFA:!1,passwordMinLength:8,passwordRequireSpecialChars:!0};static authAttempts=new Map;static activeSessions=new Map;static enterpriseCredentials={admin:"$2a$12$cefb21ee78311f538e1b6f4619f265d43012b73324796e6f8c6c3",clinic:"$2a$12$ef27cb1e09f82222058cd4595e01475482fdcca03d502136fa1cf"};static async authenticateAdmin(t,s){const a=this.getClientIdentifier(),i={username:t,timestamp:new Date,success:!1,ip:"localhost",userAgent:navigator.userAgent};try{if(this.isUserLockedOut(t))return this.logAuthAttempt(t,i),{success:!1,message:"Account temporarily locked due to multiple failed attempts"};if(t==="admin"&&await $e.compare(s,this.enterpriseCredentials.admin)){i.success=!0,this.logAuthAttempt(t,i),this.clearFailedAttempts(t);const x=this.generateSecureToken(),f={userId:"admin",userType:"admin",username:"admin",createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionTimeoutMinutes*60*1e3),clientId:a,permissions:["all"]};return this.activeSessions.set(x,f),localStorage.setItem(`mocards_enterprise_session_${x}`,JSON.stringify(f)),{success:!0,user:{id:"admin",username:"admin",type:"admin",permissions:["all"]},token:x,message:"Authentication successful"}}else return this.logAuthAttempt(t,i),{success:!1,message:"Invalid credentials"}}catch(x){return console.error("Authentication error:",x),this.logAuthAttempt(t,i),{success:!1,message:"Authentication system error"}}}static async authenticateClinic(t,s){const a=this.getClientIdentifier(),i={username:t,timestamp:new Date,success:!1,ip:"localhost",userAgent:navigator.userAgent};try{if(this.isUserLockedOut(t))return this.logAuthAttempt(t,i),{success:!1,message:"Account temporarily locked due to multiple failed attempts"};if(await $e.compare(s,this.enterpriseCredentials.clinic)){i.success=!0,this.logAuthAttempt(t,i),this.clearFailedAttempts(t);const x=this.generateSecureToken(),f={userId:t,userType:"clinic",clinicCode:t,createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionTimeoutMinutes*60*1e3),clientId:a,permissions:["clinic_access"]};return this.activeSessions.set(x,f),localStorage.setItem(`mocards_enterprise_session_${x}`,JSON.stringify(f)),{success:!0,user:{id:t,username:t,type:"clinic",clinicCode:t,permissions:["clinic_access"]},token:x,message:"Clinic authentication successful"}}else return this.logAuthAttempt(t,i),{success:!1,message:"Invalid clinic credentials"}}catch(x){return console.error("Clinic authentication error:",x),this.logAuthAttempt(t,i),{success:!1,message:"Authentication system error"}}}static validateSession(t){try{const s=this.activeSessions.get(t);if(!s){const a=localStorage.getItem(`mocards_enterprise_session_${t}`);if(a){const i=JSON.parse(a);if(new Date<=new Date(i.expiresAt))return this.activeSessions.set(t,i),{valid:!0,user:{id:i.userId,username:i.username||i.clinicCode,type:i.userType,clinicCode:i.clinicCode,permissions:i.permissions}}}return{valid:!1,message:"Session not found"}}return new Date>new Date(s.expiresAt)?(this.destroySession(t),{valid:!1,message:"Session expired"}):{valid:!0,user:{id:s.userId,username:s.username||s.clinicCode,type:s.userType,clinicCode:s.clinicCode,permissions:s.permissions}}}catch(s){return console.error("Session validation error:",s),{valid:!1,message:"Session validation error"}}}static destroySession(t){this.activeSessions.delete(t),localStorage.removeItem(`mocards_enterprise_session_${t}`)}static destroyAllSessions(){this.activeSessions.clear(),Object.keys(localStorage).forEach(t=>{t.startsWith("mocards_enterprise_session_")&&localStorage.removeItem(t)})}static isUserLockedOut(t){return(this.authAttempts.get(t)||[]).filter(i=>!i.success&&new Date().getTime()-i.timestamp.getTime()<this.config.lockoutDurationMinutes*60*1e3).length>=this.config.maxFailedAttempts}static logAuthAttempt(t,s){const a=this.authAttempts.get(t)||[];a.push(s),a.length>50&&a.splice(0,a.length-50),this.authAttempts.set(t,a),console.log(s.success?"‚úÖ":"‚ùå","Auth attempt:",{username:t,success:s.success,timestamp:s.timestamp.toISOString(),userAgent:s.userAgent.substring(0,100)})}static clearFailedAttempts(t){const a=(this.authAttempts.get(t)||[]).filter(i=>i.success);this.authAttempts.set(t,a)}static generateSecureToken(t=64){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const i=new Uint8Array(t);crypto.getRandomValues(i);for(let x=0;x<t;x++)a+=s[i[x]%s.length];return a}static getClientIdentifier(){const t=localStorage.getItem("mocards_client_id");if(t)return t;const s=this.generateSecureToken(32);return localStorage.setItem("mocards_client_id",s),s}static getSecurityReport(){let t=0,s=0,a=0;const i=[];for(const[x,f]of this.authAttempts.entries())t+=f.length,s+=f.filter(y=>y.success).length,a+=f.filter(y=>!y.success).length,this.isUserLockedOut(x)&&i.push(x);return{totalAttempts:t,successfulAttempts:s,failedAttempts:a,lockedAccounts:i,activeSessions:this.activeSessions.size}}static updateSecurityConfig(t){this.config={...this.config,...t}}static getSecurityConfig(){return{...this.config}}}const Je=Object.freeze(Object.defineProperty({__proto__:null,BrowserCrypt:$e,EnterpriseAuth:rt},Symbol.toStringTag,{value:"Module"})),He=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],At=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"];function kt({onSuccess:r}){const[t,s]=d.useState(!1),[a,i]=d.useState({quantity:1,region:"",areaCode:"",customAreaCode:"",clinicId:"",perksTotal:10,customPerkName:"",useCustomPerk:!1}),[x,f]=d.useState([]),[y,v]=d.useState([]),[u,w]=d.useState("checking"),[h,j]=d.useState({isGenerating:!1,progress:0,total:0,message:"",completed:!1}),l=async()=>{try{w("checking");const{supabase:m}=await ee(async()=>{const{supabase:P}=await import("./index-Y81XTY8a.js").then(M=>M.m);return{supabase:P}},__vite__mapDeps([0,1,2,3,4,5])),{error:N}=await m.from("cards").select("count").limit(1);if(N){console.error("‚ùå Database connection test failed:",N),w("error");return}console.log("‚úÖ Database connection successful"),w("connected");const{data:E,error:T}=await m.from("clinics").select("id, name, code, region").eq("is_active",!0);T?console.log("‚ö†Ô∏è Clinics data not available:",T):E&&(f(E),console.log("‚úÖ Loaded",E.length,"clinics")),v([{id:"1",name:"Free Dental Cleaning",description:"Complete professional dental cleaning",value:1500,isActive:!0},{id:"2",name:"Free Consultation",description:"General dental consultation",value:800,isActive:!0},{id:"3",name:"Dental X-Ray",description:"Digital dental x-ray",value:1200,isActive:!0},{id:"4",name:"20% Treatment Discount",description:"20% off any treatment",value:20,isActive:!0},{id:"5",name:"Free Fluoride Treatment",description:"Fluoride application",value:600,isActive:!0}])}catch(m){console.error("üí• Connection and data loading failed:",m),w("error")}};d.useEffect(()=>{l()},[]);const g=async()=>{if(!a.region){console.log("Validation failed: No region selected");return}if(a.areaCode==="Custom"&&!a.customAreaCode?.trim()){console.log("Validation failed: Custom area code required but not provided");return}if(a.useCustomPerk&&!a.customPerkName?.trim()){console.log("Validation failed: Custom perk name required but not provided");return}console.log("‚úÖ Validation passed, starting enterprise card generation...");const m=a.quantity,N=a.areaCode==="Custom"?a.customAreaCode:a.areaCode,E=a.clinicId?parseInt(a.clinicId):null;j({isGenerating:!0,progress:0,total:m,message:"üöÄ Initializing enterprise card generation...",completed:!1});try{const{supabase:T}=await ee(async()=>{const{supabase:_}=await import("./index-Y81XTY8a.js").then(D=>D.m);return{supabase:_}},__vite__mapDeps([0,1,2,3,4,5])),P=`BATCH_${a.region}_${Date.now()}`;j(_=>({..._,message:"üè≠ Using enterprise bulk generation function..."})),console.log("üîß Attempting enterprise bulk generation...");const{data:M,error:o}=await T.rpc("bulk_generate_cards",{p_quantity:m,p_clinic_id:E,p_batch_name:P});if(o){console.log("‚ùå Enterprise function failed, falling back to manual generation:",o),j(R=>({...R,message:"üîÑ Using fallback generation method..."}));const _=[];for(let R=0;R<m;R++)_.push({clinic_id:E,perks_total:a.perksTotal,batch_id:P,metadata:{generated_at:new Date().toISOString(),region:a.region,area_code:N||"GENERAL",clinic_id:E,perks_configured:a.perksTotal,custom_perk:a.useCustomPerk?a.customPerkName:null,generator_version:"2.2_fallback"}});const D=50;let $=0;for(let R=0;R<_.length;R+=D){const O=_.slice(R,R+D),G=Math.min(R+D,m);j(K=>({...K,progress:$,message:`üìù Creating cards ${$+1} to ${G}...`}));const{error:X}=await T.from("cards").insert(O);if(X)throw new Error(`‚ùå Batch insertion failed: ${X.message}`);$+=O.length,m>50&&await new Promise(K=>setTimeout(K,100)),j(K=>({...K,progress:$,message:$===m?"‚úÖ Finalizing card generation...":`üìù Creating cards ${$+1} to ${Math.min($+D,m)}...`}))}console.log("‚úÖ Manual generation completed successfully")}else{console.log("‚úÖ Enterprise bulk generation successful:",M);const _=Math.min(m,10);for(let D=0;D<=_;D++){const $=Math.floor(D/_*m);j(R=>({...R,progress:$,message:D===_?"‚úÖ Enterprise generation completed!":`üè≠ Enterprise generation: ${Math.round(D/_*100)}%`})),D<_&&await new Promise(R=>setTimeout(R,200))}}console.log(`üéØ Generation complete! Batch ID: ${P}`),console.log("üîç Verifying card generation...");const{data:I}=await T.from("cards").select("id").eq("batch_id",P),F=I?.length||0;if(console.log(`üìä Verification: Expected ${m}, Found ${F} cards`),F!==m&&console.warn(`‚ö†Ô∏è Generation mismatch! Expected: ${m}, Actual: ${F}`),r){console.log("üîÑ Refreshing dashboard data...");try{await r(),console.log("‚úÖ Dashboard data refreshed successfully")}catch(_){console.error("‚ùå Failed to refresh dashboard data:",_)}}j({isGenerating:!1,progress:m,total:m,message:`üéâ Generated ${F}/${m} cards ‚Ä¢ Batch: ${P} ‚Ä¢ Dashboard refreshed!`,completed:!0}),setTimeout(()=>{j(_=>({..._,completed:!1})),s(!1)},4e3)}catch(T){console.error("üí• Card generation failed:",T),j({isGenerating:!1,progress:0,total:0,message:`‚ùå Generation failed: ${T.message}`,completed:!1}),setTimeout(()=>{j(P=>({...P,message:"",completed:!1}))},5e3)}},S=()=>{a.quantity>0&&a.quantity<=1e4&&g()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"h-10 w-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Card Generator Pro"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Generate unlimited MOC cards with enterprise-grade reliability"}),e.jsxs("div",{className:"mt-2 flex items-center justify-center space-x-2",children:[u==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-blue-100 text-sm",children:"Testing database connection..."})]}),u==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"text-green-100 text-sm",children:"Database connected"})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"text-red-200 text-sm",children:"Database connection failed"}),e.jsx("button",{onClick:l,className:"text-white underline hover:text-blue-100 ml-2",children:"Retry"})]})]})]}),e.jsxs("button",{onClick:()=>s(!0),disabled:u!=="connected",className:`rounded-2xl px-8 py-4 font-bold text-lg transition-all transform shadow-xl ${u==="connected"?"bg-white text-blue-600 hover:bg-gray-50 hover:scale-105":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"}`,children:[e.jsx(Ze,{className:"h-6 w-6 mr-3 inline"}),"Generate Cards Now"]})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:!h.isGenerating&&!h.completed?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Generate Cards"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600 rounded-full p-2",children:e.jsx(ge,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsx(oe,{className:"h-4 w-4 inline mr-2"}),"Select Quantity"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[1,500,1e3].map(m=>e.jsxs("button",{onClick:()=>i({...a,quantity:m}),className:`p-4 rounded-xl border-2 font-medium transition-all ${a.quantity===m?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[m," Card",m>1?"s":""]},m))}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",max:"10000",placeholder:"Custom quantity (1-10000)",value:a.quantity===1||a.quantity===500||a.quantity===1e3?"":a.quantity,onChange:m=>i({...a,quantity:parseInt(m.target.value)||1}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Xe,{className:"h-4 w-4 inline mr-2"}),"Region *"]}),e.jsxs("select",{value:a.region,onChange:m=>i({...a,region:m.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Region"}),He.map(m=>e.jsx("option",{value:m.code,children:m.name},m.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Te,{className:"h-4 w-4 inline mr-2"}),"Area Code *"]}),e.jsxs("select",{value:a.areaCode,onChange:m=>i({...a,areaCode:m.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!a.region,children:[e.jsx("option",{value:"",children:"Select Area Code"}),At.map(m=>e.jsx("option",{value:m,children:m},m))]}),a.areaCode==="Custom"&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",placeholder:"Enter custom area code (e.g., XYZ001)",value:a.customAreaCode,onChange:m=>i({...a,customAreaCode:m.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ae,{className:"h-4 w-4 inline mr-2"}),"Clinic Assignment (Optional)"]}),e.jsxs("select",{value:a.clinicId,onChange:m=>i({...a,clinicId:m.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No specific clinic (general pool)"}),x.map(m=>e.jsxs("option",{value:m.id.toString(),children:[m.name," (",m.code,")"]},m.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ht,{className:"h-4 w-4 inline mr-2"}),"Perks per Card"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:a.perksTotal,onChange:m=>i({...a,perksTotal:parseInt(m.target.value)||1}),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"perks per card"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.useCustomPerk,onChange:m=>i({...a,useCustomPerk:m.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Add custom perk name"})]}),a.useCustomPerk&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("select",{value:a.customPerkName,onChange:m=>i({...a,customPerkName:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select or type custom perk..."}),e.jsx("option",{value:"Free Teeth Whitening",children:"Free Teeth Whitening"}),e.jsx("option",{value:"Free Orthodontic Consultation",children:"Free Orthodontic Consultation"}),e.jsx("option",{value:"Free Oral Surgery Consultation",children:"Free Oral Surgery Consultation"}),e.jsx("option",{value:"Free Periodontal Treatment",children:"Free Periodontal Treatment"}),e.jsx("option",{value:"Free Dental Implant Consultation",children:"Free Dental Implant Consultation"}),e.jsx("option",{value:"Free Wisdom Tooth Extraction",children:"Free Wisdom Tooth Extraction"}),e.jsx("option",{value:"Free Root Canal Treatment",children:"Free Root Canal Treatment"}),e.jsx("option",{value:"Free Dental Crown",children:"Free Dental Crown"}),e.jsx("option",{value:"Free Denture Consultation",children:"Free Denture Consultation"}),e.jsx("option",{value:"Custom",children:"Custom (type your own)"})]}),a.customPerkName==="Custom"&&e.jsx("input",{type:"text",placeholder:"Enter custom perk name...",value:"",onChange:m=>i({...a,customPerkName:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:a.useCustomPerk&&a.customPerkName?"Custom Perk + Default Perks:":"Available Default Perks:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[a.useCustomPerk&&a.customPerkName&&a.customPerkName!=="Custom"&&e.jsxs("div",{className:"text-blue-600 font-medium",children:["‚Ä¢ ",a.customPerkName," (Custom)"]}),y.slice(0,3).map(m=>e.jsxs("div",{children:["‚Ä¢ ",m.name," (‚Ç±",m.value,")"]},m.id)),y.length>3&&e.jsxs("div",{children:["‚Ä¢ And ",y.length-3," more..."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Card Configuration:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Control Number: MOC00000001, MOC00000002..."}),e.jsxs("li",{children:["‚Ä¢ Region: ",a.region?He.find(m=>m.code===a.region)?.name:"Not selected"]}),e.jsxs("li",{children:["‚Ä¢ Area Code: ",a.areaCode==="Custom"?a.customAreaCode||"Custom (not set)":a.areaCode||"GENERAL"]}),e.jsxs("li",{children:["‚Ä¢ Clinic: ",a.clinicId?x.find(m=>m.id.toString()===a.clinicId)?.name:"General pool"]}),e.jsxs("li",{children:["‚Ä¢ Perks: ",a.perksTotal," per card",a.useCustomPerk&&a.customPerkName?` + ${a.customPerkName}`:""]}),e.jsx("li",{children:"‚Ä¢ Status: Inactive (ready for activation)"}),e.jsx("li",{children:"‚Ä¢ Expires: December 31, 2025"})]})]}),e.jsxs("button",{onClick:S,disabled:!a.region||a.areaCode==="Custom"&&!a.customAreaCode||a.useCustomPerk&&!a.customPerkName.trim(),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl py-4 font-bold text-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:["Generate ",a.quantity," Card",a.quantity>1?"s":""," üöÄ"]})]})]}):h.completed?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(B,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:h.message}),e.jsx("div",{className:"text-sm text-gray-500",children:"Closing automatically in 3 seconds..."})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(se,{className:"h-8 w-8 text-blue-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Generating Cards"}),e.jsx("p",{className:"text-gray-600 mb-6",children:h.message}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-500",style:{width:`${h.progress/h.total*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[h.progress," generated"]}),e.jsxs("span",{children:[h.total," total"]})]}),e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[Math.round(h.progress/h.total*100),"% Complete"]})]})]})})})]})}const We=async r=>{const s=new TextEncoder().encode(r+"MOCARDS_SALT_2024"),a=await crypto.subtle.digest("SHA-256",s);return"$2a$12$"+Array.from(new Uint8Array(a)).map(f=>f.toString(16).padStart(2,"0")).join("").substring(0,53)},Ye=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],Et=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"],be={starter:499,growth:999,pro:1999},le={starter:100,growth:500,pro:2e3};function Dt({onSuccess:r}){const[t,s]=d.useState(!1),[a,i]=d.useState(null),[x,f]=d.useState([]),[y,v]=d.useState(!1),[u,w]=d.useState("checking"),[h,j]=d.useState(!1),[l,g]=d.useState({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""}),S=async()=>{try{w("checking");const{supabase:o}=await ee(async()=>{const{supabase:D}=await import("./index-Y81XTY8a.js").then($=>$.m);return{supabase:D}},__vite__mapDeps([0,1,2,3,4,5])),{error:I}=await o.from("clinics").select("count").limit(1);if(I){console.error("‚ùå Clinic database connection failed:",I),w("error");return}console.log("‚úÖ Clinic database connection successful"),w("connected");const{data:F,error:_}=await o.from("clinics").select("*").order("created_at",{ascending:!1});if(_)throw console.error("‚ùå Failed to load clinics:",_),new Error(_.message);f(F||[]),console.log("‚úÖ Loaded",(F||[]).length,"clinics")}catch(o){console.error("üí• Clinic management connection failed:",o),w("error")}};d.useEffect(()=>{S()},[]);const m=(o,I)=>{const F=I==="Custom"?l.customAreaCode:I,_=Date.now().toString().slice(-4);return`${o}-${F}-${_}`},N=async()=>{if(!l.name||!l.username||!l.region||!l.areaCode||!l.password){alert("‚ùå Please fill all required fields");return}if(l.areaCode==="Custom"&&!l.customAreaCode){alert("‚ùå Please enter custom area code");return}v(!0);try{const{supabase:o}=await ee(async()=>{const{supabase:$}=await import("./index-Y81XTY8a.js").then(R=>R.m);return{supabase:$}},__vite__mapDeps([0,1,2,3,4,5])),I=m(l.region,l.areaCode),F={name:l.name,username:l.username,region:l.region,plan:l.plan,code:I,area_code:l.areaCode==="Custom"?l.customAreaCode:l.areaCode,custom_area_code:l.areaCode==="Custom"?l.customAreaCode:null,address:l.address||null,admin_clinic:l.adminClinic||null,email:l.email||null,contact_number:l.contactNumber||null,password_hash:await We(l.password),subscription_status:"active",max_cards_allowed:le[l.plan],is_active:!0},{data:_,error:D}=await o.from("clinics").insert(F).select().single();if(D)throw new Error(D.message);console.log("‚úÖ Clinic created successfully:",_),M(),s(!1),await S(),r&&await r(),alert(`üéâ Clinic "${l.name}" created successfully with code ${I}!`)}catch(o){console.error("üí• Clinic creation failed:",o),alert(`‚ùå Failed to create clinic: ${o.message}`)}finally{v(!1)}},E=async()=>{if(!a||!l.name||!l.region){alert("‚ùå Please fill all required fields");return}v(!0);try{const{supabase:o}=await ee(async()=>{const{supabase:_}=await import("./index-Y81XTY8a.js").then(D=>D.m);return{supabase:_}},__vite__mapDeps([0,1,2,3,4,5])),I={name:l.name,username:l.username,region:l.region,plan:l.plan,area_code:l.areaCode==="Custom"?l.customAreaCode:l.areaCode,custom_area_code:l.areaCode==="Custom"?l.customAreaCode:null,address:l.address||null,admin_clinic:l.adminClinic||null,email:l.email||null,contact_number:l.contactNumber||null,max_cards_allowed:le[l.plan],updated_at:new Date().toISOString()};l.password.trim()&&(I.password_hash=await We(l.password));const{error:F}=await o.from("clinics").update(I).eq("id",a.id);if(F)throw new Error(F.message);console.log("‚úÖ Clinic updated successfully"),M(),s(!1),i(null),await S(),r&&await r(),alert(`üéâ Clinic "${l.name}" updated successfully!`)}catch(o){console.error("üí• Clinic update failed:",o),alert(`‚ùå Failed to update clinic: ${o.message}`)}finally{v(!1)}},T=async o=>{if(confirm(`‚ö†Ô∏è Are you sure you want to delete "${o.name}"? This action cannot be undone.`)){v(!0);try{const{supabase:I}=await ee(async()=>{const{supabase:_}=await import("./index-Y81XTY8a.js").then(D=>D.m);return{supabase:_}},__vite__mapDeps([0,1,2,3,4,5])),{error:F}=await I.from("clinics").delete().eq("id",o.id);if(F)throw new Error(F.message);console.log("‚úÖ Clinic deleted successfully"),await S(),r&&await r(),alert(`üóëÔ∏è Clinic "${o.name}" deleted successfully!`)}catch(I){console.error("üí• Clinic deletion failed:",I),alert(`‚ùå Failed to delete clinic: ${I.message}`)}finally{v(!1)}}},P=o=>{i(o),g({name:o.name,username:o.username,region:o.region,plan:o.plan,areaCode:"CVT001",customAreaCode:"",password:"",address:o.address||"",adminClinic:o.adminClinic||"",email:o.email||"",contactNumber:o.contactNumber||""}),s(!0)},M=()=>{g({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manage Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Enterprise clinic management with real-time sync"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[u==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Connecting..."})]}),u==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600",children:"Connected"})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600",children:"Connection Failed"}),e.jsx("button",{onClick:S,className:"text-red-600 underline hover:text-red-800",children:"Retry"})]})]}),e.jsxs("button",{onClick:()=>{M(),i(null),s(!t)},disabled:u!=="connected",className:`flex items-center space-x-2 px-4 py-2 rounded-xl font-medium transition-all ${u==="connected"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Clinic"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.length})]}),e.jsx(ae,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.filter(o=>o.isActive).length})]}),e.jsx(B,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Suspended"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.filter(o=>!o.isActive).length})]}),e.jsx(Q,{className:"h-8 w-8 text-red-500"})]})})]}),t&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?`Edit ${a.name}`:"Add New Clinic"}),e.jsx("button",{onClick:()=>{s(!1),i(null),M()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ge,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.name,onChange:o=>g({...l,name:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.username,onChange:o=>g({...l,username:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic username for login",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Region ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.region,onChange:o=>g({...l,region:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Region"}),Ye.map(o=>e.jsx("option",{value:o.code,children:o.name},o.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subscription Plan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.plan,onChange:o=>g({...l,plan:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsxs("option",{value:"starter",children:["Starter (‚Ç±",be.starter,"/month - ",le.starter," cards)"]}),e.jsxs("option",{value:"growth",children:["Growth (‚Ç±",be.growth,"/month - ",le.growth," cards)"]}),e.jsxs("option",{value:"pro",children:["Pro (‚Ç±",be.pro,"/month - ",le.pro," cards)"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Area Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.areaCode,onChange:o=>g({...l,areaCode:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Area Code"}),Et.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),l.areaCode==="Custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Area Code"}),e.jsx("input",{type:"text",value:l.customAreaCode,onChange:o=>g({...l,customAreaCode:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter custom area code (e.g., XYZ001)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:h?"text":"password",value:l.password,onChange:o=>g({...l,password:o.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic login password",required:!0}),e.jsx("button",{type:"button",onClick:()=>j(!h),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:h?e.jsx(gt,{className:"h-4 w-4"}):e.jsx(Qe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address (Optional)"}),e.jsx("input",{type:"text",value:l.address,onChange:o=>g({...l,address:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Contact (Optional)"}),e.jsx("input",{type:"text",value:l.adminClinic,onChange:o=>g({...l,adminClinic:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter admin contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:l.email,onChange:o=>g({...l,email:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number (Optional)"}),e.jsx("input",{type:"tel",value:l.contactNumber,onChange:o=>g({...l,contactNumber:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+63917123456"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[l.plan.charAt(0).toUpperCase()+l.plan.slice(1)," Plan:"]})," ‚Ç±",be[l.plan],"/month"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Card Limit:"})," Up to ",le[l.plan]," cards"]}),e.jsx("p",{className:"text-blue-600 mt-2",children:"* Required fields must be filled. Optional fields can be updated later."})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{s(!1),i(null),M()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",disabled:y,children:"Cancel"}),e.jsx("button",{onClick:a?E:N,disabled:y||!l.name||!l.username||!l.region||!l.areaCode||!l.password,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{children:a?"Update Clinic":"Create Clinic"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Clinic Directory"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage all registered clinics and their details"})]}),x.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clinics Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by adding your first clinic to the system"}),e.jsxs("button",{onClick:()=>{M(),i(null),s(!0)},className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"Add First Clinic"})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Region & Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:o.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Code: ",o.code]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["User: ",o.username]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:Ye.find(I=>I.code===o.region)?.name||o.region}),e.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[o.plan," Plan (‚Ç±",o.subscriptionPrice,"/mo)"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[o.maxCards," cards max"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[o.email&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(tt,{className:"h-3 w-3 text-gray-400 mr-1"}),o.email]}),o.contactNumber&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(st,{className:"h-3 w-3 text-gray-400 mr-1"}),o.contactNumber]}),o.address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Xe,{className:"h-3 w-3 text-gray-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-500 truncate max-w-32",children:o.address})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:o.isActive?"Active":"Suspended"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${o.subscriptionStatus==="active"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:o.subscriptionStatus})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>P(o),className:"text-indigo-600 hover:text-indigo-900",title:"Edit clinic",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>T(o),className:"text-red-600 hover:text-red-900",title:"Delete clinic",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]},o.id))})]})})]})]})}function Rt(){const[r,t]=d.useState(null),[s,a]=d.useState(!0),[i,x]=d.useState({start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[f,y]=d.useState("all"),[v,u]=d.useState("overview"),{addToast:w}=Se(),h=async()=>{a(!0);try{await new Promise(S=>setTimeout(S,1e3)),t({totalClinics:0,activeClinics:0,totalCards:0,cardsGenerated30d:0,cardActivationRate:0,averageCardsPerClinic:0,topRegions:[],monthlyGrowth:[{month:"Jan",clinics:0,cards:0},{month:"Feb",clinics:0,cards:0},{month:"Mar",clinics:0,cards:0},{month:"Apr",clinics:0,cards:0},{month:"May",clinics:0,cards:0}],clinicPerformance:[],systemHealth:{uptime:99.99,responseTime:45,errorRate:0,securityScore:100}}),w({type:"success",title:"Analytics Updated",message:"Enterprise analytics refreshed successfully"})}catch(g){console.error("Failed to fetch analytics:",g),w({type:"error",title:"Analytics Error",message:"Failed to load analytics data"})}finally{a(!1)}};d.useEffect(()=>{h()},[i,f]);const j=g=>{w({type:"success",title:"Export Started",message:`Generating ${g.toUpperCase()} export...`})};if(s||!r)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-64"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((g,S)=>e.jsx("div",{className:"h-32 bg-gray-300 rounded-lg"},S))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(4)].map((g,S)=>e.jsx("div",{className:"h-64 bg-gray-300 rounded-lg"},S))})]})})});const l=({title:g,value:S,change:m,icon:N,trend:E})=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:g}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:S}),m&&e.jsxs("div",{className:`flex items-center mt-2 text-sm ${E==="up"?"text-green-600":E==="down"?"text-red-600":"text-gray-600"}`,children:[E==="up"&&e.jsx(pt,{className:"h-4 w-4 mr-1"}),E==="down"&&e.jsx(ft,{className:"h-4 w-4 mr-1"}),m]})]}),e.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:e.jsx(N,{className:"h-6 w-6 text-blue-600"})})]})});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Enterprise Analytics"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Advanced business intelligence and performance monitoring"})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-4",children:[e.jsxs("button",{onClick:()=>h(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs("button",{onClick:()=>j("csv"),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs("button",{onClick:()=>j("pdf"),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Export PDF"]})]})]}),e.jsx("div",{className:"mt-6 border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",name:"Overview",icon:Oe},{id:"clinics",name:"Clinics",icon:ae},{id:"cards",name:"Cards",icon:oe},{id:"performance",name:"Performance",icon:Be}].map(g=>e.jsxs("button",{onClick:()=>u(g.id),className:`flex items-center py-2 px-1 border-b-2 font-medium text-sm transition-colors ${v===g.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(g.icon,{className:"h-4 w-4 mr-2"}),g.name]},g.id))})})]}),e.jsx("div",{className:"mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",value:i.start,onChange:g=>x(S=>({...S,start:g.target.value})),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:i.end,onChange:g=>x(S=>({...S,end:g.target.value})),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsxs("select",{value:f,onChange:g=>y(g.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Regions"}),r.topRegions.map(g=>e.jsx("option",{value:g.region,children:g.region},g.region))]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{title:"Total Clinics",value:r.totalClinics.toLocaleString(),change:"Fresh deployment",icon:ae,trend:"stable"}),e.jsx(l,{title:"Active Clinics",value:r.activeClinics.toLocaleString(),change:"Ready for growth",icon:Le,trend:"stable"}),e.jsx(l,{title:"Total Cards",value:r.totalCards.toLocaleString(),change:"Zero-state deployment",icon:oe,trend:"stable"}),e.jsx(l,{title:"Activation Rate",value:`${r.cardActivationRate}%`,change:"+2.3% improvement",icon:at,trend:"stable"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{title:"System Uptime",value:`${r.systemHealth.uptime}%`,change:"Last 30 days",icon:Fe,trend:"stable"}),e.jsx(l,{title:"Response Time",value:`${r.systemHealth.responseTime}ms`,change:"Average",icon:Be,trend:"stable"}),e.jsx(l,{title:"Error Rate",value:`${r.systemHealth.errorRate}%`,change:"Very low",icon:Q,trend:"down"}),e.jsx(l,{title:"Security Score",value:`${r.systemHealth.securityScore}/100`,change:"Excellent",icon:Fe,trend:"stable"})]}),v==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Regions"}),e.jsx("div",{className:"space-y-4",children:r.topRegions.map((g,S)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-3",children:S+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:g.region}),e.jsxs("p",{className:"text-sm text-gray-600",children:[g.clinics," clinics"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:g.cards.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"cards"})]})]},g.region))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Monthly Growth"}),e.jsx("div",{className:"space-y-4",children:r.monthlyGrowth.map(g=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[g.month," 2024"]}),e.jsxs("div",{className:"flex space-x-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600",children:[g.clinics," clinics"]}),e.jsxs("span",{className:"text-green-600",children:[g.cards.toLocaleString()," cards"]})]})]},g.month))})]})]}),v==="clinics"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Performing Clinics"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cards Generated"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activation Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.clinicPerformance.map((g,S)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:g.clinicName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:g.cardsGenerated.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${g.activationRate>=90?"bg-green-100 text-green-800":g.activationRate>=80?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[g.activationRate,"%"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["‚Ç±",g.revenue.toLocaleString()]})]},S))})]})})]})]})})}const It=900*1e3,te="mocards_auth_session",xe="mocards_last_activity",Tt=()=>{const[r,t]=d.useState(!1),[s,a]=d.useState(null),i=d.useCallback(()=>{const v=Date.now();if(localStorage.setItem(xe,v.toString()),s){const u={...s,lastActivity:v};a(u),localStorage.setItem(te,JSON.stringify(u))}},[s]),x=d.useCallback(v=>Date.now()-v.lastActivity<It,[]),f=d.useCallback((v,u)=>{const w=Date.now(),h={type:v,username:u.username||u.code,clinicId:u.id,clinicCode:u.code,loginTime:w,lastActivity:w};a(h),t(!0),localStorage.setItem(te,JSON.stringify(h)),localStorage.setItem(xe,w.toString()),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"login",user:h}}))},[]),y=d.useCallback(()=>{a(null),t(!1),localStorage.removeItem(te),localStorage.removeItem(xe),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"logout"}}))},[]);return d.useEffect(()=>{(()=>{try{const h=localStorage.getItem(te);if(h){const j=JSON.parse(h);x(j)?(a(j),t(!0),i()):(localStorage.removeItem(te),localStorage.removeItem(xe))}}catch(h){console.error("Error checking session:",h),localStorage.removeItem(te),localStorage.removeItem(xe)}})();const u=h=>{const{type:j,user:l}=h.detail;j==="login"&&l?(a(l),t(!0)):j==="logout"&&(a(null),t(!1))},w=h=>{if(h.key===te)if(h.newValue)try{const j=JSON.parse(h.newValue);x(j)&&(a(j),t(!0))}catch(j){console.error("Error parsing stored user data:",j)}else a(null),t(!1)};return window.addEventListener("auth-state-change",u),window.addEventListener("storage",w),()=>{window.removeEventListener("auth-state-change",u),window.removeEventListener("storage",w)}},[]),d.useEffect(()=>{if(!r||!s)return;const u=setInterval(()=>{s&&!x(s)&&y()},60*1e3);return()=>clearInterval(u)},[r,s,x,y]),d.useEffect(()=>{if(!r)return;const v=["mousedown","mousemove","keypress","scroll","touchstart","click"],u=()=>{i()};let w;const h=()=>{clearTimeout(w),w=setTimeout(u,1e3)};return v.forEach(j=>{document.addEventListener(j,h,!0)}),()=>{clearTimeout(w),v.forEach(j=>{document.removeEventListener(j,h,!0)})}},[r,i]),{isAuthenticated:r,user:s,login:f,logout:y,updateActivity:i}};function Pt(){const r=d.useRef(new Map),t=d.useRef(Date.now()),{addToast:s}=Se(),a=d.useCallback((h,j)=>(r.current.set(h,j),()=>{r.current.delete(h)}),[]),i=d.useCallback(async h=>{const j=Date.now();if(j-t.current<1e3)return;t.current=j,console.log("üîÑ Enterprise sync triggered:",h);const l=Array.from(r.current.values());try{await Promise.all(l.map(g=>Promise.resolve(g()))),console.log("‚úÖ Enterprise sync completed successfully"),(h.type==="card_generated"||h.type==="clinic_created")&&s({type:"success",title:"Data Synchronized",message:`${Ft(h.type)} - All features updated`,duration:3e3})}catch(g){console.error("‚ùå Enterprise sync failed:",g),s({type:"error",title:"Sync Error",message:"Failed to synchronize data across features",duration:5e3})}},[s]),x=d.useCallback(async h=>{await i({type:"card_generated",source:"card_generator",timestamp:Date.now(),data:{cardCount:h}})},[i]),f=d.useCallback(async(h,j)=>{await i({type:h==="created"?"clinic_created":"clinic_updated",source:"clinic_management",timestamp:Date.now(),data:{clinicName:j}})},[i]),y=d.useCallback(async h=>{await i({type:"data_changed",source:h,timestamp:Date.now()})},[i]);d.useEffect(()=>{const h=()=>{i({type:"data_changed",source:"window_focus",timestamp:Date.now()})};return window.addEventListener("focus",h),()=>window.removeEventListener("focus",h)},[i]),d.useEffect(()=>{const h=j=>{if(j.key==="mocards_sync_event"&&j.newValue)try{const l=JSON.parse(j.newValue);l.timestamp!==t.current&&i(l)}catch(l){console.error("Failed to parse sync event:",l)}};return window.addEventListener("storage",h),()=>window.removeEventListener("storage",h)},[i]);const v=d.useCallback(h=>{try{localStorage.setItem("mocards_sync_event",JSON.stringify(h)),setTimeout(()=>{localStorage.removeItem("mocards_sync_event")},100)}catch(j){console.error("Failed to broadcast sync event:",j)}},[]),u=d.useCallback(async h=>{const j={type:"card_generated",source:"card_generator",timestamp:Date.now(),data:{cardCount:h}};v(j),await i(j)},[v,i]),w=d.useCallback(async(h,j)=>{const l={type:h==="created"?"clinic_created":"clinic_updated",source:"clinic_management",timestamp:Date.now(),data:{clinicName:j}};v(l),await i(l)},[v,i]);return{registerSyncCallback:a,triggerSync:i,syncAfterCardGeneration:x,syncAfterClinicOperation:f,syncAfterDataChange:y,syncAfterCardGenerationBroadcast:u,syncAfterClinicOperationBroadcast:w}}function Ft(r){switch(r){case"card_generated":return"Cards generated";case"clinic_created":return"Clinic created";case"clinic_updated":return"Clinic updated";case"card_updated":return"Card updated";default:return"Data updated"}}function $t(){const[r,t]=d.useState(!1),[s,a]=d.useState(null),[i,x]=d.useState(null),f=async()=>{t(!0),x(null),a(null);try{console.log("[DEBUG] Starting database analysis...");const{data:y,error:v}=await Y.from("information_schema.columns").select("*").eq("table_name","cards").eq("table_schema","public"),{data:u,error:w}=await Y.from("cards").select("*").limit(10),{count:h,error:j}=await Y.from("cards").select("*",{count:"exact",head:!0}),{data:l,error:g}=await Y.from("cards").select("*").limit(5),S={tableStructure:{data:y,error:v},sampleCards:{data:u,error:w},totalCards:{count:h,error:j},testSearch:{data:l,error:g},timestamp:new Date().toISOString()};console.log("[DEBUG] Complete database analysis:",S),a(S)}catch(y){const v=y instanceof Error?y.message:"Unknown error";console.error("[DEBUG] Database check failed:",y),x(v)}finally{t(!1)}};return e.jsxs("div",{className:"light-card p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(qe,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Database Debugger"})]}),e.jsx("button",{onClick:f,disabled:r,className:"light-button-primary flex items-center space-x-2 mb-6",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing Database..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Run Database Analysis"})]})}),i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Database Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:i})]}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Database Analysis Complete"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Cards Table Structure"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:s.tableStructure.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",s.tableStructure.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Found ",s.tableStructure.data?.length||0," columns in cards table"]}),s.tableStructure.data&&s.tableStructure.data.length>0&&e.jsx("div",{className:"text-xs font-mono",children:s.tableStructure.data.map((y,v)=>e.jsxs("div",{className:"text-gray-700",children:[y.column_name,": ",y.data_type]},v))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Total Cards"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:s.totalCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",s.totalCards.error.message]}):e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[s.totalCards.count," cards"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Sample Cards Data"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto",children:s.sampleCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",s.sampleCards.error.message]}):e.jsx("pre",{className:"text-xs font-mono text-gray-700 whitespace-pre-wrap",children:JSON.stringify(s.sampleCards.data,null,2)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Basic Query Test"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:s.testSearch.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",s.testSearch.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Query returned ",s.testSearch.data?.length||0," cards"]}),s.testSearch.data&&s.testSearch.data.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"First card control_number:"}),e.jsx("p",{className:"font-mono text-blue-600",children:s.testSearch.data[0]?.control_number||"No control_number field"})]})]})})]}),e.jsxs("details",{className:"border border-gray-200 rounded-lg",children:[e.jsx("summary",{className:"p-4 cursor-pointer font-medium",children:"View Raw Results"}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("pre",{className:"text-xs font-mono text-gray-600 whitespace-pre-wrap overflow-x-auto",children:JSON.stringify(s,null,2)})})]})]})]})}class ce{static instance;analyticsTable=[{name:"analytics_events",description:"User interaction events",resetStrategy:"truncate"},{name:"analytics_metrics",description:"Business performance metrics",resetStrategy:"truncate"},{name:"analytics_sessions",description:"User session tracking",resetStrategy:"truncate"},{name:"analytics_dashboards",description:"Dashboard view analytics",resetStrategy:"truncate"},{name:"analytics_reports",description:"Generated reports cache",resetStrategy:"truncate"},{name:"card_usage_analytics",description:"Card usage tracking",resetStrategy:"truncate"},{name:"clinic_performance_metrics",description:"Clinic performance data",resetStrategy:"truncate"},{name:"appointment_analytics",description:"Appointment booking analytics",resetStrategy:"truncate"},{name:"revenue_analytics",description:"Revenue tracking data",resetStrategy:"truncate"},{name:"user_behavior_analytics",description:"User behavior patterns",resetStrategy:"truncate"}];constructor(){}static getInstance(){return ce.instance||(ce.instance=new ce),ce.instance}async resetToFreshState(){const t=`analytics_reset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={success:!1,clearedTables:[],errors:[],timestamp:new Date().toISOString(),resetId:t};console.log("üîÑ Starting Enterprise Analytics Reset...",{resetId:t}),Ie("analytics_reset_started",1,{resetId:t});try{for(const a of this.analyticsTable)try{await this.clearAnalyticsTable(a),s.clearedTables.push(a.name),console.log(`‚úÖ Cleared ${a.name}: ${a.description}`)}catch(i){const x=`Failed to clear ${a.name}: ${i instanceof Error?i.message:"Unknown error"}`;s.errors.push(x),Ue("error",x,{table:a.name,resetId:t})}await this.resetAnalyticsCounters(),s.clearedTables.push("analytics_counters_reset"),await this.clearLocalStorageAnalytics(),s.clearedTables.push("localStorage_analytics_cache"),await this.initializeFreshBaseline(t),s.clearedTables.push("fresh_baseline_initialized"),s.success=s.errors.length===0,console.log("üéâ Enterprise Analytics Reset Complete:",{success:s.success,clearedTables:s.clearedTables.length,errors:s.errors.length}),Ie("analytics_reset_completed",1,{resetId:t,success:s.success,tablesCleared:s.clearedTables.length,errors:s.errors.length})}catch(a){s.errors.push(`Critical reset error: ${a instanceof Error?a.message:"Unknown error"}`),s.success=!1,Ue("critical","Analytics reset failed",{error:a,resetId:t})}return s}async clearAnalyticsTable(t){switch(console.log(`üîÑ Clearing ${t.name} using ${t.resetStrategy} strategy`),t.resetStrategy){case"truncate":const{error:s}=await Y.from(t.name).delete().neq("id","00000000-0000-0000-0000-000000000000");if(s&&!s.message.includes("relation")&&!s.message.includes("does not exist"))throw s;break;case"delete":const{error:a}=await Y.from(t.name).delete().neq("id","00000000-0000-0000-0000-000000000000");if(a&&!a.message.includes("relation")&&!a.message.includes("does not exist"))throw a;break;case"update_zero":const{error:i}=await Y.from(t.name).update({count:0,value:0,total:0,last_reset:new Date().toISOString()}).neq("id","00000000-0000-0000-0000-000000000000");if(i&&!i.message.includes("relation")&&!i.message.includes("does not exist"))throw i;break}}async resetAnalyticsCounters(){console.log("üîÑ Resetting analytics counters in business tables");try{const{error:t}=await Y.from("cards").update({perks_used:0,last_analytics_update:new Date().toISOString()}).neq("id","00000000-0000-0000-0000-000000000000");t&&!t.message.includes("column")&&!t.message.includes("does not exist")&&console.warn("Could not reset card analytics counters:",t.message);const{error:s}=await Y.from("clinics").update({total_appointments:0,total_revenue:0,last_analytics_reset:new Date().toISOString()}).neq("id","00000000-0000-0000-0000-000000000000");s&&!s.message.includes("column")&&!s.message.includes("does not exist")&&console.warn("Could not reset clinic analytics counters:",s.message),console.log("‚úÖ Analytics counters reset completed")}catch(t){console.warn("Non-critical error resetting analytics counters:",t)}}async clearLocalStorageAnalytics(){console.log("üîÑ Clearing localStorage analytics cache"),["mocards_analytics_cache","mocards_dashboard_metrics","mocards_performance_data","mocards_user_analytics","mocards_business_metrics","mocards_last_analytics_sync","mocards_analytics_preferences","mocards_chart_cache","mocards_dashboard_state"].forEach(a=>{try{localStorage.removeItem(a),console.log(`‚úÖ Cleared localStorage key: ${a}`)}catch(i){console.warn(`Could not clear localStorage key ${a}:`,i)}}),["mocards_session_analytics","mocards_current_metrics","mocards_temp_dashboard_data"].forEach(a=>{try{sessionStorage.removeItem(a),console.log(`‚úÖ Cleared sessionStorage key: ${a}`)}catch(i){console.warn(`Could not clear sessionStorage key ${a}:`,i)}})}async initializeFreshBaseline(t){console.log("üîÑ Initializing fresh analytics baseline");const s={reset_id:t,deployment_start:new Date().toISOString(),initial_state:{total_users:0,total_cards:0,total_clinics:0,total_appointments:0,total_revenue:0},version:"1.0.0",reset_reason:"enterprise_fresh_deployment"};try{localStorage.setItem("mocards_analytics_baseline",JSON.stringify(s)),localStorage.setItem("mocards_last_analytics_reset",new Date().toISOString()),console.log("‚úÖ Fresh analytics baseline initialized")}catch(a){console.warn("Could not store analytics baseline:",a)}}async verifyResetCompletion(){console.log("üîç Verifying analytics reset completion");const t={verified:!0,details:{emptyTables:[],nonEmptyTables:[],localStorageCleared:!0,baselineExists:!1}};for(const s of this.analyticsTable)try{const{data:a,error:i}=await Y.from(s.name).select("id",{count:"exact",head:!0});i||((a?.length||0)===0?t.details.emptyTables.push(s.name):(t.details.nonEmptyTables.push(s.name),t.verified=!1))}catch{t.details.emptyTables.push(`${s.name} (not exists)`)}return t.details.localStorageCleared=!localStorage.getItem("mocards_analytics_cache"),t.details.baselineExists=!!localStorage.getItem("mocards_analytics_baseline"),t}getResetHistory(){try{const t=localStorage.getItem("mocards_last_analytics_reset"),s=localStorage.getItem("mocards_analytics_baseline");return{lastReset:t?new Date(t):null,baseline:s?JSON.parse(s):null,isReset:!!t&&!!s}}catch(t){return{lastReset:null,baseline:null,isReset:!1,error:t instanceof Error?t.message:"Unknown error"}}}}const Me=ce.getInstance(),Ot=()=>Me.resetToFreshState(),Lt=()=>Me.verifyResetCompletion(),qt=()=>Me.getResetHistory();function Mt(){const[r,t]=d.useState(null),[s,a]=d.useState(!1),[i,x]=d.useState(!1),[f,y]=d.useState(null),[v,u]=d.useState(!1),{addToast:w}=Se();d.useEffect(()=>{h()},[]);const h=async()=>{try{const N=qt();t(N),console.log("üìä Analytics Reset Status:",N)}catch(N){console.error("Failed to load reset status:",N)}},j=async()=>{if(!v){u(!0);return}u(!1),a(!0);try{w(Ve("Analytics Reset","Starting enterprise analytics reset...")),console.log("üöÄ Starting enterprise analytics reset...");const N=await Ot();N.success?(w(W("Reset Complete!",`Successfully reset ${N.clearedTables.length} analytics components`)),Ie("enterprise_analytics_reset_success",1,{resetId:N.resetId,tablesCleared:N.clearedTables.length}),await h(),console.log("‚úÖ Enterprise Analytics Reset Completed:",N)):(w(U("Reset Incomplete",`Reset completed with ${N.errors.length} errors. Check console for details.`)),console.error("‚ùå Analytics reset had errors:",N.errors))}catch(N){w(U("Reset Failed",`Analytics reset failed: ${N instanceof Error?N.message:"Unknown error"}`)),console.error("üí• Analytics reset failed:",N)}finally{a(!1)}},l=async()=>{x(!0);try{w(Ve("Verification","Verifying analytics reset completion..."));const N=await Lt();y(N),N.verified?w(W("Verification Passed","Analytics reset verified successfully!")):w(he("Verification Issues",`Found ${N.details.nonEmptyTables.length} tables with remaining data`)),console.log("üîç Verification Result:",N)}catch(N){w(U("Verification Failed",`Could not verify reset: ${N instanceof Error?N.message:"Unknown error"}`))}finally{x(!1)}},g=N=>N?(typeof N=="string"?new Date(N):N).toLocaleString():"Never",S=()=>r?r.isReset?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600",m=()=>r?r.isReset?"Reset to Fresh State":"Contains Historical Data":"Unknown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Oe,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Enterprise Analytics Manager"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Reset analytics to fresh state for client deployment"})]})]}),e.jsxs("div",{className:"light-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Analytics Status"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${S()}`,children:m()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Fe,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Last Reset"}),e.jsx("p",{className:"text-xs text-gray-600",children:g(r?.lastReset)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(qe,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Baseline Exists"}),e.jsx("p",{className:"text-xs text-gray-600",children:r?.baseline?"Yes":"No"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(at,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Reset ID"}),e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:r?.baseline?.reset_id?.slice(-8)||"None"})]})]})]})]}),e.jsxs("div",{className:"light-card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Analytics Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:j,disabled:s,className:`light-button-destructive flex items-center justify-center space-x-2 p-4 ${s?"opacity-50 cursor-not-allowed":""}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Resetting Analytics..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{children:"Reset to Fresh State"})]})}),e.jsx("button",{onClick:l,disabled:i,className:`light-button-secondary flex items-center justify-center space-x-2 p-4 ${i?"opacity-50 cursor-not-allowed":""}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{children:"Verify Reset"})]})})]})]}),f&&e.jsxs("div",{className:"light-card p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[f.verified?e.jsx(B,{className:"h-6 w-6 text-green-500"}):e.jsx(Q,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Verification Results"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-green-700 mb-2",children:["‚úÖ Empty Tables (",f.details.emptyTables.length,")"]}),e.jsxs("div",{className:"space-y-1",children:[f.details.emptyTables.slice(0,5).map((N,E)=>e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:N},E)),f.details.emptyTables.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",f.details.emptyTables.length-5," more"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-red-700 mb-2",children:["‚ö†Ô∏è Non-Empty Tables (",f.details.nonEmptyTables.length,")"]}),e.jsxs("div",{className:"space-y-1",children:[f.details.nonEmptyTables.map((N,E)=>e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:N},E)),f.details.nonEmptyTables.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"All analytics tables are empty ‚úÖ"})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["LocalStorage Cleared: ",f.details.localStorageCleared?"Yes":"No"]}),e.jsxs("span",{className:"text-gray-600",children:["Baseline Exists: ",f.details.baselineExists?"Yes":"No"]})]})})]}),r?.baseline&&e.jsxs("div",{className:"light-card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Current Baseline"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Users:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.baseline.initial_state?.total_users||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cards:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.baseline.initial_state?.total_cards||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Clinics:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:r.baseline.initial_state?.total_clinics||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Revenue:"}),e.jsxs("span",{className:"ml-2 text-gray-900",children:["‚Ç±",r.baseline.initial_state?.total_revenue||0]})]})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(Q,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Analytics Reset"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"This will permanently delete all analytics data including:"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1 ml-4",children:[e.jsx("li",{children:"‚Ä¢ All historical analytics events and metrics"}),e.jsx("li",{children:"‚Ä¢ Performance data and user behavior analytics"}),e.jsx("li",{children:"‚Ä¢ Dashboard cache and stored analytics preferences"}),e.jsx("li",{children:"‚Ä¢ Business metrics and revenue tracking data"})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-3",children:"The system will be reset to a fresh state as if newly deployed."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 light-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:j,className:"flex-1 light-button-destructive",children:"Reset Analytics"})]})]})})]})}const Ut="https://lxyexybnotixgpzflota.supabase.co",Vt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4eWV4eWJub3RpeGdwemZsb3RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMDcwODIsImV4cCI6MjA3NTc4MzA4Mn0.TSbnvPKWiDdEFbyOh38qj_L87LZ75p3FiOW05hzEBlM";console.warn("Using default Supabase URL. Please set VITE_SUPABASE_URL in your environment.");const b=_t(Ut,Vt,{auth:{persistSession:!1,autoRefreshToken:!1}}),Bt={async createCardBatch(r){const{data:t,error:s}=await b.from("card_batches").insert(r).select().single();if(s)throw s;return t},async generateCardsForBatch(r,t,s,a){try{if(!r||!t||!s||a<=0)throw new Error("Invalid parameters for card generation");if(a>1e4)throw new Error("Maximum 10,000 cards per batch allowed");const{data:i}=await b.from("location_codes").select("code").eq("code",s).eq("is_active",!0).single();if(!i)throw new Error(`Location code '${s}' not found or inactive`);const x=[];for(let v=1;v<=a;v++)try{const u=await this.generateControlNumber(t,v),w=await this.generatePasscode(s);x.push({batch_id:r,control_number:u,passcode:w,location_code:s,status:"unassigned",generation_method:"auto"})}catch(u){throw new Error(`Failed to generate card ${v}: ${u instanceof Error?u.message:"Unknown error"}`)}const{data:f,error:y}=await b.from("cards").insert(x).select();if(y)throw new Error(`Database error inserting cards: ${y.message}`);if(!f||f.length!==a)throw new Error(`Expected ${a} cards, but only ${f?.length||0} were created`);for(const v of f)try{await this.createDefaultPerksForCard(v.id)}catch(u){console.warn(`Failed to create perks for card ${v.id}:`,u)}return f}catch(i){throw console.error("Error generating cards for batch:",i),i}},async generateControlNumber(r,t,s=5){for(let a=0;a<s;a++){const i=(t+a).toString().padStart(4,"0"),x=`PHL-${r}-${i}`,{data:f,error:y}=await b.from("cards").select("id").eq("control_number",x).single();if(y&&y.code==="PGRST116")return x;if(y&&y.code!=="PGRST116")throw y;if(f&&a<s-1){console.warn(`Control number collision detected: ${x}. Trying next sequence... (attempt ${a+1}/${s})`);continue}if(f&&a===s-1)throw new Error(`Failed to generate unique control number after ${s} attempts. Batch: ${r}, Sequence: ${t}`)}throw new Error("Unexpected error in control number generation")},async generatePasscode(r,t=3){for(let s=0;s<t;s++){const a=Math.floor(1e3+Math.random()*9e3).toString(),i=`${r}-${a}`,{data:x,error:f}=await b.from("cards").select("id").eq("passcode",i).single();if(f&&f.code==="PGRST116")return i;if(f&&f.code!=="PGRST116")throw f;if(x&&s<t-1){console.warn(`Passcode collision detected: ${i}. Retrying... (attempt ${s+1}/${t})`);continue}if(x&&s===t-1)throw new Error(`Failed to generate unique passcode after ${t} attempts. Location: ${r}`)}throw new Error("Unexpected error in passcode generation")},async createDefaultPerksForCard(r){const s=[{perk_type:"consultation",perk_value:500},{perk_type:"cleaning",perk_value:800},{perk_type:"xray",perk_value:1e3},{perk_type:"extraction",perk_value:1500},{perk_type:"filling",perk_value:1200}].map(i=>({card_id:r,...i,expires_at:new Date(Date.now()+365*24*60*60*1e3).toISOString()})),{error:a}=await b.from("card_perks").insert(s);if(a)throw a},async assignCardsToClinic(r,t,s){const{data:a,error:i}=await b.from("cards").update({clinic_id:t,status:"assigned",assigned_at:new Date().toISOString(),updated_at:new Date().toISOString()}).in("id",r).eq("status","unassigned").select();if(i)throw i;for(const x of a)try{await this.logCardTransaction(x.id,"assigned",s||"system",{assigned_to_clinic:t,previous_status:"unassigned"})}catch(f){console.warn(`Failed to log assignment for card ${x.id}:`,f)}return a},async activateCard(r,t,s,a){const{data:i,error:x}=await b.from("cards").select("*").eq("id",r).eq("clinic_id",t).eq("status","assigned").single();if(x||!i)throw new Error("Card not found or not assigned to this clinic");const{data:f,error:y}=await b.from("cards").update({status:"activated",activated_at:new Date().toISOString(),expires_at:new Date(Date.now()+365*24*60*60*1e3).toISOString(),updated_at:new Date().toISOString()}).eq("id",r).select().single();if(y)throw y;return await this.logCardTransaction(r,"activated",s,{activated_by_name:a,activation_clinic:t,expires_at:f.expires_at,previous_status:"assigned"}),f},async logCardTransaction(r,t,s,a){const{error:i}=await b.from("card_transactions").insert({card_id:r,transaction_type:t,performed_by:s,details:a,created_at:new Date().toISOString()});i&&console.warn(`Failed to log transaction for card ${r}:`,i)},async createClinic(r){const{data:t,error:s}=await b.from("clinics").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(s)throw s;return t},async getAllClinics(){const{data:r,error:t}=await b.from("clinics").select("*").order("name");if(t)throw t;return r},async getActiveClinics(){const{data:r,error:t}=await b.from("clinics").select("*").eq("status","active").order("name");if(t)throw t;return r},async updateClinic(r,t){const{data:s,error:a}=await b.from("clinics").update({...t,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return s},async getClinicByCode(r){const{data:t,error:s}=await b.from("clinics").select("*").eq("clinic_code",r).single();if(s)throw s;return t},async getUnassignedCards(r=100){const{data:t,error:s}=await b.from("cards").select(`
        *,
        card_batches!inner(batch_number)
      `).eq("status","unassigned").order("created_at").limit(r);if(s)throw s;return t},async getClinicCards(r){const{data:t,error:s}=await b.from("cards").select(`
        *,
        card_batches!inner(batch_number)
      `).eq("clinic_id",r).order("assigned_at",{ascending:!1});if(s)throw s;return t},async lookupCard(r,t){const{data:s,error:a}=await b.from("cards").select(`
        *,
        clinics(name),
        card_perks(*)
      `).eq("control_number",r.toUpperCase()).eq("passcode",t.toUpperCase()).single();if(a)throw a;return s},async claimPerk(r,t){const{data:s,error:a}=await b.from("card_perks").update({claimed:!0,claimed_at:new Date().toISOString()}).eq("card_id",r).eq("perk_type",t).eq("claimed",!1).select().single();if(a)throw a;return s},async getLocationCodes(){const{data:r,error:t}=await b.from("location_codes").select("*").eq("is_active",!0).order("code");if(t)throw t;return r},async createLocationCode(r){try{if(!r.code||!r.location_name)throw new Error("Location code and name are required");const t={...r,code:r.code.trim().toUpperCase(),location_name:r.location_name.trim(),description:r.description?.trim()||null};if(t.code.length!==3)throw new Error("Location code must be exactly 3 characters");const{data:s,error:a}=await b.from("location_codes").insert([t]).select().single();if(a)throw a.code==="23505"?new Error(`Location code '${t.code}' already exists`):new Error(`Database error: ${a.message}`);if(!s)throw new Error("Failed to create location code - no data returned");return s}catch(t){throw console.error("Error creating location code:",t),t}},async getAllBatches(){const{data:r,error:t}=await b.from("card_batches").select("*").order("created_at",{ascending:!1});if(t)throw t;return r},async getBatchById(r){const{data:t,error:s}=await b.from("card_batches").select("*").eq("id",r).single();if(s)throw s;return t},async authenticateAdmin(r,t){const{EnterpriseAuth:s}=await ee(async()=>{const{EnterpriseAuth:i}=await Promise.resolve().then(()=>Je);return{EnterpriseAuth:i}},void 0),a=await s.authenticateAdmin(r,t);if(!a.success)throw new Error(a.message||"Authentication failed");return a.user},async authenticateClinic(r,t){const{EnterpriseAuth:s}=await ee(async()=>{const{EnterpriseAuth:i}=await Promise.resolve().then(()=>Je);return{EnterpriseAuth:i}},void 0),a=await s.authenticateClinic(r,t);if(!a.success)throw new Error(a.message||"Authentication failed");return a.user},async getDashboardStats(){const[r,t,s,a,i,x]=await Promise.all([b.from("clinics").select("id",{count:"exact"}),b.from("card_batches").select("id",{count:"exact"}),b.from("cards").select("id",{count:"exact"}),b.from("cards").select("id",{count:"exact"}).eq("status","unassigned"),b.from("cards").select("id",{count:"exact"}).eq("status","assigned"),b.from("cards").select("id",{count:"exact"}).eq("status","activated")]);return{totalClinics:r.count||0,totalBatches:t.count||0,totalCards:s.count||0,unassignedCards:a.count||0,assignedCards:i.count||0,activatedCards:x.count||0}},async updateLocationCode(r,t){const{data:s,error:a}=await b.from("location_codes").update({...t,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return s},async deleteLocationCode(r){const{data:t,error:s}=await b.from("cards").select("id").eq("location_code",(await this.getLocationCodeById(r)).code).limit(1);if(s)throw s;if(t&&t.length>0)throw new Error("Cannot delete location code - it is being used by existing cards");const{error:a}=await b.from("location_codes").delete().eq("id",r);if(a)throw a;return!0},async getLocationCodeById(r){const{data:t,error:s}=await b.from("location_codes").select("*").eq("id",r).single();if(s)throw s;return t},async getAllLocationCodes(){const{data:r,error:t}=await b.from("location_codes").select("*").order("code");if(t)throw t;return r},async deleteClinic(r){const{data:t,error:s}=await b.from("cards").select("id").eq("clinic_id",r).limit(1);if(s)throw s;if(t&&t.length>0)throw new Error("Cannot delete clinic - it has assigned cards. Please reassign cards first.");const{error:a}=await b.from("clinics").delete().eq("id",r);if(a)throw a;return!0},async getClinicById(r){const{data:t,error:s}=await b.from("clinics").select("*").eq("id",r).single();if(s)throw s;return t},async getClinicStats(r){const[t,s,a]=await Promise.all([b.from("cards").select("id",{count:"exact"}).eq("clinic_id",r),b.from("cards").select("id",{count:"exact"}).eq("clinic_id",r).eq("status","assigned"),b.from("cards").select("id",{count:"exact"}).eq("clinic_id",r).eq("status","activated")]);return{totalCards:t.count||0,assignedCards:s.count||0,activatedCards:a.count||0}},async updateBatch(r,t){const{data:s,error:a}=await b.from("card_batches").update({...t,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return s},async deleteBatch(r){const{data:t,error:s}=await b.from("cards").select("id").eq("batch_id",r).limit(1);if(s)throw s;if(t&&t.length>0)throw new Error("Cannot delete batch - it contains cards. Delete cards first or use cascade delete.");const{error:a}=await b.from("card_batches").delete().eq("id",r);if(a)throw a;return!0},async deleteBatchCascade(r){const{error:t}=await b.from("card_batches").delete().eq("id",r);if(t)throw t;return!0},async getCardById(r){const{data:t,error:s}=await b.from("cards").select(`
        *,
        clinics(name, clinic_code),
        card_batches(batch_number),
        card_perks(*)
      `).eq("id",r).single();if(s)throw s;return t},async updateCard(r,t){const{data:s,error:a}=await b.from("cards").update({...t,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return s},async deleteCard(r){const{error:t}=await b.from("cards").delete().eq("id",r);if(t)throw t;return!0},async getAllCards(r=100,t=0){const{data:s,error:a}=await b.from("cards").select(`
        *,
        clinics(name, clinic_code),
        card_batches(batch_number)
      `).order("created_at",{ascending:!1}).range(t,t+r-1);if(a)throw a;return s},async getSystemConfig(){const{data:r,error:t}=await b.from("system_config").select("*").eq("is_active",!0).order("category",{ascending:!0});if(t)throw t;return r},async getConfigByKey(r){const{data:t,error:s}=await b.from("system_config").select("*").eq("config_key",r).eq("is_active",!0).single();if(s)throw s;return t},async updateConfig(r,t){const{data:s,error:a}=await b.from("system_config").update({config_value:t,updated_at:new Date().toISOString()}).eq("config_key",r).select().single();if(a)throw a;return s},async createConfig(r){const{data:t,error:s}=await b.from("system_config").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(s)throw s;return t},async getTextLabels(){const{data:r,error:t}=await b.from("text_labels").select("*").order("label_category",{ascending:!0});if(t)throw t;return r},async getLabelByKey(r){const{data:t,error:s}=await b.from("text_labels").select("*").eq("label_key",r).single();if(s)throw s;return t},async updateLabel(r,t){const{data:s,error:a}=await b.from("text_labels").update({label_value:t,updated_at:new Date().toISOString()}).eq("label_key",r).eq("is_customizable",!0).select().single();if(a)throw a;return s},async createLabel(r){const{data:t,error:s}=await b.from("text_labels").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(s)throw s;return t},async getCodeFormats(){const{data:r,error:t}=await b.from("code_formats").select("*").eq("is_active",!0).order("format_type",{ascending:!0});if(t)throw t;return r},async getFormatsByType(r){const{data:t,error:s}=await b.from("code_formats").select("*").eq("format_type",r).eq("is_active",!0).order("is_default",{ascending:!1});if(s)throw s;return t},async updateCodeFormat(r,t){const{data:s,error:a}=await b.from("code_formats").update({...t,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return s},async createCodeFormat(r){const{data:t,error:s}=await b.from("code_formats").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(s)throw s;return t},async deleteCodeFormat(r){const{error:t}=await b.from("code_formats").delete().eq("id",r);if(t)throw t;return!0}},Gt=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],Ke=["Consultation","Cleaning","X-Ray","Filling","Extraction","Root Canal","Crown/Bridge","Whitening","Orthodontics","Oral Surgery","Emergency","Follow-up"];function zt({}){const[r,t]=d.useState(!1),[s,a]=d.useState(""),[i,x]=d.useState(""),[f,y]=d.useState(new Date),[v,u]=d.useState("month"),[w,h]=d.useState([]),[j,l]=d.useState([]),[g,S]=d.useState([]),[m,N]=d.useState("all"),[E,T]=d.useState("all"),[P,M]=d.useState("all"),[o,I]=d.useState(""),[F,_]=d.useState(!1),[D,$]=d.useState(null),[R,O]=d.useState({clinic_id:"",patient_name:"",patient_email:"",patient_phone:"",date:"",time:"",service_type:"",status:"scheduled",notes:""}),[G,X]=d.useState({total:0,today:0,thisWeek:0,scheduled:0,confirmed:0,completed:0,cancelled:0});d.useEffect(()=>{K()},[f,m,E,P]),d.useEffect(()=>{_e()},[w,o,m,E,P]);const K=async()=>{t(!0);try{const c=await Bt.getAllClinics();l(c);const p=[{id:"1",clinic_id:c[0]?.id||"",patient_name:"John Doe",patient_email:"john@example.com",patient_phone:"+63 912 345 6789",date:new Date().toISOString().split("T")[0],time:"09:00",service_type:"Consultation",status:"scheduled",notes:"First time patient",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),clinic:c[0]||{}},{id:"2",clinic_id:c[0]?.id||"",patient_name:"Jane Smith",patient_email:"jane@example.com",patient_phone:"+63 912 345 6790",date:new Date(Date.now()+864e5).toISOString().split("T")[0],time:"14:30",service_type:"Cleaning",status:"confirmed",notes:"Regular cleaning appointment",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),clinic:c[0]||{}}];h(p);const k=new Date,Z=k.toISOString().split("T")[0],z=new Date(k.getFullYear(),k.getMonth(),k.getDate()-k.getDay()),ke=new Date(k.getFullYear(),k.getMonth(),k.getDate()-k.getDay()+6),Ee={total:p.length,today:p.filter(J=>J.date===Z).length,thisWeek:p.filter(J=>{const ye=new Date(J.date);return ye>=z&&ye<=ke}).length,scheduled:p.filter(J=>J.status==="scheduled").length,confirmed:p.filter(J=>J.status==="confirmed").length,completed:p.filter(J=>J.status==="completed").length,cancelled:p.filter(J=>J.status==="cancelled").length};X(Ee)}catch(c){a(c.message||"Failed to load appointment data")}finally{t(!1)}},_e=()=>{let c=w;o&&(c=c.filter(p=>p.patient_name.toLowerCase().includes(o.toLowerCase())||p.patient_email?.toLowerCase().includes(o.toLowerCase())||p.service_type.toLowerCase().includes(o.toLowerCase()))),m!=="all"&&(c=c.filter(p=>p.clinic_id===m)),E!=="all"&&(c=c.filter(p=>p.status===E)),P!=="all"&&(c=c.filter(p=>p.service_type===P)),S(c)},pe=async c=>{c.preventDefault(),t(!0),a("");try{const p={id:Date.now().toString(),...R,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),clinic:j.find(k=>k.id===R.clinic_id)||{}};h(k=>[...k,p]),x("Appointment created successfully"),_(!1),re()}catch(p){a(p.message||"Failed to create appointment")}finally{t(!1)}},fe=async(c,p)=>{try{h(k=>k.map(Z=>Z.id===c?{...Z,status:p,updated_at:new Date().toISOString()}:Z)),x(`Appointment ${p} successfully`)}catch(k){a(k.message||"Failed to update appointment")}},re=()=>{O({clinic_id:"",patient_name:"",patient_email:"",patient_phone:"",date:"",time:"",service_type:"",status:"scheduled",notes:""}),$(null)},de=c=>{switch(c){case"scheduled":return e.jsx(Re,{className:"h-4 w-4"});case"confirmed":return e.jsx(B,{className:"h-4 w-4"});case"completed":return e.jsx(B,{className:"h-4 w-4"});case"cancelled":return e.jsx(Ge,{className:"h-4 w-4"});case"no_show":return e.jsx(vt,{className:"h-4 w-4"});default:return e.jsx(je,{className:"h-4 w-4"})}},Ae=c=>{switch(c){case"scheduled":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"no_show":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},L=()=>{const c=[["Date","Time","Patient","Email","Phone","Service","Status","Clinic","Notes"].join(","),...g.map(z=>[z.date,z.time,z.patient_name,z.patient_email||"",z.patient_phone||"",z.service_type,z.status,z.clinic.name,z.notes||""].join(","))].join(`
`),p=new Blob([c],{type:"text/csv"}),k=window.URL.createObjectURL(p),Z=document.createElement("a");Z.href=k,Z.download=`appointments-${new Date().toISOString().split("T")[0]}.csv`,Z.click(),window.URL.revokeObjectURL(k)};return e.jsxs("div",{className:"space-y-6",children:[s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:s}),i&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:i}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.total})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Re,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.today})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"This Week"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.thisWeek})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Re,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Scheduled"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.scheduled})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Confirmed"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.confirmed})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.completed})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:G.cancelled})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(new Date(f.getFullYear(),f.getMonth()-1)),className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(yt,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 min-w-[200px] text-center",children:f.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>y(new Date(f.getFullYear(),f.getMonth()+1)),className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(bt,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>y(new Date),className:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50",children:"Today"})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:["month","week","day"].map(c=>e.jsx("button",{onClick:()=>u(c),className:`px-3 py-1 text-sm rounded capitalize ${v===c?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50"}`,children:c},c))}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:L,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"New Appointment"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search patients...",value:o,onChange:c=>I(c.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("select",{value:m,onChange:c=>N(c.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Clinics"}),j.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsxs("select",{value:E,onChange:c=>T(c.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"no_show",children:"No Show"})]}),e.jsxs("select",{value:P,onChange:c=>M(c.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Services"}),Ke.map(c=>e.jsx("option",{value:c,children:c},c))]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:["Showing ",g.length," of ",w.length," appointments"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Service"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No appointments found matching your criteria"})]})}):g.map(c=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:new Date(c.date).toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-500",children:c.time})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(jt,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:c.patient_name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[c.patient_email&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(tt,{className:"h-3 w-3 text-gray-400 mr-1"}),e.jsx("span",{className:"text-xs",children:c.patient_email})]}),c.patient_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(st,{className:"h-3 w-3 text-gray-400 mr-1"}),e.jsx("span",{className:"text-xs",children:c.patient_phone})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.service_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(wt,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("div",{className:"text-sm text-gray-900",children:c.clinic.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Ae(c.status)}`,children:[de(c.status),e.jsx("span",{className:"ml-1 capitalize",children:c.status})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[c.status==="scheduled"&&e.jsx("button",{onClick:()=>fe(c.id,"confirmed"),className:"text-blue-600 hover:text-blue-900",title:"Confirm appointment",children:e.jsx(B,{className:"h-4 w-4"})}),c.status==="confirmed"&&e.jsx("button",{onClick:()=>fe(c.id,"completed"),className:"text-green-600 hover:text-green-900",title:"Mark as completed",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900",title:"View details",children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900",title:"Edit appointment",children:e.jsx(ve,{className:"h-4 w-4"})})]})})]},c.id))})]})})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:D?"Edit Appointment":"New Appointment"}),e.jsx("button",{onClick:()=>{_(!1),re()},className:"text-gray-400 hover:text-gray-600",children:e.jsx("span",{className:"text-2xl",children:"√ó"})})]}),e.jsxs("form",{onSubmit:pe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Clinic *"}),e.jsxs("select",{required:!0,value:R.clinic_id,onChange:c=>O(p=>({...p,clinic_id:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select clinic"}),j.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name *"}),e.jsx("input",{type:"text",required:!0,value:R.patient_name,onChange:c=>O(p=>({...p,patient_name:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",value:R.patient_email,onChange:c=>O(p=>({...p,patient_email:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("input",{type:"tel",value:R.patient_phone,onChange:c=>O(p=>({...p,patient_phone:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date *"}),e.jsx("input",{type:"date",required:!0,value:R.date,onChange:c=>O(p=>({...p,date:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Time *"}),e.jsxs("select",{required:!0,value:R.time,onChange:c=>O(p=>({...p,time:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select time"}),Gt.map(c=>e.jsx("option",{value:c,children:c},c))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Service Type *"}),e.jsxs("select",{required:!0,value:R.service_type,onChange:c=>O(p=>({...p,service_type:c.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select service"}),Ke.map(c=>e.jsx("option",{value:c,children:c},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{value:R.notes,onChange:c=>O(p=>({...p,notes:c.target.value})),rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{_(!1),re()},className:"flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:r?"Creating...":D?"Update":"Create"})]})]})]})})})]})}function Xt(){const{isAuthenticated:r,login:t,logout:s}=Tt();St({enabled:!0,showNotifications:!0});const{registerSyncCallback:a,syncAfterCardGenerationBroadcast:i}=Pt(),[x,f]=d.useState({username:"",password:""}),[y,v]=d.useState("analytics"),[u,w]=d.useState({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}}),[h,j]=d.useState(""),[l,g]=d.useState(null),[S,m]=d.useState({clinicId:"",startRange:"",endRange:""}),[N,E]=d.useState(!1),[T,P]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[M,o]=d.useState({username:"admin",password:"admin123"}),[I,F]=d.useState("cards"),[_,D]=d.useState(null),[$,R]=d.useState(""),[O,G]=d.useState([]),[X,K]=d.useState([]),[_e,pe]=d.useState([]),[fe,re]=d.useState(!0),[de,Ae]=d.useState("all"),[L,c]=d.useState({fullName:"",status:"inactive",perksTotal:5,perksUsed:0,clinicId:"",expiryDate:"",notes:""}),{addToast:p}=Se();d.useEffect(()=>{(async()=>await ie.initializeDefaults())()},[]),d.useEffect(()=>{const n=async()=>{try{re(!0);const[C,A,H]=await Promise.all([ne.getAll(),ue.getAll(),ie.getAll()]);G(C),K(A),pe(H)}catch(C){console.error("Failed to load data:",C),p(U("Error","Failed to load data"))}finally{re(!1)}};if(r){n();const C=Y.channel("admin-cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},async H=>{console.log("[Admin] Real-time cards change detected:",H);try{const V=await ne.getAll();G(V)}catch(V){console.error("Failed to reload cards after real-time update:",V)}}).subscribe(),A=Y.channel("admin-clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},async H=>{console.log("[Admin] Real-time clinics change detected:",H);try{const V=await ue.getAll();K(V)}catch(V){console.error("Failed to reload clinics after real-time update:",V)}}).subscribe();return()=>{C.unsubscribe(),A.unsubscribe()}}},[r]);const k=async()=>{try{const[n,C,A]=await Promise.all([ne.getAll(),ue.getAll(),ie.getAll()]);G(n),K(C),pe(A)}catch(n){console.error("Failed to reload data:",n),p(U("Error","Failed to reload data"))}};d.useEffect(()=>{if(r)return a("admin_portal_data",async()=>{console.log("üîÑ Enterprise sync triggered - reloading admin portal data"),await k()})},[r,a]),d.useEffect(()=>{y==="master-list"&&r&&(console.log("üîÑ Refreshing data for master list sync"),k()),y==="appointments"&&r&&(console.log("üîÑ Refreshing appointment data sync"),k())},[y,r]);const Z=async n=>{n.preventDefault();try{const C=await rt.authenticateAdmin(x.username,x.password);C.success&&C.user&&C.token?(t("admin",C.user),localStorage.setItem("mocards_auth_token",C.token),p(W("Welcome","Secure admin access granted"))):p(U("Login Failed",C.message||"Invalid credentials"))}catch(C){console.error("Authentication error:",C),p(U("Login Failed","Authentication system error"))}},z=n=>{if(n.preventDefault(),T.currentPassword!==M.password){p(U("Invalid Password","Current password is incorrect"));return}if(T.newPassword.length<8){p(U("Password Too Short","New password must be at least 8 characters long"));return}if(T.newPassword!==T.confirmPassword){p(U("Passwords Do Not Match","Please confirm your new password correctly"));return}o({...M,password:T.newPassword}),P({currentPassword:"",newPassword:"",confirmPassword:""}),E(!1),p(W("Password Changed","Admin password has been updated successfully"))},ke=async()=>{if(!u.form.name||!u.form.description){p(he("Missing Fields","Please fill all required fields"));return}u.editingPerk?(await ie.update(u.editingPerk.id,u.form),p(W("Perk Updated",`Updated ${u.form.name}`))):(await ie.create(u.form),p(W("Perk Created",`Created ${u.form.name}`))),await k(),w({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}})},Ee=n=>{w({showModal:!0,editingPerk:n,form:{type:n.type,name:n.name,description:n.description,value:n.value,isActive:n.isActive,validFor:n.validFor,requiresApproval:n.requiresApproval}})},J=async n=>{await ie.delete(n.id),p(W("Perk Deleted",`Deleted ${n.name}`)),await k()},ye=[{value:"dental_cleaning",label:"Dental Cleaning"},{value:"consultation",label:"Consultation"},{value:"xray",label:"X-Ray"},{value:"treatment",label:"Treatment"},{value:"discount",label:"Discount"},{value:"extraction",label:"Tooth Extraction (Bunot)"},{value:"filling",label:"Tooth Filling (Pasta)"},{value:"fluoride",label:"Fluoride Treatment"},{value:"checkup",label:"Checkup/Unlimited"}],nt=()=>{if(!h.trim())return;const n=O.find(C=>C.controlNumber===h);g(n||null),n||p(he("Card Not Found","No card found with this number"))},it=async()=>{if(!l)return;const n=l.status==="active"?"inactive":"active";await ne.updateStatus(l.controlNumber,n)?(g({...l,status:n}),p(W("Status Updated",`Card is now ${n}`)),await k()):p(U("Update Failed","Failed to update card status"))},lt=async()=>{if(!S.clinicId||!S.startRange||!S.endRange){p(he("Missing Fields","Please fill all fields"));return}const n=await ue.getById(S.clinicId);if(!n){p(U("Invalid Clinic","Clinic not found"));return}const A=O.filter(me=>me.controlNumber>=S.startRange&&me.controlNumber<=S.endRange&&!me.clinicId);if(A.length===0){p(he("No Cards","No unassigned cards found in this range"));return}const H=await ue.getAssignedCardsCount(n.id),V=ut[n.plan];if(H+A.length>V){p(U("Plan Limit Exceeded",`This would exceed the ${n.plan} plan limit of ${V} cards. Current: ${H}`));return}await ne.assignToClinic(A.map(me=>me.controlNumber),n.id)?(p(W("Cards Assigned",`Assigned ${A.length} cards to ${n.name}`)),m({clinicId:"",startRange:"",endRange:""}),await k()):p(U("Assignment Failed","Failed to assign cards to clinic"))},ct=n=>{const C=O.find(A=>A.controlNumber===n);C&&(c({fullName:C.fullName,status:C.status,perksTotal:C.perksTotal,perksUsed:C.perksUsed,clinicId:C.clinicId,expiryDate:C.expiryDate,notes:C.notes||""}),D(n))},ot=async n=>{const C=O.find(A=>A.controlNumber===n);if(C)try{const A={fullName:L.fullName,status:L.status,perksTotal:L.perksTotal,perksUsed:L.perksUsed,clinicId:L.clinicId,expiryDate:L.expiryDate,notes:L.notes,updatedAt:new Date().toISOString()};if(await xt.cards.update(C.id,A))D(null),p(W("Card Updated",`Updated ${n} successfully`)),await k();else throw new Error("Failed to save to database")}catch{p(U("Update Failed","Failed to update card"))}},dt=async n=>{if(window.confirm(`Are you sure you want to delete card ${n}? This action cannot be undone.`))try{await ne.delete(n)?(p(W("Card Deleted",`Card ${n} has been deleted`)),await k()):p(U("Delete Failed","Could not delete card"))}catch{p(U("Delete Failed","Could not delete card"))}},De=[{id:"analytics",label:"Analytics",icon:Oe,color:"blue"},{id:"generator",label:"Generator",icon:we,color:"emerald"},{id:"activation",label:"Activation",icon:Ze,color:"cyan"},{id:"appointments",label:"Appointments",icon:je,color:"rose"},{id:"clinic-management",label:"Manage Clinics",icon:ae,color:"indigo"},{id:"endorsement",label:"Endorsement",icon:Nt,color:"orange"},{id:"master-list",label:"Master List",icon:qe,color:"purple"},{id:"debug",label:"Debug DB",icon:Q,color:"red"},{id:"settings",label:"Settings",icon:Te,color:"gray"}];if(!r)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(ze,{className:"h-8 w-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Please authenticate to continue"})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:x.username,onChange:n=>f({...x,username:n.target.value}),className:"light-input",placeholder:"Enter admin username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:x.password,onChange:n=>f({...x,password:n.target.value}),className:"light-input",placeholder:"Enter admin password",required:!0})]}),e.jsx("button",{type:"submit",className:"light-button-primary w-full",children:"Access Admin Portal"})]})]})});const mt=[{label:"Total Cards",value:O.length,icon:oe,color:"blue"},{label:"Active Clinics",value:X.length,icon:Le,color:"green"},{label:"Active Cards",value:O.filter(n=>n.status==="active").length,icon:B,color:"emerald"},{label:"Pending Cards",value:O.filter(n=>n.status==="inactive").length,icon:Q,color:"yellow"}];return fe?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"light-card p-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin data..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 px-3 sm:px-0",children:[e.jsx("div",{className:"light-card mb-3 sm:mb-6",children:e.jsx("div",{className:"p-3 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-red-100 rounded-2xl flex items-center justify-center",children:e.jsx(ze,{className:"h-5 w-5 sm:h-6 sm:w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:"Admin Control Room"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"MOCARDS System Administration"})]})]}),e.jsxs("button",{onClick:s,className:"light-button-secondary flex items-center justify-center space-x-2 w-full sm:w-auto",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6 mb-3 sm:mb-6",children:mt.map((n,C)=>{const A=n.icon;return e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:n.label}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:n.value})]}),e.jsx("div",{className:`w-12 h-12 bg-${n.color}-100 rounded-2xl flex items-center justify-center`,children:e.jsx(A,{className:`h-6 w-6 text-${n.color}-600`})})]})},C)})}),e.jsx("div",{className:"light-card mb-3 sm:mb-6",children:e.jsxs("div",{className:"p-3 sm:p-6",children:[e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"relative",children:e.jsx("select",{value:y,onChange:n=>v(n.target.value),className:"w-full light-select py-3 pr-10 text-base font-medium",children:De.map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))})})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"bg-gray-100 p-1 rounded-xl overflow-x-auto",children:e.jsx("div",{className:"flex space-x-1 min-w-max",children:De.map(n=>{const C=n.icon,A=y===n.id;return e.jsxs("button",{onClick:()=>v(n.id),className:`flex items-center space-x-2 py-3 px-4 rounded-lg transition-all duration-200 whitespace-nowrap ${A?"light-tab-active":"light-tab"}`,children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:n.label})]},n.id)})})})}),e.jsx("div",{className:"hidden sm:block md:hidden",children:e.jsx("div",{className:"bg-gray-100 p-1 rounded-xl overflow-x-auto scrollbar-hide",children:e.jsx("div",{className:"flex space-x-1 pb-1",style:{width:"max-content"},children:De.map(n=>{const C=n.icon,A=y===n.id;return e.jsxs("button",{onClick:()=>v(n.id),className:`flex items-center space-x-2 py-2.5 px-3 rounded-lg transition-all duration-200 whitespace-nowrap text-sm ${A?"light-tab-active":"light-tab"}`,children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:n.label})]},n.id)})})})})]})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-3 sm:p-6",children:[y==="analytics"&&e.jsx(Rt,{}),y==="generator"&&e.jsx(kt,{onSuccess:async()=>{console.log("üéØ Card generation successful - forcing data reload"),await k(),await i(),p(W("Sync Complete","Master list updated with new cards"))}}),y==="activation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Activation"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:h,onChange:n=>j(n.target.value),className:"light-input",placeholder:"Enter control number to activate"})}),e.jsxs("button",{onClick:nt,className:"light-button-primary",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Search"]})]}),l&&e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.fullName}),e.jsx("p",{className:"text-gray-600",children:l.controlNumber})]}),e.jsx("span",{className:l.status==="active"?"status-active":"status-inactive",children:l.status})]}),e.jsxs("button",{onClick:it,className:"light-button-primary",children:[l.status==="active"?"Deactivate":"Activate"," Card"]})]})]}),y==="clinic-management"&&e.jsx(Dt,{onSuccess:k}),y==="endorsement"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Endorsement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic"}),e.jsxs("select",{value:S.clinicId,onChange:n=>m({...S,clinicId:n.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Clinic"}),X.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",n.plan,")"]},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Range"}),e.jsx("input",{type:"text",value:S.startRange,onChange:n=>m({...S,startRange:n.target.value}),className:"light-input",placeholder:"MOC-00001-NCR-CVT001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Range"}),e.jsx("input",{type:"text",value:S.endRange,onChange:n=>m({...S,endRange:n.target.value}),className:"light-input",placeholder:"MOC-00100-NCR-CVT001"})]})]}),e.jsx("button",{onClick:lt,className:"light-button-primary",children:"Assign Cards to Clinic"})]}),y==="appointments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Appointment Management"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Manage appointments across all clinics"})]}),e.jsx(zt,{token:M.username})]}),y==="master-list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Data Management"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>F("cards"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${I==="cards"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(oe,{className:"h-4 w-4 inline mr-2"}),"Cards"]}),e.jsxs("button",{onClick:()=>F("clinics"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${I==="clinics"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(ae,{className:"h-4 w-4 inline mr-2"}),"Clinics"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:$,onChange:n=>R(n.target.value),placeholder:I==="cards"?"Search cards by name or control number...":"Search clinics by name or code...",className:"light-input pl-10"})]}),I==="cards"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ct,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:de,onChange:n=>Ae(n.target.value),className:"light-select",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),I==="cards"&&e.jsx("div",{className:"light-table",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"light-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4",children:"Control Number"}),e.jsx("th",{className:"text-left p-4",children:"Patient Name"}),e.jsx("th",{className:"text-left p-4",children:"Status"}),e.jsx("th",{className:"text-left p-4",children:"Clinic"}),e.jsx("th",{className:"text-left p-4",children:"Perks"}),e.jsx("th",{className:"text-left p-4",children:"Expiry"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:O.filter(n=>{const C=n.fullName||"",A=n.controlNumber||"",H=!$||C.toLowerCase().includes($.toLowerCase())||A.toLowerCase().includes($.toLowerCase())||A.includes($.toUpperCase()),V=de==="all"||n.status===de;return H&&V}).map(n=>{const C=X.find(q=>q.id===n.clinicId),A=_===n.controlNumber,H=n.fullName||"Unnamed Card",V=n.controlNumber||"";return e.jsxs("tr",{className:"light-table-row",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:V}),e.jsx("td",{className:"p-4",children:A?e.jsx("input",{type:"text",value:L.fullName,onChange:q=>c({...L,fullName:q.target.value}),className:"light-input text-sm"}):H}),e.jsx("td",{className:"p-4",children:A?e.jsxs("select",{value:L.status,onChange:q=>c({...L,status:q.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("span",{className:n.status==="active"?"status-active":"status-inactive",children:n.status})}),e.jsx("td",{className:"p-4",children:A?e.jsxs("select",{value:L.clinicId,onChange:q=>c({...L,clinicId:q.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),X.map(q=>e.jsx("option",{value:q.id,children:q.name},q.id))]}):C?.name||"Unassigned"}),e.jsx("td",{className:"p-4",children:A?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",min:"0",value:L.perksUsed,onChange:q=>c({...L,perksUsed:parseInt(q.target.value)||0}),className:"light-input text-sm w-16"}),e.jsx("span",{className:"text-gray-500 self-center",children:"/"}),e.jsx("input",{type:"number",min:"1",value:L.perksTotal,onChange:q=>c({...L,perksTotal:parseInt(q.target.value)||1}),className:"light-input text-sm w-16"})]}):`${n.perksUsed}/${n.perksTotal}`}),e.jsx("td",{className:"p-4",children:A?e.jsx("input",{type:"date",value:L.expiryDate,onChange:q=>c({...L,expiryDate:q.target.value}),className:"light-input text-sm"}):new Date(n.expiryDate).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:A?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ot(n.controlNumber),className:"p-1 text-green-600 hover:text-green-700",title:"Save changes",children:e.jsx(et,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>D(null),className:"p-1 text-gray-600 hover:text-gray-700",title:"Cancel",children:e.jsx(ge,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ct(n.controlNumber),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit card",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>dt(n.controlNumber),className:"p-1 text-red-600 hover:text-red-700",title:"Delete card",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})})]},V)})})]})})]}),y==="debug"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Database Debugger"})]}),e.jsx("p",{className:"text-gray-600",children:"Use this tool to analyze the database and troubleshoot card lookup issues."}),e.jsx($t,{})]}),y==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Admin Settings"}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change your admin password for security"})]}),e.jsx("button",{onClick:()=>E(!N),className:"light-button-primary",children:"Change Password"})]}),N&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("form",{onSubmit:z,className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:T.currentPassword,onChange:n=>P({...T,currentPassword:n.target.value}),className:"light-input",placeholder:"Enter current password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:T.newPassword,onChange:n=>P({...T,newPassword:n.target.value}),className:"light-input",placeholder:"Enter new password (min 8 characters)",minLength:8,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:T.confirmPassword,onChange:n=>P({...T,confirmPassword:n.target.value}),className:"light-input",placeholder:"Confirm new password",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:"Update Password"}),e.jsx("button",{type:"button",onClick:()=>{E(!1),P({currentPassword:"",newPassword:"",confirmPassword:""})},className:"light-button-secondary",children:"Cancel"})]})]})})]})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Version:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"MOCARDS v3.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Environment:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Production"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Login:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:new Date().toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Admin Username:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:M.username})]})]})]})}),e.jsx(Mt,{})]})]})}),u.showModal&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u.editingPerk?"Edit Perk":"Create New Perk"}),e.jsx("button",{onClick:()=>w({...u,showModal:!1}),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ge,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:n=>{n.preventDefault(),ke()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("select",{value:u.form.type,onChange:n=>w({...u,form:{...u.form,type:n.target.value}}),className:"light-select",children:ye.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:u.form.name,onChange:n=>w({...u,form:{...u.form,name:n.target.value}}),className:"light-input",placeholder:"e.g., Free Dental Cleaning",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:u.form.description,onChange:n=>w({...u,form:{...u.form,description:n.target.value}}),className:"light-input",placeholder:"Describe this perk...",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value (‚Ç± PHP)"}),e.jsx("input",{type:"number",min:"0",max:"10000",value:u.form.value,onChange:n=>w({...u,form:{...u.form,value:parseInt(n.target.value)||0}}),className:"light-input",placeholder:"800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Days"}),e.jsx("input",{type:"number",min:"1",value:u.form.validFor,onChange:n=>w({...u,form:{...u.form,validFor:parseInt(n.target.value)||365}}),className:"light-input",placeholder:"365"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u.form.isActive,onChange:n=>w({...u,form:{...u.form,isActive:n.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u.form.requiresApproval,onChange:n=>w({...u,form:{...u.form,requiresApproval:n.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requires Approval"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:u.editingPerk?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>w({...u,showModal:!1}),className:"light-button-secondary",children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Existing Perks"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:_e.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.name}),e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded ${n.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:n.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>Ee(n),className:"text-blue-600 hover:text-blue-800",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>J(n),className:"text-red-600 hover:text-red-800",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]},n.id))})]})]})})]})}export{Xt as AdminPortalView};
