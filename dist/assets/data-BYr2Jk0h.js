import{g as a,f as p,D as g}from"./index-DsRBCEo3.js";const A=t=>new Date(t).toLocaleDateString("en-PH"),w=(t,e,n)=>`MOC-${t.toString().padStart(5,"0")}-${e}-${n}`,f=async t=>{const n=(await a.clinics.getAll()).map(s=>s.code);let r=1;if(t==="Custom"||t==="Others"){for(;n.includes(`CVT${r.toString().padStart(3,"0")}`);)r++;return`CVT${r.toString().padStart(3,"0")}`}return t},k={getAll:async()=>await a.cards.getAll(),getByControlNumber:async t=>(await a.cards.getAll()).find(n=>n.controlNumber===t)||null,getByClinicId:async t=>(await a.cards.getAll()).filter(n=>n.clinicId===t),create:async t=>{try{return await a.cards.add(t)}catch(e){throw console.error("Failed to create card:",e),e}},createBatch:async(t,e,n,r,s=5)=>{const o=await a.cards.getAll(),l=[],i=new Date().toISOString();for(let c=t;c<=e;c++){const u={id:`card_${Date.now()}_${c}_${Math.random().toString(36).substr(2,9)}`,controlNumber:w(c,n,r),fullName:"",status:"inactive",perksTotal:s,perksUsed:0,clinicId:"",expiryDate:"2025-12-31",createdAt:i,updatedAt:i};l.push(u)}const d=[...o,...l];return await a.cards.save(d),l},updateStatus:async(t,e)=>{const r=(await a.cards.getAll()).find(s=>s.controlNumber===t);return r?(await a.cards.update(r.id,{status:e}),!0):!1},assignToClinic:async(t,e)=>{const n=await a.clinics.getAll(),r=await a.cards.getAll(),s=n.find(i=>i.id===e);if(!s)return!1;const o=r.filter(i=>i.clinicId===e).length,l=p[s.plan];return o+t.length>l?!1:(await Promise.all(t.map(async i=>{const d=r.find(c=>c.controlNumber===i);d&&await a.cards.update(d.id,{clinicId:e})})),!0)},updatePerks:async(t,e)=>{const r=(await a.cards.getAll()).find(s=>s.controlNumber===t);if(r){const s=Math.min(e,r.perksTotal);return await a.cards.update(r.id,{perksUsed:s}),!0}return!1},delete:async t=>{const n=(await a.cards.getAll()).find(r=>r.controlNumber===t);return n?(await a.cards.remove(n.id),!0):!1}},m={getAll:async()=>await a.perks.getAll(),getById:async t=>(await a.perks.getAll()).find(n=>n.id===t)||null,getByType:async t=>(await a.perks.getAll()).filter(n=>n.type===t),getActive:async()=>(await a.perks.getAll()).filter(e=>e.isActive),create:async t=>{const e={...t,id:`perk_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await a.perks.add(e),e},update:async(t,e)=>{if((await a.perks.getAll()).find(s=>s.id===t)){const s={...e,updatedAt:new Date().toISOString()};return await a.perks.update(t,s),!0}return!1},delete:async t=>(await a.perks.remove(t),!0),initializeDefaults:async()=>{(await a.perks.getAll()).length===0&&await Promise.all(g.map(async e=>{await m.create(e)}))}},S={getAll:async()=>await a.clinics.getAll(),getById:async t=>(await a.clinics.getAll()).find(n=>n.id===t)||null,getByCode:async t=>(await a.clinics.getAll()).find(n=>n.code===t)||null,authenticate:async(t,e)=>(await a.clinics.getAll()).find(r=>r.code===t&&r.password===e)||null,create:async t=>{const e={...t,id:`clinic_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,subscriptionStatus:"active",subscriptionStartDate:new Date().toISOString(),maxCards:p[t.plan],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isActive:!0};return await a.clinics.add(e),e},update:async(t,e)=>(await a.clinics.getAll()).find(s=>s.id===t)?(await a.clinics.update(t,e),!0):!1,delete:async t=>(await a.clinics.remove(t),!0),getAssignedCardsCount:async t=>(await a.cards.getAll()).filter(n=>n.clinicId===t).length,getPlanLimit:async t=>{const n=(await a.clinics.getAll()).find(r=>r.id===t);return n?p[n.plan]:0}},C={getAll:async()=>await a.appointments.getAll(),getByClinicId:async t=>(await a.appointments.getAll()).filter(n=>n.clinicId===t),create:async t=>{const e={...t,id:`appointment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return await a.appointments.add(e),e},updateStatus:async(t,e)=>(await a.appointments.getAll()).find(s=>s.id===t)?(await a.appointments.update(t,{status:e}),!0):!1},I={getAll:async()=>await a.perkRedemptions.getAll(),getByCardNumber:async t=>(await a.perkRedemptions.getAll()).filter(n=>n.cardControlNumber===t),getByClinicId:async t=>(await a.perkRedemptions.getAll()).filter(n=>n.clinicId===t),create:async t=>await a.perkRedemptions.add(t),getByPerkType:async(t,e)=>(await a.perkRedemptions.getAll()).filter(r=>r.cardControlNumber===t&&r.perkName.toLowerCase().includes(e.toLowerCase()))};export{C as a,k as b,S as c,m as d,f as e,A as f,w as g,I as p};
