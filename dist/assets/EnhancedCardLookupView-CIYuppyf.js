import{u as F,j as e,t as y,s as x,a as $,b as A}from"./index-DfrNaHlf.js";import{r as i}from"./charts-sad3owxz.js";import{b as h,S as v,p as P,G as T,q as I,r as w,C as _,n as k,a as R}from"./icons-DSdcywBl.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";function K(){const[l,u]=i.useState(""),[a,p]=i.useState(null),[o,j]=i.useState(!1),[C,g]=i.useState(!1),[m,S]=i.useState([]),{addToast:d}=F(),b=async()=>{if(!l.trim()){d(y("Empty Search","Please enter a card number"));return}j(!0),g(!1),p(null),console.log("[Enhanced Lookup] Searching for:",l);try{const s=l.trim().toUpperCase();let{data:r,error:c}=await x.from("cards").select("*").eq("control_number",s).limit(10);if(!c&&(!r||r.length===0)){const t=await x.from("cards").select("*").ilike("control_number",`%${s}%`).limit(10);r=t.data,c=t.error}if(console.log("[Enhanced Lookup] Search result:",{searchTerm:s,data:r,error:c,count:r?.length}),c)throw console.error("[Enhanced Lookup] Search error:",c),c;if(r&&r.length>0){const t=r[0];let f="Not Assigned";if(t.assigned_clinic_id)try{const{data:n}=await x.from("clinics").select("clinic_name").eq("id",t.assigned_clinic_id).single();n&&(f=n.clinic_name)}catch(n){console.log("Could not fetch clinic name:",n)}const N={id:t.id,control_number:t.control_number,status:t.status||"inactive",perks_total:t.perks_total||5,perks_used:t.perks_used||0,created_at:t.created_at,expires_at:t.expires_at,activated_at:t.activated_at,clinic_name:f,full_name:t.full_name||"Not Activated"};p(N),m.includes(s)||S(n=>[s,...n].slice(0,5)),d($("Card Found!",`Found card: ${N.control_number}`))}else g(!0),d(y("Card Not Found",`No card found with number: ${s}`))}catch(s){console.error("[Enhanced Lookup] Error:",s),d(A("Search Error",`Failed to search: ${s instanceof Error?s.message:"Unknown error"}`))}finally{j(!1)}},E=s=>{s.key==="Enter"&&b()},L=s=>{switch(s?.toLowerCase()){case"active":case"activated":return"text-green-600 bg-green-100";case"inactive":return"text-yellow-600 bg-yellow-100";case"expired":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},D=s=>{switch(s?.toLowerCase()){case"active":case"activated":return e.jsx(w,{className:"h-4 w-4"});case"inactive":return e.jsx(_,{className:"h-4 w-4"});case"expired":return e.jsx(k,{className:"h-4 w-4"});default:return e.jsx(R,{className:"h-4 w-4"})}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(h,{className:"h-7 w-7 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Card Lookup"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Search for any MOC card using the card number"})]}),e.jsxs("div",{className:"light-card p-5 mb-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l,onChange:s=>u(s.target.value),onKeyPress:E,className:"light-input pl-10",placeholder:"Enter card number (e.g., MOC-00001-01-CVT001)",disabled:o}),e.jsx(h,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"})]}),e.jsx("button",{onClick:b,disabled:o||!l.trim(),className:"light-button-primary w-full flex items-center justify-center space-x-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Searching..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-5 w-5"}),e.jsx("span",{children:"Search Card"})]})})]}),m.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Recent searches:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s,r)=>e.jsx("button",{onClick:()=>u(s),className:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors",children:s},r))})]})]}),a&&e.jsxs("div",{className:"light-card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Card Information"}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 ${L(a.status)}`,children:[D(a.status),e.jsx("span",{className:"capitalize",children:a.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-mono text-lg font-semibold",children:a.control_number})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cardholder Name"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.full_name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned Clinic"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:a.clinic_name})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perks Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{children:[a.perks_used," / ",a.perks_total," used"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all",style:{width:`${a.perks_used/a.perks_total*100}%`}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Created Date"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:new Date(a.created_at).toLocaleDateString()})]})]}),a.activated_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Activation Date"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:new Date(a.activated_at).toLocaleDateString()})]})]}),a.expires_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{children:new Date(a.expires_at).toLocaleDateString()})]})]})]})]})]}),C&&e.jsxs("div",{className:"light-card p-6 text-center",children:[e.jsx(k,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Card Not Found"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["No card found with number: ",e.jsx("span",{className:"font-mono font-semibold",children:l})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please check the card number and try again. Make sure to include the full card number."})]})]})})})}export{K as EnhancedCardLookupView};
