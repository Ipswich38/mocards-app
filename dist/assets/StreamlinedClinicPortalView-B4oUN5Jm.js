import{c as V,u as Y,j as e,a as w,t as x}from"./index-BYwebZkp.js";import{r as d}from"./charts-sad3owxz.js";import{a as C,c as T,p as z}from"./data-_aU9vntM.js";import{a as A,e as J,f as K,g as $,h as E,d as k,i as p,U as F,c as Q,P as Z,j as q,G as ee}from"./icons-BldG30mL.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";import"./supabase-BYaNx0mI.js";function ce(){const{isAuthenticated:R,login:X,logout:O}=V(),[n,S]=d.useState(null),[i,f]=d.useState({username:"",password:""}),[h,g]=d.useState([]),[o,P]=d.useState([]),[U,D]=d.useState(!1),[b,_]=d.useState("appointments"),{addToast:c}=Y();d.useEffect(()=>{(async()=>{if(n)try{D(!0);const r=(await C.getByClinicId(n.id)).map(t=>({id:t.id,cardControlNumber:t.cardControlNumber,patientName:t.patientName,patientEmail:t.patientEmail,patientPhone:t.patientPhone,preferredDate:t.preferredDate,preferredTime:t.preferredTime,serviceType:t.serviceType,status:t.status,adminNotes:t.notes,clinicNotes:"",forwardedAt:t.createdAt,processedAt:void 0}));g(r);const l=await T.getAll();P(l)}catch(a){console.error("Failed to load data:",a)}finally{D(!1)}})()},[n]);const B=async s=>{if(s.preventDefault(),i.username&&i.password){const a={id:`clinic_${i.username}`,name:`${i.username} Dental Clinic`,code:i.username.toUpperCase(),address:"123 Clinic Street",phone:"+63 XXX XXX XXXX"};S(a),X("clinic",a),c(w("Welcome",`Logged in to ${a.name}`))}else c(x("Login Failed","Please enter valid credentials"))},I=()=>{O(),S(null),f({username:"",password:""}),g([])},M=async s=>{const a=prompt("Add any notes for the patient (optional):");try{await C.updateStatus(s,"accepted"),g(r=>r.map(l=>l.id===s?{...l,status:"accepted",clinicNotes:a||"",processedAt:new Date().toISOString()}:l)),c(w("Appointment Accepted","Patient will be notified"))}catch{c(x("Error","Failed to accept appointment"))}},W=async s=>{const a=prompt("Please provide a reason for declining:");if(a)try{await C.updateStatus(s,"declined"),g(r=>r.map(l=>l.id===s?{...l,status:"declined",clinicNotes:a,processedAt:new Date().toISOString()}:l)),c(x("Appointment Declined","Patient will be notified"))}catch{c(x("Error","Failed to decline appointment"))}},G=async(s,a)=>{const r=s.perks[a];if(r.claimed){c(x("Perk Already Used","This perk has already been redeemed"));return}const l=prompt("Enter patient name for perk redemption:");if(!l)return;const t=prompt('Enter service type provided (e.g., "Consultation", "Cleaning"):');if(!t)return;const m=prompt("Enter staff member name who processed this:");if(m)try{await z.create({cardControlNumber:s.control_number||s.unified_control_number||s.card_number,perkId:`perk_${a}`,perkName:r.type||`Perk ${a+1}`,clinicId:n?.id||"",claimantName:l,handledBy:m,serviceType:t,usedAt:new Date().toISOString(),value:r.value||1,notes:`Redeemed at ${n?.name}`});const y=s.perks?s.perks.filter(v=>v.claimed).length:0;await T.updatePerks(s.control_number||s.unified_control_number||s.card_number,y+1),P(v=>v.map(N=>N.id===s.id?{...N,perks:N.perks.map((L,H)=>H===a?{...L,claimed:!0,claimed_at:new Date().toISOString()}:L)}:N)),c(w("Perk Redeemed",`Successfully redeemed ${r.type||"perk"} for ${l}`))}catch(y){console.error("Failed to redeem perk:",y),c(x("Redemption Failed","Failed to redeem perk. Please try again."))}};if(!R)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Clinic Portal"}),e.jsx("p",{className:"text-gray-600",children:"Login to manage your appointment requests"})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic Code"}),e.jsx("input",{type:"text",value:i.username,onChange:s=>f({...i,username:s.target.value}),className:"light-input",placeholder:"Enter your clinic code",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:i.password,onChange:s=>f({...i,password:s.target.value}),className:"light-input",placeholder:"Enter your password",required:!0})]}),e.jsxs("button",{type:"submit",className:"light-button-primary w-full flex items-center justify-center",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Access Clinic Portal"]})]})]})});if(!n||U)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"h-8 w-8 text-blue-600"})}),e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading Clinic Portal"}),e.jsx("p",{className:"text-gray-600",children:"Loading your appointment requests..."})]})});const u=h.filter(s=>s.status==="pending"),j=h.filter(s=>s.status!=="pending");return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center",children:e.jsx(A,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.address," â€¢ ",n.phone]})]})]}),e.jsxs("button",{onClick:I,className:"light-button-secondary flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx("div",{className:"light-card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center",children:e.jsx($,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Requests"})]})]})}),e.jsx("div",{className:"light-card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(E,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.filter(s=>s.status==="accepted").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Accepted"})]})]})}),e.jsx("div",{className:"light-card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(k,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Appointments"})]})]})}),e.jsx("div",{className:"light-card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(p,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cards"})]})]})})]}),e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>_("appointments"),className:`flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-colors ${b==="appointments"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Appointments"})]}),e.jsxs("button",{onClick:()=>_("cards"),className:`flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-colors ${b==="cards"?"bg-purple-100 text-purple-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(p,{className:"h-4 w-4"}),e.jsxs("span",{children:["All Cards (",o.length,")"]})]})]})})}),b==="appointments"?e.jsxs(e.Fragment,{children:[u.length>0&&e.jsx("div",{className:"light-card mb-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2 text-yellow-600"}),"Pending Appointment Requests (",u.length,")"]}),e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsxs("div",{className:"border border-yellow-200 rounded-xl p-6 bg-yellow-50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(F,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.patientName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.cardControlNumber})]})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.preferredDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Time"}),e.jsx("p",{className:"font-medium",children:s.preferredTime})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Service"}),e.jsx("p",{className:"font-medium",children:s.serviceType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Phone"}),e.jsx("p",{className:"font-medium",children:s.patientPhone})]})]}),s.adminNotes&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Admin Notes:"})," ",s.adminNotes]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>M(s.id),className:"flex items-center space-x-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Accept"})]}),e.jsxs("button",{onClick:()=>W(s.id),className:"flex items-center space-x-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Decline"})]}),e.jsxs("a",{href:`tel:${s.patientPhone}`,className:"flex items-center space-x-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Call"})]}),e.jsxs("a",{href:`mailto:${s.patientEmail}`,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Email"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-4",children:["Forwarded: ",new Date(s.forwardedAt).toLocaleString()]})]},s.id))})]})}),j.length>0&&e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Recent Processed Appointments (",j.length,")"]}),e.jsx("div",{className:"space-y-3",children:j.slice(0,5).map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(F,{className:"h-4 w-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.patientName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.serviceType})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.processedAt&&new Date(s.processedAt).toLocaleDateString()})]})]}),s.clinicNotes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600 bg-gray-50 p-2 rounded",children:[e.jsx("strong",{children:"Notes:"})," ",s.clinicNotes]})]},s.id))})]})}),h.length===0&&e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(k,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Appointments Yet"}),e.jsxs("p",{className:"text-gray-600",children:["No appointment requests have been forwarded to your clinic.",e.jsx("br",{}),"When patients request appointments, they will appear here."]})]})})]}):e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(p,{className:"h-5 w-5 mr-2 text-purple-600"}),"All MOC Cards in System (",o.length,")"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"24/7 access to all cards for clinic services"})]}),o.length>0?e.jsx("div",{className:"space-y-4",children:o.map(s=>{const a=s.perks?s.perks.filter(t=>t.claimed).length:0,r=s.perks?s.perks.length:5,l=s.status==="activated"||s.status==="active"?"active":s.expires_at&&new Date(s.expires_at)<new Date?"expired":"inactive";return e.jsxs("div",{className:"border border-purple-200 rounded-xl p-6 bg-purple-50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(p,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.cardholder_name||"Card Holder"}),e.jsx("p",{className:"text-sm text-gray-600 font-mono",children:s.control_number||s.unified_control_number||s.card_number})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l==="active"?"bg-green-100 text-green-800":l==="expired"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Clinic"}),e.jsx("p",{className:"font-medium",children:s.clinic_name||(s.assigned_clinic_id?"Assigned Clinic":"Not Assigned")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Expires"}),e.jsx("p",{className:"font-medium",children:s.expires_at?new Date(s.expires_at).toLocaleDateString():"2025-12-31"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Perks Used"}),e.jsxs("p",{className:"font-medium",children:[a," / ",r]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Available"}),e.jsxs("p",{className:"font-medium text-green-600",children:[r-a," perks"]})]})]}),s.perks&&s.perks.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900 flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-purple-600"}),"Card Benefits"]}),e.jsxs("span",{className:"text-sm text-purple-700",children:[r-a," remaining"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.perks.map((t,m)=>e.jsxs("div",{className:`p-2 rounded-lg border text-sm ${t.claimed?"bg-gray-100 text-gray-600 border-gray-300":"bg-green-50 text-green-800 border-green-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t.type||`Perk ${m+1}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.claimed?"bg-gray-200 text-gray-600":"bg-green-200 text-green-700"}`,children:t.claimed?"Used":"Available"}),!t.claimed&&e.jsx("button",{onClick:()=>G(s,m),className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-colors",title:"Redeem this perk",children:"Redeem"})]})]}),t.claimed_at&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Used: ",new Date(t.claimed_at).toLocaleDateString()]})]},m))})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-4",children:["Created: ",new Date(s.created_at).toLocaleString()]})]},s.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(p,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Cards Found"}),e.jsx("p",{className:"text-gray-600",children:"No MOC cards are currently in the system."})]})]})})]})}export{ce as StreamlinedClinicPortalView};
