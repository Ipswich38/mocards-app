const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SimpleCardLookupView-ZIP7TJwe.js","assets/charts-sad3owxz.js","assets/vendor-N--QU9DW.js","assets/icons-79JrDgB8.js","assets/database-BUiByx9r.js","assets/SimpleClinicPortalView-DiWgeXic.js","assets/SimpleAdminPortalView-Can9VlE0.js"])))=>i.map(i=>d[i]);
import{r as ve,a as _e,g as Ce}from"./vendor-N--QU9DW.js";import{r as g,R as Ne}from"./charts-sad3owxz.js";import{S as D,E as je,A as T,a as F,L as X,U as Ae,C as Ie,T as ke,X as R,M as K,b as ge,c as fe,d as Ee,H as De,e as ee,D as te,f as se,g as re,h as P,i as Oe,j as xe,W as ae,k as ne,l as Te,R as Re,I as ie,m as Pe,n as Le,o as Me}from"./icons-79JrDgB8.js";import{c as we}from"./database-BUiByx9r.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var U={exports:{}},k={};var oe;function $e(){if(oe)return k;oe=1;var s=ve(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(p,c,d){var h,u={},m=null,x=null;d!==void 0&&(m=""+d),c.key!==void 0&&(m=""+c.key),c.ref!==void 0&&(x=c.ref);for(h in c)a.call(c,h)&&!o.hasOwnProperty(h)&&(u[h]=c[h]);if(p&&p.defaultProps)for(h in c=p.defaultProps,c)u[h]===void 0&&(u[h]=c[h]);return{$$typeof:e,type:p,key:m,ref:x,props:u,_owner:n.current}}return k.Fragment=t,k.jsx=i,k.jsxs=i,k}var ce;function qe(){return ce||(ce=1,U.exports=$e()),U.exports}var r=qe(),L={},le;function ze(){if(le)return L;le=1;var s=_e();return L.createRoot=s.createRoot,L.hydrateRoot=s.hydrateRoot,L}var Be=ze();const Ue=Ce(Be),He="modulepreload",Ge=function(s){return"/"+s},de={},Q=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let c=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),p=i?.nonce||i?.getAttribute("nonce");n=c(t.map(d=>{if(d=Ge(d),d in de)return;de[d]=!0;const h=d.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":He,h||(m.as="script"),m.crossOrigin="",m.href=d,p&&m.setAttribute("nonce",p),document.head.appendChild(m),h)return new Promise((x,f)=>{m.addEventListener("load",x),m.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=i,window.dispatchEvent(p),!p.defaultPrevented)throw i}return n.then(i=>{for(const p of i||[])p.status==="rejected"&&o(p.reason);return e().catch(o)})};class v{static config={maxLoginAttempts:5,lockoutDuration:15,sessionDuration:480,passwordMinLength:8,requireTwoFactor:!1};static rateLimits=new Map([["login",{windowMs:900*1e3,maxRequests:5}],["search",{windowMs:60*1e3,maxRequests:30}],["api",{windowMs:60*1e3,maxRequests:100}],["export",{windowMs:3600*1e3,maxRequests:10}]]);static attempts=new Map;static events=[];static sanitizeInput(e){return typeof e!="string"?"":e.trim().replace(/[<>\"']/g,"").replace(/[\x00-\x1F\x7F]/g,"").slice(0,1e3)}static validateControlNumber(e){const t=this.sanitizeInput(e);return t?/(union|select|insert|update|delete|drop|exec|script)/i.test(t)?(this.logSecurityEvent({type:"SUSPICIOUS_ACTIVITY",ip:"unknown",userAgent:"unknown",severity:"HIGH",details:{input:t,reason:"SQL injection attempt"}}),{valid:!1,message:"Invalid characters detected"}):/^MOC-[\w\d-]+$/.test(t)?t.length>50?{valid:!1,message:"Control number too long"}:{valid:!0}:{valid:!1,message:"Invalid control number format"}:{valid:!1,message:"Control number is required"}}static checkRateLimit(e,t){const a=this.rateLimits.get(e);if(!a)return{allowed:!0};const n=Date.now(),o=`${e}:${t}`,i=this.attempts.get(o);if(!i)return this.attempts.set(o,{count:1,lastAttempt:new Date(n),blocked:!1}),{allowed:!0};if(n-i.lastAttempt.getTime()>a.windowMs)return this.attempts.set(o,{count:1,lastAttempt:new Date(n),blocked:!1}),{allowed:!0};if(i.count>=a.maxRequests){const p=Math.ceil((a.windowMs-(n-i.lastAttempt.getTime()))/1e3);return this.logSecurityEvent({type:"RATE_LIMIT",ip:t,userAgent:"unknown",severity:"MEDIUM",details:{key:e,attempts:i.count,limit:a.maxRequests}}),{allowed:!1,retryAfter:p}}return i.count++,i.lastAttempt=new Date(n),{allowed:!0}}static createSession(e,t){const a={userId:e,userType:t,createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionDuration*60*1e3),csrfToken:this.generateSecureToken()},n=this.generateSecureToken();return localStorage.setItem(`mocards_session_${n}`,JSON.stringify(a)),this.logSecurityEvent({type:"LOGIN_ATTEMPT",userId:e,ip:"unknown",userAgent:navigator.userAgent,severity:"LOW",details:{userType:t,sessionToken:n}}),n}static validateSession(e){try{const t=localStorage.getItem(`mocards_session_${e}`);if(!t)return{valid:!1};const a=JSON.parse(t);return new Date>new Date(a.expiresAt)?(this.destroySession(e),{valid:!1}):{valid:!0,userId:a.userId,userType:a.userType}}catch{return{valid:!1}}}static destroySession(e){localStorage.removeItem(`mocards_session_${e}`)}static validatePassword(e){const t=this.sanitizeInput(e);let a=0;if(t.length<this.config.passwordMinLength)return{valid:!1,message:`Password must be at least ${this.config.passwordMinLength} characters`,strength:0};t.length>=8&&(a+=20),t.length>=12&&(a+=10),/[a-z]/.test(t)&&(a+=20),/[A-Z]/.test(t)&&(a+=20),/[0-9]/.test(t)&&(a+=15),/[^a-zA-Z0-9]/.test(t)&&(a+=15);const n=a>=80?"Strong":a>=60?"Good":"Weak";return{valid:a>=60,message:a<60?`Password is too weak (${n})`:void 0,strength:a}}static logSecurityEvent(e){const t={...e,id:this.generateSecureToken(),timestamp:new Date};this.events.push(t),this.events.length>1e3&&(this.events=this.events.slice(-1e3)),(e.severity==="CRITICAL"||e.severity==="HIGH")&&console.warn("ðŸ”’ Security Alert:",t),this.sendToMonitoring(t)}static getSecurityEvents(e){return e?this.events.filter(t=>t.severity===e):this.events.slice(-100)}static validateFileUpload(e){return["application/pdf","image/jpeg","image/png","text/csv"].includes(e.type)?e.size>10485760?{valid:!1,message:"File size exceeds 10MB limit"}:{valid:!0}:{valid:!1,message:`File type '${e.type}' is not allowed`}}static generateSecureToken(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(e);crypto.getRandomValues(n);for(let o=0;o<e;o++)a+=t[n[o]%t.length];return a}static sendToMonitoring(e){typeof window<"u"&&console.log("ðŸ“Š Security Event:",e.type,e.severity)}static updateConfig(e){this.config={...this.config,...e}}static getConfig(){return{...this.config}}static addRateLimit(e,t){this.rateLimits.set(e,t)}static getSecurityMetrics(){const e={LOW:0,MEDIUM:0,HIGH:0,CRITICAL:0};this.events.forEach(n=>{e[n.severity]++});const t=this.events.filter(n=>n.type==="RATE_LIMIT").length,a=Array.from(this.attempts.values()).filter(n=>n.blocked).length;return{totalEvents:this.events.length,eventsBySeverity:e,recentThreats:this.events.filter(n=>n.severity==="HIGH"||n.severity==="CRITICAL").slice(-10),rateLimitViolations:t,activeBlocks:a}}}const We=()=>`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,q=(s,e,t,a)=>({type:s,title:e,message:t,duration:a?.duration??(s==="loading"?void 0:5e3),action:a?.action,persistent:a?.persistent??s==="loading"}),ue=(s,e,t)=>q("success",s,e,{action:t}),J=(s,e,t)=>q("error",s,e,{action:t,duration:7e3}),Fe=(s,e,t)=>q("warning",s,e,{action:t}),O=(s,e,t)=>q("info",s,e,{action:t}),ye=g.createContext(void 0),z=()=>{const s=g.useContext(ye);if(!s)throw new Error("useToast must be used within a ToastProvider");return s},Je=({children:s})=>{const[e,t]=g.useState([]),a=g.useCallback(c=>{const d=We(),h={...c,id:d};return t(u=>[...u,h]),!c.persistent&&c.duration&&setTimeout(()=>{n(d)},c.duration),d},[]),n=g.useCallback(c=>{t(d=>d.filter(h=>h.id!==c))},[]),o=g.useCallback((c,d)=>{t(h=>h.map(u=>u.id===c?{...u,...d}:u))},[]),i=g.useCallback(()=>{t([])},[]),p={toasts:e,addToast:a,removeToast:n,updateToast:o,clearAllToasts:i};return r.jsx(ye.Provider,{value:p,children:s})},Qe=()=>{const[s,e]=g.useState({isBlocked:!1,attempts:0}),{addToast:t}=z(),a=g.useCallback((m,x)=>{const f=x||Ve(),w=v.checkRateLimit(m,f);return w.allowed?!0:(e(_=>({..._,isBlocked:!0,retryAfter:w.retryAfter,attempts:_.attempts+1,lastAttempt:new Date})),t(Fe("Rate Limit Exceeded",`Too many ${m} attempts. Please try again in ${w.retryAfter} seconds.`,{label:"Understand",onClick:()=>{}})),!1)},[t]),n=g.useCallback((m,x="general")=>{if(x==="control_number")return v.validateControlNumber(m);{const f=v.sanitizeInput(m);return{valid:f===m,message:f!==m?"Input contains invalid characters":void 0,sanitized:f}}},[]),o=g.useCallback(m=>{const x=v.validateFileUpload(m);return x.valid||t(J("File Upload Error",x.message||"Invalid file",{label:"Try Again",onClick:()=>{}})),x},[t]),i=g.useCallback((m,x)=>{const f=v.createSession(m,x);return t(O("Secure Session Created","Your session is encrypted and will auto-expire for security.",{label:"Got it",onClick:()=>{}})),f},[t]),p=g.useCallback(m=>v.validateSession(m),[]),c=g.useCallback(m=>{v.destroySession(m),t(O("Session Ended","You have been securely logged out."))},[t]),d=g.useCallback(m=>v.validatePassword(m),[]),h=g.useCallback(()=>v.getSecurityMetrics(),[]),u=g.useCallback(m=>v.getSecurityEvents(m),[]);return g.useEffect(()=>{if(s.isBlocked&&s.retryAfter){const m=setTimeout(()=>{e(x=>({...x,isBlocked:!1,retryAfter:void 0})),t(O("Access Restored","You can now try again."))},s.retryAfter*1e3);return()=>clearTimeout(m)}},[s.isBlocked,s.retryAfter,t]),{securityState:s,checkRateLimit:a,validateInput:n,validateFileUpload:o,createSecureSession:i,validateSession:p,destroySession:c,validatePassword:d,getSecurityMetrics:h,getSecurityEvents:u}};function Ve(){const s=localStorage.getItem("mocards_client_id");if(s)return s;const e=Ye();return localStorage.setItem("mocards_client_id",e),e}function Ye(){const s=[navigator.userAgent,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),navigator.language].join("|");let e=0;for(let t=0;t<s.length;t++){const a=s.charCodeAt(t);e=(e<<5)-e+a,e=e&e}return Math.abs(e).toString(36)+Date.now().toString(36)}const H=({className:s="",compact:e=!1})=>{const[t,a]=g.useState(null),[n,o]=g.useState(!1),{getSecurityMetrics:i}=Qe();if(g.useEffect(()=>{const u=()=>{const x=i();a(x)};u();const m=setInterval(u,3e4);return()=>clearInterval(m)},[i]),!t)return r.jsx("div",{className:`bg-[#1F2937] rounded-lg border border-[#374151] p-4 ${s}`,children:r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-6 bg-[#374151] rounded w-48 mb-4"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-4 bg-[#374151] rounded w-full"}),r.jsx("div",{className:"h-4 bg-[#374151] rounded w-3/4"})]})]})});const p=u=>{switch(u.toUpperCase()){case"CRITICAL":return"text-red-400 bg-red-900/20";case"HIGH":return"text-orange-400 bg-orange-900/20";case"MEDIUM":return"text-yellow-400 bg-yellow-900/20";case"LOW":return"text-blue-400 bg-blue-900/20";default:return"text-gray-400 bg-gray-900/20"}},d=(()=>{const{eventsBySeverity:u}=t,m=u.CRITICAL||0,x=u.HIGH||0,f=u.MEDIUM||0;let w=100;return w-=m*20,w-=x*10,w-=f*5,Math.max(w,0)})(),h=d>=80?"text-green-400":d>=60?"text-yellow-400":"text-red-400";return r.jsxs("div",{className:`bg-[#1F2937] rounded-lg border border-[#374151] ${s}`,children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#374151]",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(D,{className:"h-5 w-5 text-blue-400 mr-2"}),r.jsx("h3",{className:"text-[#E8EAED] font-medium",children:"Security Monitor"}),r.jsxs("div",{className:`ml-3 px-2 py-1 rounded text-xs font-medium ${h.replace("text-","bg-").replace("400","900/20")}`,children:["Score: ",r.jsxs("span",{className:h,children:[d,"/100"]})]})]}),r.jsx("button",{onClick:()=>o(!n),className:"text-[#9AA0A6] hover:text-[#E8EAED] transition-colors",children:r.jsx(je,{className:"h-4 w-4"})})]}),r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:`grid gap-4 mb-4 ${e?"grid-cols-2":"grid-cols-2 md:grid-cols-4"}`,children:[r.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(T,{className:"h-4 w-4 text-blue-400"}),r.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Total Events"})]}),r.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:t.totalEvents})]}),r.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(F,{className:"h-4 w-4 text-red-400"}),r.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Threats"})]}),r.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:(t.eventsBySeverity.HIGH||0)+(t.eventsBySeverity.CRITICAL||0)})]}),r.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(X,{className:"h-4 w-4 text-yellow-400"}),r.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Rate Limits"})]}),r.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:t.rateLimitViolations})]}),r.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(Ae,{className:"h-4 w-4 text-purple-400"}),r.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Blocked"})]}),r.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:t.activeBlocks})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("h4",{className:"text-[#E8EAED] text-sm font-medium mb-2",children:"Event Severity Distribution"}),r.jsx("div",{className:"space-y-2",children:Object.entries(t.eventsBySeverity).map(([u,m])=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${p(u).split(" ")[1]}`}),r.jsx("span",{className:"text-[#9AA0A6] text-sm capitalize",children:u.toLowerCase()})]}),r.jsx("span",{className:"text-[#E8EAED] font-medium",children:m})]},u))})]})]}),n&&r.jsxs("div",{className:"border-t border-[#374151] p-4",children:[r.jsx("h4",{className:"text-[#E8EAED] text-sm font-medium mb-3",children:"Recent Security Events"}),t.recentThreats.length===0?r.jsxs("div",{className:"text-center py-4",children:[r.jsx(D,{className:"h-8 w-8 text-green-400 mx-auto mb-2"}),r.jsx("p",{className:"text-[#9AA0A6] text-sm",children:"No security threats detected"}),r.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"All systems operating normally"})]}):r.jsx("div",{className:"space-y-2",children:t.recentThreats.slice(0,5).map(u=>r.jsx("div",{className:"bg-[#303134] rounded-lg p-3",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center mb-1",children:[r.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${p(u.severity)}`,children:u.severity}),r.jsx("span",{className:"text-[#9AA0A6] text-sm ml-2",children:u.type.replace("_"," ")})]}),r.jsx("p",{className:"text-[#E8EAED] text-sm",children:u.details.reason||"Security event detected"})]}),r.jsxs("div",{className:"flex items-center text-[#9AA0A6] text-xs",children:[r.jsx(Ie,{className:"h-3 w-3 mr-1"}),new Date(u.timestamp).toLocaleTimeString()]})]})},u.id))}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-[#374151]",children:[r.jsx("h4",{className:"text-[#E8EAED] text-sm font-medium mb-2",children:"Security Recommendations"}),r.jsxs("div",{className:"space-y-2",children:[d<80&&r.jsxs("div",{className:"flex items-start",children:[r.jsx(ke,{className:"h-4 w-4 text-yellow-400 mr-2 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Improve Security Score"}),r.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"Review recent security events and implement additional protections"})]})]}),t.rateLimitViolations>10&&r.jsxs("div",{className:"flex items-start",children:[r.jsx(X,{className:"h-4 w-4 text-blue-400 mr-2 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Review Rate Limiting"}),r.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"High number of rate limit violations detected"})]})]}),(t.eventsBySeverity.HIGH||0)+(t.eventsBySeverity.CRITICAL||0)>0&&r.jsxs("div",{className:"flex items-start",children:[r.jsx(F,{className:"h-4 w-4 text-red-400 mr-2 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Address High Priority Threats"}),r.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"Critical or high severity security events require attention"})]})]}),d>=80&&t.recentThreats.length===0&&r.jsxs("div",{className:"flex items-start",children:[r.jsx(D,{className:"h-4 w-4 text-green-400 mr-2 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Security Status Excellent"}),r.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"All security systems operating normally"})]})]})]})]})]})]})},Ze=({currentView:s,onViewChange:e,onSecurityToggle:t,showSecurityDashboard:a,navItems:n})=>{const[o,i]=g.useState(!1),c=n||[{id:"card-lookup",label:"Card Lookup",icon:ge,description:"Verify card validity",color:"text-blue-600",bgColor:"bg-blue-50",disabled:!1},{id:"clinic-portal",label:"Clinic Portal",icon:fe,description:"Clinic management",color:"text-green-600",bgColor:"bg-green-50",disabled:!1},{id:"admin-access",label:"Admin Access",icon:D,description:"System administration",color:"text-purple-600",bgColor:"bg-purple-50",disabled:!1}],d=(u,m)=>{m||(e(u),i(!1))},h=()=>{i(!o)};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"lg:hidden bg-white shadow-lg border-b border-gray-200 fixed top-0 left-0 right-0 z-50",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-[#1A535C] rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-sm",children:"MC"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"MOCARDS"}),r.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"Dental Benefits Platform"})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:t,className:`p-2 rounded-lg transition-colors ${a?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:r.jsx(T,{className:"h-4 w-4"})}),r.jsx("button",{onClick:h,className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",children:o?r.jsx(R,{className:"h-5 w-5"}):r.jsx(K,{className:"h-5 w-5"})})]})]}),r.jsx("div",{className:"px-4 pb-2",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-2 h-2 bg-[#1A535C] rounded-full"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:c.find(u=>u.id===s)?.label})]})})]}),r.jsxs("div",{className:`lg:hidden fixed inset-0 z-50 transition-opacity duration-300 ${o?"opacity-100 visible":"opacity-0 invisible"}`,children:[r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>i(!1)}),r.jsxs("div",{className:`absolute right-0 top-0 h-full w-80 max-w-[85vw] bg-white shadow-xl transform transition-transform duration-300 ${o?"translate-x-0":"translate-x-full"}`,children:[r.jsx("div",{className:"p-6 bg-[#1A535C] text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-xl font-bold",children:"MOCARDS CLOUD"}),r.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-colors",children:r.jsx(R,{className:"h-5 w-5"})})]})}),r.jsx("div",{className:"p-4 space-y-2",children:c.map(u=>{const m=u.icon,x=s===u.id,f=u.disabled;return r.jsxs("button",{onClick:()=>d(u.id,f),disabled:f,className:`w-full flex items-center space-x-3 p-4 rounded-xl transition-all duration-200 ${f?"bg-gray-200 text-gray-400 cursor-not-allowed opacity-60":x?"bg-[#1A535C] text-white shadow-lg":"hover:bg-gray-50 text-gray-700"}`,title:f?"Please logout to access this portal":void 0,children:[r.jsx("div",{className:`p-2 rounded-lg ${f?"bg-gray-300":x?"bg-white bg-opacity-20":u.bgColor}`,children:r.jsx(m,{className:`h-5 w-5 ${f?"text-gray-400":x?"text-white":u.color}`})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsxs("div",{className:`font-medium ${f?"text-gray-400":x?"text-white":"text-gray-900"}`,children:[u.label,f&&r.jsx("span",{className:"ml-2",children:"ðŸ”’"})]}),r.jsx("div",{className:`text-sm ${f?"text-gray-500":x?"text-teal-200":"text-gray-500"}`,children:f?"Logout required":u.description})]}),r.jsx(Ee,{className:`h-4 w-4 ${f?"text-gray-400":x?"text-white":"text-gray-400"}`})]},u.id)})}),r.jsx("div",{className:"p-4 border-t border-gray-200",children:r.jsxs("button",{onClick:()=>{t(),i(!1)},className:`w-full flex items-center space-x-3 p-4 rounded-xl transition-all duration-200 ${a?"bg-blue-600 text-white":"hover:bg-blue-50 text-gray-700"}`,children:[r.jsx("div",{className:`p-2 rounded-lg ${a?"bg-white bg-opacity-20":"bg-blue-50"}`,children:r.jsx(T,{className:`h-5 w-5 ${a?"text-white":"text-blue-600"}`})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("div",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:"Security Monitor"}),r.jsx("div",{className:`text-sm ${a?"text-blue-200":"text-gray-500"}`,children:"Live security dashboard"})]}),a&&r.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs text-gray-500",children:"MOCARDS v4.0"}),r.jsx("p",{className:"text-xs text-gray-400",children:"Â© 2025 Dental Group"})]})})]})]}),r.jsx("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 z-40 bg-white border-t border-gray-200 shadow-lg",children:r.jsxs("div",{className:"grid grid-cols-4 py-2",children:[r.jsxs("button",{className:"flex flex-col items-center py-2 text-[#1A535C]",children:[r.jsx(De,{className:"h-5 w-5 mb-1"}),r.jsx("span",{className:"text-xs font-medium",children:"Home"})]}),c.slice(0,2).map(u=>{const m=u.icon,x=s===u.id;return r.jsxs("button",{onClick:()=>d(u.id),className:`flex flex-col items-center py-2 ${x?"text-[#1A535C]":"text-gray-400"}`,children:[r.jsx(m,{className:"h-5 w-5 mb-1"}),r.jsx("span",{className:"text-xs font-medium",children:u.label.split(" ")[0]})]},u.id)}),r.jsxs("button",{onClick:h,className:"flex flex-col items-center py-2 text-gray-600",children:[r.jsx(K,{className:"h-5 w-5 mb-1"}),r.jsx("span",{className:"text-xs font-medium",children:"Menu"})]})]})})]})},Xe=()=>{const[s,e]=g.useState(null),[t,a]=g.useState({isSupported:!1,isInstalled:!1,canInstall:!1,isStandalone:!1,platform:"unknown"});g.useEffect(()=>{const c=()=>{const h="serviceWorker"in navigator&&"PushManager"in window,u=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),m=me(),x=u||Ke();a({isSupported:h,isInstalled:x,canInstall:s!==null,isStandalone:u,platform:m})};c();const d=window.matchMedia("(display-mode: standalone)");return d.addListener(c),()=>d.removeListener(c)},[s]),g.useEffect(()=>{const c=h=>{console.log("[PWA] beforeinstallprompt fired"),h.preventDefault(),e(h)},d=()=>{console.log("[PWA] App was installed"),e(null),a(h=>({...h,isInstalled:!0,canInstall:!1}))};return window.addEventListener("beforeinstallprompt",c),window.addEventListener("appinstalled",d),()=>{window.removeEventListener("beforeinstallprompt",c),window.removeEventListener("appinstalled",d)}},[]),g.useEffect(()=>{t.isSupported&&et()},[t.isSupported]);const n=g.useCallback(async()=>{if(!s)return{success:!1,error:"Installation prompt not available"};try{await s.prompt();const c=await s.userChoice;return console.log("[PWA] User choice:",c.outcome),c.outcome==="accepted"?(e(null),{success:!0,outcome:"accepted"}):{success:!1,outcome:"dismissed"}}catch(c){return console.error("[PWA] Installation failed:",c),{success:!1,error:c instanceof Error?c.message:"Installation failed"}}},[s]),o=g.useCallback(async c=>{const d={title:"MOCARDS Cloud - Dental Benefits Management Platform",text:"Professional dental benefits card management and clinic portal system",url:window.location.origin,...c};if(navigator.share)try{return await navigator.share(d),!0}catch(h){return h.name!=="AbortError"&&console.error("[PWA] Share failed:",h),!1}else try{return await navigator.clipboard.writeText(d.url),!0}catch(h){return console.error("[PWA] Clipboard write failed:",h),!1}},[]),i=g.useCallback(async()=>{if(!("Notification"in window))return console.warn("[PWA] This browser does not support notifications"),!1;if(Notification.permission==="granted")return!0;if(Notification.permission==="denied")return!1;try{return await Notification.requestPermission()==="granted"}catch(c){return console.error("[PWA] Notification permission request failed:",c),!1}},[]),p=g.useCallback(()=>{const c=me(),d={ios:["Tap the Share button in Safari",'Scroll down and tap "Add to Home Screen"','Tap "Add" to install the app'],android:["Tap the menu button (â‹®) in Chrome",'Select "Add to Home screen"','Tap "Add" to install the app'],desktop:["Click the install button in your browser's address bar","Or use Ctrl+Shift+A (Cmd+Shift+A on Mac)",'Click "Install" when prompted']};return{platform:c,steps:d[c]||d.desktop}},[]);return{...t,installApp:n,shareApp:o,requestNotificationPermission:i,getInstallInstructions:p,canShare:"share"in navigator||"clipboard"in navigator}};function me(){const s=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(s)?"ios":/android/.test(s)?"android":/windows/.test(s)?"windows":/mac/.test(s)?"mac":"desktop"}function Ke(){return window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches||!!window.cordova||!!window.Capacitor||!!window.require}async function et(){try{const s=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("[PWA] Service Worker registered:",s),s.addEventListener("updatefound",()=>{const e=s.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&console.log("[PWA] New service worker available")})}),!0}catch(s){return console.error("[PWA] Service Worker registration failed:",s),!1}}const tt=async(s,e)=>"serviceWorker"in navigator&&"PushManager"in window?(await(await navigator.serviceWorker.ready).showNotification(s,{badge:"/icons/badge-72x72.png",icon:"/icons/icon-192x192.png",...e}),null):"Notification"in window&&Notification.permission==="granted"?new Notification(s,{icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",...e}):null,G=({showPrompt:s=!0,onDismiss:e,compact:t=!1})=>{const[a,n]=g.useState(!1),[o,i]=g.useState(!1),[p,c]=g.useState(!1),{isSupported:d,isInstalled:h,canInstall:u,platform:m,installApp:x,shareApp:f,requestNotificationPermission:w,getInstallInstructions:_,canShare:C}=Xe(),{addToast:N}=z();g.useEffect(()=>{n(s&&d&&!h&&u&&!localStorage.getItem("pwa-prompt-dismissed"))},[s,d,h,u]);const V=async()=>{i(!0);try{const S=await x();if(S.success)N(ue("App Installed Successfully!","MOCARDS is now available on your home screen",{label:"Open App",onClick:()=>window.location.reload()})),n(!1),setTimeout(async()=>{await w()&&tt("Welcome to MOCARDS!",{body:"You'll receive important updates and notifications here.",tag:"welcome"})},2e3);else if(S.outcome==="dismissed")N(O("Installation Cancelled","You can install MOCARDS anytime from your browser menu"));else throw new Error(S.error||"Installation failed")}catch(S){N(J("Installation Failed",S instanceof Error?S.message:"Please try again"))}finally{i(!1)}},Y=async()=>{try{const S=await f();N(S?ue("Shared Successfully!","MOCARDS link has been shared"):O("Link Copied","MOCARDS link copied to clipboard"))}catch{N(J("Share Failed","Unable to share the app"))}},be=()=>{n(!1),localStorage.setItem("pwa-prompt-dismissed","true"),e?.()},Z=()=>{c(!0)},Se=_();return!a&&!t?null:t?r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(ee,{className:"h-6 w-6 text-blue-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Install MOCARDS App"}),r.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Get faster access and offline capabilities"}),r.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[u?r.jsxs("button",{onClick:V,disabled:o,className:"inline-flex items-center px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 disabled:opacity-50",children:[r.jsx(te,{className:"h-3 w-3 mr-1"}),o?"Installing...":"Install"]}):r.jsxs("button",{onClick:Z,className:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200",children:[r.jsx(se,{className:"h-3 w-3 mr-1"}),"How to Install"]}),C&&r.jsxs("button",{onClick:Y,className:"inline-flex items-center px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-md hover:bg-gray-200",children:[r.jsx(re,{className:"h-3 w-3 mr-1"}),"Share"]})]})]})]})}):r.jsxs(r.Fragment,{children:[a&&r.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm z-50 animate-slide-in-right",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:r.jsx(ee,{className:"h-6 w-6 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Install MOCARDS"}),r.jsx("p",{className:"text-sm text-gray-600",children:"For better performance & offline access"})]})]}),r.jsx("button",{onClick:be,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(R,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"space-y-2 mb-6",children:[r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(P,{className:"h-4 w-4 text-green-500 mr-2"}),"Faster loading and performance"]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(P,{className:"h-4 w-4 text-green-500 mr-2"}),"Offline access to core features"]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(P,{className:"h-4 w-4 text-green-500 mr-2"}),"Push notifications for updates"]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(P,{className:"h-4 w-4 text-green-500 mr-2"}),"Home screen shortcut"]})]}),r.jsxs("div",{className:"flex space-x-3",children:[r.jsx("button",{onClick:V,disabled:o,className:"flex-1 flex items-center justify-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Installing..."]}):r.jsxs(r.Fragment,{children:[r.jsx(te,{className:"h-4 w-4 mr-2"}),"Install App"]})}),r.jsx("button",{onClick:Z,className:"px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:r.jsx(se,{className:"h-4 w-4"})}),C&&r.jsx("button",{onClick:Y,className:"px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:r.jsx(re,{className:"h-4 w-4"})})]})]})}),p&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Oe,{className:"h-6 w-6 text-blue-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"How to Install"})]}),r.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx(R,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center mb-3",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full mr-2"}),r.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Platform: ",m.charAt(0).toUpperCase()+m.slice(1)]})]}),r.jsx("ol",{className:"space-y-3",children:Se.steps.map((S,B)=>r.jsxs("li",{className:"flex items-start",children:[r.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 text-sm font-medium rounded-full flex items-center justify-center mr-3",children:B+1}),r.jsx("span",{className:"text-sm text-gray-700",children:S})]},B))})]}),r.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex",children:[r.jsx(xe,{className:"h-5 w-5 text-amber-400 mt-0.5 mr-2"}),r.jsx("div",{children:r.jsxs("p",{className:"text-sm text-amber-800",children:[r.jsx("span",{className:"font-medium",children:"Note:"})," Installation steps may vary depending on your browser and operating system."]})})]})}),r.jsx("div",{className:"flex justify-end mt-6",children:r.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Got it"})})]})})})]})},st="https://lxyexybnotixgpzflota.supabase.co",rt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4eWV4eWJub3RpeGdwemZsb3RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMDcwODIsImV4cCI6MjA3NTc4MzA4Mn0.TSbnvPKWiDdEFbyOh38qj_L87LZ75p3FiOW05hzEBlM",l=we(st,rt,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1}}),Et={async createCardBatch(s){const{data:e,error:t}=await l.from("card_batches").insert(s).select().single();if(t)throw t;return e},async createCard(s){const{data:e,error:t}=await l.from("cards").insert(s).select().single();if(t)throw t;return e},async getCardByControlNumber(s,e){console.log("[Supabase] BULLETPROOF SEARCH for card:",s);const t=s.trim().toUpperCase();let{data:a,error:n}=await l.from("cards").select("*").eq("control_number",t).limit(10);if(!n&&(!a||a.length===0)){const o=await l.from("cards").select("*").ilike("control_number",`%${t}%`).limit(10);a=o.data,n=o.error}if(e&&a&&a.length>0&&(a=a.filter(o=>o.passcode===e)),console.log("[Supabase] BULLETPROOF Card search result:",{searchTerm:t,foundCards:a?.length||0,error:n,firstCard:a?.[0]?.control_number}),n)throw console.error("[Supabase] BULLETPROOF Card search error:",n),n;return a&&a.length>0?a[0]:null},async searchCards(s,e=10){const{data:t,error:a}=await l.rpc("search_card_universal",{search_term:s}).limit(e);if(a)throw a;return t},getPrimaryControlNumber(s){return s.unified_control_number||s.control_number_v2||s.control_number||`Card #${s.card_number}`},getDisplayCardNumber(s){return s.display_card_number||(s.card_number||0)+9999},async activateCard(s,e,t="16"){const{data:a}=await l.from("clinics").select("clinic_code").eq("id",e).single(),n=a?.clinic_code||null,{data:o,error:i}=await l.from("cards").update({is_activated:!0,status:"activated",assigned_clinic_id:e,activated_at:new Date().toISOString(),expires_at:new Date(Date.now()+365*24*60*60*1e3).toISOString(),location_code_v2:t,clinic_code_v2:n,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return o},async claimPerk(s,e){const{data:t,error:a}=await l.from("card_perks").update({claimed:!0,claimed_at:new Date().toISOString(),claimed_by_clinic:e}).eq("id",s).eq("claimed",!1).select().single();if(a)throw a;return t},async createClinic(s){const{data:e,error:t}=await l.from("clinics").insert({...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getClinicByCode(s){const{data:e,error:t}=await l.from("clinics").select("*").eq("clinic_code",s).single();if(t)throw t;return e},async getClinicCards(s){const{data:e,error:t}=await l.from("cards").select(`
        *,
        perks:card_perks(*)
      `).eq("assigned_clinic_id",s);if(t)throw t;return e},async logTransaction(s){const{data:e,error:t}=await l.from("card_transactions").insert({...s,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async createAdminUser(s){const{data:e,error:t}=await l.from("mocards_admin_users").insert({...s,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getAdminByUsername(s){const{data:e,error:t}=await l.from("mocards_admin_users").select("*").eq("username",s).single();if(t)throw t;return e},async createAppointment(s){const{data:e,error:t}=await l.from("appointments").insert({...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getAppointments(s){let e=l.from("appointments").select(`
        *,
        clinic:clinics(*),
        card:cards(*)
      `).order("created_at",{ascending:!1});s?.status&&(e=e.eq("status",s.status)),s?.clinic_id&&(e=e.eq("assigned_clinic_id",s.clinic_id)),s?.admin_id&&(e=e.eq("booked_by_admin_id",s.admin_id)),s?.date_from&&(e=e.gte("appointment_date",s.date_from)),s?.date_to&&(e=e.lte("appointment_date",s.date_to));const{data:t,error:a}=await e;if(a)throw a;return t},async getAppointmentById(s){const{data:e,error:t}=await l.from("appointments").select(`
        *,
        clinic:clinics(*),
        card:cards(*)
      `).eq("id",s).single();if(t)throw t;return e},async updateAppointmentStatus(s,e,t,a,n){const{data:o,error:i}=await l.rpc("update_appointment_status",{p_appointment_id:s,p_new_status:e,p_changed_by:t,p_changed_by_id:a,p_reason:n});if(i)throw i;return o},async rescheduleAppointment(s,e,t,a,n,o){const{data:i,error:p}=await l.rpc("reschedule_appointment",{p_appointment_id:s,p_new_date:e,p_new_time:t,p_reschedule_reason:a,p_changed_by:n,p_changed_by_id:o});if(p)throw p;return i},async getAppointmentHistory(s){const{data:e,error:t}=await l.from("appointment_status_history").select("*").eq("appointment_id",s).order("created_at",{ascending:!0});if(t)throw t;return e},async createAppointmentNotification(s){const{data:e,error:t}=await l.from("appointment_notifications").insert({...s,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getUnreadNotifications(s,e){let t=l.from("appointment_notifications").select("*").eq("recipient_type",s).is("read_at",null).order("created_at",{ascending:!1});e&&(t=t.eq("recipient_id",e));const{data:a,error:n}=await t;if(n)throw n;return a},async markNotificationAsRead(s){const{data:e,error:t}=await l.from("appointment_notifications").update({read_at:new Date().toISOString()}).eq("id",s).select().single();if(t)throw t;return e},async getAllClinics(){const{data:s,error:e}=await l.from("clinics").select("*").eq("status","active").order("name");if(e)throw e;return s},async createPerkdatalate(s){const{data:e,error:t}=await l.from("perk_datalates").insert({...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getAllPerkdatalates(){const{data:s,error:e}=await l.from("perk_datalates").select("*").order("category",{ascending:!0}).order("name",{ascending:!0});if(e)throw e;return s},async getActivePerkdatalates(){const{data:s,error:e}=await l.from("perk_datalates").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});if(e)throw e;return s},async getPerkdatalateById(s){const{data:e,error:t}=await l.from("perk_datalates").select("*").eq("id",s).single();if(t)throw t;return e},async updatePerkdatalate(s,e){const{data:t,error:a}=await l.from("perk_datalates").update({...e,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return t},async deletePerkdatalate(s){if((await this.getPerkdatalateById(s)).is_system_default)throw new Error("System default perks cannot be deleted");const{data:t,error:a}=await l.from("perk_datalates").delete().eq("id",s).eq("is_system_default",!1).select().single();if(a)throw a;return t},async getAllPerkCategories(){const{data:s,error:e}=await l.from("perk_categories").select("*").order("display_order",{ascending:!0});if(e)throw e;return s},async createPerkCategory(s){const{data:e,error:t}=await l.from("perk_categories").insert({...s,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async updatePerkCategory(s,e){const{data:t,error:a}=await l.from("perk_categories").update(e).eq("id",s).select().single();if(a)throw a;return t},async getClinicPerkCustomizations(s){const{data:e,error:t}=await l.from("clinic_perk_customizations").select(`
        *,
        perk_datalate:perk_datalates(*)
      `).eq("clinic_id",s).order("created_at",{ascending:!1});if(t)throw t;return e},async getActiveClinicPerkCustomizations(s){const{data:e,error:t}=await l.from("clinic_perk_customizations").select(`
        *,
        perk_datalate:perk_datalates(*)
      `).eq("clinic_id",s).eq("is_enabled",!0).order("created_at",{ascending:!1});if(t)throw t;return e},async updateClinicPerkCustomization(s,e){const{data:t,error:a}=await l.from("clinic_perk_customizations").update({...e,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return t},async createClinicPerkCustomization(s){const{data:e,error:t}=await l.from("clinic_perk_customizations").insert({...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async recordPerkUsage(s){const e=new Date(s.redemption_date),t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}`,{data:a,error:n}=await l.from("perk_usage_analytics").insert({...s,month_year:t,created_at:new Date().toISOString()}).select().single();if(n)throw n;return a},async getClinicPerkAnalytics(s,e){let t=l.from("perk_usage_analytics").select("*").eq("clinic_id",s);e&&(t=t.eq("month_year",e));const{data:a,error:n}=await t.order("redemption_date",{ascending:!1});if(n)throw n;return a},async getPerkdatalateUsageStats(s,e){let t=l.from("perk_usage_analytics").select("*").eq("perk_datalate_id",s);e&&(t=t.eq("month_year",e));const{data:a,error:n}=await t;if(n)throw n;return a},async getCodeGenerationSettings(){const{data:s,error:e}=await l.from("code_generation_settings").select("*").order("setting_type",{ascending:!0}).order("generation_mode",{ascending:!0});if(e)throw e;return s},async updateCodeGenerationSetting(s,e){const{data:t,error:a}=await l.from("code_generation_settings").update({...e,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return t},async createCodeGenerationSetting(s){const{data:e,error:t}=await l.from("code_generation_settings").insert({...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getLocationCodes(){const{data:s,error:e}=await l.from("location_codes").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(e)throw e;return s},async getAllLocationCodes(){const{data:s,error:e}=await l.from("location_codes").select("*").order("sort_order",{ascending:!0});if(e)throw e;return s},async createLocationCode(s){const{data:e,error:t}=await l.from("location_codes").insert({...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async updateLocationCode(s,e){const{data:t,error:a}=await l.from("location_codes").update({...e,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return t},async generateBatchNumber(s,e,t){const{data:a,error:n}=await l.rpc("generate_batch_number",{generation_mode:s,custom_input:e,location_prefix:t||"PHL"});if(n)throw n;return a},async generateControlNumber(s,e,t="auto",a){const{data:n,error:o}=await l.rpc("generate_control_number",{batch_prefix:s,card_index:e,generation_mode:t,custom_format:a});if(o)throw o;return n},async generatePasscode(s,e="auto",t){const{data:a,error:n}=await l.rpc("generate_passcode",{location_code:s,generation_mode:e,custom_passcode:t});if(n)throw n;return a},async normalizeCode(s,e){const{data:t,error:a}=await l.rpc("normalize_code",{input_code:s,code_type:e});if(a)throw a;return t},async getCardByControlNumberNormalized(s,e){const t=await this.normalizeCode(s,"control"),a=e?await this.normalizeCode(e,"passcode"):void 0;return this.getCardByControlNumber(t,a)},async getCardCodeHistory(s){const{data:e,error:t}=await l.from("card_code_history").select("*").eq("card_id",s).order("created_at",{ascending:!1});if(t)throw t;return e},async recordCardCodeChange(s,e,t,a,n,o,i){const{data:p,error:c}=await l.from("card_code_history").insert({card_id:s,change_type:e,field_name:t,old_value:a,new_value:n,changed_by:o,change_reason:i,metadata:{},created_at:new Date().toISOString()}).select().single();if(c)throw c;return p},async getSystemVersions(){const{data:s,error:e}=await l.from("system_versions").select("*").order("component",{ascending:!0});if(e)throw e;return s},async getComponentVersion(s){const{data:e,error:t}=await l.from("system_versions").select("*").eq("component",s).single();if(t)throw t;return e},async saveUserSessionState(s,e,t,a,n){const{data:o,error:i}=await l.from("user_session_state").upsert({user_id:s,user_type:e,component_name:t,form_data:a,draft_state:n,last_saved:new Date().toISOString(),expires_at:new Date(Date.now()+864e5).toISOString()}).select().single();if(i)throw i;return o},async getUserSessionState(s,e){const{data:t,error:a}=await l.from("user_session_state").select("*").eq("user_id",s).eq("component_name",e).single();if(a&&a.code!=="PGRST116")throw a;return t},async clearExpiredSessions(){const{error:s}=await l.from("user_session_state").delete().lt("expires_at",new Date().toISOString());if(s)throw s},async updateCardCodes(s,e,t){const a=await l.from("cards").select("control_number, passcode, location_code").eq("id",s).single();if(a.error)throw a.error;const{data:n,error:o}=await l.from("cards").update({...e,admin_override:!0,last_modified_by:t,last_modified_at:new Date().toISOString()}).eq("id",s).select().single();if(o)throw o;for(const[i,p]of Object.entries(e))if(i in a.data&&p!==void 0){const c=a.data[i];c!==p&&await this.recordCardCodeChange(s,i.includes("control")?"control_updated":i.includes("passcode")?"passcode_updated":"batch_updated",i,c,p,t,"Admin manual update")}return n},async getCardBatchById(s){const{data:e,error:t}=await l.from("card_batches").select("*").eq("id",s).single();if(t)throw t;return e},async generateCardsWithSettings(s,e,t,a){const n=[],o=await this.getCardBatchById(s);for(let c=0;c<e;c++){const d=(t.startIndex||1)+c,h=await this.generateControlNumber(o.batch_number,d,t.generationMode,t.customPrefix?`${t.customPrefix}-${d.toString().padStart(3,"0")}`:void 0),u=await this.generatePasscode(t.locationCode,t.generationMode),m={batch_id:s,control_number:h,passcode:u,location_code:t.locationCode,status:"unactivated",generation_method:t.generationMode,admin_override:t.generationMode!=="auto",last_modified_by:a,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};n.push(m)}const{data:i,error:p}=await l.from("cards").insert(n).select();if(p)throw p;for(const c of i)await this.recordCardCodeChange(c.id,"created","card_created","",`Control: ${c.control_number}, Passcode: ${c.passcode}`,a,`Batch generation with ${t.generationMode} mode`);return i},async getAllCardBatches(){const{data:s,error:e}=await l.from("card_batches").select("*").order("created_at",{ascending:!1});if(e)throw e;return s}},j={starter:{limit:500,price:299},growth:{limit:1e3,price:499},pro:{limit:2e3,price:799},enterprise:{limit:3e3,price:999}},E={starter:j.starter.limit,growth:j.growth.limit,pro:j.pro.limit,enterprise:j.enterprise.limit},$={starter:j.starter.price,growth:j.growth.price,pro:j.pro.price,enterprise:j.enterprise.price};class at{syncStatus="synced";lastSync=null;subscriptions=[];constructor(){this.setupRealTimeSubscriptions(),this.checkConnection()}async checkConnection(){try{const{error:e}=await l.from("cards").select("id").limit(1);if(e)throw e;return this.setSyncStatus("synced"),!0}catch(e){return console.error("[SupabaseCloudSync] Connection failed:",e),this.setSyncStatus("offline"),!1}}setSyncStatus(e){this.syncStatus=e,e==="synced"&&(this.lastSync=new Date)}setupRealTimeSubscriptions(){const e=l.channel("cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},i=>{console.log("[SupabaseCloudSync] Cards changed:",i),this.lastSync=new Date}).subscribe(),t=l.channel("clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},i=>{console.log("[SupabaseCloudSync] Clinics changed:",i),this.lastSync=new Date}).subscribe(),a=l.channel("appointments-changes").on("postgres_changes",{event:"*",schema:"public",table:"appointments"},i=>{console.log("[SupabaseCloudSync] Appointments changed:",i),this.lastSync=new Date}).subscribe(),n=l.channel("perks-changes").on("postgres_changes",{event:"*",schema:"public",table:"perks"},i=>{console.log("[SupabaseCloudSync] Perks changed:",i),this.lastSync=new Date}).subscribe(),o=l.channel("redemptions-changes").on("postgres_changes",{event:"*",schema:"public",table:"perk_redemptions"},i=>{console.log("[SupabaseCloudSync] Perk redemptions changed:",i),this.lastSync=new Date}).subscribe();this.subscriptions=[e,t,a,n,o]}async getAllCards(){try{this.setSyncStatus("syncing");let e=[],t=!0,a=0;const n=1e3;for(;t;){const{data:i,error:p}=await l.from("cards").select("*").order("created_at",{ascending:!1}).range(a,a+n-1);if(p)throw p;i&&i.length>0?(e=e.concat(i),a+=n,t=i.length===n):t=!1}console.log(`[SupabaseCloudSync] Retrieved ${e.length} total cards from database`),e||(e=[]);const o=(e||[]).map(i=>({id:i.id,controlNumber:i.control_number||`MOC-${i.id}`,fullName:i.full_name||"",status:i.status==="active"||i.status==="activated"?"active":"inactive",perksTotal:i.perks_total||5,perksUsed:i.perks_used||0,clinicId:i.clinic_id||"",expiryDate:i.expiry_date||"2025-12-31",notes:i.notes||"",createdAt:i.created_at,updatedAt:i.updated_at||i.created_at}));return this.setSyncStatus("synced"),o}catch(e){return console.error("[SupabaseCloudSync] Error getting cards:",e),this.setSyncStatus("error"),[]}}async createCard(e){try{this.setSyncStatus("syncing");const t={control_number:e.controlNumber,full_name:e.fullName||"",status:e.status,perks_total:e.perksTotal||5,perks_used:e.perksUsed||0,expiry_date:e.expiryDate};e.clinicId&&e.clinicId.trim()!==""&&(t.clinic_id=e.clinicId),e.notes&&(t.notes=e.notes);const{data:a,error:n}=await l.from("cards").insert(t).select().single();if(n)throw n;const o={id:a.id,controlNumber:a.control_number,fullName:a.full_name||"",status:a.status,perksTotal:a.perks_total,perksUsed:a.perks_used,clinicId:a.clinic_id||"",expiryDate:a.expiry_date,notes:a.notes||"",createdAt:a.created_at,updatedAt:a.updated_at||a.created_at};return this.setSyncStatus("synced"),o}catch(t){throw console.error("[SupabaseCloudSync] Error creating card:",t),this.setSyncStatus("error"),t}}async updateCard(e,t){try{this.setSyncStatus("syncing");const a={};t.status!==void 0&&(a.status=t.status==="active"?"activated":"unactivated"),t.clinicId!==void 0&&(a.clinic_id=t.clinicId||null),t.fullName!==void 0&&(a.full_name=t.fullName),t.perksTotal!==void 0&&(a.perks_total=t.perksTotal),t.perksUsed!==void 0&&(a.perks_used=t.perksUsed),t.notes!==void 0&&(a.notes=t.notes),t.expiryDate!==void 0&&(a.expiry_date=t.expiryDate),a.updated_at=new Date().toISOString();const{error:n}=await l.from("cards").update(a).eq("id",e);if(n)throw n;return this.setSyncStatus("synced"),!0}catch(a){return console.error("[SupabaseCloudSync] Error updating card:",a),this.setSyncStatus("error"),!1}}async getAllClinics(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await l.from("clinics").select("*").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,name:n.clinic_name,username:n.username||n.clinic_code.toLowerCase(),code:n.clinic_code,password:n.password_hash||"clinic123",plan:"starter",maxCards:500,region:n.region||"NCR",address:n.address,email:n.contact_email,contactNumber:n.contact_phone,subscriptionStatus:n.status==="active"?"active":"suspended",subscriptionStartDate:n.created_at.split("T")[0],subscriptionPrice:$.starter,createdAt:n.created_at,updatedAt:n.updated_at,isActive:n.status==="active"}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting clinics:",e),this.setSyncStatus("error"),[]}}async createClinic(e){try{this.setSyncStatus("syncing");const t={clinic_name:e.name,username:e.username,clinic_code:e.code,password_hash:e.password,region:e.region,address:e.address,contact_email:e.email,contact_phone:e.contactNumber,status:e.isActive!==!1?"active":"inactive"},{data:a,error:n}=await l.from("clinics").insert(t).select().single();if(n)throw n;const o={id:a.id,name:a.clinic_name,username:e.username,code:a.clinic_code,password:e.password,plan:e.plan,maxCards:e.maxCards,region:a.region,address:a.address,email:a.contact_email,contactNumber:a.contact_phone,subscriptionStatus:a.status==="active"?"active":"suspended",subscriptionStartDate:a.created_at.split("T")[0],subscriptionPrice:$[e.plan],createdAt:a.created_at,updatedAt:a.updated_at,isActive:a.status==="active"};return this.setSyncStatus("synced"),o}catch(t){throw console.error("[SupabaseCloudSync] Error creating clinic:",t),this.setSyncStatus("error"),t}}async getAllAppointments(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await l.from("appointments").select("*").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,cardControlNumber:n.control_number,clinicId:n.assigned_clinic_id||"",patientName:n.patient_name||"Unknown Patient",patientEmail:n.patient_email||"patient@example.com",patientPhone:n.patient_phone||"+63 000 000 0000",preferredDate:n.appointment_date,preferredTime:n.appointment_time,serviceType:n.service_type||"General Consultation",perkRequested:n.perk_type,status:this.mapAppointmentStatus(n.status),notes:n.cardholder_notes,createdAt:n.created_at}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting appointments:",e),this.setSyncStatus("error"),[]}}async createAppointment(e){try{this.setSyncStatus("syncing");const t={control_number:e.cardControlNumber,assigned_clinic_id:e.clinicId,appointment_date:e.preferredDate,appointment_time:e.preferredTime,perk_type:e.perkRequested||e.serviceType,cardholder_notes:e.notes,status:"waiting_for_approval",patient_name:e.patientName,patient_email:e.patientEmail,patient_phone:e.patientPhone,service_type:e.serviceType},{data:a,error:n}=await l.from("appointments").insert(t).select().single();if(n)throw n;const o={id:a.id,cardControlNumber:a.control_number,clinicId:a.assigned_clinic_id,patientName:a.patient_name,patientEmail:a.patient_email,patientPhone:a.patient_phone,preferredDate:a.appointment_date,preferredTime:a.appointment_time,serviceType:a.service_type,perkRequested:a.perk_type,status:this.mapAppointmentStatus(a.status),notes:a.cardholder_notes,createdAt:a.created_at};return this.setSyncStatus("synced"),o}catch(t){throw console.error("[SupabaseCloudSync] Error creating appointment:",t),this.setSyncStatus("error"),t}}async updateAppointment(e,t){try{this.setSyncStatus("syncing");const a={};t.status!==void 0&&(a.status=this.mapAppointmentStatusToSupabase(t.status)),t.notes!==void 0&&(a.cardholder_notes=t.notes),a.updated_at=new Date().toISOString();const{error:n}=await l.from("appointments").update(a).eq("id",e);if(n)throw n;return this.setSyncStatus("synced"),!0}catch(a){return console.error("[SupabaseCloudSync] Error updating appointment:",a),this.setSyncStatus("error"),!1}}async getAllPerks(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await l.from("perk_templates").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,type:this.mapPerkType(n.type),name:n.name,description:n.description||"",value:n.value||0,isActive:n.is_active,validFor:365,requiresApproval:!1,createdAt:n.created_at,updatedAt:n.updated_at}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting perks:",e),this.setSyncStatus("error"),[]}}async getAllPerkRedemptions(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await l.from("perk_redemptions").select("*").order("used_at",{ascending:!1});if(t)throw console.error("[SupabaseCloudSync] Perk redemptions query failed:",t),t;const a=(e||[]).map(n=>({id:n.id,cardControlNumber:n.card_control_number||"Unknown",perkId:n.perk_id,perkName:n.perk_name||"Unknown Perk",clinicId:n.clinic_id,claimantName:n.claimant_name||"Unknown Patient",handledBy:n.handled_by||"System",serviceType:n.service_type||"General Service",usedAt:n.used_at,value:n.value||0,notes:n.notes||""}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting perk redemptions:",e),this.setSyncStatus("error"),[]}}mapAppointmentStatus(e){return{waiting_for_approval:"pending",approved:"accepted",pending_reschedule:"rescheduled",approved_reschedule:"accepted",cancelled:"cancelled",completed:"completed"}[e]||"pending"}mapAppointmentStatusToSupabase(e){return{pending:"waiting_for_approval",accepted:"approved",declined:"cancelled",rescheduled:"pending_reschedule",completed:"completed",cancelled:"cancelled"}[e]||"waiting_for_approval"}mapPerkType(e){return{consultation:"consultation",cleaning:"dental_cleaning",xray:"xray",discount:"discount",service:"treatment"}[e]||"consultation"}getSyncStatus(){return this.syncStatus}getLastSync(){return this.lastSync}async forceSync(){return await this.checkConnection()}cleanup(){this.subscriptions.forEach(e=>{l.removeChannel(e)}),this.subscriptions=[]}}const b=new at,y={cards:{getAll:()=>b.getAllCards(),save:async s=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async s=>{try{return await b.createCard(s)}catch(e){throw console.error("[CloudOperations] Error adding card:",e),e}},update:async(s,e)=>await b.updateCard(s,e),remove:async s=>{try{const{error:e}=await l.from("cards").delete().eq("id",s);return!e}catch(e){return console.error("[CloudOperations] Error removing card:",e),!1}}},clinics:{getAll:()=>b.getAllClinics(),save:async s=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async s=>{try{return await b.createClinic(s),!0}catch(e){return console.error("[CloudOperations] Error adding clinic:",e),!1}},update:async(s,e)=>{try{const{error:t}=await l.from("clinics").update({clinic_name:e.name,contact_email:e.email,contact_phone:e.contactNumber,updated_at:new Date().toISOString()}).eq("id",s);return!t}catch(t){return console.error("[CloudOperations] Error updating clinic:",t),!1}},remove:async s=>{try{const{error:e}=await l.from("clinics").delete().eq("id",s);return!e}catch(e){return console.error("[CloudOperations] Error removing clinic:",e),!1}}},appointments:{getAll:()=>b.getAllAppointments(),save:async s=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async s=>{try{return await b.createAppointment(s),!0}catch(e){return console.error("[CloudOperations] Error adding appointment:",e),!1}},update:async(s,e)=>await b.updateAppointment(s,e),remove:async s=>{try{const{error:e}=await l.from("appointments").delete().eq("id",s);return!e}catch(e){return console.error("[CloudOperations] Error removing appointment:",e),!1}}},perks:{getAll:()=>b.getAllPerks(),save:async s=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async s=>{try{const{error:e}=await l.from("perks").insert({name:s.name,description:s.description,type:s.type,value:s.value,is_active:s.isActive,is_system_default:!1});return!e}catch(e){return console.error("[CloudOperations] Error adding perk:",e),!1}},update:async(s,e)=>{try{const{error:t}=await l.from("perks").update({name:e.name,description:e.description,default_value:e.value,is_active:e.isActive,updated_at:new Date().toISOString()}).eq("id",s);return!t}catch(t){return console.error("[CloudOperations] Error updating perk:",t),!1}},remove:async s=>{try{const{error:e}=await l.from("perk_templates").delete().eq("id",s);return!e}catch(e){return console.error("[CloudOperations] Error removing perk:",e),!1}}},perkRedemptions:{getAll:()=>b.getAllPerkRedemptions(),save:async s=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async s=>{try{const{data:e,error:t}=await l.from("perk_redemptions").insert({perk_id:s.perkId,perk_name:s.perkName,clinic_id:s.clinicId,card_control_number:s.cardControlNumber,claimant_name:s.claimantName,handled_by:s.handledBy,service_type:s.serviceType,used_at:s.usedAt,value:s.value,notes:s.notes||null}).select().single();if(t)throw t;return{id:e.id,cardControlNumber:e.card_control_number,perkId:e.perk_id,perkName:e.perk_name,clinicId:e.clinic_id,claimantName:e.claimant_name,handledBy:e.handled_by,serviceType:e.service_type,usedAt:e.used_at,value:e.value,notes:e.notes||""}}catch(e){throw console.error("[CloudOperations] Error adding perk redemption:",e),e}}},sync:{getStatus:()=>b.getSyncStatus(),getLastSync:()=>b.getLastSync(),forceSync:()=>b.forceSync()}},nt=()=>({status:b.getSyncStatus(),lastSync:b.getLastSync(),forceSync:b.forceSync}),it=({compact:s=!1,showText:e=!0,className:t=""})=>{const{status:a,lastSync:n,forceSync:o}=nt(),[i,p]=g.useState(typeof navigator<"u"?navigator.onLine:!0);g.useEffect(()=>{const x=()=>p(!0),f=()=>p(!1);if(typeof window<"u")return window.addEventListener("online",x),window.addEventListener("offline",f),()=>{window.removeEventListener("online",x),window.removeEventListener("offline",f)}},[]);const d=((x,f)=>{if(!f)return{icon:ae,color:"text-gray-500",bgColor:"bg-gray-100",text:"Offline",description:"Working offline. Will sync when connection is restored."};switch(x){case"synced":return{icon:ne,color:"text-green-600",bgColor:"bg-green-100",text:"Synced",description:"All data is synced across devices"};case"syncing":return{icon:Re,color:"text-blue-600",bgColor:"bg-blue-100",text:"Syncing...",description:"Syncing data across devices",animate:"animate-spin"};case"error":return{icon:xe,color:"text-red-600",bgColor:"bg-red-100",text:"Sync Error",description:"Failed to sync. Click to retry."};case"offline":return{icon:Te,color:"text-gray-500",bgColor:"bg-gray-100",text:"Offline",description:"Working offline"};default:return{icon:ne,color:"text-gray-600",bgColor:"bg-gray-100",text:"Unknown",description:"Sync status unknown"}}})(a,i),h=d.icon,u=async()=>{(a==="error"||!i&&i)&&await o()},m=()=>{if(!n)return"Never synced";const f=new Date().getTime()-n.getTime();return f<6e4?"Just now":f<36e5?`${Math.floor(f/6e4)}m ago`:f<864e5?`${Math.floor(f/36e5)}h ago`:n.toLocaleDateString()};return s?r.jsxs("button",{onClick:u,className:`flex items-center space-x-1 px-2 py-1 rounded-md ${d.bgColor} hover:opacity-80 transition-opacity ${t}`,title:`${d.description}. Last sync: ${m()}`,children:[r.jsx(h,{className:`h-3 w-3 ${d.color} ${d.animate||""}`}),e&&r.jsx("span",{className:`text-xs font-medium ${d.color}`,children:d.text})]}):r.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${d.bgColor} ${t}`,children:[r.jsx("div",{className:"p-2 rounded-full bg-white",children:r.jsx(h,{className:`h-4 w-4 ${d.color} ${d.animate||""}`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:`text-sm font-semibold ${d.color}`,children:["Cloud Sync ",d.text]}),a==="error"&&r.jsx("button",{onClick:u,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Retry"})]}),r.jsx("p",{className:"text-xs text-gray-600 mt-1",children:d.description}),n&&r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last sync: ",m()]})]}),!i&&r.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[r.jsx(ae,{className:"h-3 w-3"}),r.jsx("span",{className:"text-xs",children:"Offline"})]})]})},M=s=>{const[e,t]=g.useState(!1);return g.useEffect(()=>{const a=window.matchMedia(s);t(a.matches);const n=o=>{t(o.matches)};return a.addEventListener?a.addEventListener("change",n):a.addListener(n),()=>{a.removeEventListener?a.removeEventListener("change",n):a.removeListener(n)}},[s]),e},ot=()=>{const s=M("(max-width: 640px)"),e=M("(max-width: 1024px)"),t=M("(min-width: 1024px)"),a=M("(min-width: 1280px)");return{isMobile:s,isTablet:e,isDesktop:t,isLargeDesktop:a,isMobileOrTablet:s||e,isDesktopOrLarger:t}},ct=()=>{const[s,e]=g.useState({width:typeof window<"u"?window.innerWidth:0,height:typeof window<"u"?window.innerHeight:0});return g.useEffect(()=>{const t=()=>{e({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)},[]),{...s,isLandscape:s.width>s.height,isPortrait:s.height>s.width,isSmallMobile:s.width<375,isMobile:s.width<640,isTablet:s.width>=640&&s.width<1024,isDesktop:s.width>=1024,isHighDensity:typeof window<"u"?window.devicePixelRatio>1.5:!1}};function lt({currentView:s,onViewChange:e,children:t,isAuthenticated:a,userType:n}){const[o,i]=g.useState(!1),{isMobile:p,isTablet:c}=ot(),{height:d}=ct();g.useEffect(()=>{p&&d<600&&i(!1)},[p,d]);const h=m=>!a||!n?!1:n==="admin"&&m==="clinic-portal"||n==="clinic"&&m==="admin-access",u=[{id:"card-lookup",label:"Card Lookup",icon:ge,description:"View card details only",disabled:!1},{id:"clinic-portal",label:"Clinic Portal",icon:fe,description:"View appointment requests only",disabled:h("clinic-portal")},{id:"admin-access",label:"Admin Access",icon:D,description:"Generate cards, assign to clinics, send appointments",disabled:h("admin-access")}];return p?r.jsxs("div",{className:"min-h-screen bg-gray-50 pb-16",children:[r.jsx(Ze,{currentView:s,onViewChange:e,onSecurityToggle:()=>i(!o),showSecurityDashboard:o,navItems:u}),r.jsx("div",{className:"pt-20 px-4 pb-4",children:r.jsx("div",{className:"max-w-full mx-auto",children:t})}),o&&r.jsx("div",{className:"fixed inset-x-4 top-24 z-40 animate-slide-in-down",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 max-h-[70vh] overflow-y-auto",children:[r.jsx("div",{className:"p-3 border-b border-gray-200 bg-blue-600 text-white rounded-t-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"font-semibold",children:"Security Monitor"}),r.jsx("button",{onClick:()=>i(!1),className:"text-white hover:bg-white hover:bg-opacity-20 rounded p-1 transition-colors",children:"âœ•"})]})}),r.jsx("div",{className:"p-4",children:r.jsx(H,{compact:!0})})]})}),r.jsx(G,{})]}):c?r.jsxs("div",{className:"min-h-screen flex flex-col",children:[r.jsxs("div",{className:"bg-[#1A535C] text-white shadow-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-lg",children:"MC"})}),r.jsx("div",{children:r.jsx("h1",{className:"text-xl font-bold text-white",children:"MOCARDS CLOUD"})})]}),r.jsxs("button",{onClick:()=>i(!o),className:`flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 ${o?"bg-blue-600 text-white shadow-lg":"bg-white bg-opacity-20 text-teal-100 hover:bg-opacity-30"}`,children:[r.jsx(T,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Security"})]})]}),r.jsx("div",{className:"px-6 pb-4",children:r.jsx("div",{className:"flex space-x-2",children:u.map(m=>{const x=m.icon,f=s===m.id,w=m.disabled;return r.jsxs("button",{onClick:()=>!w&&e(m.id),disabled:w,className:`flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 ${w?"bg-gray-400 bg-opacity-20 text-gray-500 cursor-not-allowed opacity-50":f?"bg-white text-[#1A535C] shadow-lg":"bg-white bg-opacity-10 text-teal-100 hover:bg-opacity-20"}`,title:w?"Please logout to access this portal":void 0,children:[r.jsx(x,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:m.label}),w&&r.jsx("span",{className:"text-xs",children:"ðŸ”’"})]},m.id)})})})]}),r.jsxs("div",{className:"flex-1 bg-gray-50 relative",children:[r.jsx("div",{className:"p-6",children:t}),o&&r.jsx("div",{className:"fixed bottom-4 right-4 z-50 w-80 animate-slide-in-right",children:r.jsx(H,{})}),r.jsx(G,{})]})]}):r.jsxs("div",{className:"min-h-screen flex",children:[r.jsxs("div",{className:"w-56 bg-[#1A535C] text-white flex flex-col fixed h-full z-10",children:[r.jsx("div",{className:"p-5 border-b border-teal-600",children:r.jsx("h1",{className:"text-lg font-bold text-white",children:"MOCARDS CLOUD"})}),r.jsx("nav",{className:"flex-1 p-3",children:r.jsx("ul",{className:"space-y-2",children:u.map(m=>{const x=m.icon,f=s===m.id,w=m.disabled;return r.jsx("li",{children:r.jsxs("button",{onClick:()=>!w&&e(m.id),disabled:w,className:`w-full flex items-center space-x-2.5 px-3 py-2.5 rounded-lg transition-all duration-200 ${w?"bg-gray-600 bg-opacity-20 text-gray-400 cursor-not-allowed opacity-60":f?"bg-white text-[#1A535C] shadow-lg":"text-teal-100 hover:bg-teal-600 hover:text-white"}`,title:w?"Please logout to access this portal":void 0,children:[r.jsx(x,{className:`h-4 w-4 ${w?"text-gray-400":f?"text-[#1A535C]":""}`}),r.jsxs("div",{className:"text-left flex-1",children:[r.jsxs("div",{className:`font-medium text-sm ${w?"text-gray-400":f?"text-[#1A535C]":""}`,children:[m.label,w&&r.jsx("span",{className:"ml-2",children:"ðŸ”’"})]}),r.jsx("div",{className:`text-xs ${w?"text-gray-500":f?"text-teal-600":"text-teal-300"}`,children:w?"Logout required":m.description})]})]})},m.id)})})}),r.jsxs("div",{className:"p-3 border-t border-teal-600",children:[r.jsxs("button",{onClick:()=>i(!o),className:`w-full flex items-center justify-center space-x-2 px-3 py-2.5 rounded-lg transition-all duration-200 ${o?"bg-blue-600 text-white shadow-lg":"text-teal-100 hover:bg-teal-600 hover:text-white"}`,children:[r.jsx(T,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Security"})]}),r.jsx("div",{className:"mt-3",children:r.jsx(it,{compact:!0,className:"w-full"})}),r.jsxs("div",{className:"text-xs text-teal-300 text-center mt-2 leading-tight",children:["MOCARDS v4.0",r.jsx("br",{}),"Â© 2025 Dental Group"]})]})]}),r.jsx("div",{className:"flex-1 ml-56 bg-gray-50 min-h-screen",children:t}),o&&r.jsx("div",{className:"fixed bottom-4 right-4 z-50 w-96 animate-slide-in-right",children:r.jsx(H,{})}),r.jsx(G,{})]})}const dt=({type:s})=>{const e={size:20};switch(s){case"success":return r.jsx(Me,{...e,className:"text-green-500"});case"error":return r.jsx(Le,{...e,className:"text-red-500"});case"warning":return r.jsx(F,{...e,className:"text-yellow-500"});case"info":return r.jsx(ie,{...e,className:"text-blue-500"});case"loading":return r.jsx(Pe,{...e,className:"text-blue-500 animate-spin"});default:return r.jsx(ie,{...e,className:"text-gray-500"})}},ut=({toast:s})=>{const{removeToast:e}=z(),t={success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",warning:"bg-yellow-50 border-yellow-200",info:"bg-blue-50 border-blue-200",loading:"bg-blue-50 border-blue-200"},a={success:"text-green-800",error:"text-red-800",warning:"text-yellow-800",info:"text-blue-800",loading:"text-blue-800"};return r.jsx("div",{className:`
        max-w-sm w-full ${t[s.type]} border rounded-lg shadow-lg p-4
        transform transition-all duration-300 ease-in-out
        hover:shadow-xl animate-in slide-in-from-right-full
      `,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(dt,{type:s.type}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:`font-medium ${a[s.type]} text-sm`,children:s.title}),s.message&&r.jsx("p",{className:`mt-1 text-sm ${a[s.type]} opacity-90`,children:s.message}),s.action&&r.jsx("button",{onClick:s.action.onClick,className:`
                mt-2 text-sm font-medium ${a[s.type]}
                hover:underline focus:outline-none focus:underline
              `,children:s.action.label})]}),r.jsx("button",{onClick:()=>e(s.id),className:`
            ${a[s.type]} opacity-60 hover:opacity-100
            transition-opacity focus:outline-none
          `,children:r.jsx(R,{size:16})})]})})},mt=()=>{const{toasts:s}=z();return s.length===0?null:r.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-h-screen overflow-y-auto",children:s.map(e=>r.jsx(ut,{toast:e},e.id))})},ht="https://lxyexybnotixgpzflota.supabase.co",pt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4eWV4eWJub3RpeGdwemZsb3RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMDcwODIsImV4cCI6MjA3NTc4MzA4Mn0.TSbnvPKWiDdEFbyOh38qj_L87LZ75p3FiOW05hzEBlM";we(ht,pt,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Application-Name":"MOCARDS-Enterprise"}}});g.createContext(null);function gt(){const[s,e]=g.useState(!1),[t,a]=g.useState(null);return{isAuthenticated:s,user:t,login:(i,p)=>{e(!0),a({type:i,...p})},logout:()=>{e(!1),a(null)}}}class ft extends g.Component{state={hasError:!1};static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t});const a={message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:new Date().toISOString()};console.error("ðŸš¨ CRITICAL ERROR DETAILS:",a);try{const n=JSON.parse(localStorage.getItem("mocards_errors")||"[]");n.push(a),localStorage.setItem("mocards_errors",JSON.stringify(n.slice(-10)))}catch(n){console.error("Failed to store error in localStorage:",n)}}render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:r.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:r.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Something went wrong"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"The application encountered an unexpected error. Please try refreshing the page."}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Refresh Page"}),r.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors",children:"Try Again"})]}),!1]})})}):this.props.children}}function xt(){const[s,e]=g.useState(!1),[t,a]=g.useState([]),[n,o]=g.useState(!1);return null}function wt({enabled:s=!0,onHealthChange:e}){const[t,a]=g.useState({database:!1,clinicTable:!1,cardsTable:!1,sequences:!1,functions:!1,lastChecked:""}),[n,o]=g.useState(s),i=async()=>{const c={database:!1,clinicTable:!1,cardsTable:!1,sequences:!1,functions:!1,lastChecked:new Date().toISOString()};try{const{error:d}=await l.from("information_schema.tables").select("table_name").limit(1);if(c.database=!d,c.database){try{const{error:h}=await l.from("clinics").select("count").limit(1);c.clinicTable=!h}catch(h){console.warn("Clinic table check failed:",h)}try{const{error:h}=await l.from("cards").select("count").limit(1);c.cardsTable=!h}catch(h){console.warn("Cards table check failed:",h)}try{const{data:h,error:u}=await l.rpc("check_sequence",{sequence_name:"card_number_seq"}).single();c.sequences=!u&&!!h}catch(h){console.warn("Sequence check failed:",h)}try{const{data:h,error:u}=await l.rpc("generate_card_control_number");c.functions=!u&&typeof h=="string"}catch(h){console.warn("Function check failed:",h)}}}catch(d){console.error("Health check failed:",d)}return c},p=async()=>{if(n)try{const c=await i();a(c),e?.(c),c.database||console.error("ðŸš¨ CRITICAL: Database connection failed"),c.clinicTable||console.warn("âš ï¸ WARNING: Clinic table access failed"),c.cardsTable||console.warn("âš ï¸ WARNING: Cards table access failed"),c.functions||console.warn("âš ï¸ WARNING: Card generation function failed"),localStorage.setItem("mocards_health",JSON.stringify(c))}catch(c){console.error("Health monitor error:",c)}};return g.useEffect(()=>{if(!s)return;p();const c=setInterval(p,3e4);return()=>clearInterval(c)},[s,n]),null}const yt=(s,e,t)=>`MOC-${s.toString().padStart(5,"0")}-${e}-${t}`,bt={getAll:async()=>await y.cards.getAll(),getByControlNumber:async s=>(await y.cards.getAll()).find(t=>t.controlNumber===s)||null,getByClinicId:async s=>(await y.cards.getAll()).filter(t=>t.clinicId===s),create:async s=>{try{return await y.cards.add(s)}catch(e){throw console.error("Failed to create card:",e),e}},generateCards:async(s,e,t,a=5)=>{const n=[];if(console.log("[GENERATOR] Creating",s,"cards with region:",e,"areaCode:",t),!e||!t)throw console.error("[GENERATOR] Invalid input - region and areaCode are required"),console.error("[GENERATOR] Received:",{region:e,areaCode:t,quantity:s,perksTotal:a}),new Error("Region and Area Code are required for card generation");if(s<=0)throw console.error("[GENERATOR] Invalid quantity:",s),new Error("Quantity must be greater than 0");console.log("[GENERATOR] Input validation passed"),console.log("[GENERATOR] Fetching existing cards...");const o=await y.cards.getAll();console.log("[GENERATOR] Found",o.length,"existing cards");const i=new Set(o.map(w=>w.controlNumber));let p=1;console.log("[GENERATOR] Finding highest existing ID across all cards...");const c=o.filter(w=>w.controlNumber.startsWith("MOC-"));if(console.log("[GENERATOR] Found",c.length,"existing MOC cards"),c.length>0){const w=Math.max(...c.map(_=>{const C=_.controlNumber.match(/MOC-(\d+)/);return C?parseInt(C[1]):0}));p=w+1,console.log("[GENERATOR] Highest existing ID found:",w,"- Starting from:",p)}else console.log("[GENERATOR] No existing MOC cards found, starting from ID 1");console.log("[GENERATOR] Starting from ID:",p);let d=0,h=0,u=0;const m=s*5,x=Math.min(10,Math.max(5,s/10)),f=50;for(console.log("[GENERATOR] Configuration:",{maxAttempts:m,maxConsecutiveFailures:x,batchSize:f,targetQuantity:s}),console.log("[GENERATOR] Processing in batches for optimal performance...");d<s&&h<m&&u<x;){const w=yt(p,e,t);if(h++,i.has(w)){console.log("[GENERATOR] Skipping existing card:",w),p++;continue}const _={controlNumber:w,fullName:"",status:"inactive",perksTotal:a,perksUsed:0,clinicId:"",expiryDate:"2025-12-31"};try{const C=await y.cards.add(_);n.push(C),i.add(w),d++,p++,u=0,(d%10===0||d===1||d===s)&&console.log(`[GENERATOR] Progress: ${d}/${s} cards created (${Math.round(d/s*100)}%)`),d%f===0&&d<s&&(console.log(`[GENERATOR] Batch of ${f} completed, brief pause...`),await new Promise(N=>setTimeout(N,100)))}catch(C){if(console.error("[GENERATOR] Failed to create card:",_.controlNumber,C),u++,p++,u>=x){console.error(`[GENERATOR] Too many consecutive failures (${u}), stopping generation.`);break}else console.log(`[GENERATOR] Continuing after failure (${u}/${x})...`)}}return d<s&&console.warn(`[GENERATOR] Only created ${d} out of ${s} requested cards`),console.log("[GENERATOR] Successfully created",d,"unique cards"),n},updateStatus:async(s,e)=>{const a=(await y.cards.getAll()).find(n=>n.controlNumber===s);return a?(await y.cards.update(a.id,{status:e}),!0):!1},assignToClinic:async(s,e)=>{const t=await y.clinics.getAll(),a=await y.cards.getAll(),n=t.find(p=>p.id===e);if(!n)return!1;const o=a.filter(p=>p.clinicId===e).length,i=E[n.plan];return o+s.length>i?!1:(await Promise.all(s.map(async p=>{const c=a.find(d=>d.controlNumber===p);c&&await y.cards.update(c.id,{clinicId:e})})),!0)},updatePerks:async(s,e)=>{const a=(await y.cards.getAll()).find(n=>n.controlNumber===s);if(a){const n=Math.min(e,a.perksTotal);return await y.cards.update(a.id,{perksUsed:n}),!0}return!1},delete:async s=>{const t=(await y.cards.getAll()).find(a=>a.controlNumber===s);return t?(await y.cards.remove(t.id),!0):!1}},St={getAll:async()=>{try{return await y.clinics.getAll()}catch(s){console.warn("Cloud sync failed, using Supabase fallback:",s);const{data:e}=await l.from("clinics").select("*");return(e||[]).map(t=>({id:t.id,name:t.clinic_name,username:t.clinic_code.toLowerCase(),region:"4A",plan:"starter",code:t.clinic_code,password:t.password_hash,subscriptionPrice:$.starter,subscriptionStatus:"active",subscriptionStartDate:new Date().toISOString(),maxCards:E.starter,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isActive:!0}))}},getById:async s=>(await y.clinics.getAll()).find(t=>t.id===s)||null,getByCode:async s=>(await y.clinics.getAll()).find(t=>t.code===s)||null,authenticate:async(s,e)=>{try{const{data:t}=await l.from("clinics").select("*").eq("clinic_code",s).single();if(t&&t.password_hash===e)return{id:t.id,name:t.clinic_name,username:t.clinic_code.toLowerCase(),region:"4A",plan:"starter",code:t.clinic_code,password:t.password_hash,subscriptionPrice:$.starter,subscriptionStatus:"active",subscriptionStartDate:new Date().toISOString(),maxCards:E.starter,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isActive:!0}}catch(t){console.error("Authentication error:",t)}return null},create:async s=>{const e={...s,id:`clinic_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,subscriptionStatus:"active",subscriptionStartDate:new Date().toISOString(),maxCards:E[s.plan],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isActive:!0};return await y.clinics.add(e),e},update:async(s,e)=>(await y.clinics.getAll()).find(n=>n.id===s)?(await y.clinics.update(s,e),!0):!1,delete:async s=>(await y.clinics.remove(s),!0),getAssignedCardsCount:async s=>(await y.cards.getAll()).filter(t=>t.clinicId===s).length,getPlanLimit:async s=>{const t=(await y.clinics.getAll()).find(a=>a.id===s);return t?E[t.plan]:0}},Dt={getAll:async()=>await y.appointments.getAll(),getByClinicId:async s=>(await y.appointments.getAll()).filter(t=>t.clinicId===s),create:async s=>{const e={...s,id:`appointment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return await y.appointments.add(e),e},updateStatus:async(s,e)=>(await y.appointments.getAll()).find(n=>n.id===s)?(await y.appointments.update(s,{status:e}),!0):!1};class A{static instance;lastHealthCheck=null;healthCheckInterval=null;constructor(){}static getInstance(){return A.instance||(A.instance=new A),A.instance}async checkDatabase(){const e=Date.now();try{const{data:t,error:a}=await l.from("perks").select("id").limit(1),n=Date.now()-e;return a?{status:"critical",message:`Database connection failed: ${a.message}`,timestamp:new Date().toISOString(),responseTime:n}:{status:n<1e3?"healthy":"warning",message:n<1e3?"Database connection healthy":"Database connection slow but functional",timestamp:new Date().toISOString(),responseTime:n,details:{recordCount:t?.length||0}}}catch(t){return{status:"critical",message:`Database check failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString(),responseTime:Date.now()-e}}}async checkAuthentication(){const e=Date.now();try{const t=l.auth.getSession(),a=Date.now()-e;return{status:"healthy",message:"Authentication system operational",timestamp:new Date().toISOString(),responseTime:a,details:{sessionAvailable:!!t}}}catch(t){return{status:"critical",message:`Authentication check failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString(),responseTime:Date.now()-e}}}async checkCardOperations(){const e=Date.now();try{const t=await bt.getAll(),a=Date.now()-e;return{status:a<2e3?"healthy":"warning",message:a<2e3?"Card operations functioning normally":"Card operations slow but functional",timestamp:new Date().toISOString(),responseTime:a,details:{totalCards:t.length,activeCards:t.filter(n=>n.status==="active").length}}}catch(t){return{status:"critical",message:`Card operations failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString(),responseTime:Date.now()-e}}}async checkClinicOperations(){const e=Date.now();try{const t=await St.getAll(),a=Date.now()-e;return{status:a<2e3?"healthy":"warning",message:a<2e3?"Clinic operations functioning normally":"Clinic operations slow but functional",timestamp:new Date().toISOString(),responseTime:a,details:{totalClinics:t.length,activeClinics:t.filter(n=>n.isActive).length}}}catch(t){return{status:"critical",message:`Clinic operations failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString(),responseTime:Date.now()-e}}}async checkStorage(){const e=Date.now();try{const t="mocards_health_check_test",a=Date.now().toString();localStorage.setItem(t,a);const n=localStorage.getItem(t);localStorage.removeItem(t);const o=Date.now()-e;return n===a?{status:"healthy",message:"Storage systems operational",timestamp:new Date().toISOString(),responseTime:o,details:{localStorageItems:localStorage.length,storageAvailable:!0}}:{status:"warning",message:"Storage system inconsistency detected",timestamp:new Date().toISOString(),responseTime:o}}catch(t){return{status:"warning",message:`Storage check completed with issues: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString(),responseTime:Date.now()-e}}}async checkPerformance(){const e=Date.now();try{const t=performance.memory,a=performance.getEntriesByType("navigation")[0],n=Date.now()-e,o={memoryUsage:t?{used:Math.round(t.usedJSHeapSize/1024/1024),total:Math.round(t.totalJSHeapSize/1024/1024),limit:Math.round(t.jsHeapSizeLimit/1024/1024)}:null,pageLoad:a?{domLoad:Math.round(a.domContentLoadedEventEnd-a.fetchStart),fullLoad:Math.round(a.loadEventEnd-a.fetchStart)}:null,connectionType:navigator.connection?.effectiveType||"unknown"},p=(t?t.usedJSHeapSize/t.jsHeapSizeLimit:0)>.8?"warning":"healthy";return{status:p,message:p==="healthy"?"Performance metrics within normal ranges":"Performance metrics show potential issues",timestamp:new Date().toISOString(),responseTime:n,details:o}}catch(t){return{status:"warning",message:`Performance check completed: ${t instanceof Error?t.message:"Limited metrics available"}`,timestamp:new Date().toISOString(),responseTime:Date.now()-e}}}async performHealthCheck(){console.log("ðŸ¥ Running comprehensive health check...");const[e,t,a,n,o,i]=await Promise.all([this.checkDatabase(),this.checkAuthentication(),this.checkCardOperations(),this.checkClinicOperations(),this.checkStorage(),this.checkPerformance()]),p={database:e,authentication:t,cardOperations:a,clinicOperations:n,storage:o,performance:i},c=Object.values(p),d=c.filter(f=>f.status==="healthy").length,h=c.filter(f=>f.status==="warning").length,u=c.filter(f=>f.status==="critical").length;let m="healthy";u>0||h>2?m="critical":h>0&&(m="warning");const x={overall:m,checks:p,summary:{totalChecks:c.length,healthyChecks:d,warningChecks:h,criticalChecks:u}};return this.lastHealthCheck=x,console.log(`ðŸ¥ Health check completed: ${m.toUpperCase()}`,{healthy:d,warnings:h,critical:u}),x}startMonitoring(e=6e4){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.healthCheckInterval=setInterval(async()=>{const t=await this.performHealthCheck();t.overall==="critical"?console.error("ðŸš¨ CRITICAL SYSTEM ISSUES DETECTED:",t):t.overall==="warning"&&console.warn("âš ï¸ System warnings detected:",t),localStorage.setItem("mocards_last_health_check",JSON.stringify(t))},e),console.log("ðŸ”„ Health monitoring started")}stopMonitoring(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null,console.log("â¹ï¸ Health monitoring stopped"))}getLastHealthCheck(){return this.lastHealthCheck}getHealthStatus(){return{status:this.getLastHealthCheck()?.overall||"unknown",timestamp:new Date().toISOString()}}}const W=A.getInstance();class I{static instance;sessionId;errorQueue=[];metricsQueue=[];businessQueue=[];isProduction;constructor(){this.sessionId=this.generateSessionId(),this.isProduction=!0,this.setupGlobalErrorHandlers(),this.startPerformanceMonitoring(),this.scheduleDataFlush()}static getInstance(){return I.instance||(I.instance=new I),I.instance}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}setupGlobalErrorHandlers(){if(window.addEventListener("error",e=>{this.logError("error",e.message,{filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error?.stack})}),window.addEventListener("unhandledrejection",e=>{this.logError("critical",`Unhandled Promise Rejection: ${e.reason}`,{reason:e.reason,promise:e.promise})}),this.isProduction){const e=console.error,t=console.warn;console.error=(...a)=>{this.logError("error",a.join(" "),{originalArgs:a}),e.apply(console,a)},console.warn=(...a)=>{this.logError("warn",a.join(" "),{originalArgs:a}),t.apply(console,a)}}}startPerformanceMonitoring(){window.addEventListener("load",()=>{setTimeout(()=>{const t=performance.getEntriesByType("navigation")[0];t&&(this.logMetric("page_load_time",t.loadEventEnd-t.fetchStart,"ms"),this.logMetric("dom_content_loaded",t.domContentLoadedEventEnd-t.fetchStart,"ms"),this.logMetric("first_byte",t.responseStart-t.fetchStart,"ms"));const a=performance.memory;a&&(this.logMetric("memory_used",a.usedJSHeapSize,"bytes"),this.logMetric("memory_total",a.totalJSHeapSize,"bytes"),this.logMetric("memory_limit",a.jsHeapSizeLimit,"bytes"))},1e3)});const e=new PerformanceObserver(t=>{t.getEntries().forEach(a=>{if(a.entryType==="resource"){const n=a;this.logMetric(`resource_load_${n.initiatorType}`,n.duration,"ms",{name:n.name,size:n.transferSize})}})});try{e.observe({entryTypes:["resource"]})}catch{console.warn("Performance observer not supported")}}scheduleDataFlush(){setInterval(()=>{this.flushData()},3e4),window.addEventListener("beforeunload",()=>{this.flushData()})}logError(e,t,a){const n={id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),level:e,message:t,stack:a?.error||new Error().stack,context:a,userAgent:navigator.userAgent,url:window.location.href,userId:this.getCurrentUserId(),sessionId:this.sessionId};this.errorQueue.push(n),this.persistError(n),e==="critical"&&this.isProduction&&(console.error("ðŸš¨ CRITICAL ERROR:",n),this.flushData())}logMetric(e,t,a,n){const o={id:`metric_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),name:e,value:t,unit:a,context:n};this.metricsQueue.push(o)}logBusinessEvent(e,t=1,a){const n={timestamp:new Date().toISOString(),event:e,value:t,metadata:a};this.businessQueue.push(n),["card_generated","clinic_created","appointment_booked"].includes(e)&&this.persistBusinessEvent(n)}persistError(e){try{const t=this.getStoredErrors();t.push(e),t.length>100&&t.splice(0,t.length-100),localStorage.setItem("mocards_error_log",JSON.stringify(t))}catch{console.warn("Failed to persist error to localStorage")}}persistBusinessEvent(e){try{const t=this.getStoredBusinessEvents();t.push(e),t.length>50&&t.splice(0,t.length-50),localStorage.setItem("mocards_business_events",JSON.stringify(t))}catch{console.warn("Failed to persist business event to localStorage")}}getStoredErrors(){try{const e=localStorage.getItem("mocards_error_log");return e?JSON.parse(e):[]}catch{return[]}}getStoredBusinessEvents(){try{const e=localStorage.getItem("mocards_business_events");return e?JSON.parse(e):[]}catch{return[]}}getCurrentUserId(){try{const e=localStorage.getItem("mocards_current_user");if(e){const t=JSON.parse(e);return t.id||t.username}}catch{}}flushData(){if(this.errorQueue.length>0||this.metricsQueue.length>0||this.businessQueue.length>0){const e={timestamp:new Date().toISOString(),sessionId:this.sessionId,errors:[...this.errorQueue],metrics:[...this.metricsQueue],businessEvents:[...this.businessQueue],systemInfo:this.getSystemInfo()};this.isProduction?console.log("ðŸ“Š Flushing monitoring data:",{errors:this.errorQueue.length,metrics:this.metricsQueue.length,businessEvents:this.businessQueue.length}):console.log("ðŸ“Š Development monitoring data:",e),localStorage.setItem("mocards_last_flush",JSON.stringify(e)),this.errorQueue=[],this.metricsQueue=[],this.businessQueue=[]}}getSystemInfo(){return{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,screen:{width:screen.width,height:screen.height,colorDepth:screen.colorDepth},viewport:{width:window.innerWidth,height:window.innerHeight},connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:null,memory:performance.memory?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}:null}}getErrorCount(){return this.getStoredErrors().length}getRecentErrors(e=10){return this.getStoredErrors().slice(-e)}getBusinessEventCount(){return this.getStoredBusinessEvents().length}clearStoredData(){localStorage.removeItem("mocards_error_log"),localStorage.removeItem("mocards_business_events"),localStorage.removeItem("mocards_last_flush"),this.errorQueue=[],this.metricsQueue=[],this.businessQueue=[]}generateReport(){return{sessionId:this.sessionId,timestamp:new Date().toISOString(),errorCount:this.getErrorCount(),recentErrors:this.getRecentErrors(5),businessEventCount:this.getBusinessEventCount(),systemInfo:this.getSystemInfo(),queueSizes:{errors:this.errorQueue.length,metrics:this.metricsQueue.length,businessEvents:this.businessQueue.length}}}}const vt=I.getInstance(),he=(s,e,t)=>{vt.logBusinessEvent(s,e,t)},pe=g.lazy(()=>Q(()=>import("./SimpleCardLookupView-ZIP7TJwe.js"),__vite__mapDeps([0,1,2,3,4])).then(s=>({default:s.SimpleCardLookupView}))),_t=g.lazy(()=>Q(()=>import("./SimpleClinicPortalView-DiWgeXic.js"),__vite__mapDeps([5,1,2,3,4])).then(s=>({default:s.SimpleClinicPortalView}))),Ct=g.lazy(()=>Q(()=>import("./SimpleAdminPortalView-Can9VlE0.js"),__vite__mapDeps([6,1,2,3,4])).then(s=>({default:s.SimpleAdminPortalView})));function Nt(){const[s,e]=g.useState("card-lookup"),{isAuthenticated:t,user:a}=gt();g.useEffect(()=>(W.startMonitoring(6e4),he("app_startup",1,{timestamp:new Date().toISOString(),userAgent:navigator.userAgent,viewportSize:`${window.innerWidth}x${window.innerHeight}`}),W.performHealthCheck().then(i=>{console.log("ðŸ¥ Initial health check completed:",i.overall),i.overall==="critical"&&console.error("ðŸš¨ Critical system issues detected on startup")}),console.log("ðŸš€ MOCARDS CLOUD - Production Ready",{timestamp:new Date().toISOString(),build:"production",monitoring:"active"}),()=>{W.stopMonitoring()}),[]),g.useEffect(()=>{!t&&(s==="admin-access"||s==="clinic-portal")&&e("card-lookup")},[t]),g.useEffect(()=>{he("view_change",1,{from:"previous_view",to:s,authenticated:t,userType:a?.type})},[s,t,a?.type]);const n=()=>{switch(s){case"card-lookup":return r.jsx(pe,{});case"clinic-portal":return r.jsx(_t,{});case"admin-access":return r.jsx(Ct,{});default:return r.jsx(pe,{})}},o=i=>{if(i==="card-lookup"){e(i);return}t&&a&&(a.type==="admin"&&i==="clinic-portal"||a.type==="clinic"&&i==="admin-access")||e(i)};return r.jsx(ft,{children:r.jsxs(Je,{children:[r.jsx(lt,{currentView:s,onViewChange:o,isAuthenticated:t,userType:a?.type,children:r.jsx(g.Suspense,{fallback:r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsxs("div",{className:"light-card p-8 w-full max-w-md text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600 mx-auto mb-4"}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading..."}),r.jsx("p",{className:"text-gray-600",children:"Please wait while we load the application."})]})}),children:n()})}),r.jsx(mt,{}),r.jsx(xt,{}),r.jsx(wt,{enabled:!1})]})})}Ue.createRoot(document.getElementById("root")).render(r.jsx(Ne.StrictMode,{children:r.jsx(Nt,{})}));export{ue as a,J as b,gt as c,Et as d,Dt as e,bt as f,St as g,r as j,Fe as t,z as u};
