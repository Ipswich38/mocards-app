const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CardLookupView-B2O4KWG4.js","assets/charts-sad3owxz.js","assets/vendor-N--QU9DW.js","assets/data-B26KYoAg.js","assets/icons-Dn_uH5YA.js","assets/database-BUiByx9r.js","assets/ClinicPortalView-BSuElK2c.js","assets/useAutoRefresh-DC_elvQE.js","assets/AdminPortalView-D3VsWXsg.js"])))=>i.map(i=>d[i]);
import{r as xe,a as ye,g as we}from"./vendor-N--QU9DW.js";import{r as h,R as be}from"./charts-sad3owxz.js";import{S as A,E as ve,A as I,a as z,L as J,U as _e,C as Se,T as Ne,X as E,M as Y,b as ue,c as me,d as Ce,H as je,e as Z,D as K,f as X,g as Q,h as T,i as Ae,j as pe,W as ee,k as te,l as ke,R as Ie,I as se,m as Ee,n as De,o as Te}from"./icons-Dn_uH5YA.js";import{c as Oe}from"./database-BUiByx9r.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var q={exports:{}},C={};var re;function Pe(){if(re)return C;re=1;var r=xe(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(g,u,m){var p,c={},l=null,f=null;m!==void 0&&(l=""+m),u.key!==void 0&&(l=""+u.key),u.ref!==void 0&&(f=u.ref);for(p in u)a.call(u,p)&&!o.hasOwnProperty(p)&&(c[p]=u[p]);if(g&&g.defaultProps)for(p in u=g.defaultProps,u)c[p]===void 0&&(c[p]=u[p]);return{$$typeof:e,type:g,key:l,ref:f,props:c,_owner:n.current}}return C.Fragment=t,C.jsx=i,C.jsxs=i,C}var ae;function Le(){return ae||(ae=1,q.exports=Pe()),q.exports}var s=Le(),O={},ne;function Re(){if(ne)return O;ne=1;var r=ye();return O.createRoot=r.createRoot,O.hydrateRoot=r.hydrateRoot,O}var Me=Re();const qe=we(Me),$e="modulepreload",Be=function(r){return"/"+r},ie={},G=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let u=function(m){return Promise.all(m.map(p=>Promise.resolve(p).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),g=i?.nonce||i?.getAttribute("nonce");n=u(t.map(m=>{if(m=Be(m),m in ie)return;ie[m]=!0;const p=m.endsWith(".css"),c=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${c}`))return;const l=document.createElement("link");if(l.rel=p?"stylesheet":$e,p||(l.as="script"),l.crossOrigin="",l.href=m,g&&l.setAttribute("nonce",g),document.head.appendChild(l),p)return new Promise((f,x)=>{l.addEventListener("load",f),l.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(i){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=i,window.dispatchEvent(g),!g.defaultPrevented)throw i}return n.then(i=>{for(const g of i||[])g.status==="rejected"&&o(g.reason);return e().catch(o)})};class v{static config={maxLoginAttempts:5,lockoutDuration:15,sessionDuration:480,passwordMinLength:8,requireTwoFactor:!1};static rateLimits=new Map([["login",{windowMs:900*1e3,maxRequests:5}],["search",{windowMs:60*1e3,maxRequests:30}],["api",{windowMs:60*1e3,maxRequests:100}],["export",{windowMs:3600*1e3,maxRequests:10}]]);static attempts=new Map;static events=[];static sanitizeInput(e){return typeof e!="string"?"":e.trim().replace(/[<>\"']/g,"").replace(/[\x00-\x1F\x7F]/g,"").slice(0,1e3)}static validateControlNumber(e){const t=this.sanitizeInput(e);return t?/(union|select|insert|update|delete|drop|exec|script)/i.test(t)?(this.logSecurityEvent({type:"SUSPICIOUS_ACTIVITY",ip:"unknown",userAgent:"unknown",severity:"HIGH",details:{input:t,reason:"SQL injection attempt"}}),{valid:!1,message:"Invalid characters detected"}):/^MOC-[\w\d-]+$/.test(t)?t.length>50?{valid:!1,message:"Control number too long"}:{valid:!0}:{valid:!1,message:"Invalid control number format"}:{valid:!1,message:"Control number is required"}}static checkRateLimit(e,t){const a=this.rateLimits.get(e);if(!a)return{allowed:!0};const n=Date.now(),o=`${e}:${t}`,i=this.attempts.get(o);if(!i)return this.attempts.set(o,{count:1,lastAttempt:new Date(n),blocked:!1}),{allowed:!0};if(n-i.lastAttempt.getTime()>a.windowMs)return this.attempts.set(o,{count:1,lastAttempt:new Date(n),blocked:!1}),{allowed:!0};if(i.count>=a.maxRequests){const g=Math.ceil((a.windowMs-(n-i.lastAttempt.getTime()))/1e3);return this.logSecurityEvent({type:"RATE_LIMIT",ip:t,userAgent:"unknown",severity:"MEDIUM",details:{key:e,attempts:i.count,limit:a.maxRequests}}),{allowed:!1,retryAfter:g}}return i.count++,i.lastAttempt=new Date(n),{allowed:!0}}static createSession(e,t){const a={userId:e,userType:t,createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionDuration*60*1e3),csrfToken:this.generateSecureToken()},n=this.generateSecureToken();return localStorage.setItem(`mocards_session_${n}`,JSON.stringify(a)),this.logSecurityEvent({type:"LOGIN_ATTEMPT",userId:e,ip:"unknown",userAgent:navigator.userAgent,severity:"LOW",details:{userType:t,sessionToken:n}}),n}static validateSession(e){try{const t=localStorage.getItem(`mocards_session_${e}`);if(!t)return{valid:!1};const a=JSON.parse(t);return new Date>new Date(a.expiresAt)?(this.destroySession(e),{valid:!1}):{valid:!0,userId:a.userId,userType:a.userType}}catch{return{valid:!1}}}static destroySession(e){localStorage.removeItem(`mocards_session_${e}`)}static validatePassword(e){const t=this.sanitizeInput(e);let a=0;if(t.length<this.config.passwordMinLength)return{valid:!1,message:`Password must be at least ${this.config.passwordMinLength} characters`,strength:0};t.length>=8&&(a+=20),t.length>=12&&(a+=10),/[a-z]/.test(t)&&(a+=20),/[A-Z]/.test(t)&&(a+=20),/[0-9]/.test(t)&&(a+=15),/[^a-zA-Z0-9]/.test(t)&&(a+=15);const n=a>=80?"Strong":a>=60?"Good":"Weak";return{valid:a>=60,message:a<60?`Password is too weak (${n})`:void 0,strength:a}}static logSecurityEvent(e){const t={...e,id:this.generateSecureToken(),timestamp:new Date};this.events.push(t),this.events.length>1e3&&(this.events=this.events.slice(-1e3)),(e.severity==="CRITICAL"||e.severity==="HIGH")&&console.warn("ðŸ”’ Security Alert:",t),this.sendToMonitoring(t)}static getSecurityEvents(e){return e?this.events.filter(t=>t.severity===e):this.events.slice(-100)}static validateFileUpload(e){return["application/pdf","image/jpeg","image/png","text/csv"].includes(e.type)?e.size>10485760?{valid:!1,message:"File size exceeds 10MB limit"}:{valid:!0}:{valid:!1,message:`File type '${e.type}' is not allowed`}}static generateSecureToken(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";const n=new Uint8Array(e);crypto.getRandomValues(n);for(let o=0;o<e;o++)a+=t[n[o]%t.length];return a}static sendToMonitoring(e){typeof window<"u"&&console.log("ðŸ“Š Security Event:",e.type,e.severity)}static updateConfig(e){this.config={...this.config,...e}}static getConfig(){return{...this.config}}static addRateLimit(e,t){this.rateLimits.set(e,t)}static getSecurityMetrics(){const e={LOW:0,MEDIUM:0,HIGH:0,CRITICAL:0};this.events.forEach(n=>{e[n.severity]++});const t=this.events.filter(n=>n.type==="RATE_LIMIT").length,a=Array.from(this.attempts.values()).filter(n=>n.blocked).length;return{totalEvents:this.events.length,eventsBySeverity:e,recentThreats:this.events.filter(n=>n.severity==="HIGH"||n.severity==="CRITICAL").slice(-10),rateLimitViolations:t,activeBlocks:a}}}const ze=()=>`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,L=(r,e,t,a)=>({type:r,title:e,message:t,duration:a?.duration??(r==="loading"?void 0:5e3),action:a?.action,persistent:a?.persistent??r==="loading"}),oe=(r,e,t)=>L("success",r,e,{action:t}),U=(r,e,t)=>L("error",r,e,{action:t,duration:7e3}),Ue=(r,e,t)=>L("warning",r,e,{action:t}),k=(r,e,t)=>L("info",r,e,{action:t}),he=h.createContext(void 0),R=()=>{const r=h.useContext(he);if(!r)throw new Error("useToast must be used within a ToastProvider");return r},Ge=({children:r})=>{const[e,t]=h.useState([]),a=h.useCallback(u=>{const m=ze(),p={...u,id:m};return t(c=>[...c,p]),!u.persistent&&u.duration&&setTimeout(()=>{n(m)},u.duration),m},[]),n=h.useCallback(u=>{t(m=>m.filter(p=>p.id!==u))},[]),o=h.useCallback((u,m)=>{t(p=>p.map(c=>c.id===u?{...c,...m}:c))},[]),i=h.useCallback(()=>{t([])},[]),g={toasts:e,addToast:a,removeToast:n,updateToast:o,clearAllToasts:i};return s.jsx(he.Provider,{value:g,children:r})},We=()=>{const[r,e]=h.useState({isBlocked:!1,attempts:0}),{addToast:t}=R(),a=h.useCallback((l,f)=>{const x=f||Ve(),y=v.checkRateLimit(l,x);return y.allowed?!0:(e(D=>({...D,isBlocked:!0,retryAfter:y.retryAfter,attempts:D.attempts+1,lastAttempt:new Date})),t(Ue("Rate Limit Exceeded",`Too many ${l} attempts. Please try again in ${y.retryAfter} seconds.`,{label:"Understand",onClick:()=>{}})),!1)},[t]),n=h.useCallback((l,f="general")=>{if(f==="control_number")return v.validateControlNumber(l);{const x=v.sanitizeInput(l);return{valid:x===l,message:x!==l?"Input contains invalid characters":void 0,sanitized:x}}},[]),o=h.useCallback(l=>{const f=v.validateFileUpload(l);return f.valid||t(U("File Upload Error",f.message||"Invalid file",{label:"Try Again",onClick:()=>{}})),f},[t]),i=h.useCallback((l,f)=>{const x=v.createSession(l,f);return t(k("Secure Session Created","Your session is encrypted and will auto-expire for security.",{label:"Got it",onClick:()=>{}})),x},[t]),g=h.useCallback(l=>v.validateSession(l),[]),u=h.useCallback(l=>{v.destroySession(l),t(k("Session Ended","You have been securely logged out."))},[t]),m=h.useCallback(l=>v.validatePassword(l),[]),p=h.useCallback(()=>v.getSecurityMetrics(),[]),c=h.useCallback(l=>v.getSecurityEvents(l),[]);return h.useEffect(()=>{if(r.isBlocked&&r.retryAfter){const l=setTimeout(()=>{e(f=>({...f,isBlocked:!1,retryAfter:void 0})),t(k("Access Restored","You can now try again."))},r.retryAfter*1e3);return()=>clearTimeout(l)}},[r.isBlocked,r.retryAfter,t]),{securityState:r,checkRateLimit:a,validateInput:n,validateFileUpload:o,createSecureSession:i,validateSession:g,destroySession:u,validatePassword:m,getSecurityMetrics:p,getSecurityEvents:c}};function Ve(){const r=localStorage.getItem("mocards_client_id");if(r)return r;const e=Fe();return localStorage.setItem("mocards_client_id",e),e}function Fe(){const r=[navigator.userAgent,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),navigator.language].join("|");let e=0;for(let t=0;t<r.length;t++){const a=r.charCodeAt(t);e=(e<<5)-e+a,e=e&e}return Math.abs(e).toString(36)+Date.now().toString(36)}const $=({className:r="",compact:e=!1})=>{const[t,a]=h.useState(null),[n,o]=h.useState(!1),{getSecurityMetrics:i}=We();if(h.useEffect(()=>{const c=()=>{const f=i();a(f)};c();const l=setInterval(c,3e4);return()=>clearInterval(l)},[i]),!t)return s.jsx("div",{className:`bg-[#1F2937] rounded-lg border border-[#374151] p-4 ${r}`,children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-6 bg-[#374151] rounded w-48 mb-4"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-4 bg-[#374151] rounded w-full"}),s.jsx("div",{className:"h-4 bg-[#374151] rounded w-3/4"})]})]})});const g=c=>{switch(c.toUpperCase()){case"CRITICAL":return"text-red-400 bg-red-900/20";case"HIGH":return"text-orange-400 bg-orange-900/20";case"MEDIUM":return"text-yellow-400 bg-yellow-900/20";case"LOW":return"text-blue-400 bg-blue-900/20";default:return"text-gray-400 bg-gray-900/20"}},m=(()=>{const{eventsBySeverity:c}=t,l=c.CRITICAL||0,f=c.HIGH||0,x=c.MEDIUM||0;let y=100;return y-=l*20,y-=f*10,y-=x*5,Math.max(y,0)})(),p=m>=80?"text-green-400":m>=60?"text-yellow-400":"text-red-400";return s.jsxs("div",{className:`bg-[#1F2937] rounded-lg border border-[#374151] ${r}`,children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#374151]",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(A,{className:"h-5 w-5 text-blue-400 mr-2"}),s.jsx("h3",{className:"text-[#E8EAED] font-medium",children:"Security Monitor"}),s.jsxs("div",{className:`ml-3 px-2 py-1 rounded text-xs font-medium ${p.replace("text-","bg-").replace("400","900/20")}`,children:["Score: ",s.jsxs("span",{className:p,children:[m,"/100"]})]})]}),s.jsx("button",{onClick:()=>o(!n),className:"text-[#9AA0A6] hover:text-[#E8EAED] transition-colors",children:s.jsx(ve,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:`grid gap-4 mb-4 ${e?"grid-cols-2":"grid-cols-2 md:grid-cols-4"}`,children:[s.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(I,{className:"h-4 w-4 text-blue-400"}),s.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Total Events"})]}),s.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:t.totalEvents})]}),s.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(z,{className:"h-4 w-4 text-red-400"}),s.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Threats"})]}),s.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:(t.eventsBySeverity.HIGH||0)+(t.eventsBySeverity.CRITICAL||0)})]}),s.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(J,{className:"h-4 w-4 text-yellow-400"}),s.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Rate Limits"})]}),s.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:t.rateLimitViolations})]}),s.jsxs("div",{className:"bg-[#303134] rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(_e,{className:"h-4 w-4 text-purple-400"}),s.jsx("span",{className:"text-xs text-[#9AA0A6]",children:"Blocked"})]}),s.jsx("div",{className:"text-lg font-bold text-[#E8EAED] mt-1",children:t.activeBlocks})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-[#E8EAED] text-sm font-medium mb-2",children:"Event Severity Distribution"}),s.jsx("div",{className:"space-y-2",children:Object.entries(t.eventsBySeverity).map(([c,l])=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${g(c).split(" ")[1]}`}),s.jsx("span",{className:"text-[#9AA0A6] text-sm capitalize",children:c.toLowerCase()})]}),s.jsx("span",{className:"text-[#E8EAED] font-medium",children:l})]},c))})]})]}),n&&s.jsxs("div",{className:"border-t border-[#374151] p-4",children:[s.jsx("h4",{className:"text-[#E8EAED] text-sm font-medium mb-3",children:"Recent Security Events"}),t.recentThreats.length===0?s.jsxs("div",{className:"text-center py-4",children:[s.jsx(A,{className:"h-8 w-8 text-green-400 mx-auto mb-2"}),s.jsx("p",{className:"text-[#9AA0A6] text-sm",children:"No security threats detected"}),s.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"All systems operating normally"})]}):s.jsx("div",{className:"space-y-2",children:t.recentThreats.slice(0,5).map(c=>s.jsx("div",{className:"bg-[#303134] rounded-lg p-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${g(c.severity)}`,children:c.severity}),s.jsx("span",{className:"text-[#9AA0A6] text-sm ml-2",children:c.type.replace("_"," ")})]}),s.jsx("p",{className:"text-[#E8EAED] text-sm",children:c.details.reason||"Security event detected"})]}),s.jsxs("div",{className:"flex items-center text-[#9AA0A6] text-xs",children:[s.jsx(Se,{className:"h-3 w-3 mr-1"}),new Date(c.timestamp).toLocaleTimeString()]})]})},c.id))}),s.jsxs("div",{className:"mt-4 pt-4 border-t border-[#374151]",children:[s.jsx("h4",{className:"text-[#E8EAED] text-sm font-medium mb-2",children:"Security Recommendations"}),s.jsxs("div",{className:"space-y-2",children:[m<80&&s.jsxs("div",{className:"flex items-start",children:[s.jsx(Ne,{className:"h-4 w-4 text-yellow-400 mr-2 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Improve Security Score"}),s.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"Review recent security events and implement additional protections"})]})]}),t.rateLimitViolations>10&&s.jsxs("div",{className:"flex items-start",children:[s.jsx(J,{className:"h-4 w-4 text-blue-400 mr-2 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Review Rate Limiting"}),s.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"High number of rate limit violations detected"})]})]}),(t.eventsBySeverity.HIGH||0)+(t.eventsBySeverity.CRITICAL||0)>0&&s.jsxs("div",{className:"flex items-start",children:[s.jsx(z,{className:"h-4 w-4 text-red-400 mr-2 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Address High Priority Threats"}),s.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"Critical or high severity security events require attention"})]})]}),m>=80&&t.recentThreats.length===0&&s.jsxs("div",{className:"flex items-start",children:[s.jsx(A,{className:"h-4 w-4 text-green-400 mr-2 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-[#E8EAED] text-sm",children:"Security Status Excellent"}),s.jsx("p",{className:"text-[#9AA0A6] text-xs",children:"All security systems operating normally"})]})]})]})]})]})]})},He=({currentView:r,onViewChange:e,onSecurityToggle:t,showSecurityDashboard:a,navItems:n})=>{const[o,i]=h.useState(!1),u=n||[{id:"card-lookup",label:"Card Lookup",icon:ue,description:"Verify card validity",color:"text-blue-600",bgColor:"bg-blue-50",disabled:!1},{id:"clinic-portal",label:"Clinic Portal",icon:me,description:"Clinic management",color:"text-green-600",bgColor:"bg-green-50",disabled:!1},{id:"admin-access",label:"Admin Access",icon:A,description:"System administration",color:"text-purple-600",bgColor:"bg-purple-50",disabled:!1}],m=(c,l)=>{l||(e(c),i(!1))},p=()=>{i(!o)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"lg:hidden bg-white shadow-lg border-b border-gray-200 fixed top-0 left-0 right-0 z-50",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-[#1A535C] rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-sm",children:"MC"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"MOCARDS"}),s.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"Dental Benefits Platform"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:t,className:`p-2 rounded-lg transition-colors ${a?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s.jsx(I,{className:"h-4 w-4"})}),s.jsx("button",{onClick:p,className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",children:o?s.jsx(E,{className:"h-5 w-5"}):s.jsx(Y,{className:"h-5 w-5"})})]})]}),s.jsx("div",{className:"px-4 pb-2",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-[#1A535C] rounded-full"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:u.find(c=>c.id===r)?.label})]})})]}),s.jsxs("div",{className:`lg:hidden fixed inset-0 z-50 transition-opacity duration-300 ${o?"opacity-100 visible":"opacity-0 invisible"}`,children:[s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>i(!1)}),s.jsxs("div",{className:`absolute right-0 top-0 h-full w-80 max-w-[85vw] bg-white shadow-xl transform transition-transform duration-300 ${o?"translate-x-0":"translate-x-full"}`,children:[s.jsx("div",{className:"p-6 bg-[#1A535C] text-white",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-bold",children:"MOCARDS CLOUD"}),s.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-colors",children:s.jsx(E,{className:"h-5 w-5"})})]})}),s.jsx("div",{className:"p-4 space-y-2",children:u.map(c=>{const l=c.icon,f=r===c.id,x=c.disabled;return s.jsxs("button",{onClick:()=>m(c.id,x),disabled:x,className:`w-full flex items-center space-x-3 p-4 rounded-xl transition-all duration-200 ${x?"bg-gray-200 text-gray-400 cursor-not-allowed opacity-60":f?"bg-[#1A535C] text-white shadow-lg":"hover:bg-gray-50 text-gray-700"}`,title:x?"Please logout to access this portal":void 0,children:[s.jsx("div",{className:`p-2 rounded-lg ${x?"bg-gray-300":f?"bg-white bg-opacity-20":c.bgColor}`,children:s.jsx(l,{className:`h-5 w-5 ${x?"text-gray-400":f?"text-white":c.color}`})}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsxs("div",{className:`font-medium ${x?"text-gray-400":f?"text-white":"text-gray-900"}`,children:[c.label,x&&s.jsx("span",{className:"ml-2",children:"ðŸ”’"})]}),s.jsx("div",{className:`text-sm ${x?"text-gray-500":f?"text-teal-200":"text-gray-500"}`,children:x?"Logout required":c.description})]}),s.jsx(Ce,{className:`h-4 w-4 ${x?"text-gray-400":f?"text-white":"text-gray-400"}`})]},c.id)})}),s.jsx("div",{className:"p-4 border-t border-gray-200",children:s.jsxs("button",{onClick:()=>{t(),i(!1)},className:`w-full flex items-center space-x-3 p-4 rounded-xl transition-all duration-200 ${a?"bg-blue-600 text-white":"hover:bg-blue-50 text-gray-700"}`,children:[s.jsx("div",{className:`p-2 rounded-lg ${a?"bg-white bg-opacity-20":"bg-blue-50"}`,children:s.jsx(I,{className:`h-5 w-5 ${a?"text-white":"text-blue-600"}`})}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("div",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:"Security Monitor"}),s.jsx("div",{className:`text-sm ${a?"text-blue-200":"text-gray-500"}`,children:"Live security dashboard"})]}),a&&s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"MOCARDS v4.0"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Â© 2025 Dental Group"})]})})]})]}),s.jsx("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 z-40 bg-white border-t border-gray-200 shadow-lg",children:s.jsxs("div",{className:"grid grid-cols-4 py-2",children:[s.jsxs("button",{className:"flex flex-col items-center py-2 text-[#1A535C]",children:[s.jsx(je,{className:"h-5 w-5 mb-1"}),s.jsx("span",{className:"text-xs font-medium",children:"Home"})]}),u.slice(0,2).map(c=>{const l=c.icon,f=r===c.id;return s.jsxs("button",{onClick:()=>m(c.id),className:`flex flex-col items-center py-2 ${f?"text-[#1A535C]":"text-gray-400"}`,children:[s.jsx(l,{className:"h-5 w-5 mb-1"}),s.jsx("span",{className:"text-xs font-medium",children:c.label.split(" ")[0]})]},c.id)}),s.jsxs("button",{onClick:p,className:"flex flex-col items-center py-2 text-gray-600",children:[s.jsx(Y,{className:"h-5 w-5 mb-1"}),s.jsx("span",{className:"text-xs font-medium",children:"Menu"})]})]})})]})},Je=()=>{const[r,e]=h.useState(null),[t,a]=h.useState({isSupported:!1,isInstalled:!1,canInstall:!1,isStandalone:!1,platform:"unknown"});h.useEffect(()=>{const u=()=>{const p="serviceWorker"in navigator&&"PushManager"in window,c=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),l=ce(),f=c||Ye();a({isSupported:p,isInstalled:f,canInstall:r!==null,isStandalone:c,platform:l})};u();const m=window.matchMedia("(display-mode: standalone)");return m.addListener(u),()=>m.removeListener(u)},[r]),h.useEffect(()=>{const u=p=>{console.log("[PWA] beforeinstallprompt fired"),p.preventDefault(),e(p)},m=()=>{console.log("[PWA] App was installed"),e(null),a(p=>({...p,isInstalled:!0,canInstall:!1}))};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",m),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",m)}},[]),h.useEffect(()=>{t.isSupported&&Ze()},[t.isSupported]);const n=h.useCallback(async()=>{if(!r)return{success:!1,error:"Installation prompt not available"};try{await r.prompt();const u=await r.userChoice;return console.log("[PWA] User choice:",u.outcome),u.outcome==="accepted"?(e(null),{success:!0,outcome:"accepted"}):{success:!1,outcome:"dismissed"}}catch(u){return console.error("[PWA] Installation failed:",u),{success:!1,error:u instanceof Error?u.message:"Installation failed"}}},[r]),o=h.useCallback(async u=>{const m={title:"MOCARDS Cloud - Dental Benefits Management Platform",text:"Professional dental benefits card management and clinic portal system",url:window.location.origin,...u};if(navigator.share)try{return await navigator.share(m),!0}catch(p){return p.name!=="AbortError"&&console.error("[PWA] Share failed:",p),!1}else try{return await navigator.clipboard.writeText(m.url),!0}catch(p){return console.error("[PWA] Clipboard write failed:",p),!1}},[]),i=h.useCallback(async()=>{if(!("Notification"in window))return console.warn("[PWA] This browser does not support notifications"),!1;if(Notification.permission==="granted")return!0;if(Notification.permission==="denied")return!1;try{return await Notification.requestPermission()==="granted"}catch(u){return console.error("[PWA] Notification permission request failed:",u),!1}},[]),g=h.useCallback(()=>{const u=ce(),m={ios:["Tap the Share button in Safari",'Scroll down and tap "Add to Home Screen"','Tap "Add" to install the app'],android:["Tap the menu button (â‹®) in Chrome",'Select "Add to Home screen"','Tap "Add" to install the app'],desktop:["Click the install button in your browser's address bar","Or use Ctrl+Shift+A (Cmd+Shift+A on Mac)",'Click "Install" when prompted']};return{platform:u,steps:m[u]||m.desktop}},[]);return{...t,installApp:n,shareApp:o,requestNotificationPermission:i,getInstallInstructions:g,canShare:"share"in navigator||"clipboard"in navigator}};function ce(){const r=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(r)?"ios":/android/.test(r)?"android":/windows/.test(r)?"windows":/mac/.test(r)?"mac":"desktop"}function Ye(){return window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches||!!window.cordova||!!window.Capacitor||!!window.require}async function Ze(){try{const r=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("[PWA] Service Worker registered:",r),r.addEventListener("updatefound",()=>{const e=r.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&console.log("[PWA] New service worker available")})}),!0}catch(r){return console.error("[PWA] Service Worker registration failed:",r),!1}}const Ke=async(r,e)=>"serviceWorker"in navigator&&"PushManager"in window?(await(await navigator.serviceWorker.ready).showNotification(r,{badge:"/icons/badge-72x72.png",icon:"/icons/icon-192x192.png",...e}),null):"Notification"in window&&Notification.permission==="granted"?new Notification(r,{icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",...e}):null,B=({showPrompt:r=!0,onDismiss:e,compact:t=!1})=>{const[a,n]=h.useState(!1),[o,i]=h.useState(!1),[g,u]=h.useState(!1),{isSupported:m,isInstalled:p,canInstall:c,platform:l,installApp:f,shareApp:x,requestNotificationPermission:y,getInstallInstructions:D,canShare:W}=Je(),{addToast:S}=R();h.useEffect(()=>{n(r&&m&&!p&&c&&!localStorage.getItem("pwa-prompt-dismissed"))},[r,m,p,c]);const V=async()=>{i(!0);try{const b=await f();if(b.success)S(oe("App Installed Successfully!","MOCARDS is now available on your home screen",{label:"Open App",onClick:()=>window.location.reload()})),n(!1),setTimeout(async()=>{await y()&&Ke("Welcome to MOCARDS!",{body:"You'll receive important updates and notifications here.",tag:"welcome"})},2e3);else if(b.outcome==="dismissed")S(k("Installation Cancelled","You can install MOCARDS anytime from your browser menu"));else throw new Error(b.error||"Installation failed")}catch(b){S(U("Installation Failed",b instanceof Error?b.message:"Please try again"))}finally{i(!1)}},F=async()=>{try{const b=await x();S(b?oe("Shared Successfully!","MOCARDS link has been shared"):k("Link Copied","MOCARDS link copied to clipboard"))}catch{S(U("Share Failed","Unable to share the app"))}},ge=()=>{n(!1),localStorage.setItem("pwa-prompt-dismissed","true"),e?.()},H=()=>{u(!0)},fe=D();return!a&&!t?null:t?s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Z,{className:"h-6 w-6 text-blue-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Install MOCARDS App"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Get faster access and offline capabilities"}),s.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[c?s.jsxs("button",{onClick:V,disabled:o,className:"inline-flex items-center px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 disabled:opacity-50",children:[s.jsx(K,{className:"h-3 w-3 mr-1"}),o?"Installing...":"Install"]}):s.jsxs("button",{onClick:H,className:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200",children:[s.jsx(X,{className:"h-3 w-3 mr-1"}),"How to Install"]}),W&&s.jsxs("button",{onClick:F,className:"inline-flex items-center px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-md hover:bg-gray-200",children:[s.jsx(Q,{className:"h-3 w-3 mr-1"}),"Share"]})]})]})]})}):s.jsxs(s.Fragment,{children:[a&&s.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm z-50 animate-slide-in-right",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-6",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(Z,{className:"h-6 w-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Install MOCARDS"}),s.jsx("p",{className:"text-sm text-gray-600",children:"For better performance & offline access"})]})]}),s.jsx("button",{onClick:ge,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(E,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"space-y-2 mb-6",children:[s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Faster loading and performance"]}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Offline access to core features"]}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Push notifications for updates"]}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Home screen shortcut"]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:V,disabled:o,className:"flex-1 flex items-center justify-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:o?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Installing..."]}):s.jsxs(s.Fragment,{children:[s.jsx(K,{className:"h-4 w-4 mr-2"}),"Install App"]})}),s.jsx("button",{onClick:H,className:"px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:s.jsx(X,{className:"h-4 w-4"})}),W&&s.jsx("button",{onClick:F,className:"px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:s.jsx(Q,{className:"h-4 w-4"})})]})]})}),g&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Ae,{className:"h-6 w-6 text-blue-600"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"How to Install"})]}),s.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:s.jsx(E,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full mr-2"}),s.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Platform: ",l.charAt(0).toUpperCase()+l.slice(1)]})]}),s.jsx("ol",{className:"space-y-3",children:fe.steps.map((b,M)=>s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 text-sm font-medium rounded-full flex items-center justify-center mr-3",children:M+1}),s.jsx("span",{className:"text-sm text-gray-700",children:b})]},M))})]}),s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:s.jsxs("div",{className:"flex",children:[s.jsx(pe,{className:"h-5 w-5 text-amber-400 mt-0.5 mr-2"}),s.jsx("div",{children:s.jsxs("p",{className:"text-sm text-amber-800",children:[s.jsx("span",{className:"font-medium",children:"Note:"})," Installation steps may vary depending on your browser and operating system."]})})]})}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Got it"})})]})})})]})},Xe="https://lxyexybnotixgpzflota.supabase.co",Qe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4eWV4eWJub3RpeGdwemZsb3RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMDcwODIsImV4cCI6MjA3NTc4MzA4Mn0.TSbnvPKWiDdEFbyOh38qj_L87LZ75p3FiOW05hzEBlM",d=Oe(Xe,Qe),yt={async createCardBatch(r){const{data:e,error:t}=await d.from("card_batches").insert(r).select().single();if(t)throw t;return e},async createCard(r){const{data:e,error:t}=await d.from("cards").insert(r).select().single();if(t)throw t;return e},async getCardByControlNumber(r,e){const t=/^\d{5}$/,a=/^\d{1,5}$/,n=t.test(r),o=a.test(r);let i=d.from("cards").select(`
        *,
        clinic:mocards_clinics(*),
        perks:card_perks(*)
      `);if(n||o){const m=parseInt(r.replace(/^0+/,"")||"0"),p=r.padStart(5,"0");i=i.or(`control_number.like.%${p},control_number_v2.like.%${p},unified_control_number.like.%${p},card_number.eq.${m},display_card_number.eq.${m+9999}`)}else i=i.or(`control_number.eq.${r},control_number_v2.eq.${r},unified_control_number.eq.${r}`);i=i.gte("card_number",1).lte("card_number",1e4),e&&(i=i.eq("passcode",e));const{data:g,error:u}=await i.single();if(u)throw u;return g},async searchCards(r,e=10){const{data:t,error:a}=await d.rpc("search_card_universal",{search_term:r}).limit(e);if(a)throw a;return t},getPrimaryControlNumber(r){return r.unified_control_number||r.control_number_v2||r.control_number||`Card #${r.card_number}`},getDisplayCardNumber(r){return r.display_card_number||(r.card_number||0)+9999},async activateCard(r,e,t="16"){const{data:a}=await d.from("mocards_clinics").select("clinic_code").eq("id",e).single(),n=a?.clinic_code||null,{data:o,error:i}=await d.from("cards").update({is_activated:!0,status:"activated",assigned_clinic_id:e,activated_at:new Date().toISOString(),expires_at:new Date(Date.now()+365*24*60*60*1e3).toISOString(),location_code_v2:t,clinic_code_v2:n,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return o},async claimPerk(r,e){const{data:t,error:a}=await d.from("card_perks").update({claimed:!0,claimed_at:new Date().toISOString(),claimed_by_clinic:e}).eq("id",r).eq("claimed",!1).select().single();if(a)throw a;return t},async createClinic(r){const{data:e,error:t}=await d.from("mocards_clinics").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getClinicByCode(r){const{data:e,error:t}=await d.from("mocards_clinics").select("*").eq("clinic_code",r).single();if(t)throw t;return e},async getClinicCards(r){const{data:e,error:t}=await d.from("cards").select(`
        *,
        perks:card_perks(*)
      `).eq("assigned_clinic_id",r);if(t)throw t;return e},async logTransaction(r){const{data:e,error:t}=await d.from("card_transactions").insert({...r,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async createAdminUser(r){const{data:e,error:t}=await d.from("mocards_admin_users").insert({...r,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getAdminByUsername(r){const{data:e,error:t}=await d.from("mocards_admin_users").select("*").eq("username",r).single();if(t)throw t;return e},async createAppointment(r){const{data:e,error:t}=await d.from("appointments").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getAppointments(r){let e=d.from("appointments").select(`
        *,
        clinic:mocards_clinics(*),
        card:cards(*)
      `).order("created_at",{ascending:!1});r?.status&&(e=e.eq("status",r.status)),r?.clinic_id&&(e=e.eq("assigned_clinic_id",r.clinic_id)),r?.admin_id&&(e=e.eq("booked_by_admin_id",r.admin_id)),r?.date_from&&(e=e.gte("appointment_date",r.date_from)),r?.date_to&&(e=e.lte("appointment_date",r.date_to));const{data:t,error:a}=await e;if(a)throw a;return t},async getAppointmentById(r){const{data:e,error:t}=await d.from("appointments").select(`
        *,
        clinic:mocards_clinics(*),
        card:cards(*)
      `).eq("id",r).single();if(t)throw t;return e},async updateAppointmentStatus(r,e,t,a,n){const{data:o,error:i}=await d.rpc("update_appointment_status",{p_appointment_id:r,p_new_status:e,p_changed_by:t,p_changed_by_id:a,p_reason:n});if(i)throw i;return o},async rescheduleAppointment(r,e,t,a,n,o){const{data:i,error:g}=await d.rpc("reschedule_appointment",{p_appointment_id:r,p_new_date:e,p_new_time:t,p_reschedule_reason:a,p_changed_by:n,p_changed_by_id:o});if(g)throw g;return i},async getAppointmentHistory(r){const{data:e,error:t}=await d.from("appointment_status_history").select("*").eq("appointment_id",r).order("created_at",{ascending:!0});if(t)throw t;return e},async createAppointmentNotification(r){const{data:e,error:t}=await d.from("appointment_notifications").insert({...r,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getUnreadNotifications(r,e){let t=d.from("appointment_notifications").select("*").eq("recipient_type",r).is("read_at",null).order("created_at",{ascending:!1});e&&(t=t.eq("recipient_id",e));const{data:a,error:n}=await t;if(n)throw n;return a},async markNotificationAsRead(r){const{data:e,error:t}=await d.from("appointment_notifications").update({read_at:new Date().toISOString()}).eq("id",r).select().single();if(t)throw t;return e},async getAllClinics(){const{data:r,error:e}=await d.from("mocards_clinics").select("*").eq("status","active").order("clinic_name");if(e)throw e;return r},async createPerkdatalate(r){const{data:e,error:t}=await d.from("perk_datalates").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getAllPerkdatalates(){const{data:r,error:e}=await d.from("perk_datalates").select("*").order("category",{ascending:!0}).order("name",{ascending:!0});if(e)throw e;return r},async getActivePerkdatalates(){const{data:r,error:e}=await d.from("perk_datalates").select("*").eq("is_active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});if(e)throw e;return r},async getPerkdatalateById(r){const{data:e,error:t}=await d.from("perk_datalates").select("*").eq("id",r).single();if(t)throw t;return e},async updatePerkdatalate(r,e){const{data:t,error:a}=await d.from("perk_datalates").update({...e,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return t},async deletePerkdatalate(r){if((await this.getPerkdatalateById(r)).is_system_default)throw new Error("System default perks cannot be deleted");const{data:t,error:a}=await d.from("perk_datalates").delete().eq("id",r).eq("is_system_default",!1).select().single();if(a)throw a;return t},async getAllPerkCategories(){const{data:r,error:e}=await d.from("perk_categories").select("*").order("display_order",{ascending:!0});if(e)throw e;return r},async createPerkCategory(r){const{data:e,error:t}=await d.from("perk_categories").insert({...r,created_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async updatePerkCategory(r,e){const{data:t,error:a}=await d.from("perk_categories").update(e).eq("id",r).select().single();if(a)throw a;return t},async getClinicPerkCustomizations(r){const{data:e,error:t}=await d.from("clinic_perk_customizations").select(`
        *,
        perk_datalate:perk_datalates(*)
      `).eq("clinic_id",r).order("created_at",{ascending:!1});if(t)throw t;return e},async getActiveClinicPerkCustomizations(r){const{data:e,error:t}=await d.from("clinic_perk_customizations").select(`
        *,
        perk_datalate:perk_datalates(*)
      `).eq("clinic_id",r).eq("is_enabled",!0).order("created_at",{ascending:!1});if(t)throw t;return e},async updateClinicPerkCustomization(r,e){const{data:t,error:a}=await d.from("clinic_perk_customizations").update({...e,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return t},async createClinicPerkCustomization(r){const{data:e,error:t}=await d.from("clinic_perk_customizations").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async recordPerkUsage(r){const e=new Date(r.redemption_date),t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}`,{data:a,error:n}=await d.from("perk_usage_analytics").insert({...r,month_year:t,created_at:new Date().toISOString()}).select().single();if(n)throw n;return a},async getClinicPerkAnalytics(r,e){let t=d.from("perk_usage_analytics").select("*").eq("clinic_id",r);e&&(t=t.eq("month_year",e));const{data:a,error:n}=await t.order("redemption_date",{ascending:!1});if(n)throw n;return a},async getPerkdatalateUsageStats(r,e){let t=d.from("perk_usage_analytics").select("*").eq("perk_datalate_id",r);e&&(t=t.eq("month_year",e));const{data:a,error:n}=await t;if(n)throw n;return a},async getCodeGenerationSettings(){const{data:r,error:e}=await d.from("code_generation_settings").select("*").order("setting_type",{ascending:!0}).order("generation_mode",{ascending:!0});if(e)throw e;return r},async updateCodeGenerationSetting(r,e){const{data:t,error:a}=await d.from("code_generation_settings").update({...e,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return t},async createCodeGenerationSetting(r){const{data:e,error:t}=await d.from("code_generation_settings").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async getLocationCodes(){const{data:r,error:e}=await d.from("location_codes").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(e)throw e;return r},async getAllLocationCodes(){const{data:r,error:e}=await d.from("location_codes").select("*").order("sort_order",{ascending:!0});if(e)throw e;return r},async createLocationCode(r){const{data:e,error:t}=await d.from("location_codes").insert({...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(t)throw t;return e},async updateLocationCode(r,e){const{data:t,error:a}=await d.from("location_codes").update({...e,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return t},async generateBatchNumber(r,e,t){const{data:a,error:n}=await d.rpc("generate_batch_number",{generation_mode:r,custom_input:e,location_prefix:t||"PHL"});if(n)throw n;return a},async generateControlNumber(r,e,t="auto",a){const{data:n,error:o}=await d.rpc("generate_control_number",{batch_prefix:r,card_index:e,generation_mode:t,custom_format:a});if(o)throw o;return n},async generatePasscode(r,e="auto",t){const{data:a,error:n}=await d.rpc("generate_passcode",{location_code:r,generation_mode:e,custom_passcode:t});if(n)throw n;return a},async normalizeCode(r,e){const{data:t,error:a}=await d.rpc("normalize_code",{input_code:r,code_type:e});if(a)throw a;return t},async getCardByControlNumberNormalized(r,e){const t=await this.normalizeCode(r,"control"),a=e?await this.normalizeCode(e,"passcode"):void 0;return this.getCardByControlNumber(t,a)},async getCardCodeHistory(r){const{data:e,error:t}=await d.from("card_code_history").select("*").eq("card_id",r).order("created_at",{ascending:!1});if(t)throw t;return e},async recordCardCodeChange(r,e,t,a,n,o,i){const{data:g,error:u}=await d.from("card_code_history").insert({card_id:r,change_type:e,field_name:t,old_value:a,new_value:n,changed_by:o,change_reason:i,metadata:{},created_at:new Date().toISOString()}).select().single();if(u)throw u;return g},async getSystemVersions(){const{data:r,error:e}=await d.from("system_versions").select("*").order("component",{ascending:!0});if(e)throw e;return r},async getComponentVersion(r){const{data:e,error:t}=await d.from("system_versions").select("*").eq("component",r).single();if(t)throw t;return e},async saveUserSessionState(r,e,t,a,n){const{data:o,error:i}=await d.from("user_session_state").upsert({user_id:r,user_type:e,component_name:t,form_data:a,draft_state:n,last_saved:new Date().toISOString(),expires_at:new Date(Date.now()+864e5).toISOString()}).select().single();if(i)throw i;return o},async getUserSessionState(r,e){const{data:t,error:a}=await d.from("user_session_state").select("*").eq("user_id",r).eq("component_name",e).single();if(a&&a.code!=="PGRST116")throw a;return t},async clearExpiredSessions(){const{error:r}=await d.from("user_session_state").delete().lt("expires_at",new Date().toISOString());if(r)throw r},async updateCardCodes(r,e,t){const a=await d.from("cards").select("control_number, passcode, location_code").eq("id",r).single();if(a.error)throw a.error;const{data:n,error:o}=await d.from("cards").update({...e,admin_override:!0,last_modified_by:t,last_modified_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw o;for(const[i,g]of Object.entries(e))if(i in a.data&&g!==void 0){const u=a.data[i];u!==g&&await this.recordCardCodeChange(r,i.includes("control")?"control_updated":i.includes("passcode")?"passcode_updated":"batch_updated",i,u,g,t,"Admin manual update")}return n},async getCardBatchById(r){const{data:e,error:t}=await d.from("card_batches").select("*").eq("id",r).single();if(t)throw t;return e},async generateCardsWithSettings(r,e,t,a){const n=[],o=await this.getCardBatchById(r);for(let u=0;u<e;u++){const m=(t.startIndex||1)+u,p=await this.generateControlNumber(o.batch_number,m,t.generationMode,t.customPrefix?`${t.customPrefix}-${m.toString().padStart(3,"0")}`:void 0),c=await this.generatePasscode(t.locationCode,t.generationMode),l={batch_id:r,control_number:p,passcode:c,location_code:t.locationCode,status:"unactivated",generation_method:t.generationMode,admin_override:t.generationMode!=="auto",last_modified_by:a,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};n.push(l)}const{data:i,error:g}=await d.from("cards").insert(n).select();if(g)throw g;for(const u of i)await this.recordCardCodeChange(u.id,"created","card_created","",`Control: ${u.control_number}, Passcode: ${u.passcode}`,a,`Batch generation with ${t.generationMode} mode`);return i},async getAllCardBatches(){const{data:r,error:e}=await d.from("card_batches").select("*").order("created_at",{ascending:!1});if(e)throw e;return r}},N={starter:{limit:500,price:299},growth:{limit:1e3,price:499},pro:{limit:2e3,price:799}},wt={starter:N.starter.limit,growth:N.growth.limit,pro:N.pro.limit},le={starter:N.starter.price,growth:N.growth.price,pro:N.pro.price},bt=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"Soccsksargen (Region 12)"},{code:"13",name:"Caraga Region (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"}],vt=["CVT001","CVT002","CVT003","CVT004","CVT005","CVT006","CVT007","CVT008","CVT009","CVT010","BTG001","BTG002","BTG003","BTG004","BTG005","BTG006","BTG007","BTG008","BTG009","BTG010","LGN001","LGN002","LGN003","LGN004","LGN005","LGN006","LGN007","LGN008","LGN009","LGN010","Others","Custom"],_t=[{type:"dental_cleaning",name:"Free Dental Cleaning",description:"Complete professional dental cleaning service",value:1500,isActive:!0,validFor:365,requiresApproval:!1},{type:"consultation",name:"Free Dental Consultation",description:"Comprehensive dental consultation and check-up",value:500,isActive:!0,validFor:365,requiresApproval:!1},{type:"xray",name:"X-Ray Imaging Service",description:"Digital X-ray imaging for diagnosis",value:800,isActive:!0,validFor:365,requiresApproval:!0},{type:"treatment",name:"Treatment Discount",description:"20% discount on dental treatments and procedures",value:20,isActive:!0,validFor:365,requiresApproval:!0},{type:"discount",name:"General Service Discount",description:"10% discount on all dental services",value:10,isActive:!0,validFor:365,requiresApproval:!1}];class et{syncStatus="synced";lastSync=null;subscriptions=[];constructor(){this.setupRealTimeSubscriptions(),this.checkConnection()}async checkConnection(){try{const{error:e}=await d.from("cards").select("id").limit(1);if(e)throw e;return this.setSyncStatus("synced"),!0}catch(e){return console.error("[SupabaseCloudSync] Connection failed:",e),this.setSyncStatus("offline"),!1}}setSyncStatus(e){this.syncStatus=e,e==="synced"&&(this.lastSync=new Date)}setupRealTimeSubscriptions(){const e=d.channel("cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},i=>{console.log("[SupabaseCloudSync] Cards changed:",i),this.lastSync=new Date}).subscribe(),t=d.channel("clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},i=>{console.log("[SupabaseCloudSync] Clinics changed:",i),this.lastSync=new Date}).subscribe(),a=d.channel("appointments-changes").on("postgres_changes",{event:"*",schema:"public",table:"appointments"},i=>{console.log("[SupabaseCloudSync] Appointments changed:",i),this.lastSync=new Date}).subscribe(),n=d.channel("perks-changes").on("postgres_changes",{event:"*",schema:"public",table:"perks"},i=>{console.log("[SupabaseCloudSync] Perks changed:",i),this.lastSync=new Date}).subscribe(),o=d.channel("redemptions-changes").on("postgres_changes",{event:"*",schema:"public",table:"perk_redemptions"},i=>{console.log("[SupabaseCloudSync] Perk redemptions changed:",i),this.lastSync=new Date}).subscribe();this.subscriptions=[e,t,a,n,o]}async getAllCards(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await d.from("cards").select("*").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,controlNumber:n.control_number||`MOC-${n.id}`,fullName:n.full_name||"",status:n.status==="active"?"active":"inactive",perksTotal:n.perks_total||5,perksUsed:n.perks_used||0,clinicId:n.clinic_id||"",expiryDate:n.expiry_date||"2025-12-31",notes:n.notes||"",createdAt:n.created_at,updatedAt:n.updated_at||n.created_at}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting cards:",e),this.setSyncStatus("error"),[]}}async createCard(e){try{this.setSyncStatus("syncing");const t={control_number:e.controlNumber,full_name:e.fullName||"",status:e.status,perks_total:e.perksTotal||5,perks_used:e.perksUsed||0,expiry_date:e.expiryDate};e.clinicId&&e.clinicId.trim()!==""&&(t.clinic_id=e.clinicId),e.notes&&(t.notes=e.notes);const{data:a,error:n}=await d.from("cards").insert(t).select().single();if(n)throw n;const o={id:a.id,controlNumber:a.control_number,fullName:a.full_name||"",status:a.status,perksTotal:a.perks_total,perksUsed:a.perks_used,clinicId:a.clinic_id||"",expiryDate:a.expiry_date,notes:a.notes||"",createdAt:a.created_at,updatedAt:a.updated_at||a.created_at};return this.setSyncStatus("synced"),o}catch(t){throw console.error("[SupabaseCloudSync] Error creating card:",t),this.setSyncStatus("error"),t}}async updateCard(e,t){try{this.setSyncStatus("syncing");const a={};t.status!==void 0&&(a.status=t.status==="active"?"activated":"unactivated"),t.clinicId!==void 0&&(a.assigned_clinic_id=t.clinicId||null),t.expiryDate!==void 0&&(a.expires_at=t.expiryDate+"T23:59:59Z"),a.updated_at=new Date().toISOString();const{error:n}=await d.from("cards").update(a).eq("id",e);if(n)throw n;return this.setSyncStatus("synced"),!0}catch(a){return console.error("[SupabaseCloudSync] Error updating card:",a),this.setSyncStatus("error"),!1}}async getAllClinics(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await d.from("clinics").select("*").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,name:n.clinic_name,code:n.clinic_code,password:"clinic123",plan:"starter",maxCards:500,region:n.region||"NCR",address:n.address,email:n.contact_email,contactNumber:n.contact_phone,subscriptionStatus:n.status==="active"?"active":"suspended",subscriptionStartDate:n.created_at.split("T")[0],subscriptionPrice:le.starter,createdAt:n.created_at,updatedAt:n.updated_at,isActive:n.status==="active"}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting clinics:",e),this.setSyncStatus("error"),[]}}async createClinic(e){try{this.setSyncStatus("syncing");const t={clinic_name:e.name,clinic_code:e.code,password_hash:e.password,region:e.region,address:e.address,contact_email:e.email,contact_phone:e.contactNumber,status:e.isActive!==!1?"active":"inactive"},{data:a,error:n}=await d.from("clinics").insert(t).select().single();if(n)throw n;const o={id:a.id,name:a.clinic_name,code:a.clinic_code,password:e.password,plan:e.plan,maxCards:e.maxCards,region:a.region,address:a.address,email:a.contact_email,contactNumber:a.contact_phone,subscriptionStatus:a.status==="active"?"active":"suspended",subscriptionStartDate:a.created_at.split("T")[0],subscriptionPrice:le[e.plan],createdAt:a.created_at,updatedAt:a.updated_at,isActive:a.status==="active"};return this.setSyncStatus("synced"),o}catch(t){throw console.error("[SupabaseCloudSync] Error creating clinic:",t),this.setSyncStatus("error"),t}}async getAllAppointments(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await d.from("appointments").select("*").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,cardControlNumber:n.control_number,clinicId:n.assigned_clinic_id||"",patientName:n.patient_name||"Unknown Patient",patientEmail:n.patient_email||"patient@example.com",patientPhone:n.patient_phone||"+63 000 000 0000",preferredDate:n.appointment_date,preferredTime:n.appointment_time,serviceType:n.service_type||"General Consultation",perkRequested:n.perk_type,status:this.mapAppointmentStatus(n.status),notes:n.cardholder_notes,createdAt:n.created_at}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting appointments:",e),this.setSyncStatus("error"),[]}}async createAppointment(e){try{this.setSyncStatus("syncing");const t={control_number:e.cardControlNumber,assigned_clinic_id:e.clinicId,appointment_date:e.preferredDate,appointment_time:e.preferredTime,perk_type:e.perkRequested||e.serviceType,cardholder_notes:e.notes,status:"waiting_for_approval",patient_name:e.patientName,patient_email:e.patientEmail,patient_phone:e.patientPhone,service_type:e.serviceType},{data:a,error:n}=await d.from("appointments").insert(t).select().single();if(n)throw n;const o={id:a.id,cardControlNumber:a.control_number,clinicId:a.assigned_clinic_id,patientName:a.patient_name,patientEmail:a.patient_email,patientPhone:a.patient_phone,preferredDate:a.appointment_date,preferredTime:a.appointment_time,serviceType:a.service_type,perkRequested:a.perk_type,status:this.mapAppointmentStatus(a.status),notes:a.cardholder_notes,createdAt:a.created_at};return this.setSyncStatus("synced"),o}catch(t){throw console.error("[SupabaseCloudSync] Error creating appointment:",t),this.setSyncStatus("error"),t}}async updateAppointment(e,t){try{this.setSyncStatus("syncing");const a={};t.status!==void 0&&(a.status=this.mapAppointmentStatusToSupabase(t.status)),t.notes!==void 0&&(a.cardholder_notes=t.notes),a.updated_at=new Date().toISOString();const{error:n}=await d.from("appointments").update(a).eq("id",e);if(n)throw n;return this.setSyncStatus("synced"),!0}catch(a){return console.error("[SupabaseCloudSync] Error updating appointment:",a),this.setSyncStatus("error"),!1}}async getAllPerks(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await d.from("perk_templates").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(n=>({id:n.id,type:this.mapPerkType(n.type),name:n.name,description:n.description||"",value:n.value||0,isActive:n.is_active,validFor:365,requiresApproval:!1,createdAt:n.created_at,updatedAt:n.updated_at}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting perks:",e),this.setSyncStatus("error"),[]}}async getAllPerkRedemptions(){try{this.setSyncStatus("syncing");const{data:e,error:t}=await d.from("perk_redemptions").select("*").order("used_at",{ascending:!1});if(t)throw console.error("[SupabaseCloudSync] Perk redemptions query failed:",t),t;const a=(e||[]).map(n=>({id:n.id,cardControlNumber:n.card_control_number||"Unknown",perkId:n.perk_id,perkName:n.perk_name||"Unknown Perk",clinicId:n.clinic_id,claimantName:n.claimant_name||"Unknown Patient",handledBy:n.handled_by||"System",serviceType:n.service_type||"General Service",usedAt:n.used_at,value:n.value||0,notes:n.notes||""}));return this.setSyncStatus("synced"),a}catch(e){return console.error("[SupabaseCloudSync] Error getting perk redemptions:",e),this.setSyncStatus("error"),[]}}mapAppointmentStatus(e){return{waiting_for_approval:"pending",approved:"accepted",pending_reschedule:"rescheduled",approved_reschedule:"accepted",cancelled:"cancelled",completed:"completed"}[e]||"pending"}mapAppointmentStatusToSupabase(e){return{pending:"waiting_for_approval",accepted:"approved",declined:"cancelled",rescheduled:"pending_reschedule",completed:"completed",cancelled:"cancelled"}[e]||"waiting_for_approval"}mapPerkType(e){return{consultation:"consultation",cleaning:"dental_cleaning",xray:"xray",discount:"discount",service:"treatment"}[e]||"consultation"}getSyncStatus(){return this.syncStatus}getLastSync(){return this.lastSync}async forceSync(){return await this.checkConnection()}cleanup(){this.subscriptions.forEach(e=>{d.removeChannel(e)}),this.subscriptions=[]}}const w=new et,St={cards:{getAll:()=>w.getAllCards(),save:async r=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async r=>{try{return await w.createCard(r)}catch(e){throw console.error("[CloudOperations] Error adding card:",e),e}},update:async(r,e)=>await w.updateCard(r,e),remove:async r=>{try{const{error:e}=await d.from("cards").delete().eq("id",r);return!e}catch(e){return console.error("[CloudOperations] Error removing card:",e),!1}}},clinics:{getAll:()=>w.getAllClinics(),save:async r=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async r=>{try{return await w.createClinic(r),!0}catch(e){return console.error("[CloudOperations] Error adding clinic:",e),!1}},update:async(r,e)=>{try{const{error:t}=await d.from("clinics").update({clinic_name:e.name,contact_email:e.email,contact_phone:e.contactNumber,updated_at:new Date().toISOString()}).eq("id",r);return!t}catch(t){return console.error("[CloudOperations] Error updating clinic:",t),!1}},remove:async r=>{try{const{error:e}=await d.from("clinics").delete().eq("id",r);return!e}catch(e){return console.error("[CloudOperations] Error removing clinic:",e),!1}}},appointments:{getAll:()=>w.getAllAppointments(),save:async r=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async r=>{try{return await w.createAppointment(r),!0}catch(e){return console.error("[CloudOperations] Error adding appointment:",e),!1}},update:async(r,e)=>await w.updateAppointment(r,e),remove:async r=>{try{const{error:e}=await d.from("appointments").delete().eq("id",r);return!e}catch(e){return console.error("[CloudOperations] Error removing appointment:",e),!1}}},perks:{getAll:()=>w.getAllPerks(),save:async r=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async r=>{try{const{error:e}=await d.from("perks").insert({name:r.name,description:r.description,type:r.type,value:r.value,is_active:r.isActive,is_system_default:!1});return!e}catch(e){return console.error("[CloudOperations] Error adding perk:",e),!1}},update:async(r,e)=>{try{const{error:t}=await d.from("perks").update({name:e.name,description:e.description,default_value:e.value,is_active:e.isActive,updated_at:new Date().toISOString()}).eq("id",r);return!t}catch(t){return console.error("[CloudOperations] Error updating perk:",t),!1}},remove:async r=>{try{const{error:e}=await d.from("perk_templates").delete().eq("id",r);return!e}catch(e){return console.error("[CloudOperations] Error removing perk:",e),!1}}},perkRedemptions:{getAll:()=>w.getAllPerkRedemptions(),save:async r=>(console.warn("[CloudOperations] Batch save not implemented for Supabase"),!0),add:async r=>{try{const{data:e,error:t}=await d.from("perk_redemptions").insert({perk_id:r.perkId,perk_name:r.perkName,clinic_id:r.clinicId,card_control_number:r.cardControlNumber,claimant_name:r.claimantName,handled_by:r.handledBy,service_type:r.serviceType,used_at:r.usedAt,value:r.value,notes:r.notes||null}).select().single();if(t)throw t;return{id:e.id,cardControlNumber:e.card_control_number,perkId:e.perk_id,perkName:e.perk_name,clinicId:e.clinic_id,claimantName:e.claimant_name,handledBy:e.handled_by,serviceType:e.service_type,usedAt:e.used_at,value:e.value,notes:e.notes||""}}catch(e){throw console.error("[CloudOperations] Error adding perk redemption:",e),e}}},sync:{getStatus:()=>w.getSyncStatus(),getLastSync:()=>w.getLastSync(),forceSync:()=>w.forceSync()}},tt=()=>({status:w.getSyncStatus(),lastSync:w.getLastSync(),forceSync:w.forceSync}),st=({compact:r=!1,showText:e=!0,className:t=""})=>{const{status:a,lastSync:n,forceSync:o}=tt(),[i,g]=h.useState(typeof navigator<"u"?navigator.onLine:!0);h.useEffect(()=>{const f=()=>g(!0),x=()=>g(!1);if(typeof window<"u")return window.addEventListener("online",f),window.addEventListener("offline",x),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",x)}},[]);const m=((f,x)=>{if(!x)return{icon:ee,color:"text-gray-500",bgColor:"bg-gray-100",text:"Offline",description:"Working offline. Will sync when connection is restored."};switch(f){case"synced":return{icon:te,color:"text-green-600",bgColor:"bg-green-100",text:"Synced",description:"All data is synced across devices"};case"syncing":return{icon:Ie,color:"text-blue-600",bgColor:"bg-blue-100",text:"Syncing...",description:"Syncing data across devices",animate:"animate-spin"};case"error":return{icon:pe,color:"text-red-600",bgColor:"bg-red-100",text:"Sync Error",description:"Failed to sync. Click to retry."};case"offline":return{icon:ke,color:"text-gray-500",bgColor:"bg-gray-100",text:"Offline",description:"Working offline"};default:return{icon:te,color:"text-gray-600",bgColor:"bg-gray-100",text:"Unknown",description:"Sync status unknown"}}})(a,i),p=m.icon,c=async()=>{(a==="error"||!i&&i)&&await o()},l=()=>{if(!n)return"Never synced";const x=new Date().getTime()-n.getTime();return x<6e4?"Just now":x<36e5?`${Math.floor(x/6e4)}m ago`:x<864e5?`${Math.floor(x/36e5)}h ago`:n.toLocaleDateString()};return r?s.jsxs("button",{onClick:c,className:`flex items-center space-x-1 px-2 py-1 rounded-md ${m.bgColor} hover:opacity-80 transition-opacity ${t}`,title:`${m.description}. Last sync: ${l()}`,children:[s.jsx(p,{className:`h-3 w-3 ${m.color} ${m.animate||""}`}),e&&s.jsx("span",{className:`text-xs font-medium ${m.color}`,children:m.text})]}):s.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg ${m.bgColor} ${t}`,children:[s.jsx("div",{className:"p-2 rounded-full bg-white",children:s.jsx(p,{className:`h-4 w-4 ${m.color} ${m.animate||""}`})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h4",{className:`text-sm font-semibold ${m.color}`,children:["Cloud Sync ",m.text]}),a==="error"&&s.jsx("button",{onClick:c,className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Retry"})]}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:m.description}),n&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last sync: ",l()]})]}),!i&&s.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[s.jsx(ee,{className:"h-3 w-3"}),s.jsx("span",{className:"text-xs",children:"Offline"})]})]})},P=r=>{const[e,t]=h.useState(!1);return h.useEffect(()=>{const a=window.matchMedia(r);t(a.matches);const n=o=>{t(o.matches)};return a.addEventListener?a.addEventListener("change",n):a.addListener(n),()=>{a.removeEventListener?a.removeEventListener("change",n):a.removeListener(n)}},[r]),e},rt=()=>{const r=P("(max-width: 640px)"),e=P("(max-width: 1024px)"),t=P("(min-width: 1024px)"),a=P("(min-width: 1280px)");return{isMobile:r,isTablet:e,isDesktop:t,isLargeDesktop:a,isMobileOrTablet:r||e,isDesktopOrLarger:t}},at=()=>{const[r,e]=h.useState({width:typeof window<"u"?window.innerWidth:0,height:typeof window<"u"?window.innerHeight:0});return h.useEffect(()=>{const t=()=>{e({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)},[]),{...r,isLandscape:r.width>r.height,isPortrait:r.height>r.width,isSmallMobile:r.width<375,isMobile:r.width<640,isTablet:r.width>=640&&r.width<1024,isDesktop:r.width>=1024,isHighDensity:typeof window<"u"?window.devicePixelRatio>1.5:!1}};function nt({currentView:r,onViewChange:e,children:t,isAuthenticated:a,userType:n}){const[o,i]=h.useState(!1),{isMobile:g,isTablet:u}=rt(),{height:m}=at();h.useEffect(()=>{g&&m<600&&i(!1)},[g,m]);const p=l=>!a||!n?!1:n==="admin"&&l==="clinic-portal"||n==="clinic"&&l==="admin-access",c=[{id:"card-lookup",label:"Card Lookup",icon:ue,description:"Verify card validity",disabled:!1},{id:"clinic-portal",label:"Clinic Portal",icon:me,description:"Clinic management",disabled:p("clinic-portal")},{id:"admin-access",label:"Admin Access",icon:A,description:"System administration",disabled:p("admin-access")}];return g?s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-16",children:[s.jsx(He,{currentView:r,onViewChange:e,onSecurityToggle:()=>i(!o),showSecurityDashboard:o,navItems:c}),s.jsx("div",{className:"pt-20 px-4 pb-4",children:s.jsx("div",{className:"max-w-full mx-auto",children:t})}),o&&s.jsx("div",{className:"fixed inset-x-4 top-24 z-40 animate-slide-in-down",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 max-h-[70vh] overflow-y-auto",children:[s.jsx("div",{className:"p-3 border-b border-gray-200 bg-blue-600 text-white rounded-t-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-semibold",children:"Security Monitor"}),s.jsx("button",{onClick:()=>i(!1),className:"text-white hover:bg-white hover:bg-opacity-20 rounded p-1 transition-colors",children:"âœ•"})]})}),s.jsx("div",{className:"p-4",children:s.jsx($,{compact:!0})})]})}),s.jsx(B,{})]}):u?s.jsxs("div",{className:"min-h-screen flex flex-col",children:[s.jsxs("div",{className:"bg-[#1A535C] text-white shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-lg",children:"MC"})}),s.jsx("div",{children:s.jsx("h1",{className:"text-xl font-bold text-white",children:"MOCARDS CLOUD"})})]}),s.jsxs("button",{onClick:()=>i(!o),className:`flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 ${o?"bg-blue-600 text-white shadow-lg":"bg-white bg-opacity-20 text-teal-100 hover:bg-opacity-30"}`,children:[s.jsx(I,{className:"h-4 w-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Security"})]})]}),s.jsx("div",{className:"px-6 pb-4",children:s.jsx("div",{className:"flex space-x-2",children:c.map(l=>{const f=l.icon,x=r===l.id,y=l.disabled;return s.jsxs("button",{onClick:()=>!y&&e(l.id),disabled:y,className:`flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 ${y?"bg-gray-400 bg-opacity-20 text-gray-500 cursor-not-allowed opacity-50":x?"bg-white text-[#1A535C] shadow-lg":"bg-white bg-opacity-10 text-teal-100 hover:bg-opacity-20"}`,title:y?"Please logout to access this portal":void 0,children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"text-sm font-medium",children:l.label}),y&&s.jsx("span",{className:"text-xs",children:"ðŸ”’"})]},l.id)})})})]}),s.jsxs("div",{className:"flex-1 bg-gray-50 relative",children:[s.jsx("div",{className:"p-6",children:t}),o&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 w-80 animate-slide-in-right",children:s.jsx($,{})}),s.jsx(B,{})]})]}):s.jsxs("div",{className:"min-h-screen flex",children:[s.jsxs("div",{className:"w-64 bg-[#1A535C] text-white flex flex-col fixed h-full z-10",children:[s.jsx("div",{className:"p-6 border-b border-teal-600",children:s.jsx("h1",{className:"text-xl font-bold text-white",children:"MOCARDS CLOUD"})}),s.jsx("nav",{className:"flex-1 p-4",children:s.jsx("ul",{className:"space-y-2",children:c.map(l=>{const f=l.icon,x=r===l.id,y=l.disabled;return s.jsx("li",{children:s.jsxs("button",{onClick:()=>!y&&e(l.id),disabled:y,className:`w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 ${y?"bg-gray-600 bg-opacity-20 text-gray-400 cursor-not-allowed opacity-60":x?"bg-white text-[#1A535C] shadow-lg":"text-teal-100 hover:bg-teal-600 hover:text-white"}`,title:y?"Please logout to access this portal":void 0,children:[s.jsx(f,{className:`h-5 w-5 ${y?"text-gray-400":x?"text-[#1A535C]":""}`}),s.jsxs("div",{className:"text-left flex-1",children:[s.jsxs("div",{className:`font-medium ${y?"text-gray-400":x?"text-[#1A535C]":""}`,children:[l.label,y&&s.jsx("span",{className:"ml-2",children:"ðŸ”’"})]}),s.jsx("div",{className:`text-xs ${y?"text-gray-500":x?"text-teal-600":"text-teal-300"}`,children:y?"Logout required":l.description})]})]})},l.id)})})}),s.jsxs("div",{className:"p-4 border-t border-teal-600",children:[s.jsxs("button",{onClick:()=>i(!o),className:`w-full flex items-center justify-center space-x-2 px-4 py-3 rounded-xl transition-all duration-200 ${o?"bg-blue-600 text-white shadow-lg":"text-teal-100 hover:bg-teal-600 hover:text-white"}`,children:[s.jsx(I,{className:"h-4 w-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Security Monitor"})]}),s.jsx("div",{className:"mt-4",children:s.jsx(st,{compact:!0,className:"w-full"})}),s.jsxs("div",{className:"text-xs text-teal-300 text-center mt-3",children:["MOCARDS v4.0 Cloud",s.jsx("br",{}),"Â© 2025 Dental Group"]})]})]}),s.jsx("div",{className:"flex-1 ml-64 bg-gray-50 min-h-screen",children:t}),o&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 w-96 animate-slide-in-right",children:s.jsx($,{})}),s.jsx(B,{})]})}const it=({type:r})=>{const e={size:20};switch(r){case"success":return s.jsx(Te,{...e,className:"text-green-500"});case"error":return s.jsx(De,{...e,className:"text-red-500"});case"warning":return s.jsx(z,{...e,className:"text-yellow-500"});case"info":return s.jsx(se,{...e,className:"text-blue-500"});case"loading":return s.jsx(Ee,{...e,className:"text-blue-500 animate-spin"});default:return s.jsx(se,{...e,className:"text-gray-500"})}},ot=({toast:r})=>{const{removeToast:e}=R(),t={success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",warning:"bg-yellow-50 border-yellow-200",info:"bg-blue-50 border-blue-200",loading:"bg-blue-50 border-blue-200"},a={success:"text-green-800",error:"text-red-800",warning:"text-yellow-800",info:"text-blue-800",loading:"text-blue-800"};return s.jsx("div",{className:`
        max-w-sm w-full ${t[r.type]} border rounded-lg shadow-lg p-4
        transform transition-all duration-300 ease-in-out
        hover:shadow-xl animate-in slide-in-from-right-full
      `,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(it,{type:r.type}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:`font-medium ${a[r.type]} text-sm`,children:r.title}),r.message&&s.jsx("p",{className:`mt-1 text-sm ${a[r.type]} opacity-90`,children:r.message}),r.action&&s.jsx("button",{onClick:r.action.onClick,className:`
                mt-2 text-sm font-medium ${a[r.type]}
                hover:underline focus:outline-none focus:underline
              `,children:r.action.label})]}),s.jsx("button",{onClick:()=>e(r.id),className:`
            ${a[r.type]} opacity-60 hover:opacity-100
            transition-opacity focus:outline-none
          `,children:s.jsx(E,{size:16})})]})})},ct=()=>{const{toasts:r}=R();return r.length===0?null:s.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-h-screen overflow-y-auto",children:r.map(e=>s.jsx(ot,{toast:e},e.id))})},lt=900*1e3,_="mocards_auth_session",j="mocards_last_activity",dt=()=>{const[r,e]=h.useState(!1),[t,a]=h.useState(null),n=h.useCallback(()=>{const u=Date.now();if(localStorage.setItem(j,u.toString()),t){const m={...t,lastActivity:u};a(m),localStorage.setItem(_,JSON.stringify(m))}},[t]),o=h.useCallback(u=>Date.now()-u.lastActivity<lt,[]),i=h.useCallback((u,m)=>{const p=Date.now(),c={type:u,username:m.username||m.code,clinicId:m.id,clinicCode:m.code,loginTime:p,lastActivity:p};a(c),e(!0),localStorage.setItem(_,JSON.stringify(c)),localStorage.setItem(j,p.toString()),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"login",user:c}}))},[]),g=h.useCallback(()=>{a(null),e(!1),localStorage.removeItem(_),localStorage.removeItem(j),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"logout"}}))},[]);return h.useEffect(()=>{(()=>{try{const c=localStorage.getItem(_);if(c){const l=JSON.parse(c);o(l)?(a(l),e(!0),n()):(localStorage.removeItem(_),localStorage.removeItem(j))}}catch(c){console.error("Error checking session:",c),localStorage.removeItem(_),localStorage.removeItem(j)}})();const m=c=>{const{type:l,user:f}=c.detail;l==="login"&&f?(a(f),e(!0)):l==="logout"&&(a(null),e(!1))},p=c=>{if(c.key===_)if(c.newValue)try{const l=JSON.parse(c.newValue);o(l)&&(a(l),e(!0))}catch(l){console.error("Error parsing stored user data:",l)}else a(null),e(!1)};return window.addEventListener("auth-state-change",m),window.addEventListener("storage",p),()=>{window.removeEventListener("auth-state-change",m),window.removeEventListener("storage",p)}},[o,n]),h.useEffect(()=>{if(!r||!t)return;const m=setInterval(()=>{t&&!o(t)&&g()},60*1e3);return()=>clearInterval(m)},[r,t,o,g]),h.useEffect(()=>{if(!r)return;const u=["mousedown","mousemove","keypress","scroll","touchstart","click"],m=()=>{n()};let p;const c=()=>{clearTimeout(p),p=setTimeout(m,1e3)};return u.forEach(l=>{document.addEventListener(l,c,!0)}),()=>{clearTimeout(p),u.forEach(l=>{document.removeEventListener(l,c,!0)})}},[r,n]),{isAuthenticated:r,user:t,login:i,logout:g,updateActivity:n}},de=h.lazy(()=>G(()=>import("./CardLookupView-B2O4KWG4.js"),__vite__mapDeps([0,1,2,3,4,5])).then(r=>({default:r.CardLookupView}))),ut=h.lazy(()=>G(()=>import("./ClinicPortalView-BSuElK2c.js"),__vite__mapDeps([6,1,2,7,3,4,5])).then(r=>({default:r.ClinicPortalView}))),mt=h.lazy(()=>G(()=>import("./AdminPortalView-D3VsWXsg.js"),__vite__mapDeps([8,1,2,7,3,4,5])).then(r=>({default:r.AdminPortalView})));function pt(){const[r,e]=h.useState("card-lookup"),{isAuthenticated:t,user:a}=dt(),n=()=>{switch(r){case"card-lookup":return s.jsx(de,{});case"clinic-portal":return s.jsx(ut,{});case"admin-access":return s.jsx(mt,{});default:return s.jsx(de,{})}},o=i=>{if(i==="card-lookup"){e(i);return}t&&a&&(a.type==="admin"&&i==="clinic-portal"||a.type==="clinic"&&i==="admin-access")||e(i)};return s.jsxs(Ge,{children:[s.jsx(nt,{currentView:r,onViewChange:o,isAuthenticated:t,userType:a?.type,children:s.jsx(h.Suspense,{fallback:s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"light-card p-8 w-full max-w-md text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading..."}),s.jsx("p",{className:"text-gray-600",children:"Please wait while we load the application."})]})}),children:n()})}),s.jsx(ct,{})]})}qe.createRoot(document.getElementById("root")).render(s.jsx(be.StrictMode,{children:s.jsx(pt,{})}));export{vt as A,_t as D,bt as P,oe as a,U as b,dt as c,yt as d,le as e,wt as f,St as g,s as j,Ue as t,R as u};
