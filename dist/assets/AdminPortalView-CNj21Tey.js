const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bc5fOP-S.js","assets/vendor-N--QU9DW.js","assets/charts-sad3owxz.js","assets/icons-dveH2TvA.js","assets/database-BUiByx9r.js","assets/index-D6z9DbOC.css"])))=>i.map(i=>d[i]);
import{j as e,_ as se,u as ue,s as V,l as he,h as Se,i as Ae,a as G,b as $,t as ce,f as Q,d as le,g as X,P as ts,k as as}from"./index-Bc5fOP-S.js";import{r as o}from"./charts-sad3owxz.js";import{y as ae,R as Y,r as H,X as oe,Z as Ie,z as Fe,t as ge,F as Z,x as rs,a as z,J as pe,K as ns,E as ls,u as $e,N as is,P as cs,v as fe,w as me,D as _e,B as je,O as ke,U as Le,T as Oe,A as ye,Q as os,V as ds,Y as ve,b as be,S as Re,q as ms,_ as us,$ as xs}from"./icons-dveH2TvA.js";import{u as hs}from"./useAutoRefresh-D3V5Au6U.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";class Ee{static async hashPassword(r,a="MOCARDS_ENTERPRISE_SALT_2024"){const l=new TextEncoder().encode(r+a),h=await crypto.subtle.digest("SHA-256",l);return`$2a$12$${Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,"0")).join("").substring(0,53)}`}static async compare(r,a){try{return await this.hashPassword(r)===a}catch(s){return console.error("Password comparison failed:",s),!1}}static async hash(r){return this.hashPassword(r)}}class gs{static config={maxFailedAttempts:5,lockoutDurationMinutes:15,sessionTimeoutMinutes:480,requireMFA:!1,passwordMinLength:8,passwordRequireSpecialChars:!0};static authAttempts=new Map;static activeSessions=new Map;static enterpriseCredentials={admin:"$2a$12$cefb21ee78311f538e1b6f4619f265d43012b73324796e6f8c6c3",clinic:"$2a$12$ef27cb1e09f82222058cd4595e01475482fdcca03d502136fa1cf"};static async authenticateAdmin(r,a){const s=this.getClientIdentifier(),l={username:r,timestamp:new Date,success:!1,ip:"localhost",userAgent:navigator.userAgent};try{if(this.isUserLockedOut(r))return this.logAuthAttempt(r,l),{success:!1,message:"Account temporarily locked due to multiple failed attempts"};if(r==="admin"&&await Ee.compare(a,this.enterpriseCredentials.admin)){l.success=!0,this.logAuthAttempt(r,l),this.clearFailedAttempts(r);const h=this.generateSecureToken(),N={userId:"admin",userType:"admin",username:"admin",createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionTimeoutMinutes*60*1e3),clientId:s,permissions:["all"]};return this.activeSessions.set(h,N),localStorage.setItem(`mocards_enterprise_session_${h}`,JSON.stringify(N)),{success:!0,user:{id:"admin",username:"admin",type:"admin",permissions:["all"]},token:h,message:"Authentication successful"}}else return this.logAuthAttempt(r,l),{success:!1,message:"Invalid credentials"}}catch(h){return console.error("Authentication error:",h),this.logAuthAttempt(r,l),{success:!1,message:"Authentication system error"}}}static async authenticateClinic(r,a){const s=this.getClientIdentifier(),l={username:r,timestamp:new Date,success:!1,ip:"localhost",userAgent:navigator.userAgent};try{if(this.isUserLockedOut(r))return this.logAuthAttempt(r,l),{success:!1,message:"Account temporarily locked due to multiple failed attempts"};if(await Ee.compare(a,this.enterpriseCredentials.clinic)){l.success=!0,this.logAuthAttempt(r,l),this.clearFailedAttempts(r);const h=this.generateSecureToken(),N={userId:r,userType:"clinic",clinicCode:r,createdAt:new Date,expiresAt:new Date(Date.now()+this.config.sessionTimeoutMinutes*60*1e3),clientId:s,permissions:["clinic_access"]};return this.activeSessions.set(h,N),localStorage.setItem(`mocards_enterprise_session_${h}`,JSON.stringify(N)),{success:!0,user:{id:r,username:r,type:"clinic",clinicCode:r,permissions:["clinic_access"]},token:h,message:"Clinic authentication successful"}}else return this.logAuthAttempt(r,l),{success:!1,message:"Invalid clinic credentials"}}catch(h){return console.error("Clinic authentication error:",h),this.logAuthAttempt(r,l),{success:!1,message:"Authentication system error"}}}static validateSession(r){try{const a=this.activeSessions.get(r);if(!a){const s=localStorage.getItem(`mocards_enterprise_session_${r}`);if(s){const l=JSON.parse(s);if(new Date<=new Date(l.expiresAt))return this.activeSessions.set(r,l),{valid:!0,user:{id:l.userId,username:l.username||l.clinicCode,type:l.userType,clinicCode:l.clinicCode,permissions:l.permissions}}}return{valid:!1,message:"Session not found"}}return new Date>new Date(a.expiresAt)?(this.destroySession(r),{valid:!1,message:"Session expired"}):{valid:!0,user:{id:a.userId,username:a.username||a.clinicCode,type:a.userType,clinicCode:a.clinicCode,permissions:a.permissions}}}catch(a){return console.error("Session validation error:",a),{valid:!1,message:"Session validation error"}}}static destroySession(r){this.activeSessions.delete(r),localStorage.removeItem(`mocards_enterprise_session_${r}`)}static destroyAllSessions(){this.activeSessions.clear(),Object.keys(localStorage).forEach(r=>{r.startsWith("mocards_enterprise_session_")&&localStorage.removeItem(r)})}static isUserLockedOut(r){return(this.authAttempts.get(r)||[]).filter(l=>!l.success&&new Date().getTime()-l.timestamp.getTime()<this.config.lockoutDurationMinutes*60*1e3).length>=this.config.maxFailedAttempts}static logAuthAttempt(r,a){const s=this.authAttempts.get(r)||[];s.push(a),s.length>50&&s.splice(0,s.length-50),this.authAttempts.set(r,s),console.log(a.success?"‚úÖ":"‚ùå","Auth attempt:",{username:r,success:a.success,timestamp:a.timestamp.toISOString(),userAgent:a.userAgent.substring(0,100)})}static clearFailedAttempts(r){const s=(this.authAttempts.get(r)||[]).filter(l=>l.success);this.authAttempts.set(r,s)}static generateSecureToken(r=64){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";const l=new Uint8Array(r);crypto.getRandomValues(l);for(let h=0;h<r;h++)s+=a[l[h]%a.length];return s}static getClientIdentifier(){const r=localStorage.getItem("mocards_client_id");if(r)return r;const a=this.generateSecureToken(32);return localStorage.setItem("mocards_client_id",a),a}static getSecurityReport(){let r=0,a=0,s=0;const l=[];for(const[h,N]of this.authAttempts.entries())r+=N.length,a+=N.filter(y=>y.success).length,s+=N.filter(y=>!y.success).length,this.isUserLockedOut(h)&&l.push(h);return{totalAttempts:r,successfulAttempts:a,failedAttempts:s,lockedAccounts:l,activeSessions:this.activeSessions.size}}static updateSecurityConfig(r){this.config={...this.config,...r}}static getSecurityConfig(){return{...this.config}}}const Te=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],ps=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"];function fs({onSuccess:x}){const[r,a]=o.useState(!1),[s,l]=o.useState({quantity:1,region:"",areaCode:"",customAreaCode:"",clinicId:"",perksTotal:10,customPerkName:"",useCustomPerk:!1}),[h,N]=o.useState([]),[y,b]=o.useState([]),[d,p]=o.useState("checking"),[m,g]=o.useState({isGenerating:!1,progress:0,total:0,message:"",completed:!1}),n=async()=>{try{p("checking");const{supabase:c}=await se(async()=>{const{supabase:F}=await import("./index-Bc5fOP-S.js").then(O=>O.m);return{supabase:F}},__vite__mapDeps([0,1,2,3,4,5])),{error:f}=await c.from("cards").select("count").limit(1);if(f){console.error("‚ùå Database connection test failed:",f),p("error");return}console.log("‚úÖ Database connection successful"),p("connected");const{data:k,error:R}=await c.from("clinics").select("id, name, code, region").eq("is_active",!0);R?console.log("‚ö†Ô∏è Clinics data not available:",R):k&&(N(k),console.log("‚úÖ Loaded",k.length,"clinics")),b([{id:"1",name:"Free Dental Cleaning",description:"Complete professional dental cleaning",value:1500,isActive:!0},{id:"2",name:"Free Consultation",description:"General dental consultation",value:800,isActive:!0},{id:"3",name:"Dental X-Ray",description:"Digital dental x-ray",value:1200,isActive:!0},{id:"4",name:"20% Treatment Discount",description:"20% off any treatment",value:20,isActive:!0},{id:"5",name:"Free Fluoride Treatment",description:"Fluoride application",value:600,isActive:!0}])}catch(c){console.error("üí• Connection and data loading failed:",c),p("error")}};o.useEffect(()=>{n()},[]);const u=async()=>{if(!s.region){console.log("Validation failed: No region selected");return}if(s.areaCode==="Custom"&&!s.customAreaCode?.trim()){console.log("Validation failed: Custom area code required but not provided");return}if(s.useCustomPerk&&!s.customPerkName?.trim()){console.log("Validation failed: Custom perk name required but not provided");return}console.log("‚úÖ Validation passed, starting enterprise card generation...");const c=s.quantity,f=s.areaCode==="Custom"?s.customAreaCode:s.areaCode,k=s.clinicId?parseInt(s.clinicId):null;g({isGenerating:!0,progress:0,total:c,message:"üöÄ Initializing enterprise card generation...",completed:!1});try{const{supabase:R}=await se(async()=>{const{supabase:w}=await import("./index-Bc5fOP-S.js").then(_=>_.m);return{supabase:w}},__vite__mapDeps([0,1,2,3,4,5])),F=`BATCH_${s.region}_${Date.now()}`;g(w=>({...w,message:"üè≠ Using enterprise bulk generation function..."})),console.log("üîß Attempting enterprise bulk generation...");const{data:O,error:i}=await R.rpc("bulk_generate_cards",{p_quantity:c,p_clinic_id:k,p_batch_name:F});if(i){console.log("‚ùå Enterprise function failed, falling back to manual generation:",i),g(P=>({...P,message:"üîÑ Using fallback generation method..."}));const w=[];for(let P=0;P<c;P++)w.push({clinic_id:k,perks_total:s.perksTotal,batch_id:F,metadata:{generated_at:new Date().toISOString(),region:s.region,area_code:f||"GENERAL",clinic_id:k,perks_configured:s.perksTotal,custom_perk:s.useCustomPerk?s.customPerkName:null,generator_version:"2.2_fallback"}});const _=50;let T=0;for(let P=0;P<w.length;P+=_){const U=w.slice(P,P+_),re=Math.min(P+_,c);g(B=>({...B,progress:T,message:`üìù Creating cards ${T+1} to ${re}...`}));const{error:J}=await R.from("cards").insert(U);if(J)throw new Error(`‚ùå Batch insertion failed: ${J.message}`);T+=U.length,c>50&&await new Promise(B=>setTimeout(B,100)),g(B=>({...B,progress:T,message:T===c?"‚úÖ Finalizing card generation...":`üìù Creating cards ${T+1} to ${Math.min(T+_,c)}...`}))}console.log("‚úÖ Manual generation completed successfully")}else{console.log("‚úÖ Enterprise bulk generation successful:",O);const w=Math.min(c,10);for(let _=0;_<=w;_++){const T=Math.floor(_/w*c);g(P=>({...P,progress:T,message:_===w?"‚úÖ Enterprise generation completed!":`üè≠ Enterprise generation: ${Math.round(_/w*100)}%`})),_<w&&await new Promise(P=>setTimeout(P,200))}}console.log(`üéØ Generation complete! Batch ID: ${F}`),console.log("üîç Verifying card generation...");const{data:A}=await R.from("cards").select("id").eq("batch_id",F),E=A?.length||0;if(console.log(`üìä Verification: Expected ${c}, Found ${E} cards`),E!==c&&console.warn(`‚ö†Ô∏è Generation mismatch! Expected: ${c}, Actual: ${E}`),x){console.log("üîÑ Refreshing dashboard data...");try{await x(),console.log("‚úÖ Dashboard data refreshed successfully")}catch(w){console.error("‚ùå Failed to refresh dashboard data:",w)}}g({isGenerating:!1,progress:c,total:c,message:`üéâ Generated ${E}/${c} cards ‚Ä¢ Batch: ${F} ‚Ä¢ Dashboard refreshed!`,completed:!0}),setTimeout(()=>{g(w=>({...w,completed:!1})),a(!1)},4e3)}catch(R){console.error("üí• Card generation failed:",R),g({isGenerating:!1,progress:0,total:0,message:`‚ùå Generation failed: ${R.message}`,completed:!1}),setTimeout(()=>{g(F=>({...F,message:"",completed:!1}))},5e3)}},v=()=>{s.quantity>0&&s.quantity<=1e4&&u()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(ae,{className:"h-10 w-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Card Generator Pro"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Generate unlimited MOC cards with enterprise-grade reliability"}),e.jsxs("div",{className:"mt-2 flex items-center justify-center space-x-2",children:[d==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-blue-100 text-sm",children:"Testing database connection..."})]}),d==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"text-green-100 text-sm",children:"Database connected"})]}),d==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-red-200 text-sm",children:"Database connection failed"}),e.jsx("button",{onClick:n,className:"text-white underline hover:text-blue-100 ml-2",children:"Retry"})]})]})]}),e.jsxs("button",{onClick:()=>a(!0),disabled:d!=="connected",className:`rounded-2xl px-8 py-4 font-bold text-lg transition-all transform shadow-xl ${d==="connected"?"bg-white text-blue-600 hover:bg-gray-50 hover:scale-105":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"}`,children:[e.jsx(Ie,{className:"h-6 w-6 mr-3 inline"}),"Generate Cards Now"]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:!m.isGenerating&&!m.completed?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Generate Cards"}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-gray-600 rounded-full p-2",children:e.jsx(oe,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsx(ae,{className:"h-4 w-4 inline mr-2"}),"Select Quantity"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[1,500,1e3].map(c=>e.jsxs("button",{onClick:()=>l({...s,quantity:c}),className:`p-4 rounded-xl border-2 font-medium transition-all ${s.quantity===c?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[c," Card",c>1?"s":""]},c))}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",max:"10000",placeholder:"Custom quantity (1-10000)",value:s.quantity===1||s.quantity===500||s.quantity===1e3?"":s.quantity,onChange:c=>l({...s,quantity:parseInt(c.target.value)||1}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Fe,{className:"h-4 w-4 inline mr-2"}),"Region *"]}),e.jsxs("select",{value:s.region,onChange:c=>l({...s,region:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Region"}),Te.map(c=>e.jsx("option",{value:c.code,children:c.name},c.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ge,{className:"h-4 w-4 inline mr-2"}),"Area Code *"]}),e.jsxs("select",{value:s.areaCode,onChange:c=>l({...s,areaCode:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!s.region,children:[e.jsx("option",{value:"",children:"Select Area Code"}),ps.map(c=>e.jsx("option",{value:c,children:c},c))]}),s.areaCode==="Custom"&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",placeholder:"Enter custom area code (e.g., XYZ001)",value:s.customAreaCode,onChange:c=>l({...s,customAreaCode:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Z,{className:"h-4 w-4 inline mr-2"}),"Clinic Assignment (Optional)"]}),e.jsxs("select",{value:s.clinicId,onChange:c=>l({...s,clinicId:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No specific clinic (general pool)"}),h.map(c=>e.jsxs("option",{value:c.id.toString(),children:[c.name," (",c.code,")"]},c.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(rs,{className:"h-4 w-4 inline mr-2"}),"Perks per Card"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:s.perksTotal,onChange:c=>l({...s,perksTotal:parseInt(c.target.value)||1}),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"perks per card"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.useCustomPerk,onChange:c=>l({...s,useCustomPerk:c.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Add custom perk name"})]}),s.useCustomPerk&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("select",{value:s.customPerkName,onChange:c=>l({...s,customPerkName:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select or type custom perk..."}),e.jsx("option",{value:"Free Teeth Whitening",children:"Free Teeth Whitening"}),e.jsx("option",{value:"Free Orthodontic Consultation",children:"Free Orthodontic Consultation"}),e.jsx("option",{value:"Free Oral Surgery Consultation",children:"Free Oral Surgery Consultation"}),e.jsx("option",{value:"Free Periodontal Treatment",children:"Free Periodontal Treatment"}),e.jsx("option",{value:"Free Dental Implant Consultation",children:"Free Dental Implant Consultation"}),e.jsx("option",{value:"Free Wisdom Tooth Extraction",children:"Free Wisdom Tooth Extraction"}),e.jsx("option",{value:"Free Root Canal Treatment",children:"Free Root Canal Treatment"}),e.jsx("option",{value:"Free Dental Crown",children:"Free Dental Crown"}),e.jsx("option",{value:"Free Denture Consultation",children:"Free Denture Consultation"}),e.jsx("option",{value:"Custom",children:"Custom (type your own)"})]}),s.customPerkName==="Custom"&&e.jsx("input",{type:"text",placeholder:"Enter custom perk name...",value:"",onChange:c=>l({...s,customPerkName:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:s.useCustomPerk&&s.customPerkName?"Custom Perk + Default Perks:":"Available Default Perks:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[s.useCustomPerk&&s.customPerkName&&s.customPerkName!=="Custom"&&e.jsxs("div",{className:"text-blue-600 font-medium",children:["‚Ä¢ ",s.customPerkName," (Custom)"]}),y.slice(0,3).map(c=>e.jsxs("div",{children:["‚Ä¢ ",c.name," (‚Ç±",c.value,")"]},c.id)),y.length>3&&e.jsxs("div",{children:["‚Ä¢ And ",y.length-3," more..."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Card Configuration:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Control Number: MOC00000001, MOC00000002..."}),e.jsxs("li",{children:["‚Ä¢ Region: ",s.region?Te.find(c=>c.code===s.region)?.name:"Not selected"]}),e.jsxs("li",{children:["‚Ä¢ Area Code: ",s.areaCode==="Custom"?s.customAreaCode||"Custom (not set)":s.areaCode||"GENERAL"]}),e.jsxs("li",{children:["‚Ä¢ Clinic: ",s.clinicId?h.find(c=>c.id.toString()===s.clinicId)?.name:"General pool"]}),e.jsxs("li",{children:["‚Ä¢ Perks: ",s.perksTotal," per card",s.useCustomPerk&&s.customPerkName?` + ${s.customPerkName}`:""]}),e.jsx("li",{children:"‚Ä¢ Status: Inactive (ready for activation)"}),e.jsx("li",{children:"‚Ä¢ Expires: December 31, 2025"})]})]}),e.jsxs("button",{onClick:v,disabled:!s.region||s.areaCode==="Custom"&&!s.customAreaCode||s.useCustomPerk&&!s.customPerkName.trim(),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl py-4 font-bold text-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:["Generate ",s.quantity," Card",s.quantity>1?"s":""," üöÄ"]})]})]}):m.completed?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(H,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:m.message}),e.jsx("div",{className:"text-sm text-gray-500",children:"Closing automatically in 3 seconds..."})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(Y,{className:"h-8 w-8 text-blue-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Generating Cards"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m.message}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-500",style:{width:`${m.progress/m.total*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[m.progress," generated"]}),e.jsxs("span",{children:[m.total," total"]})]}),e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[Math.round(m.progress/m.total*100),"% Complete"]})]})]})})})]})}const De=async x=>{const a=new TextEncoder().encode(x+"MOCARDS_SALT_2024"),s=await crypto.subtle.digest("SHA-256",a);return"$2a$12$"+Array.from(new Uint8Array(s)).map(N=>N.toString(16).padStart(2,"0")).join("").substring(0,53)},Pe=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],ys=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"],de={starter:499,growth:999,pro:1999},ee={starter:100,growth:500,pro:2e3};function bs({onSuccess:x}){const[r,a]=o.useState(!1),[s,l]=o.useState(null),[h,N]=o.useState([]),[y,b]=o.useState(!1),[d,p]=o.useState("checking"),[m,g]=o.useState(!1),[n,u]=o.useState({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""}),v=async()=>{try{p("checking");const{supabase:i}=await se(async()=>{const{supabase:_}=await import("./index-Bc5fOP-S.js").then(T=>T.m);return{supabase:_}},__vite__mapDeps([0,1,2,3,4,5])),{error:A}=await i.from("clinics").select("count").limit(1);if(A){console.error("‚ùå Clinic database connection failed:",A),p("error");return}console.log("‚úÖ Clinic database connection successful"),p("connected");const{data:E,error:w}=await i.from("clinics").select("*").order("created_at",{ascending:!1});if(w)throw console.error("‚ùå Failed to load clinics:",w),new Error(w.message);N(E||[]),console.log("‚úÖ Loaded",(E||[]).length,"clinics")}catch(i){console.error("üí• Clinic management connection failed:",i),p("error")}};o.useEffect(()=>{v()},[]);const c=(i,A)=>{const E=A==="Custom"?n.customAreaCode:A,w=Date.now().toString().slice(-4);return`${i}-${E}-${w}`},f=async()=>{if(!n.name||!n.username||!n.region||!n.areaCode||!n.password){alert("‚ùå Please fill all required fields");return}if(n.areaCode==="Custom"&&!n.customAreaCode){alert("‚ùå Please enter custom area code");return}b(!0);try{const{supabase:i}=await se(async()=>{const{supabase:T}=await import("./index-Bc5fOP-S.js").then(P=>P.m);return{supabase:T}},__vite__mapDeps([0,1,2,3,4,5])),A=c(n.region,n.areaCode),E={name:n.name,username:n.username,region:n.region,plan:n.plan,code:A,area_code:n.areaCode==="Custom"?n.customAreaCode:n.areaCode,custom_area_code:n.areaCode==="Custom"?n.customAreaCode:null,address:n.address||null,admin_clinic:n.adminClinic||null,email:n.email||null,contact_number:n.contactNumber||null,password_hash:await De(n.password),subscription_status:"active",max_cards_allowed:ee[n.plan],is_active:!0},{data:w,error:_}=await i.from("clinics").insert(E).select().single();if(_)throw new Error(_.message);console.log("‚úÖ Clinic created successfully:",w),O(),a(!1),await v(),x&&await x(),alert(`üéâ Clinic "${n.name}" created successfully with code ${A}!`)}catch(i){console.error("üí• Clinic creation failed:",i),alert(`‚ùå Failed to create clinic: ${i.message}`)}finally{b(!1)}},k=async()=>{if(!s||!n.name||!n.region){alert("‚ùå Please fill all required fields");return}b(!0);try{const{supabase:i}=await se(async()=>{const{supabase:w}=await import("./index-Bc5fOP-S.js").then(_=>_.m);return{supabase:w}},__vite__mapDeps([0,1,2,3,4,5])),A={name:n.name,username:n.username,region:n.region,plan:n.plan,area_code:n.areaCode==="Custom"?n.customAreaCode:n.areaCode,custom_area_code:n.areaCode==="Custom"?n.customAreaCode:null,address:n.address||null,admin_clinic:n.adminClinic||null,email:n.email||null,contact_number:n.contactNumber||null,max_cards_allowed:ee[n.plan],updated_at:new Date().toISOString()};n.password.trim()&&(A.password_hash=await De(n.password));const{error:E}=await i.from("clinics").update(A).eq("id",s.id);if(E)throw new Error(E.message);console.log("‚úÖ Clinic updated successfully"),O(),a(!1),l(null),await v(),x&&await x(),alert(`üéâ Clinic "${n.name}" updated successfully!`)}catch(i){console.error("üí• Clinic update failed:",i),alert(`‚ùå Failed to update clinic: ${i.message}`)}finally{b(!1)}},R=async i=>{if(confirm(`‚ö†Ô∏è Are you sure you want to delete "${i.name}"? This action cannot be undone.`)){b(!0);try{const{supabase:A}=await se(async()=>{const{supabase:w}=await import("./index-Bc5fOP-S.js").then(_=>_.m);return{supabase:w}},__vite__mapDeps([0,1,2,3,4,5])),{error:E}=await A.from("clinics").delete().eq("id",i.id);if(E)throw new Error(E.message);console.log("‚úÖ Clinic deleted successfully"),await v(),x&&await x(),alert(`üóëÔ∏è Clinic "${i.name}" deleted successfully!`)}catch(A){console.error("üí• Clinic deletion failed:",A),alert(`‚ùå Failed to delete clinic: ${A.message}`)}finally{b(!1)}}},F=i=>{l(i),u({name:i.name,username:i.username,region:i.region,plan:i.plan,areaCode:"CVT001",customAreaCode:"",password:"",address:i.address||"",adminClinic:i.adminClinic||"",email:i.email||"",contactNumber:i.contactNumber||""}),a(!0)},O=()=>{u({name:"",username:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manage Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Enterprise clinic management with real-time sync"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[d==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Connecting..."})]}),d==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600",children:"Connected"})]}),d==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600",children:"Connection Failed"}),e.jsx("button",{onClick:v,className:"text-red-600 underline hover:text-red-800",children:"Retry"})]})]}),e.jsxs("button",{onClick:()=>{O(),l(null),a(!r)},disabled:d!=="connected",className:`flex items-center space-x-2 px-4 py-2 rounded-xl font-medium transition-all ${d==="connected"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Clinic"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.length})]}),e.jsx(Z,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clinics"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(i=>i.isActive).length})]}),e.jsx(H,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Suspended"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.filter(i=>!i.isActive).length})]}),e.jsx(z,{className:"h-8 w-8 text-red-500"})]})})]}),r&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s?`Edit ${s.name}`:"Add New Clinic"}),e.jsx("button",{onClick:()=>{a(!1),l(null),O()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:n.name,onChange:i=>u({...n,name:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic name",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:n.username,onChange:i=>u({...n,username:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic username for login",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Region ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.region,onChange:i=>u({...n,region:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Region"}),Pe.map(i=>e.jsx("option",{value:i.code,children:i.name},i.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subscription Plan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.plan,onChange:i=>u({...n,plan:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsxs("option",{value:"starter",children:["Starter (‚Ç±",de.starter,"/month - ",ee.starter," cards)"]}),e.jsxs("option",{value:"growth",children:["Growth (‚Ç±",de.growth,"/month - ",ee.growth," cards)"]}),e.jsxs("option",{value:"pro",children:["Pro (‚Ç±",de.pro,"/month - ",ee.pro," cards)"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Area Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.areaCode,onChange:i=>u({...n,areaCode:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Area Code"}),ys.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),n.areaCode==="Custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Area Code"}),e.jsx("input",{type:"text",value:n.customAreaCode,onChange:i=>u({...n,customAreaCode:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter custom area code (e.g., XYZ001)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m?"text":"password",value:n.password,onChange:i=>u({...n,password:i.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic login password",required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!m),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:m?e.jsx(ns,{className:"h-4 w-4"}):e.jsx(ls,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address (Optional)"}),e.jsx("input",{type:"text",value:n.address,onChange:i=>u({...n,address:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Contact (Optional)"}),e.jsx("input",{type:"text",value:n.adminClinic,onChange:i=>u({...n,adminClinic:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter admin contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:n.email,onChange:i=>u({...n,email:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter clinic email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number (Optional)"}),e.jsx("input",{type:"tel",value:n.contactNumber,onChange:i=>u({...n,contactNumber:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+63917123456"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[n.plan.charAt(0).toUpperCase()+n.plan.slice(1)," Plan:"]})," ‚Ç±",de[n.plan],"/month"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Card Limit:"})," Up to ",ee[n.plan]," cards"]}),e.jsx("p",{className:"text-blue-600 mt-2",children:"* Required fields must be filled. Optional fields can be updated later."})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{a(!1),l(null),O()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",disabled:y,children:"Cancel"}),e.jsx("button",{onClick:s?k:f,disabled:y||!n.name||!n.username||!n.region||!n.areaCode||!n.password,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:s?"Update Clinic":"Create Clinic"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Clinic Directory"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage all registered clinics and their details"})]}),h.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clinics Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by adding your first clinic to the system"}),e.jsxs("button",{onClick:()=>{O(),l(null),a(!0)},className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:"Add First Clinic"})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Region & Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Code: ",i.code]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["User: ",i.username]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:Pe.find(A=>A.code===i.region)?.name||i.region}),e.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[i.plan," Plan (‚Ç±",i.subscriptionPrice,"/mo)"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[i.maxCards," cards max"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[i.email&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(is,{className:"h-3 w-3 text-gray-400 mr-1"}),i.email]}),i.contactNumber&&e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(cs,{className:"h-3 w-3 text-gray-400 mr-1"}),i.contactNumber]}),i.address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fe,{className:"h-3 w-3 text-gray-400 mr-1"}),e.jsx("span",{className:"text-xs text-gray-500 truncate max-w-32",children:i.address})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.isActive?"Active":"Suspended"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${i.subscriptionStatus==="active"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:i.subscriptionStatus})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>F(i),className:"text-indigo-600 hover:text-indigo-900",title:"Edit clinic",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>R(i),className:"text-red-600 hover:text-red-900",title:"Delete clinic",children:e.jsx(me,{className:"h-4 w-4"})})]})})]},i.id))})]})})]})]})}function js(){const[x,r]=o.useState(null),[a,s]=o.useState(!0),[l,h]=o.useState({start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[N,y]=o.useState("all"),[b,d]=o.useState("overview"),{addToast:p}=ue(),m=async()=>{s(!0);try{await new Promise(v=>setTimeout(v,1e3)),r({totalClinics:247,activeClinics:235,totalCards:89750,cardsGenerated30d:12845,cardActivationRate:87.5,averageCardsPerClinic:363.4,topRegions:[{region:"NCR",clinics:89,cards:32456},{region:"CALABARZON",clinics:45,cards:18290},{region:"Central Luzon",clinics:38,cards:15678},{region:"Central Visayas",clinics:31,cards:12890},{region:"Western Visayas",clinics:25,cards:9876}],monthlyGrowth:[{month:"Jan",clinics:198,cards:65432},{month:"Feb",clinics:210,cards:69875},{month:"Mar",clinics:225,cards:74320},{month:"Apr",clinics:235,cards:79845},{month:"May",clinics:247,cards:89750}],clinicPerformance:[{clinicName:"Smile Plus Dental Center",cardsGenerated:1250,activationRate:94.2,revenue:156250},{clinicName:"Perfect Teeth Clinic",cardsGenerated:980,activationRate:91.5,revenue:122500},{clinicName:"Dental Care Pro",cardsGenerated:875,activationRate:89.1,revenue:109375},{clinicName:"Elite Dental Services",cardsGenerated:760,activationRate:87.8,revenue:95e3}],systemHealth:{uptime:99.97,responseTime:120,errorRate:.03,securityScore:98.5}}),p({type:"success",title:"Analytics Updated",message:"Enterprise analytics refreshed successfully"})}catch(u){console.error("Failed to fetch analytics:",u),p({type:"error",title:"Analytics Error",message:"Failed to load analytics data"})}finally{s(!1)}};o.useEffect(()=>{m()},[l,N]);const g=u=>{p({type:"success",title:"Export Started",message:`Generating ${u.toUpperCase()} export...`})};if(a||!x)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-64"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((u,v)=>e.jsx("div",{className:"h-32 bg-gray-300 rounded-lg"},v))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(4)].map((u,v)=>e.jsx("div",{className:"h-64 bg-gray-300 rounded-lg"},v))})]})})});const n=({title:u,value:v,change:c,icon:f,trend:k})=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:u}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:v}),c&&e.jsxs("div",{className:`flex items-center mt-2 text-sm ${k==="up"?"text-green-600":k==="down"?"text-red-600":"text-gray-600"}`,children:[k==="up"&&e.jsx(os,{className:"h-4 w-4 mr-1"}),k==="down"&&e.jsx(ds,{className:"h-4 w-4 mr-1"}),c]})]}),e.jsx("div",{className:"p-3 bg-blue-50 rounded-full",children:e.jsx(f,{className:"h-6 w-6 text-blue-600"})})]})});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Enterprise Analytics"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Advanced business intelligence and performance monitoring"})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-4",children:[e.jsxs("button",{onClick:()=>m(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs("button",{onClick:()=>g("csv"),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs("button",{onClick:()=>g("pdf"),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Export PDF"]})]})]}),e.jsx("div",{className:"mt-6 border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",name:"Overview",icon:je},{id:"clinics",name:"Clinics",icon:Z},{id:"cards",name:"Cards",icon:ae},{id:"performance",name:"Performance",icon:ke}].map(u=>e.jsxs("button",{onClick:()=>d(u.id),className:`flex items-center py-2 px-1 border-b-2 font-medium text-sm transition-colors ${b===u.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(u.icon,{className:"h-4 w-4 mr-2"}),u.name]},u.id))})})]}),e.jsx("div",{className:"mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",value:l.start,onChange:u=>h(v=>({...v,start:u.target.value})),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:l.end,onChange:u=>h(v=>({...v,end:u.target.value})),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsxs("select",{value:N,onChange:u=>y(u.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Regions"}),x.topRegions.map(u=>e.jsx("option",{value:u.region,children:u.region},u.region))]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(n,{title:"Total Clinics",value:x.totalClinics.toLocaleString(),change:"+5.2% from last month",icon:Z,trend:"up"}),e.jsx(n,{title:"Active Clinics",value:x.activeClinics.toLocaleString(),change:"95.1% of total",icon:Le,trend:"up"}),e.jsx(n,{title:"Total Cards",value:x.totalCards.toLocaleString(),change:"+12.8% from last month",icon:ae,trend:"up"}),e.jsx(n,{title:"Activation Rate",value:`${x.cardActivationRate}%`,change:"+2.3% improvement",icon:Oe,trend:"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(n,{title:"System Uptime",value:`${x.systemHealth.uptime}%`,change:"Last 30 days",icon:ye,trend:"up"}),e.jsx(n,{title:"Response Time",value:`${x.systemHealth.responseTime}ms`,change:"Average",icon:ke,trend:"stable"}),e.jsx(n,{title:"Error Rate",value:`${x.systemHealth.errorRate}%`,change:"Very low",icon:z,trend:"down"}),e.jsx(n,{title:"Security Score",value:`${x.systemHealth.securityScore}/100`,change:"Excellent",icon:ye,trend:"up"})]}),b==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Regions"}),e.jsx("div",{className:"space-y-4",children:x.topRegions.map((u,v)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-3",children:v+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:u.region}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u.clinics," clinics"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:u.cards.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"cards"})]})]},u.region))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Monthly Growth"}),e.jsx("div",{className:"space-y-4",children:x.monthlyGrowth.map(u=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[u.month," 2024"]}),e.jsxs("div",{className:"flex space-x-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600",children:[u.clinics," clinics"]}),e.jsxs("span",{className:"text-green-600",children:[u.cards.toLocaleString()," cards"]})]})]},u.month))})]})]}),b==="clinics"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Performing Clinics"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clinic"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cards Generated"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activation Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.clinicPerformance.map((u,v)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.clinicName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:u.cardsGenerated.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${u.activationRate>=90?"bg-green-100 text-green-800":u.activationRate>=80?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[u.activationRate,"%"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["‚Ç±",u.revenue.toLocaleString()]})]},v))})]})})]})]})})}const vs=900*1e3,W="mocards_auth_session",ie="mocards_last_activity",Ns=()=>{const[x,r]=o.useState(!1),[a,s]=o.useState(null),l=o.useCallback(()=>{const b=Date.now();if(localStorage.setItem(ie,b.toString()),a){const d={...a,lastActivity:b};s(d),localStorage.setItem(W,JSON.stringify(d))}},[a]),h=o.useCallback(b=>Date.now()-b.lastActivity<vs,[]),N=o.useCallback((b,d)=>{const p=Date.now(),m={type:b,username:d.username||d.code,clinicId:d.id,clinicCode:d.code,loginTime:p,lastActivity:p};s(m),r(!0),localStorage.setItem(W,JSON.stringify(m)),localStorage.setItem(ie,p.toString()),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"login",user:m}}))},[]),y=o.useCallback(()=>{s(null),r(!1),localStorage.removeItem(W),localStorage.removeItem(ie),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"logout"}}))},[]);return o.useEffect(()=>{(()=>{try{const m=localStorage.getItem(W);if(m){const g=JSON.parse(m);h(g)?(s(g),r(!0),l()):(localStorage.removeItem(W),localStorage.removeItem(ie))}}catch(m){console.error("Error checking session:",m),localStorage.removeItem(W),localStorage.removeItem(ie)}})();const d=m=>{const{type:g,user:n}=m.detail;g==="login"&&n?(s(n),r(!0)):g==="logout"&&(s(null),r(!1))},p=m=>{if(m.key===W)if(m.newValue)try{const g=JSON.parse(m.newValue);h(g)&&(s(g),r(!0))}catch(g){console.error("Error parsing stored user data:",g)}else s(null),r(!1)};return window.addEventListener("auth-state-change",d),window.addEventListener("storage",p),()=>{window.removeEventListener("auth-state-change",d),window.removeEventListener("storage",p)}},[]),o.useEffect(()=>{if(!x||!a)return;const d=setInterval(()=>{a&&!h(a)&&y()},60*1e3);return()=>clearInterval(d)},[x,a,h,y]),o.useEffect(()=>{if(!x)return;const b=["mousedown","mousemove","keypress","scroll","touchstart","click"],d=()=>{l()};let p;const m=()=>{clearTimeout(p),p=setTimeout(d,1e3)};return b.forEach(g=>{document.addEventListener(g,m,!0)}),()=>{clearTimeout(p),b.forEach(g=>{document.removeEventListener(g,m,!0)})}},[x,l]),{isAuthenticated:x,user:a,login:N,logout:y,updateActivity:l}};function ws(){const x=o.useRef(new Map),r=o.useRef(Date.now()),{addToast:a}=ue(),s=o.useCallback((m,g)=>(x.current.set(m,g),()=>{x.current.delete(m)}),[]),l=o.useCallback(async m=>{const g=Date.now();if(g-r.current<1e3)return;r.current=g,console.log("üîÑ Enterprise sync triggered:",m);const n=Array.from(x.current.values());try{await Promise.all(n.map(u=>Promise.resolve(u()))),console.log("‚úÖ Enterprise sync completed successfully"),(m.type==="card_generated"||m.type==="clinic_created")&&a({type:"success",title:"Data Synchronized",message:`${Cs(m.type)} - All features updated`,duration:3e3})}catch(u){console.error("‚ùå Enterprise sync failed:",u),a({type:"error",title:"Sync Error",message:"Failed to synchronize data across features",duration:5e3})}},[a]),h=o.useCallback(async m=>{await l({type:"card_generated",source:"card_generator",timestamp:Date.now(),data:{cardCount:m}})},[l]),N=o.useCallback(async(m,g)=>{await l({type:m==="created"?"clinic_created":"clinic_updated",source:"clinic_management",timestamp:Date.now(),data:{clinicName:g}})},[l]),y=o.useCallback(async m=>{await l({type:"data_changed",source:m,timestamp:Date.now()})},[l]);o.useEffect(()=>{const m=()=>{l({type:"data_changed",source:"window_focus",timestamp:Date.now()})};return window.addEventListener("focus",m),()=>window.removeEventListener("focus",m)},[l]),o.useEffect(()=>{const m=g=>{if(g.key==="mocards_sync_event"&&g.newValue)try{const n=JSON.parse(g.newValue);n.timestamp!==r.current&&l(n)}catch(n){console.error("Failed to parse sync event:",n)}};return window.addEventListener("storage",m),()=>window.removeEventListener("storage",m)},[l]);const b=o.useCallback(m=>{try{localStorage.setItem("mocards_sync_event",JSON.stringify(m)),setTimeout(()=>{localStorage.removeItem("mocards_sync_event")},100)}catch(g){console.error("Failed to broadcast sync event:",g)}},[]),d=o.useCallback(async m=>{const g={type:"card_generated",source:"card_generator",timestamp:Date.now(),data:{cardCount:m}};b(g),await l(g)},[b,l]),p=o.useCallback(async(m,g)=>{const n={type:m==="created"?"clinic_created":"clinic_updated",source:"clinic_management",timestamp:Date.now(),data:{clinicName:g}};b(n),await l(n)},[b,l]);return{registerSyncCallback:s,triggerSync:l,syncAfterCardGeneration:h,syncAfterClinicOperation:N,syncAfterDataChange:y,syncAfterCardGenerationBroadcast:d,syncAfterClinicOperationBroadcast:p}}function Cs(x){switch(x){case"card_generated":return"Cards generated";case"clinic_created":return"Clinic created";case"clinic_updated":return"Clinic updated";case"card_updated":return"Card updated";default:return"Data updated"}}function Ss(){const[x,r]=o.useState(!1),[a,s]=o.useState(null),[l,h]=o.useState(null),N=async()=>{r(!0),h(null),s(null);try{console.log("[DEBUG] Starting database analysis...");const{data:y,error:b}=await V.from("information_schema.columns").select("*").eq("table_name","cards").eq("table_schema","public"),{data:d,error:p}=await V.from("cards").select("*").limit(10),{count:m,error:g}=await V.from("cards").select("*",{count:"exact",head:!0}),{data:n,error:u}=await V.from("cards").select("*").limit(5),v={tableStructure:{data:y,error:b},sampleCards:{data:d,error:p},totalCards:{count:m,error:g},testSearch:{data:n,error:u},timestamp:new Date().toISOString()};console.log("[DEBUG] Complete database analysis:",v),s(v)}catch(y){const b=y instanceof Error?y.message:"Unknown error";console.error("[DEBUG] Database check failed:",y),h(b)}finally{r(!1)}};return e.jsxs("div",{className:"light-card p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(ve,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Database Debugger"})]}),e.jsx("button",{onClick:N,disabled:x,className:"light-button-primary flex items-center space-x-2 mb-6",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing Database..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Run Database Analysis"})]})}),l&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Database Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:l})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Database Analysis Complete"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Cards Table Structure"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.tableStructure.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",a.tableStructure.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Found ",a.tableStructure.data?.length||0," columns in cards table"]}),a.tableStructure.data&&a.tableStructure.data.length>0&&e.jsx("div",{className:"text-xs font-mono",children:a.tableStructure.data.map((y,b)=>e.jsxs("div",{className:"text-gray-700",children:[y.column_name,": ",y.data_type]},b))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Total Cards"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.totalCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",a.totalCards.error.message]}):e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[a.totalCards.count," cards"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Sample Cards Data"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto",children:a.sampleCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",a.sampleCards.error.message]}):e.jsx("pre",{className:"text-xs font-mono text-gray-700 whitespace-pre-wrap",children:JSON.stringify(a.sampleCards.data,null,2)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Basic Query Test"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.testSearch.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",a.testSearch.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Query returned ",a.testSearch.data?.length||0," cards"]}),a.testSearch.data&&a.testSearch.data.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"First card control_number:"}),e.jsx("p",{className:"font-mono text-blue-600",children:a.testSearch.data[0]?.control_number||"No control_number field"})]})]})})]}),e.jsxs("details",{className:"border border-gray-200 rounded-lg",children:[e.jsx("summary",{className:"p-4 cursor-pointer font-medium",children:"View Raw Results"}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("pre",{className:"text-xs font-mono text-gray-600 whitespace-pre-wrap overflow-x-auto",children:JSON.stringify(a,null,2)})})]})]})]})}class te{static instance;analyticsTable=[{name:"analytics_events",description:"User interaction events",resetStrategy:"truncate"},{name:"analytics_metrics",description:"Business performance metrics",resetStrategy:"truncate"},{name:"analytics_sessions",description:"User session tracking",resetStrategy:"truncate"},{name:"analytics_dashboards",description:"Dashboard view analytics",resetStrategy:"truncate"},{name:"analytics_reports",description:"Generated reports cache",resetStrategy:"truncate"},{name:"card_usage_analytics",description:"Card usage tracking",resetStrategy:"truncate"},{name:"clinic_performance_metrics",description:"Clinic performance data",resetStrategy:"truncate"},{name:"appointment_analytics",description:"Appointment booking analytics",resetStrategy:"truncate"},{name:"revenue_analytics",description:"Revenue tracking data",resetStrategy:"truncate"},{name:"user_behavior_analytics",description:"User behavior patterns",resetStrategy:"truncate"}];constructor(){}static getInstance(){return te.instance||(te.instance=new te),te.instance}async resetToFreshState(){const r=`analytics_reset_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={success:!1,clearedTables:[],errors:[],timestamp:new Date().toISOString(),resetId:r};console.log("üîÑ Starting Enterprise Analytics Reset...",{resetId:r}),he("analytics_reset_started",1,{resetId:r});try{for(const s of this.analyticsTable)try{await this.clearAnalyticsTable(s),a.clearedTables.push(s.name),console.log(`‚úÖ Cleared ${s.name}: ${s.description}`)}catch(l){const h=`Failed to clear ${s.name}: ${l instanceof Error?l.message:"Unknown error"}`;a.errors.push(h),Se("error",h,{table:s.name,resetId:r})}await this.resetAnalyticsCounters(),a.clearedTables.push("analytics_counters_reset"),await this.clearLocalStorageAnalytics(),a.clearedTables.push("localStorage_analytics_cache"),await this.initializeFreshBaseline(r),a.clearedTables.push("fresh_baseline_initialized"),a.success=a.errors.length===0,console.log("üéâ Enterprise Analytics Reset Complete:",{success:a.success,clearedTables:a.clearedTables.length,errors:a.errors.length}),he("analytics_reset_completed",1,{resetId:r,success:a.success,tablesCleared:a.clearedTables.length,errors:a.errors.length})}catch(s){a.errors.push(`Critical reset error: ${s instanceof Error?s.message:"Unknown error"}`),a.success=!1,Se("critical","Analytics reset failed",{error:s,resetId:r})}return a}async clearAnalyticsTable(r){switch(console.log(`üîÑ Clearing ${r.name} using ${r.resetStrategy} strategy`),r.resetStrategy){case"truncate":const{error:a}=await V.from(r.name).delete().neq("id","00000000-0000-0000-0000-000000000000");if(a&&!a.message.includes("relation")&&!a.message.includes("does not exist"))throw a;break;case"delete":const{error:s}=await V.from(r.name).delete().neq("id","00000000-0000-0000-0000-000000000000");if(s&&!s.message.includes("relation")&&!s.message.includes("does not exist"))throw s;break;case"update_zero":const{error:l}=await V.from(r.name).update({count:0,value:0,total:0,last_reset:new Date().toISOString()}).neq("id","00000000-0000-0000-0000-000000000000");if(l&&!l.message.includes("relation")&&!l.message.includes("does not exist"))throw l;break}}async resetAnalyticsCounters(){console.log("üîÑ Resetting analytics counters in business tables");try{const{error:r}=await V.from("cards").update({perks_used:0,last_analytics_update:new Date().toISOString()}).neq("id","00000000-0000-0000-0000-000000000000");r&&!r.message.includes("column")&&!r.message.includes("does not exist")&&console.warn("Could not reset card analytics counters:",r.message);const{error:a}=await V.from("clinics").update({total_appointments:0,total_revenue:0,last_analytics_reset:new Date().toISOString()}).neq("id","00000000-0000-0000-0000-000000000000");a&&!a.message.includes("column")&&!a.message.includes("does not exist")&&console.warn("Could not reset clinic analytics counters:",a.message),console.log("‚úÖ Analytics counters reset completed")}catch(r){console.warn("Non-critical error resetting analytics counters:",r)}}async clearLocalStorageAnalytics(){console.log("üîÑ Clearing localStorage analytics cache"),["mocards_analytics_cache","mocards_dashboard_metrics","mocards_performance_data","mocards_user_analytics","mocards_business_metrics","mocards_last_analytics_sync","mocards_analytics_preferences","mocards_chart_cache","mocards_dashboard_state"].forEach(s=>{try{localStorage.removeItem(s),console.log(`‚úÖ Cleared localStorage key: ${s}`)}catch(l){console.warn(`Could not clear localStorage key ${s}:`,l)}}),["mocards_session_analytics","mocards_current_metrics","mocards_temp_dashboard_data"].forEach(s=>{try{sessionStorage.removeItem(s),console.log(`‚úÖ Cleared sessionStorage key: ${s}`)}catch(l){console.warn(`Could not clear sessionStorage key ${s}:`,l)}})}async initializeFreshBaseline(r){console.log("üîÑ Initializing fresh analytics baseline");const a={reset_id:r,deployment_start:new Date().toISOString(),initial_state:{total_users:0,total_cards:0,total_clinics:0,total_appointments:0,total_revenue:0},version:"1.0.0",reset_reason:"enterprise_fresh_deployment"};try{localStorage.setItem("mocards_analytics_baseline",JSON.stringify(a)),localStorage.setItem("mocards_last_analytics_reset",new Date().toISOString()),console.log("‚úÖ Fresh analytics baseline initialized")}catch(s){console.warn("Could not store analytics baseline:",s)}}async verifyResetCompletion(){console.log("üîç Verifying analytics reset completion");const r={verified:!0,details:{emptyTables:[],nonEmptyTables:[],localStorageCleared:!0,baselineExists:!1}};for(const a of this.analyticsTable)try{const{data:s,error:l}=await V.from(a.name).select("id",{count:"exact",head:!0});l||((s?.length||0)===0?r.details.emptyTables.push(a.name):(r.details.nonEmptyTables.push(a.name),r.verified=!1))}catch{r.details.emptyTables.push(`${a.name} (not exists)`)}return r.details.localStorageCleared=!localStorage.getItem("mocards_analytics_cache"),r.details.baselineExists=!!localStorage.getItem("mocards_analytics_baseline"),r}getResetHistory(){try{const r=localStorage.getItem("mocards_last_analytics_reset"),a=localStorage.getItem("mocards_analytics_baseline");return{lastReset:r?new Date(r):null,baseline:a?JSON.parse(a):null,isReset:!!r&&!!a}}catch(r){return{lastReset:null,baseline:null,isReset:!1,error:r instanceof Error?r.message:"Unknown error"}}}}const Ne=te.getInstance(),As=()=>Ne.resetToFreshState(),_s=()=>Ne.verifyResetCompletion(),ks=()=>Ne.getResetHistory();function Rs(){const[x,r]=o.useState(null),[a,s]=o.useState(!1),[l,h]=o.useState(!1),[N,y]=o.useState(null),[b,d]=o.useState(!1),{addToast:p}=ue();o.useEffect(()=>{m()},[]);const m=async()=>{try{const f=ks();r(f),console.log("üìä Analytics Reset Status:",f)}catch(f){console.error("Failed to load reset status:",f)}},g=async()=>{if(!b){d(!0);return}d(!1),s(!0);try{p(Ae("Analytics Reset","Starting enterprise analytics reset...")),console.log("üöÄ Starting enterprise analytics reset...");const f=await As();f.success?(p(G("Reset Complete!",`Successfully reset ${f.clearedTables.length} analytics components`)),he("enterprise_analytics_reset_success",1,{resetId:f.resetId,tablesCleared:f.clearedTables.length}),await m(),console.log("‚úÖ Enterprise Analytics Reset Completed:",f)):(p($("Reset Incomplete",`Reset completed with ${f.errors.length} errors. Check console for details.`)),console.error("‚ùå Analytics reset had errors:",f.errors))}catch(f){p($("Reset Failed",`Analytics reset failed: ${f instanceof Error?f.message:"Unknown error"}`)),console.error("üí• Analytics reset failed:",f)}finally{s(!1)}},n=async()=>{h(!0);try{p(Ae("Verification","Verifying analytics reset completion..."));const f=await _s();y(f),f.verified?p(G("Verification Passed","Analytics reset verified successfully!")):p(ce("Verification Issues",`Found ${f.details.nonEmptyTables.length} tables with remaining data`)),console.log("üîç Verification Result:",f)}catch(f){p($("Verification Failed",`Could not verify reset: ${f instanceof Error?f.message:"Unknown error"}`))}finally{h(!1)}},u=f=>f?(typeof f=="string"?new Date(f):f).toLocaleString():"Never",v=()=>x?x.isReset?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600",c=()=>x?x.isReset?"Reset to Fresh State":"Contains Historical Data":"Unknown";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(je,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Enterprise Analytics Manager"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Reset analytics to fresh state for client deployment"})]})]}),e.jsxs("div",{className:"light-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Analytics Status"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${v()}`,children:c()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Last Reset"}),e.jsx("p",{className:"text-xs text-gray-600",children:u(x?.lastReset)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ve,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Baseline Exists"}),e.jsx("p",{className:"text-xs text-gray-600",children:x?.baseline?"Yes":"No"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Reset ID"}),e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:x?.baseline?.reset_id?.slice(-8)||"None"})]})]})]})]}),e.jsxs("div",{className:"light-card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Analytics Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:g,disabled:a,className:`light-button-destructive flex items-center justify-center space-x-2 p-4 ${a?"opacity-50 cursor-not-allowed":""}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Resetting Analytics..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-5 w-5"}),e.jsx("span",{children:"Reset to Fresh State"})]})}),e.jsx("button",{onClick:n,disabled:l,className:`light-button-secondary flex items-center justify-center space-x-2 p-4 ${l?"opacity-50 cursor-not-allowed":""}`,children:l?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"Verify Reset"})]})})]})]}),N&&e.jsxs("div",{className:"light-card p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[N.verified?e.jsx(H,{className:"h-6 w-6 text-green-500"}):e.jsx(z,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Verification Results"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-green-700 mb-2",children:["‚úÖ Empty Tables (",N.details.emptyTables.length,")"]}),e.jsxs("div",{className:"space-y-1",children:[N.details.emptyTables.slice(0,5).map((f,k)=>e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:f},k)),N.details.emptyTables.length>5&&e.jsxs("p",{className:"text-xs text-gray-500",children:["... and ",N.details.emptyTables.length-5," more"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-red-700 mb-2",children:["‚ö†Ô∏è Non-Empty Tables (",N.details.nonEmptyTables.length,")"]}),e.jsxs("div",{className:"space-y-1",children:[N.details.nonEmptyTables.map((f,k)=>e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:f},k)),N.details.nonEmptyTables.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"All analytics tables are empty ‚úÖ"})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["LocalStorage Cleared: ",N.details.localStorageCleared?"Yes":"No"]}),e.jsxs("span",{className:"text-gray-600",children:["Baseline Exists: ",N.details.baselineExists?"Yes":"No"]})]})})]}),x?.baseline&&e.jsxs("div",{className:"light-card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Current Baseline"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Users:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:x.baseline.initial_state?.total_users||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cards:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:x.baseline.initial_state?.total_cards||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Clinics:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:x.baseline.initial_state?.total_clinics||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Revenue:"}),e.jsxs("span",{className:"ml-2 text-gray-900",children:["‚Ç±",x.baseline.initial_state?.total_revenue||0]})]})]})})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(z,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Analytics Reset"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"This will permanently delete all analytics data including:"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1 ml-4",children:[e.jsx("li",{children:"‚Ä¢ All historical analytics events and metrics"}),e.jsx("li",{children:"‚Ä¢ Performance data and user behavior analytics"}),e.jsx("li",{children:"‚Ä¢ Dashboard cache and stored analytics preferences"}),e.jsx("li",{children:"‚Ä¢ Business metrics and revenue tracking data"})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-3",children:"The system will be reset to a fresh state as if newly deployed."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 light-button-secondary",children:"Cancel"}),e.jsx("button",{onClick:g,className:"flex-1 light-button-destructive",children:"Reset Analytics"})]})]})})]})}function $s(){const{isAuthenticated:x,login:r,logout:a}=Ns();hs({enabled:!0,showNotifications:!0});const{registerSyncCallback:s,syncAfterCardGenerationBroadcast:l}=ws(),[h,N]=o.useState({username:"",password:""}),[y,b]=o.useState("analytics"),[d,p]=o.useState({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}}),[m,g]=o.useState(""),[n,u]=o.useState(null),[v,c]=o.useState({clinicId:"",startRange:"",endRange:""}),[f,k]=o.useState(!1),[R,F]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[O,i]=o.useState({username:"admin",password:"admin123"}),[A,E]=o.useState("cards"),[w,_]=o.useState(null),[T,P]=o.useState(""),[U,re]=o.useState([]),[J,B]=o.useState([]),[Me,we]=o.useState([]),[Ge,Ce]=o.useState(!0),[xe,Ve]=o.useState("all"),[D,K]=o.useState({fullName:"",status:"inactive",perksTotal:5,perksUsed:0,clinicId:"",expiryDate:"",notes:""}),{addToast:S}=ue();o.useEffect(()=>{(async()=>await X.initializeDefaults())()},[]),o.useEffect(()=>{const t=async()=>{try{Ce(!0);const[j,C,M]=await Promise.all([Q.getAll(),le.getAll(),X.getAll()]);re(j),B(C),we(M)}catch(j){console.error("Failed to load data:",j),S($("Error","Failed to load data"))}finally{Ce(!1)}};if(x){t();const j=V.channel("admin-cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},async M=>{console.log("[Admin] Real-time cards change detected:",M);try{const L=await Q.getAll();re(L)}catch(L){console.error("Failed to reload cards after real-time update:",L)}}).subscribe(),C=V.channel("admin-clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},async M=>{console.log("[Admin] Real-time clinics change detected:",M);try{const L=await le.getAll();B(L)}catch(L){console.error("Failed to reload clinics after real-time update:",L)}}).subscribe();return()=>{j.unsubscribe(),C.unsubscribe()}}},[x]);const q=async()=>{try{const[t,j,C]=await Promise.all([Q.getAll(),le.getAll(),X.getAll()]);re(t),B(j),we(C)}catch(t){console.error("Failed to reload data:",t),S($("Error","Failed to reload data"))}};o.useEffect(()=>{if(x)return s("admin_portal_data",async()=>{console.log("üîÑ Enterprise sync triggered - reloading admin portal data"),await q()})},[x,s]),o.useEffect(()=>{y==="master-list"&&x&&(console.log("üîÑ Refreshing data for master list sync"),q())},[y,x]);const Ue=async t=>{t.preventDefault();try{const j=await gs.authenticateAdmin(h.username,h.password);j.success&&j.user&&j.token?(r("admin",j.user),localStorage.setItem("mocards_auth_token",j.token),S(G("Welcome","Secure admin access granted"))):S($("Login Failed",j.message||"Invalid credentials"))}catch(j){console.error("Authentication error:",j),S($("Login Failed","Authentication system error"))}},qe=t=>{if(t.preventDefault(),R.currentPassword!==O.password){S($("Invalid Password","Current password is incorrect"));return}if(R.newPassword.length<8){S($("Password Too Short","New password must be at least 8 characters long"));return}if(R.newPassword!==R.confirmPassword){S($("Passwords Do Not Match","Please confirm your new password correctly"));return}i({...O,password:R.newPassword}),F({currentPassword:"",newPassword:"",confirmPassword:""}),k(!1),S(G("Password Changed","Admin password has been updated successfully"))},Be=async()=>{if(!d.form.name||!d.form.description){S(ce("Missing Fields","Please fill all required fields"));return}d.editingPerk?(await X.update(d.editingPerk.id,d.form),S(G("Perk Updated",`Updated ${d.form.name}`))):(await X.create(d.form),S(G("Perk Created",`Created ${d.form.name}`))),await q(),p({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}})},ze=t=>{p({showModal:!0,editingPerk:t,form:{type:t.type,name:t.name,description:t.description,value:t.value,isActive:t.isActive,validFor:t.validFor,requiresApproval:t.requiresApproval}})},He=async t=>{await X.delete(t.id),S(G("Perk Deleted",`Deleted ${t.name}`)),await q()},Je=[{value:"dental_cleaning",label:"Dental Cleaning"},{value:"consultation",label:"Consultation"},{value:"xray",label:"X-Ray"},{value:"treatment",label:"Treatment"},{value:"discount",label:"Discount"},{value:"extraction",label:"Tooth Extraction (Bunot)"},{value:"filling",label:"Tooth Filling (Pasta)"},{value:"fluoride",label:"Fluoride Treatment"},{value:"checkup",label:"Checkup/Unlimited"}],Ke=()=>{if(!m.trim())return;const t=U.find(j=>j.controlNumber===m);u(t||null),t||S(ce("Card Not Found","No card found with this number"))},We=async()=>{if(!n)return;const t=n.status==="active"?"inactive":"active";await Q.updateStatus(n.controlNumber,t)?(u({...n,status:t}),S(G("Status Updated",`Card is now ${t}`)),await q()):S($("Update Failed","Failed to update card status"))},Ye=async()=>{if(!v.clinicId||!v.startRange||!v.endRange){S(ce("Missing Fields","Please fill all fields"));return}const t=await le.getById(v.clinicId);if(!t){S($("Invalid Clinic","Clinic not found"));return}const C=U.filter(ne=>ne.controlNumber>=v.startRange&&ne.controlNumber<=v.endRange&&!ne.clinicId);if(C.length===0){S(ce("No Cards","No unassigned cards found in this range"));return}const M=await le.getAssignedCardsCount(t.id),L=ts[t.plan];if(M+C.length>L){S($("Plan Limit Exceeded",`This would exceed the ${t.plan} plan limit of ${L} cards. Current: ${M}`));return}await Q.assignToClinic(C.map(ne=>ne.controlNumber),t.id)?(S(G("Cards Assigned",`Assigned ${C.length} cards to ${t.name}`)),c({clinicId:"",startRange:"",endRange:""}),await q()):S($("Assignment Failed","Failed to assign cards to clinic"))},Ze=t=>{const j=U.find(C=>C.controlNumber===t);j&&(K({fullName:j.fullName,status:j.status,perksTotal:j.perksTotal,perksUsed:j.perksUsed,clinicId:j.clinicId,expiryDate:j.expiryDate,notes:j.notes||""}),_(t))},Qe=async t=>{const j=U.find(C=>C.controlNumber===t);if(j)try{const C={fullName:D.fullName,status:D.status,perksTotal:D.perksTotal,perksUsed:D.perksUsed,clinicId:D.clinicId,expiryDate:D.expiryDate,notes:D.notes,updatedAt:new Date().toISOString()};if(await as.cards.update(j.id,C))_(null),S(G("Card Updated",`Updated ${t} successfully`)),await q();else throw new Error("Failed to save to database")}catch{S($("Update Failed","Failed to update card"))}},Xe=async t=>{if(window.confirm(`Are you sure you want to delete card ${t}? This action cannot be undone.`))try{await Q.delete(t)?(S(G("Card Deleted",`Card ${t} has been deleted`)),await q()):S($("Delete Failed","Could not delete card"))}catch{S($("Delete Failed","Could not delete card"))}},es=[{id:"analytics",label:"Analytics",icon:je,color:"blue"},{id:"generator",label:"Generator",icon:pe,color:"emerald"},{id:"activation",label:"Activation",icon:Ie,color:"cyan"},{id:"appointments",label:"Appointments",icon:ms,color:"rose"},{id:"clinic-management",label:"Manage Clinics",icon:Z,color:"indigo"},{id:"endorsement",label:"Endorsement",icon:us,color:"orange"},{id:"master-list",label:"Master List",icon:ve,color:"purple"},{id:"debug",label:"Debug DB",icon:z,color:"red"},{id:"settings",label:"Settings",icon:ge,color:"gray"}];if(!x)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(Re,{className:"h-8 w-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Please authenticate to continue"})]}),e.jsxs("form",{onSubmit:Ue,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:h.username,onChange:t=>N({...h,username:t.target.value}),className:"light-input",placeholder:"Enter admin username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:h.password,onChange:t=>N({...h,password:t.target.value}),className:"light-input",placeholder:"Enter admin password",required:!0})]}),e.jsx("button",{type:"submit",className:"light-button-primary w-full",children:"Access Admin Portal"})]})]})});const ss=[{label:"Total Cards",value:U.length,icon:ae,color:"blue"},{label:"Active Clinics",value:J.length,icon:Le,color:"green"},{label:"Active Cards",value:U.filter(t=>t.status==="active").length,icon:H,color:"emerald"},{label:"Pending Cards",value:U.filter(t=>t.status==="inactive").length,icon:z,color:"yellow"}];return Ge?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"light-card p-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin data..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-2xl flex items-center justify-center",children:e.jsx(Re,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Control Room"}),e.jsx("p",{className:"text-gray-600",children:"MOCARDS System Administration"})]})]}),e.jsxs("button",{onClick:a,className:"light-button-secondary flex items-center space-x-2",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:ss.map((t,j)=>{const C=t.icon;return e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:t.label}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t.value})]}),e.jsx("div",{className:`w-12 h-12 bg-${t.color}-100 rounded-2xl flex items-center justify-center`,children:e.jsx(C,{className:`h-6 w-6 text-${t.color}-600`})})]})},j)})}),e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-xl",children:es.map(t=>{const j=t.icon,C=y===t.id;return e.jsxs("button",{onClick:()=>b(t.id),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg transition-all duration-200 ${C?"light-tab-active":"light-tab"}`,children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.label})]},t.id)})})})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[y==="analytics"&&e.jsx(js,{}),y==="generator"&&e.jsx(fs,{onSuccess:async()=>{console.log("üéØ Card generation successful - forcing data reload"),await q(),await l(),S(G("Sync Complete","Master list updated with new cards"))}}),y==="activation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Activation"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:m,onChange:t=>g(t.target.value),className:"light-input",placeholder:"Enter control number to activate"})}),e.jsxs("button",{onClick:Ke,className:"light-button-primary",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Search"]})]}),n&&e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n.fullName}),e.jsx("p",{className:"text-gray-600",children:n.controlNumber})]}),e.jsx("span",{className:n.status==="active"?"status-active":"status-inactive",children:n.status})]}),e.jsxs("button",{onClick:We,className:"light-button-primary",children:[n.status==="active"?"Deactivate":"Activate"," Card"]})]})]}),y==="clinic-management"&&e.jsx(bs,{onSuccess:q}),y==="endorsement"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Endorsement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic"}),e.jsxs("select",{value:v.clinicId,onChange:t=>c({...v,clinicId:t.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Clinic"}),J.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.plan,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Range"}),e.jsx("input",{type:"text",value:v.startRange,onChange:t=>c({...v,startRange:t.target.value}),className:"light-input",placeholder:"MOC-00001-NCR-CVT001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Range"}),e.jsx("input",{type:"text",value:v.endRange,onChange:t=>c({...v,endRange:t.target.value}),className:"light-input",placeholder:"MOC-00100-NCR-CVT001"})]})]}),e.jsx("button",{onClick:Ye,className:"light-button-primary",children:"Assign Cards to Clinic"})]}),y==="master-list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Data Management"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>E("cards"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${A==="cards"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(ae,{className:"h-4 w-4 inline mr-2"}),"Cards"]}),e.jsxs("button",{onClick:()=>E("clinics"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${A==="clinics"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(Z,{className:"h-4 w-4 inline mr-2"}),"Clinics"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(be,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:T,onChange:t=>P(t.target.value),placeholder:A==="cards"?"Search cards by name or control number...":"Search clinics by name or code...",className:"light-input pl-10"})]}),A==="cards"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:xe,onChange:t=>Ve(t.target.value),className:"light-select",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),A==="cards"&&e.jsx("div",{className:"light-table",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"light-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4",children:"Control Number"}),e.jsx("th",{className:"text-left p-4",children:"Patient Name"}),e.jsx("th",{className:"text-left p-4",children:"Status"}),e.jsx("th",{className:"text-left p-4",children:"Clinic"}),e.jsx("th",{className:"text-left p-4",children:"Perks"}),e.jsx("th",{className:"text-left p-4",children:"Expiry"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:U.filter(t=>{const j=t.fullName||"",C=t.controlNumber||"",M=!T||j.toLowerCase().includes(T.toLowerCase())||C.toLowerCase().includes(T.toLowerCase())||C.includes(T.toUpperCase()),L=xe==="all"||t.status===xe;return M&&L}).map(t=>{const j=J.find(I=>I.id===t.clinicId),C=w===t.controlNumber,M=t.fullName||"Unnamed Card",L=t.controlNumber||"";return e.jsxs("tr",{className:"light-table-row",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:L}),e.jsx("td",{className:"p-4",children:C?e.jsx("input",{type:"text",value:D.fullName,onChange:I=>K({...D,fullName:I.target.value}),className:"light-input text-sm"}):M}),e.jsx("td",{className:"p-4",children:C?e.jsxs("select",{value:D.status,onChange:I=>K({...D,status:I.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("span",{className:t.status==="active"?"status-active":"status-inactive",children:t.status})}),e.jsx("td",{className:"p-4",children:C?e.jsxs("select",{value:D.clinicId,onChange:I=>K({...D,clinicId:I.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),J.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]}):j?.name||"Unassigned"}),e.jsx("td",{className:"p-4",children:C?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",min:"0",value:D.perksUsed,onChange:I=>K({...D,perksUsed:parseInt(I.target.value)||0}),className:"light-input text-sm w-16"}),e.jsx("span",{className:"text-gray-500 self-center",children:"/"}),e.jsx("input",{type:"number",min:"1",value:D.perksTotal,onChange:I=>K({...D,perksTotal:parseInt(I.target.value)||1}),className:"light-input text-sm w-16"})]}):`${t.perksUsed}/${t.perksTotal}`}),e.jsx("td",{className:"p-4",children:C?e.jsx("input",{type:"date",value:D.expiryDate,onChange:I=>K({...D,expiryDate:I.target.value}),className:"light-input text-sm"}):new Date(t.expiryDate).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Qe(t.controlNumber),className:"p-1 text-green-600 hover:text-green-700",title:"Save changes",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(null),className:"p-1 text-gray-600 hover:text-gray-700",title:"Cancel",children:e.jsx(oe,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ze(t.controlNumber),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit card",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Xe(t.controlNumber),className:"p-1 text-red-600 hover:text-red-700",title:"Delete card",children:e.jsx(me,{className:"h-4 w-4"})})]})})})]},L)})})]})})]}),y==="debug"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Database Debugger"})]}),e.jsx("p",{className:"text-gray-600",children:"Use this tool to analyze the database and troubleshoot card lookup issues."}),e.jsx(Ss,{})]}),y==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Admin Settings"}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change your admin password for security"})]}),e.jsx("button",{onClick:()=>k(!f),className:"light-button-primary",children:"Change Password"})]}),f&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("form",{onSubmit:qe,className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:R.currentPassword,onChange:t=>F({...R,currentPassword:t.target.value}),className:"light-input",placeholder:"Enter current password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:R.newPassword,onChange:t=>F({...R,newPassword:t.target.value}),className:"light-input",placeholder:"Enter new password (min 8 characters)",minLength:8,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:R.confirmPassword,onChange:t=>F({...R,confirmPassword:t.target.value}),className:"light-input",placeholder:"Confirm new password",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:"Update Password"}),e.jsx("button",{type:"button",onClick:()=>{k(!1),F({currentPassword:"",newPassword:"",confirmPassword:""})},className:"light-button-secondary",children:"Cancel"})]})]})})]})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Version:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"MOCARDS v3.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Environment:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Production"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Login:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:new Date().toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Admin Username:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:O.username})]})]})]})}),e.jsx(Rs,{})]})]})}),d.showModal&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:d.editingPerk?"Edit Perk":"Create New Perk"}),e.jsx("button",{onClick:()=>p({...d,showModal:!1}),className:"text-gray-500 hover:text-gray-700",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),Be()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("select",{value:d.form.type,onChange:t=>p({...d,form:{...d.form,type:t.target.value}}),className:"light-select",children:Je.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:d.form.name,onChange:t=>p({...d,form:{...d.form,name:t.target.value}}),className:"light-input",placeholder:"e.g., Free Dental Cleaning",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:d.form.description,onChange:t=>p({...d,form:{...d.form,description:t.target.value}}),className:"light-input",placeholder:"Describe this perk...",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value (‚Ç± PHP)"}),e.jsx("input",{type:"number",min:"0",max:"10000",value:d.form.value,onChange:t=>p({...d,form:{...d.form,value:parseInt(t.target.value)||0}}),className:"light-input",placeholder:"800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Days"}),e.jsx("input",{type:"number",min:"1",value:d.form.validFor,onChange:t=>p({...d,form:{...d.form,validFor:parseInt(t.target.value)||365}}),className:"light-input",placeholder:"365"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.form.isActive,onChange:t=>p({...d,form:{...d.form,isActive:t.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.form.requiresApproval,onChange:t=>p({...d,form:{...d.form,requiresApproval:t.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requires Approval"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:d.editingPerk?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>p({...d,showModal:!1}),className:"light-button-secondary",children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Existing Perks"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Me.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded ${t.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>ze(t),className:"text-blue-600 hover:text-blue-800",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>He(t),className:"text-red-600 hover:text-red-800",children:e.jsx(me,{className:"h-4 w-4"})})]})]},t.id))})]})]})})]})}export{$s as AdminPortalView};
