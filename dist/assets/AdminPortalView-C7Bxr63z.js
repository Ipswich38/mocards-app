const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DNy8TF7k.js","assets/vendor-N--QU9DW.js","assets/charts-sad3owxz.js","assets/icons-BvDCEL-g.js","assets/database-BUiByx9r.js","assets/index-DNpou-oB.css"])))=>i.map(i=>d[i]);
import{j as e,_ as Te,s as le,u as ms,P as xe,d as se,e as Y,A as xs,t as V,b as k,a as I,f as us}from"./index-DNy8TF7k.js";import{r as c}from"./charts-sad3owxz.js";import{y as de,R as Fe,r as oe,X as Q,Z as Ue,z as hs,t as Ce,F as we,x as gs,J as Ge,b as ke,a as ce,S as ye,U as ps,K as ne,q as ue,N as _e,O as js,Q as qe,P as $e,p as Ns,v as he,w as ge,C as Me,V as bs,Y as fs,u as Le,_ as vs,E as ys}from"./icons-BvDCEL-g.js";import{u as Cs,b as ae,c as $,d as te,g as ws,a as ks}from"./data-D3aew1qP.js";import"./vendor-N--QU9DW.js";import"./database-BUiByx9r.js";const Oe=[{code:"01",name:"Ilocos Region (Region 1)"},{code:"02",name:"Cagayan Valley (Region 2)"},{code:"03",name:"Central Luzon (Region 3)"},{code:"4A",name:"Calabarzon (Region 4A)"},{code:"4B",name:"Mimaropa (Region 4B)"},{code:"05",name:"Bicol Region (Region 5)"},{code:"06",name:"Western Visayas (Region 6)"},{code:"07",name:"Central Visayas (Region 7)"},{code:"08",name:"Eastern Visayas (Region 8)"},{code:"09",name:"Zamboanga Peninsula (Region 9)"},{code:"10",name:"Northern Mindanao (Region 10)"},{code:"11",name:"Davao Region (Region 11)"},{code:"12",name:"SOCCSKSARGEN (Region 12)"},{code:"13",name:"Caraga (Region 13)"},{code:"NCR",name:"National Capital Region (NCR)"},{code:"CAR",name:"Cordillera Administrative Region (CAR)"},{code:"BARMM",name:"Bangsamoro Autonomous Region in Muslim Mindanao"}],Ss=["CVT001","CVT002","CVT003","CVT004","CVT005","BTG001","BTG002","BTG003","BTG004","BTG005","LAG001","LAG002","LAG003","LAG004","LAG005","NCR001","NCR002","NCR003","NCR004","NCR005","Custom"];function As({onSuccess:A}){const[E,u]=c.useState(!1),[a,N]=c.useState({quantity:1,region:"",areaCode:"",customAreaCode:"",clinicId:"",perksTotal:10,customPerkName:"",useCustomPerk:!1}),[b,B]=c.useState([]),[i,h]=c.useState([]),[p,f]=c.useState("checking"),[m,g]=c.useState({isGenerating:!1,progress:0,total:0,message:"",completed:!1}),v=async()=>{try{f("checking");const{supabase:t}=await Te(async()=>{const{supabase:S}=await import("./index-DNy8TF7k.js").then(F=>F.g);return{supabase:S}},__vite__mapDeps([0,1,2,3,4,5])),{error:z}=await t.from("cards").select("count").limit(1);if(z){console.error("âŒ Database connection test failed:",z),f("error");return}console.log("âœ… Database connection successful"),f("connected");const{data:P,error:w}=await t.from("clinics").select("id, name, code, region").eq("is_active",!0);w?console.log("âš ï¸ Clinics data not available:",w):P&&(B(P),console.log("âœ… Loaded",P.length,"clinics")),h([{id:"1",name:"Free Dental Cleaning",description:"Complete professional dental cleaning",value:1500,isActive:!0},{id:"2",name:"Free Consultation",description:"General dental consultation",value:800,isActive:!0},{id:"3",name:"Dental X-Ray",description:"Digital dental x-ray",value:1200,isActive:!0},{id:"4",name:"20% Treatment Discount",description:"20% off any treatment",value:20,isActive:!0},{id:"5",name:"Free Fluoride Treatment",description:"Fluoride application",value:600,isActive:!0}])}catch(t){console.error("ğŸ’¥ Connection and data loading failed:",t),f("error")}};c.useEffect(()=>{v()},[]);const O=async()=>{if(!a.region){console.log("Validation failed: No region selected");return}if(a.areaCode==="Custom"&&!a.customAreaCode?.trim()){console.log("Validation failed: Custom area code required but not provided");return}if(a.useCustomPerk&&!a.customPerkName?.trim()){console.log("Validation failed: Custom perk name required but not provided");return}console.log("âœ… Validation passed, starting enterprise card generation...");const t=a.quantity,z=a.areaCode==="Custom"?a.customAreaCode:a.areaCode,P=a.clinicId?parseInt(a.clinicId):null;g({isGenerating:!0,progress:0,total:t,message:"ğŸš€ Initializing enterprise card generation...",completed:!1});try{const{supabase:w}=await Te(async()=>{const{supabase:d}=await import("./index-DNy8TF7k.js").then(j=>j.g);return{supabase:d}},__vite__mapDeps([0,1,2,3,4,5])),S=`BATCH_${a.region}_${Date.now()}`;g(d=>({...d,message:"ğŸ­ Using enterprise bulk generation function..."})),console.log("ğŸ”§ Attempting enterprise bulk generation...");const{data:F,error:me}=await w.rpc("bulk_generate_cards",{p_quantity:t,p_clinic_id:P,p_batch_name:S});if(me){console.log("âŒ Enterprise function failed, falling back to manual generation:",me),g(C=>({...C,message:"ğŸ”„ Using fallback generation method..."}));const d=[];for(let C=0;C<t;C++)d.push({clinic_id:P,perks_total:a.perksTotal,batch_id:S,metadata:{generated_at:new Date().toISOString(),region:a.region,area_code:z||"GENERAL",clinic_id:P,perks_configured:a.perksTotal,custom_perk:a.useCustomPerk?a.customPerkName:null,generator_version:"2.2_fallback"}});const j=50;let T=0;for(let C=0;C<d.length;C+=j){const D=d.slice(C,C+j),X=Math.min(C+j,t);g(H=>({...H,progress:T,message:`ğŸ“ Creating cards ${T+1} to ${X}...`}));const{error:Z}=await w.from("cards").insert(D);if(Z)throw new Error(`âŒ Batch insertion failed: ${Z.message}`);T+=D.length,t>50&&await new Promise(H=>setTimeout(H,100)),g(H=>({...H,progress:T,message:T===t?"âœ… Finalizing card generation...":`ğŸ“ Creating cards ${T+1} to ${Math.min(T+j,t)}...`}))}console.log("âœ… Manual generation completed successfully")}else{console.log("âœ… Enterprise bulk generation successful:",F);const d=Math.min(t,10);for(let j=0;j<=d;j++){const T=Math.floor(j/d*t);g(C=>({...C,progress:T,message:j===d?"âœ… Enterprise generation completed!":`ğŸ­ Enterprise generation: ${Math.round(j/d*100)}%`})),j<d&&await new Promise(C=>setTimeout(C,200))}}console.log(`ğŸ¯ Generation complete! Batch ID: ${S}`),console.log("ğŸ” Verifying card generation...");const{data:pe}=await w.from("cards").select("id").eq("batch_id",S),M=pe?.length||0;if(console.log(`ğŸ“Š Verification: Expected ${t}, Found ${M} cards`),M!==t&&console.warn(`âš ï¸ Generation mismatch! Expected: ${t}, Actual: ${M}`),A){console.log("ğŸ”„ Refreshing dashboard data...");try{await A(),console.log("âœ… Dashboard data refreshed successfully")}catch(d){console.error("âŒ Failed to refresh dashboard data:",d)}}g({isGenerating:!1,progress:t,total:t,message:`ğŸ‰ Generated ${M}/${t} cards â€¢ Batch: ${S} â€¢ Dashboard refreshed!`,completed:!0}),setTimeout(()=>{g(d=>({...d,completed:!1})),u(!1)},4e3)}catch(w){console.error("ğŸ’¥ Card generation failed:",w),g({isGenerating:!1,progress:0,total:0,message:`âŒ Generation failed: ${w.message}`,completed:!1}),setTimeout(()=>{g(S=>({...S,message:"",completed:!1}))},5e3)}},l=()=>{a.quantity>0&&a.quantity<=1e4&&O()};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-10 w-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Card Generator Pro"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Generate unlimited MOC cards with enterprise-grade reliability"}),e.jsxs("div",{className:"mt-2 flex items-center justify-center space-x-2",children:[p==="checking"&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-blue-100 text-sm",children:"Testing database connection..."})]}),p==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-green-100 text-sm",children:"Database connected"})]}),p==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"text-red-200 text-sm",children:"Database connection failed"}),e.jsx("button",{onClick:v,className:"text-white underline hover:text-blue-100 ml-2",children:"Retry"})]})]})]}),e.jsxs("button",{onClick:()=>u(!0),disabled:p!=="connected",className:`rounded-2xl px-8 py-4 font-bold text-lg transition-all transform shadow-xl ${p==="connected"?"bg-white text-blue-600 hover:bg-gray-50 hover:scale-105":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"}`,children:[e.jsx(Ue,{className:"h-6 w-6 mr-3 inline"}),"Generate Cards Now"]})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:!m.isGenerating&&!m.completed?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Generate Cards"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 rounded-full p-2",children:e.jsx(Q,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsx(de,{className:"h-4 w-4 inline mr-2"}),"Select Quantity"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[1,500,1e3].map(t=>e.jsxs("button",{onClick:()=>N({...a,quantity:t}),className:`p-4 rounded-xl border-2 font-medium transition-all ${a.quantity===t?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[t," Card",t>1?"s":""]},t))}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",max:"10000",placeholder:"Custom quantity (1-10000)",value:a.quantity===1||a.quantity===500||a.quantity===1e3?"":a.quantity,onChange:t=>N({...a,quantity:parseInt(t.target.value)||1}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(hs,{className:"h-4 w-4 inline mr-2"}),"Region *"]}),e.jsxs("select",{value:a.region,onChange:t=>N({...a,region:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Region"}),Oe.map(t=>e.jsx("option",{value:t.code,children:t.name},t.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ce,{className:"h-4 w-4 inline mr-2"}),"Area Code *"]}),e.jsxs("select",{value:a.areaCode,onChange:t=>N({...a,areaCode:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!a.region,children:[e.jsx("option",{value:"",children:"Select Area Code"}),Ss.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.areaCode==="Custom"&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",placeholder:"Enter custom area code (e.g., XYZ001)",value:a.customAreaCode,onChange:t=>N({...a,customAreaCode:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(we,{className:"h-4 w-4 inline mr-2"}),"Clinic Assignment (Optional)"]}),e.jsxs("select",{value:a.clinicId,onChange:t=>N({...a,clinicId:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No specific clinic (general pool)"}),b.map(t=>e.jsxs("option",{value:t.id.toString(),children:[t.name," (",t.code,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(gs,{className:"h-4 w-4 inline mr-2"}),"Perks per Card"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:a.perksTotal,onChange:t=>N({...a,perksTotal:parseInt(t.target.value)||1}),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"perks per card"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.useCustomPerk,onChange:t=>N({...a,useCustomPerk:t.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Add custom perk name"})]}),a.useCustomPerk&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("select",{value:a.customPerkName,onChange:t=>N({...a,customPerkName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select or type custom perk..."}),e.jsx("option",{value:"Free Teeth Whitening",children:"Free Teeth Whitening"}),e.jsx("option",{value:"Free Orthodontic Consultation",children:"Free Orthodontic Consultation"}),e.jsx("option",{value:"Free Oral Surgery Consultation",children:"Free Oral Surgery Consultation"}),e.jsx("option",{value:"Free Periodontal Treatment",children:"Free Periodontal Treatment"}),e.jsx("option",{value:"Free Dental Implant Consultation",children:"Free Dental Implant Consultation"}),e.jsx("option",{value:"Free Wisdom Tooth Extraction",children:"Free Wisdom Tooth Extraction"}),e.jsx("option",{value:"Free Root Canal Treatment",children:"Free Root Canal Treatment"}),e.jsx("option",{value:"Free Dental Crown",children:"Free Dental Crown"}),e.jsx("option",{value:"Free Denture Consultation",children:"Free Denture Consultation"}),e.jsx("option",{value:"Custom",children:"Custom (type your own)"})]}),a.customPerkName==="Custom"&&e.jsx("input",{type:"text",placeholder:"Enter custom perk name...",value:"",onChange:t=>N({...a,customPerkName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:a.useCustomPerk&&a.customPerkName?"Custom Perk + Default Perks:":"Available Default Perks:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[a.useCustomPerk&&a.customPerkName&&a.customPerkName!=="Custom"&&e.jsxs("div",{className:"text-blue-600 font-medium",children:["â€¢ ",a.customPerkName," (Custom)"]}),i.slice(0,3).map(t=>e.jsxs("div",{children:["â€¢ ",t.name," (â‚±",t.value,")"]},t.id)),i.length>3&&e.jsxs("div",{children:["â€¢ And ",i.length-3," more..."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Card Configuration:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Control Number: MOC00000001, MOC00000002..."}),e.jsxs("li",{children:["â€¢ Region: ",a.region?Oe.find(t=>t.code===a.region)?.name:"Not selected"]}),e.jsxs("li",{children:["â€¢ Area Code: ",a.areaCode==="Custom"?a.customAreaCode||"Custom (not set)":a.areaCode||"GENERAL"]}),e.jsxs("li",{children:["â€¢ Clinic: ",a.clinicId?b.find(t=>t.id.toString()===a.clinicId)?.name:"General pool"]}),e.jsxs("li",{children:["â€¢ Perks: ",a.perksTotal," per card",a.useCustomPerk&&a.customPerkName?` + ${a.customPerkName}`:""]}),e.jsx("li",{children:"â€¢ Status: Inactive (ready for activation)"}),e.jsx("li",{children:"â€¢ Expires: December 31, 2025"})]})]}),e.jsxs("button",{onClick:l,disabled:!a.region||a.areaCode==="Custom"&&!a.customAreaCode||a.useCustomPerk&&!a.customPerkName.trim(),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl py-4 font-bold text-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:["Generate ",a.quantity," Card",a.quantity>1?"s":""," ğŸš€"]})]})]}):m.completed?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(oe,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:m.message}),e.jsx("div",{className:"text-sm text-gray-500",children:"Closing automatically in 3 seconds..."})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(Fe,{className:"h-8 w-8 text-blue-600 animate-spin"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Generating Cards"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m.message}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-500",style:{width:`${m.progress/m.total*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[m.progress," generated"]}),e.jsxs("span",{children:[m.total," total"]})]}),e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[Math.round(m.progress/m.total*100),"% Complete"]})]})]})})})]})}const Ps=900*1e3,K="mocards_auth_session",ie="mocards_last_activity",Es=()=>{const[A,E]=c.useState(!1),[u,a]=c.useState(null),N=c.useCallback(()=>{const h=Date.now();if(localStorage.setItem(ie,h.toString()),u){const p={...u,lastActivity:h};a(p),localStorage.setItem(K,JSON.stringify(p))}},[u]),b=c.useCallback(h=>Date.now()-h.lastActivity<Ps,[]),B=c.useCallback((h,p)=>{const f=Date.now(),m={type:h,username:p.username||p.code,clinicId:p.id,clinicCode:p.code,loginTime:f,lastActivity:f};a(m),E(!0),localStorage.setItem(K,JSON.stringify(m)),localStorage.setItem(ie,f.toString()),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"login",user:m}}))},[]),i=c.useCallback(()=>{a(null),E(!1),localStorage.removeItem(K),localStorage.removeItem(ie),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{type:"logout"}}))},[]);return c.useEffect(()=>{(()=>{try{const m=localStorage.getItem(K);if(m){const g=JSON.parse(m);b(g)?(a(g),E(!0),N()):(localStorage.removeItem(K),localStorage.removeItem(ie))}}catch(m){console.error("Error checking session:",m),localStorage.removeItem(K),localStorage.removeItem(ie)}})();const p=m=>{const{type:g,user:v}=m.detail;g==="login"&&v?(a(v),E(!0)):g==="logout"&&(a(null),E(!1))},f=m=>{if(m.key===K)if(m.newValue)try{const g=JSON.parse(m.newValue);b(g)&&(a(g),E(!0))}catch(g){console.error("Error parsing stored user data:",g)}else a(null),E(!1)};return window.addEventListener("auth-state-change",p),window.addEventListener("storage",f),()=>{window.removeEventListener("auth-state-change",p),window.removeEventListener("storage",f)}},[b,N]),c.useEffect(()=>{if(!A||!u)return;const p=setInterval(()=>{u&&!b(u)&&i()},60*1e3);return()=>clearInterval(p)},[A,u,b,i]),c.useEffect(()=>{if(!A)return;const h=["mousedown","mousemove","keypress","scroll","touchstart","click"],p=()=>{N()};let f;const m=()=>{clearTimeout(f),f=setTimeout(p,1e3)};return h.forEach(g=>{document.addEventListener(g,m,!0)}),()=>{clearTimeout(f),h.forEach(g=>{document.removeEventListener(g,m,!0)})}},[A,N]),{isAuthenticated:A,user:u,login:B,logout:i,updateActivity:N}};function Ds(){const[A,E]=c.useState(!1),[u,a]=c.useState(null),[N,b]=c.useState(null),B=async()=>{E(!0),b(null),a(null);try{console.log("[DEBUG] Starting database analysis...");const{data:i,error:h}=await le.from("information_schema.columns").select("*").eq("table_name","cards").eq("table_schema","public"),{data:p,error:f}=await le.from("cards").select("*").limit(10),{count:m,error:g}=await le.from("cards").select("*",{count:"exact",head:!0}),{data:v,error:O}=await le.from("cards").select("*").limit(5),l={tableStructure:{data:i,error:h},sampleCards:{data:p,error:f},totalCards:{count:m,error:g},testSearch:{data:v,error:O},timestamp:new Date().toISOString()};console.log("[DEBUG] Complete database analysis:",l),a(l)}catch(i){const h=i instanceof Error?i.message:"Unknown error";console.error("[DEBUG] Database check failed:",i),b(h)}finally{E(!1)}};return e.jsxs("div",{className:"light-card p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(Ge,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Database Debugger"})]}),e.jsx("button",{onClick:B,disabled:A,className:"light-button-primary flex items-center space-x-2 mb-6",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing Database..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Run Database Analysis"})]})}),N&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Database Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:N})]}),u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Database Analysis Complete"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Cards Table Structure"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:u.tableStructure.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",u.tableStructure.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Found ",u.tableStructure.data?.length||0," columns in cards table"]}),u.tableStructure.data&&u.tableStructure.data.length>0&&e.jsx("div",{className:"text-xs font-mono",children:u.tableStructure.data.map((i,h)=>e.jsxs("div",{className:"text-gray-700",children:[i.column_name,": ",i.data_type]},h))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Total Cards"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:u.totalCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",u.totalCards.error.message]}):e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[u.totalCards.count," cards"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Sample Cards Data"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto",children:u.sampleCards.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",u.sampleCards.error.message]}):e.jsx("pre",{className:"text-xs font-mono text-gray-700 whitespace-pre-wrap",children:JSON.stringify(u.sampleCards.data,null,2)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Basic Query Test"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:u.testSearch.error?e.jsxs("p",{className:"text-red-600",children:["Error: ",u.testSearch.error.message]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Query returned ",u.testSearch.data?.length||0," cards"]}),u.testSearch.data&&u.testSearch.data.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"First card control_number:"}),e.jsx("p",{className:"font-mono text-blue-600",children:u.testSearch.data[0]?.control_number||"No control_number field"})]})]})})]}),e.jsxs("details",{className:"border border-gray-200 rounded-lg",children:[e.jsx("summary",{className:"p-4 cursor-pointer font-medium",children:"View Raw Results"}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsx("pre",{className:"text-xs font-mono text-gray-600 whitespace-pre-wrap overflow-x-auto",children:JSON.stringify(u,null,2)})})]})]})]})}function $s(){const{isAuthenticated:A,login:E,logout:u}=Es();Cs({enabled:!0,showNotifications:!0});const[a,N]=c.useState({username:"",password:""}),[b,B]=c.useState("generator"),[i,h]=c.useState({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}}),[p,f]=c.useState(""),[m,g]=c.useState(null),[v,O]=c.useState({clinicId:"",startRange:"",endRange:""}),[l,t]=c.useState({name:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",address:"",adminClinic:"",email:"",contactNumber:"",password:"",username:""}),[z,P]=c.useState(!1),[w,S]=c.useState(null),[F,me]=c.useState([]),[pe,M]=c.useState(!1),[d,j]=c.useState({cardControlNumber:"",patientName:"",patientEmail:"",patientPhone:"",preferredDate:"",preferredTime:"",serviceType:"",perkRequested:"",clinicId:"",adminNotes:""}),[T,C]=c.useState(!1),[D,X]=c.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[Z,H]=c.useState({username:"admin",password:"admin123"}),[ee,Se]=c.useState("cards"),[Ve,je]=c.useState(null),[W,Be]=c.useState(""),[_,Ne]=c.useState([]),[U,be]=c.useState([]),[ze,Ae]=c.useState([]),[Xe,Pe]=c.useState(!0),[fe,He]=c.useState("all"),[ve,We]=c.useState(null),[y,J]=c.useState({fullName:"",status:"inactive",perksTotal:5,perksUsed:0,clinicId:"",expiryDate:"",notes:""}),[q,re]=c.useState({name:"",region:"",plan:"starter",address:"",adminClinic:"",email:"",contactNumber:"",password:""}),{addToast:x}=ms();c.useEffect(()=>{(async()=>await te.initializeDefaults())()},[]),c.useEffect(()=>{const s=async()=>{try{Pe(!0);const[n,o,r]=await Promise.all([ae.getAll(),$.getAll(),te.getAll()]);Ne(n),be(o),Ae(r)}catch(n){console.error("Failed to load data:",n),x(k("Error","Failed to load data"))}finally{Pe(!1)}};if(A){s();const n=le.channel("admin-cards-changes").on("postgres_changes",{event:"*",schema:"public",table:"cards"},async r=>{console.log("[Admin] Real-time cards change detected:",r);try{const R=await ae.getAll();Ne(R)}catch(R){console.error("Failed to reload cards after real-time update:",R)}}).subscribe(),o=le.channel("admin-clinics-changes").on("postgres_changes",{event:"*",schema:"public",table:"clinics"},async r=>{console.log("[Admin] Real-time clinics change detected:",r);try{const R=await $.getAll();be(R)}catch(R){console.error("Failed to reload clinics after real-time update:",R)}}).subscribe();return()=>{n.unsubscribe(),o.unsubscribe()}}},[A]);const G=async()=>{try{const[s,n,o]=await Promise.all([ae.getAll(),$.getAll(),te.getAll()]);Ne(s),be(n),Ae(o)}catch(s){console.error("Failed to reload data:",s),x(k("Error","Failed to reload data"))}},Je=s=>{s.preventDefault(),a.username==="admin"&&a.password==="admin123"?(E("admin",{username:a.username}),x(I("Welcome","Admin access granted"))):x(k("Login Failed","Invalid credentials"))},Ye=s=>{if(s.preventDefault(),D.currentPassword!==Z.password){x(k("Invalid Password","Current password is incorrect"));return}if(D.newPassword.length<8){x(k("Password Too Short","New password must be at least 8 characters long"));return}if(D.newPassword!==D.confirmPassword){x(k("Passwords Do Not Match","Please confirm your new password correctly"));return}H({...Z,password:D.newPassword}),X({currentPassword:"",newPassword:"",confirmPassword:""}),C(!1),x(I("Password Changed","Admin password has been updated successfully"))},Ke=async()=>{if(!i.form.name||!i.form.description){x(V("Missing Fields","Please fill all required fields"));return}i.editingPerk?(await te.update(i.editingPerk.id,i.form),x(I("Perk Updated",`Updated ${i.form.name}`))):(await te.create(i.form),x(I("Perk Created",`Created ${i.form.name}`))),await G(),h({showModal:!1,editingPerk:null,form:{type:"dental_cleaning",name:"",description:"",value:800,isActive:!0,validFor:365,requiresApproval:!1}})},Qe=s=>{h({showModal:!0,editingPerk:s,form:{type:s.type,name:s.name,description:s.description,value:s.value,isActive:s.isActive,validFor:s.validFor,requiresApproval:s.requiresApproval}})},Ze=async s=>{await te.delete(s.id),x(I("Perk Deleted",`Deleted ${s.name}`)),await G()},es=[{value:"dental_cleaning",label:"Dental Cleaning"},{value:"consultation",label:"Consultation"},{value:"xray",label:"X-Ray"},{value:"treatment",label:"Treatment"},{value:"discount",label:"Discount"},{value:"extraction",label:"Tooth Extraction (Bunot)"},{value:"filling",label:"Tooth Filling (Pasta)"},{value:"fluoride",label:"Fluoride Treatment"},{value:"checkup",label:"Checkup/Unlimited"}],ss=()=>{if(!p.trim())return;const s=_.find(n=>n.controlNumber===p);g(s||null),s||x(V("Card Not Found","No card found with this number"))},as=async()=>{if(!m)return;const s=m.status==="active"?"inactive":"active";await ae.updateStatus(m.controlNumber,s)?(g({...m,status:s}),x(I("Status Updated",`Card is now ${s}`)),await G()):x(k("Update Failed","Failed to update card status"))},ts=async()=>{if(!v.clinicId||!v.startRange||!v.endRange){x(V("Missing Fields","Please fill all fields"));return}const s=await $.getById(v.clinicId);if(!s){x(k("Invalid Clinic","Clinic not found"));return}const o=_.filter(L=>L.controlNumber>=v.startRange&&L.controlNumber<=v.endRange&&!L.clinicId);if(o.length===0){x(V("No Cards","No unassigned cards found in this range"));return}const r=await $.getAssignedCardsCount(s.id),R=Y[s.plan];if(r+o.length>R){x(k("Plan Limit Exceeded",`This would exceed the ${s.plan} plan limit of ${R} cards. Current: ${r}`));return}await ae.assignToClinic(o.map(L=>L.controlNumber),s.id)?(x(I("Cards Assigned",`Assigned ${o.length} cards to ${s.name}`)),O({clinicId:"",startRange:"",endRange:""}),await G()):x(k("Assignment Failed","Failed to assign cards to clinic"))},ls=async()=>{if(!l.name||!l.username||!l.region||!l.plan||!l.areaCode||!l.password){x(V("Missing Required Fields","Please fill all required fields including username"));return}let s=l.areaCode;l.areaCode==="Custom"&&l.customAreaCode&&(s=l.customAreaCode);const n=await ws(s);try{const o={name:l.name,username:l.username,region:l.region,plan:l.plan,code:n,address:l.address||void 0,adminClinic:l.adminClinic||void 0,email:l.email||void 0,contactNumber:l.contactNumber||void 0,password:l.password,subscriptionPrice:se[l.plan]},r=await $.create(o);x(I("Clinic Created",`${r.name} created successfully with code ${r.code}`)),t({name:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",address:"",adminClinic:"",email:"",contactNumber:"",password:"",username:""}),await G()}catch{x(k("Creation Failed","Failed to create clinic"))}},Ee=s=>{S(s),t({name:s.name,region:s.region,plan:s.plan,areaCode:s.code.substring(0,3),customAreaCode:"",address:s.address||"",adminClinic:s.adminClinic||"",email:s.email||"",contactNumber:s.contactNumber||"",password:"",username:s.username||""}),P(!0)},De=async()=>{if(w){if(!l.name||!l.region||!l.plan){x(V("Missing Required Fields","Please fill all required fields"));return}try{const s={name:l.name,username:l.username,region:l.region,plan:l.plan,address:l.address||void 0,adminClinic:l.adminClinic||void 0,email:l.email||void 0,contactNumber:l.contactNumber||void 0,maxCards:Y[l.plan],updatedAt:new Date().toISOString()};l.password.trim()&&(s.password=l.password),await $.update(w.id,s)?(x(I("Clinic Updated",`${l.name} has been updated successfully`)),P(!1),S(null),t({name:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",password:"",address:"",adminClinic:"",email:"",contactNumber:"",username:""})):x(k("Update Failed","Could not update clinic"))}catch{x(k("Update Failed","Failed to update clinic"))}}},Re=async s=>{const n=await $.getById(s);if(!n)return;const o=await $.getAssignedCardsCount(s);if(o>0){x(V("Cannot Delete",`This clinic has ${o} assigned cards. Please reassign them first.`));return}if(confirm(`Are you sure you want to delete "${n.name}"? This action cannot be undone.`)){const r=await $.delete(s);x(r?I("Clinic Deleted",`${n.name} has been deleted`):k("Delete Failed","Could not delete clinic"))}},rs=async s=>{const n=new Date().toISOString(),o=await ks.create({cardControlNumber:s.cardControlNumber,clinicId:s.clinicId,patientName:s.patientName,patientEmail:s.patientEmail,patientPhone:s.patientPhone,preferredDate:s.preferredDate,preferredTime:s.preferredTime,status:"pending",serviceType:s.serviceType,notes:s.adminNotes,createdAt:n,updatedAt:n});me(r=>[...r,o]),x(I("Manual Appointment Created","Appointment request sent to clinic for processing"))},ns=s=>{const n=_.find(o=>o.controlNumber===s);n&&(J({fullName:n.fullName,status:n.status,perksTotal:n.perksTotal,perksUsed:n.perksUsed,clinicId:n.clinicId,expiryDate:n.expiryDate,notes:n.notes||""}),je(s))},is=async s=>{const n=_.find(o=>o.controlNumber===s);if(n)try{const o={fullName:y.fullName,status:y.status,perksTotal:y.perksTotal,perksUsed:y.perksUsed,clinicId:y.clinicId,expiryDate:y.expiryDate,notes:y.notes,updatedAt:new Date().toISOString()};if(await us.cards.update(n.id,o))je(null),x(I("Card Updated",`Updated ${s} successfully`)),await G();else throw new Error("Failed to save to database")}catch{x(k("Update Failed","Failed to update card"))}},cs=async s=>{if(window.confirm(`Are you sure you want to delete card ${s}? This action cannot be undone.`))try{await ae.delete(s)?(x(I("Card Deleted",`Card ${s} has been deleted`)),await G()):x(k("Delete Failed","Could not delete card"))}catch{x(k("Delete Failed","Could not delete card"))}},ds=[{id:"generator",label:"Generator",icon:ne,color:"emerald"},{id:"activation",label:"Activation",icon:Ue,color:"blue"},{id:"appointments",label:"Appointments",icon:ue,color:"rose"},{id:"clinic-management",label:"Manage Clinics",icon:we,color:"indigo"},{id:"endorsement",label:"Endorsement",icon:_e,color:"orange"},{id:"master-list",label:"Master List",icon:Ge,color:"purple"},{id:"debug",label:"Debug DB",icon:ce,color:"red"},{id:"settings",label:"Settings",icon:Ce,color:"gray"}];if(!A)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"light-card p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(ye,{className:"h-8 w-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Please authenticate to continue"})]}),e.jsxs("form",{onSubmit:Je,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:a.username,onChange:s=>N({...a,username:s.target.value}),className:"light-input",placeholder:"Enter admin username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:s=>N({...a,password:s.target.value}),className:"light-input",placeholder:"Enter admin password",required:!0})]}),e.jsx("button",{type:"submit",className:"light-button-primary w-full",children:"Access Admin Portal"})]})]})});const os=[{label:"Total Cards",value:_.length,icon:de,color:"blue"},{label:"Active Clinics",value:U.length,icon:ps,color:"green"},{label:"Active Cards",value:_.filter(s=>s.status==="active").length,icon:oe,color:"emerald"},{label:"Pending Cards",value:_.filter(s=>s.status==="inactive").length,icon:ce,color:"yellow"}];return Xe?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"light-card p-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin data..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-2xl flex items-center justify-center",children:e.jsx(ye,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Control Room"}),e.jsx("p",{className:"text-gray-600",children:"MOCARDS System Administration"})]})]}),e.jsxs("button",{onClick:u,className:"light-button-secondary flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:os.map((s,n)=>{const o=s.icon;return e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.label}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.value})]}),e.jsx("div",{className:`w-12 h-12 bg-${s.color}-100 rounded-2xl flex items-center justify-center`,children:e.jsx(o,{className:`h-6 w-6 text-${s.color}-600`})})]})},n)})}),e.jsx("div",{className:"light-card mb-6",children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-xl",children:ds.map(s=>{const n=s.icon,o=b===s.id;return e.jsxs("button",{onClick:()=>B(s.id),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg transition-all duration-200 ${o?"light-tab-active":"light-tab"}`,children:[e.jsx(n,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.id)})})})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[b==="generator"&&e.jsx(As,{onSuccess:G}),b==="activation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Activation"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:p,onChange:s=>f(s.target.value),className:"light-input",placeholder:"Enter control number to activate"})}),e.jsxs("button",{onClick:ss,className:"light-button-primary",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Search"]})]}),m&&e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:m.fullName}),e.jsx("p",{className:"text-gray-600",children:m.controlNumber})]}),e.jsx("span",{className:m.status==="active"?"status-active":"status-inactive",children:m.status})]}),e.jsxs("button",{onClick:as,className:"light-button-primary",children:[m.status==="active"?"Deactivate":"Activate"," Card"]})]})]}),b==="clinic-management"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manage Clinics"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive clinic management with subscription plans and monitoring"})]}),e.jsxs("button",{onClick:()=>{P(!z),S(null),t({name:"",region:"",plan:"starter",areaCode:"",customAreaCode:"",address:"",adminClinic:"",email:"",contactNumber:"",password:"",username:""})},className:"light-button-primary flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Add New Clinic"]})]}),z&&e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:w?`Edit Clinic: ${w.name}`:"Add New Clinic"}),e.jsx("button",{onClick:()=>{P(!1),S(null)},className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.name,onChange:s=>t({...l,name:s.target.value}),className:"light-input",placeholder:"Enter clinic name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.username,onChange:s=>t({...l,username:s.target.value}),className:"light-input",placeholder:"Enter clinic username for login"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Region ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.region,onChange:s=>t({...l,region:s.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Region"}),xe.map(s=>e.jsx("option",{value:s.code,children:s.name},s.code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subscription Plan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.plan,onChange:s=>t({...l,plan:s.target.value}),className:"light-select",children:[e.jsxs("option",{value:"starter",children:["Starter Plan - â‚±",se.starter,"/month (up to ",Y.starter," cards)"]}),e.jsxs("option",{value:"growth",children:["Growth Plan - â‚±",se.growth,"/month (up to ",Y.growth," cards)"]}),e.jsxs("option",{value:"pro",children:["Pro Plan - â‚±",se.pro,"/month (up to ",Y.pro," cards)"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Area Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.areaCode,onChange:s=>t({...l,areaCode:s.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Area Code"}),xs.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),l.areaCode==="Custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Area Code"}),e.jsx("input",{type:"text",value:l.customAreaCode,onChange:s=>t({...l,customAreaCode:s.target.value}),className:"light-input",placeholder:"Enter custom area code (e.g., XYZ001)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Clinic Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:l.password,onChange:s=>t({...l,password:s.target.value}),className:"light-input",placeholder:"Enter clinic login password"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address (Optional)"}),e.jsx("input",{type:"text",value:l.address,onChange:s=>t({...l,address:s.target.value}),className:"light-input",placeholder:"Enter clinic address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Contact (Optional)"}),e.jsx("input",{type:"text",value:l.adminClinic,onChange:s=>t({...l,adminClinic:s.target.value}),className:"light-input",placeholder:"Enter admin contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:l.email,onChange:s=>t({...l,email:s.target.value}),className:"light-input",placeholder:"Enter clinic email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Number (Optional)"}),e.jsx("input",{type:"tel",value:l.contactNumber,onChange:s=>t({...l,contactNumber:s.target.value}),className:"light-input",placeholder:"+63917123456"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl mt-6",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Subscription Summary"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[l.plan.charAt(0).toUpperCase()+l.plan.slice(1)," Plan:"]})," â‚±",se[l.plan]||0,"/month"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Card Limit:"})," Up to ",Y[l.plan]||0," cards"]}),e.jsx("p",{className:"text-blue-600 mt-2",children:"* Required fields must be filled. Optional fields can be updated later."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{P(!1),S(null)},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:w?De:ls,className:"light-button-primary",children:w?"Update Clinic":"Create Clinic Profile"})]})]})}),e.jsx("div",{className:"light-card",children:e.jsx("div",{className:"p-6",children:U.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(js,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clinics Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by adding your first clinic to the system"}),e.jsxs("button",{onClick:()=>P(!0),className:"light-button-primary flex items-center gap-2 mx-auto",children:[e.jsx(ne,{className:"h-4 w-4"}),"Add First Clinic"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-medium text-gray-900",children:"Clinic Details"}),e.jsx("th",{className:"text-left p-4 font-medium text-gray-900",children:"Plan & Usage"}),e.jsx("th",{className:"text-left p-4 font-medium text-gray-900",children:"Contact Info"}),e.jsx("th",{className:"text-left p-4 font-medium text-gray-900",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-medium text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:U.map(s=>{const n=_.filter(L=>L.clinicId===s.id),o=n.length,r=Y[s.plan],R=o/r*100,Ie=xe.find(L=>L.code===s.region)?.name||s.region;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600 font-mono",children:s.code}),e.jsx("div",{className:"text-sm text-gray-500",children:Ie})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.plan==="starter"?"bg-blue-100 text-blue-700":s.plan==="growth"?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700"}`,children:s.plan.toUpperCase()}),e.jsxs("span",{className:"text-sm text-gray-600",children:["â‚±",se[s.plan],"/mo"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Card Usage"}),e.jsxs("span",{className:"font-medium",children:[o,"/",r]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${R>=90?"bg-red-500":R>=70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(R,100)}%`}})})]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsx("span",{children:s.email})]}),s.contactNumber&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx($e,{className:"h-3 w-3"}),e.jsx("span",{children:s.contactNumber})]}),s.adminClinic&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ns,{className:"h-3 w-3"}),e.jsx("span",{children:s.adminClinic})]}),!s.email&&!s.contactNumber&&!s.adminClinic&&e.jsx("span",{className:"text-gray-400 italic",children:"No contact info"})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:"Active"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{Ee(s),P(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"Edit clinic",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Re(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Delete clinic",disabled:n.length>0,children:e.jsx(ge,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})})]}),b==="appointments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Appointment Status Monitor"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View all appointment requests and their processing status"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs("span",{children:[F.length," total requests"]})]}),e.jsxs("button",{onClick:()=>M(!0),className:"light-button-primary flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Create Manual Appointment"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:F.filter(s=>s.status==="pending").length})]}),e.jsx(Me,{className:"h-8 w-8 text-orange-600"})]})}),e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:F.filter(s=>s.status==="pending").length})]}),e.jsx(_e,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Accepted"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:F.filter(s=>s.status==="accepted").length})]}),e.jsx(oe,{className:"h-8 w-8 text-emerald-600"})]})}),e.jsx("div",{className:"light-stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:F.filter(s=>s.status==="rejected").length})]}),e.jsx(ce,{className:"h-8 w-8 text-red-600"})]})})]}),pe&&e.jsxs("div",{className:"light-card p-6 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Manual Appointment"})]}),e.jsx("button",{onClick:()=>M(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Control Number *"}),e.jsx("input",{type:"text",value:d.cardControlNumber,onChange:s=>j({...d,cardControlNumber:s.target.value}),className:"light-input",placeholder:"MOC-00000-XX-XXX000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic *"}),e.jsxs("select",{value:d.clinicId,onChange:s=>j({...d,clinicId:s.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Clinic"}),U.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.code,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Patient Name *"}),e.jsx("input",{type:"text",value:d.patientName,onChange:s=>j({...d,patientName:s.target.value}),className:"light-input",placeholder:"Patient's full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:d.patientEmail,onChange:s=>j({...d,patientEmail:s.target.value}),className:"light-input",placeholder:"patient@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:d.patientPhone,onChange:s=>j({...d,patientPhone:s.target.value}),className:"light-input",placeholder:"+63917123456"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Service Type *"}),e.jsx("input",{type:"text",value:d.serviceType,onChange:s=>j({...d,serviceType:s.target.value}),className:"light-input",placeholder:"e.g., Dental Cleaning, Consultation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Date *"}),e.jsx("input",{type:"date",value:d.preferredDate,onChange:s=>j({...d,preferredDate:s.target.value}),min:new Date().toISOString().split("T")[0],className:"light-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Time *"}),e.jsx("input",{type:"time",value:d.preferredTime,onChange:s=>j({...d,preferredTime:s.target.value}),className:"light-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Perk Requested"}),e.jsx("input",{type:"text",value:d.perkRequested,onChange:s=>j({...d,perkRequested:s.target.value}),className:"light-input",placeholder:"e.g., Free Dental Cleaning"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Notes"}),e.jsx("textarea",{value:d.adminNotes,onChange:s=>j({...d,adminNotes:s.target.value}),rows:3,className:"light-input resize-none",placeholder:"Any additional notes or instructions..."})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 mt-6",children:[e.jsxs("button",{onClick:()=>{if(!d.cardControlNumber||!d.patientName||!d.patientEmail||!d.preferredDate||!d.preferredTime||!d.serviceType||!d.clinicId){x(V("Missing Fields","Please fill in all required fields"));return}rs(d),j({cardControlNumber:"",patientName:"",patientEmail:"",patientPhone:"",preferredDate:"",preferredTime:"",serviceType:"",perkRequested:"",clinicId:"",adminNotes:""}),M(!1)},className:"light-button-primary flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"Send to Clinic"]}),e.jsx("button",{onClick:()=>M(!1),className:"light-button-secondary",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-4",children:F.length===0?e.jsxs("div",{className:"light-card p-8 text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Appointment Requests"}),e.jsx("p",{className:"text-gray-600",children:"When cardholders request appointments, they will appear here."})]}):F.map(s=>e.jsx("div",{className:"light-card p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-[#1A535C]"}),e.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:s.cardControlNumber})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="pending"?"bg-orange-100 text-orange-700":s.status==="accepted"?"bg-emerald-100 text-emerald-700":s.status==="rejected"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:s.status.replace(/_/g," ").toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.patientName}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:s.patientEmail})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:s.patientPhone})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(s.preferredDate).toLocaleDateString("en-PH")}),e.jsx(Me,{className:"h-4 w-4 ml-2"}),e.jsx("span",{children:s.preferredTime})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Service:"})," ",s.serviceType]}),s.perkRequested&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Perk:"})," ",s.perkRequested]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Clinic:"})," ",s.clinicName]})]})})]}),s.adminNotes&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Admin Notes:"})," ",s.adminNotes]})}),s.clinicNotes&&e.jsx("div",{className:"bg-green-50 p-3 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Clinic Response:"})," ",s.clinicNotes]})}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Requested: ",new Date(s.requestedAt).toLocaleString("en-PH")]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[e.jsxs("div",{children:["Sent to Clinic: ",new Date(s.forwardedAt).toLocaleString("en-PH")]}),s.processedAt&&e.jsxs("div",{children:["Processed: ",new Date(s.processedAt).toLocaleString("en-PH")]})]})})]})},s.id))})]}),b==="endorsement"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Card Endorsement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clinic"}),e.jsxs("select",{value:v.clinicId,onChange:s=>O({...v,clinicId:s.target.value}),className:"light-select",children:[e.jsx("option",{value:"",children:"Select Clinic"}),U.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.plan,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Range"}),e.jsx("input",{type:"text",value:v.startRange,onChange:s=>O({...v,startRange:s.target.value}),className:"light-input",placeholder:"MOC-00001-NCR-CVT001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Range"}),e.jsx("input",{type:"text",value:v.endRange,onChange:s=>O({...v,endRange:s.target.value}),className:"light-input",placeholder:"MOC-00100-NCR-CVT001"})]})]}),e.jsx("button",{onClick:ts,className:"light-button-primary",children:"Assign Cards to Clinic"})]}),b==="master-list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Data Management"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>Se("cards"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${ee==="cards"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(de,{className:"h-4 w-4 inline mr-2"}),"Cards"]}),e.jsxs("button",{onClick:()=>Se("clinics"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${ee==="clinics"?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(we,{className:"h-4 w-4 inline mr-2"}),"Clinics"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:W,onChange:s=>Be(s.target.value),placeholder:ee==="cards"?"Search cards by name or control number...":"Search clinics by name or code...",className:"light-input pl-10"})]}),ee==="cards"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:fe,onChange:s=>He(s.target.value),className:"light-select",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),ee==="cards"&&e.jsx("div",{className:"light-table",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"light-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4",children:"Control Number"}),e.jsx("th",{className:"text-left p-4",children:"Patient Name"}),e.jsx("th",{className:"text-left p-4",children:"Status"}),e.jsx("th",{className:"text-left p-4",children:"Clinic"}),e.jsx("th",{className:"text-left p-4",children:"Perks"}),e.jsx("th",{className:"text-left p-4",children:"Expiry"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:_.filter(s=>{const n=!W||s.fullName.toLowerCase().includes(W.toLowerCase())||s.controlNumber.toLowerCase().includes(W.toLowerCase()),o=fe==="all"||s.status===fe;return n&&o}).map(s=>{const n=U.find(r=>r.id===s.clinicId),o=Ve===s.controlNumber;return e.jsxs("tr",{className:"light-table-row",children:[e.jsx("td",{className:"p-4 font-mono text-sm",children:s.controlNumber}),e.jsx("td",{className:"p-4",children:o?e.jsx("input",{type:"text",value:y.fullName,onChange:r=>J({...y,fullName:r.target.value}),className:"light-input text-sm"}):s.fullName}),e.jsx("td",{className:"p-4",children:o?e.jsxs("select",{value:y.status,onChange:r=>J({...y,status:r.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("span",{className:s.status==="active"?"status-active":"status-inactive",children:s.status})}),e.jsx("td",{className:"p-4",children:o?e.jsxs("select",{value:y.clinicId,onChange:r=>J({...y,clinicId:r.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),U.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}):n?.name||"Unassigned"}),e.jsx("td",{className:"p-4",children:o?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",min:"0",value:y.perksUsed,onChange:r=>J({...y,perksUsed:parseInt(r.target.value)||0}),className:"light-input text-sm w-16"}),e.jsx("span",{className:"text-gray-500 self-center",children:"/"}),e.jsx("input",{type:"number",min:"1",value:y.perksTotal,onChange:r=>J({...y,perksTotal:parseInt(r.target.value)||1}),className:"light-input text-sm w-16"})]}):`${s.perksUsed}/${s.perksTotal}`}),e.jsx("td",{className:"p-4",children:o?e.jsx("input",{type:"date",value:y.expiryDate,onChange:r=>J({...y,expiryDate:r.target.value}),className:"light-input text-sm"}):new Date(s.expiryDate).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>is(s.controlNumber),className:"p-1 text-green-600 hover:text-green-700",title:"Save changes",children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>je(null),className:"p-1 text-gray-600 hover:text-gray-700",title:"Cancel",children:e.jsx(Q,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ns(s.controlNumber),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit card",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>cs(s.controlNumber),className:"p-1 text-red-600 hover:text-red-700",title:"Delete card",children:e.jsx(ge,{className:"h-4 w-4"})})]})})})]},s.controlNumber)})})]})}),ee==="clinics"&&e.jsx("div",{className:"light-table",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"light-table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4",children:"Name"}),e.jsx("th",{className:"text-left p-4",children:"Code"}),e.jsx("th",{className:"text-left p-4",children:"Region"}),e.jsx("th",{className:"text-left p-4",children:"Plan"}),e.jsx("th",{className:"text-left p-4",children:"Cards"}),e.jsx("th",{className:"text-left p-4",children:"Contact"}),e.jsx("th",{className:"text-left p-4",children:"Status"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:U.filter(s=>!W||s.name.toLowerCase().includes(W.toLowerCase())||s.code.toLowerCase().includes(W.toLowerCase())).map(s=>{const n=w?.id===s.id,o=_.filter(r=>r.clinicId===s.id);return e.jsxs("tr",{className:"light-table-row",children:[e.jsx("td",{className:"p-4",children:n?e.jsx("input",{type:"text",value:q.name,onChange:r=>re({...q,name:r.target.value}),className:"light-input text-sm"}):e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.address})]})}),e.jsx("td",{className:"p-4 font-mono text-sm",children:s.code}),e.jsx("td",{className:"p-4",children:n?e.jsxs("select",{value:q.region,onChange:r=>re({...q,region:r.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"",children:"Select Region"}),xe.map(r=>e.jsx("option",{value:r.code,children:r.name},r.code))]}):xe.find(r=>r.code===s.region)?.name||s.region}),e.jsx("td",{className:"p-4",children:n?e.jsxs("select",{value:q.plan,onChange:r=>re({...q,plan:r.target.value}),className:"light-select text-sm",children:[e.jsx("option",{value:"starter",children:"Starter"}),e.jsx("option",{value:"growth",children:"Growth"}),e.jsx("option",{value:"pro",children:"Pro"})]}):e.jsx("span",{className:`plan-${s.plan} capitalize`,children:s.plan})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[o.length," / ",s.maxCards]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1 mt-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${Math.min(o.length/s.maxCards*100,100)}%`}})})]})}),e.jsx("td",{className:"p-4",children:n?e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{type:"email",value:q.email,onChange:r=>re({...q,email:r.target.value}),placeholder:"Email",className:"light-input text-sm"}),e.jsx("input",{type:"text",value:q.contactNumber,onChange:r=>re({...q,contactNumber:r.target.value}),placeholder:"Phone",className:"light-input text-sm"})]}):e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.email}),e.jsx("div",{className:"text-gray-500",children:s.contactNumber})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:s.isActive?"status-active":"status-inactive",children:s.isActive?"Active":"Inactive"})}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>De(),className:"p-1 text-green-600 hover:text-green-700",title:"Save changes",children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>S(null),className:"p-1 text-gray-600 hover:text-gray-700",title:"Cancel",children:e.jsx(Q,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ee(s),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit clinic",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>We(ve===s.id?null:s.id),className:"p-1 text-amber-600 hover:text-amber-700",title:"Show/Hide Credentials (Emergency Access)",children:ve===s.id?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(ys,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Re(s.id),className:"p-1 text-red-600 hover:text-red-700",title:"Delete clinic",children:e.jsx(ge,{className:"h-4 w-4"})})]})}),ve===s.id&&e.jsxs("div",{className:"mt-3 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ye,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-semibold text-amber-800",children:"Emergency Credentials"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Clinic Code:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-1 rounded border text-gray-900",children:s.code})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Password:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-1 rounded border text-gray-900",children:s.password})]})]}),e.jsxs("div",{className:"mt-3 p-2 bg-amber-100 rounded text-xs text-amber-800",children:["âš ï¸ ",e.jsx("strong",{children:"Emergency Use Only:"})," Only provide these credentials to clinic staff who have forgotten their login details. Keep this information secure."]})]})]})]},s.id)})})]})})]}),b==="debug"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ce,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Database Debugger"})]}),e.jsx("p",{className:"text-gray-600",children:"Use this tool to analyze the database and troubleshoot card lookup issues."}),e.jsx(Ds,{})]}),b==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Admin Settings"}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change your admin password for security"})]}),e.jsx("button",{onClick:()=>C(!T),className:"light-button-primary",children:"Change Password"})]}),T&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("form",{onSubmit:Ye,className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:D.currentPassword,onChange:s=>X({...D,currentPassword:s.target.value}),className:"light-input",placeholder:"Enter current password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:D.newPassword,onChange:s=>X({...D,newPassword:s.target.value}),className:"light-input",placeholder:"Enter new password (min 8 characters)",minLength:8,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:D.confirmPassword,onChange:s=>X({...D,confirmPassword:s.target.value}),className:"light-input",placeholder:"Confirm new password",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:"Update Password"}),e.jsx("button",{type:"button",onClick:()=>{C(!1),X({currentPassword:"",newPassword:"",confirmPassword:""})},className:"light-button-secondary",children:"Cancel"})]})]})})]})}),e.jsx("div",{className:"light-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Version:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"MOCARDS v3.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Environment:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Production"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Login:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:new Date().toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Admin Username:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:Z.username})]})]})]})})]})]})}),i.showModal&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:i.editingPerk?"Edit Perk":"Create New Perk"}),e.jsx("button",{onClick:()=>h({...i,showModal:!1}),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Ke()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("select",{value:i.form.type,onChange:s=>h({...i,form:{...i.form,type:s.target.value}}),className:"light-select",children:es.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:i.form.name,onChange:s=>h({...i,form:{...i.form,name:s.target.value}}),className:"light-input",placeholder:"e.g., Free Dental Cleaning",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:i.form.description,onChange:s=>h({...i,form:{...i.form,description:s.target.value}}),className:"light-input",placeholder:"Describe this perk...",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value (â‚± PHP)"}),e.jsx("input",{type:"number",min:"0",max:"10000",value:i.form.value,onChange:s=>h({...i,form:{...i.form,value:parseInt(s.target.value)||0}}),className:"light-input",placeholder:"800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Days"}),e.jsx("input",{type:"number",min:"1",value:i.form.validFor,onChange:s=>h({...i,form:{...i.form,validFor:parseInt(s.target.value)||365}}),className:"light-input",placeholder:"365"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.form.isActive,onChange:s=>h({...i,form:{...i.form,isActive:s.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.form.requiresApproval,onChange:s=>h({...i,form:{...i.form,requiresApproval:s.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requires Approval"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",className:"light-button-primary",children:i.editingPerk?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>h({...i,showModal:!1}),className:"light-button-secondary",children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Existing Perks"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:ze.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded ${s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>Qe(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Ze(s),className:"text-red-600 hover:text-red-800",children:e.jsx(ge,{className:"h-4 w-4"})})]})]},s.id))})]})]})})]})}export{$s as AdminPortalView};
